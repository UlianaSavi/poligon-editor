(self.webpackChunkpoligon_editor=self.webpackChunkpoligon_editor||[]).push([[179],{357:function(kf){kf.exports=function(){"use strict";var hl=function(P,V){var te={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},ce={on:function(we,Te,Le){if(void 0===te[we])throw new Error("Invalid event type: "+we);te[we].push({selector:Te,fn:Le})},render:function(we){V.store.featureChanged(we)}},xe=function(we,Te){for(var Le=te[we],nt=Le.length;nt--;){var jt=Le[nt];if(jt.selector(Te)){jt.fn.call(ce,Te)||V.store.render(),V.ui.updateMapClasses();break}}};return P.start.call(ce),{render:P.render,stop:function(){P.stop&&P.stop()},trash:function(){P.trash&&(P.trash(),V.store.render())},combineFeatures:function(){P.combineFeatures&&P.combineFeatures()},uncombineFeatures:function(){P.uncombineFeatures&&P.uncombineFeatures()},drag:function(we){xe("drag",we)},click:function(we){xe("click",we)},mousemove:function(we){xe("mousemove",we)},mousedown:function(we){xe("mousedown",we)},mouseup:function(we){xe("mouseup",we)},mouseout:function(we){xe("mouseout",we)},keydown:function(we){xe("keydown",we)},keyup:function(we){xe("keyup",we)},touchstart:function(we){xe("touchstart",we)},touchmove:function(we){xe("touchmove",we)},touchend:function(we){xe("touchend",we)},tap:function(we){xe("tap",we)}}};function es(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}var mc={},f={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function en(P){var V=0;if(P&&P.length>0){V+=Math.abs(ts(P[0]));for(var te=1;te<P.length;te++)V-=Math.abs(ts(P[te]))}return V}function ts(P){var V,te,ce,xe,we,Te,Le=0,nt=P.length;if(nt>2){for(Te=0;Te<nt;Te++)Te===nt-2?(ce=nt-2,xe=nt-1,we=0):Te===nt-1?(ce=nt-1,xe=0,we=1):(ce=Te,xe=Te+1,we=Te+2),V=P[ce],te=P[xe],Le+=(vn(P[we][0])-vn(V[0]))*Math.sin(vn(te[1]));Le=Le*f.RADIUS*f.RADIUS/2}return Le}function vn(P){return P*Math.PI/180}mc.geometry=function P(V){var te,ce=0;switch(V.type){case"Polygon":return en(V.coordinates);case"MultiPolygon":for(te=0;te<V.coordinates.length;te++)ce+=en(V.coordinates[te]);return ce;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(te=0;te<V.geometries.length;te++)ce+=P(V.geometries[te]);return ce}},mc.ring=ts;var bi={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},hn={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Un={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},ti={POLYGON:"polygon",LINE:"line_string",POINT:"point"},on={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Ln={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},io={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Ba={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},yr={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Cr={ACTIVE:"true",INACTIVE:"false"},go=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],sa=-85,aa=Object.freeze({__proto__:null,classes:bi,sources:hn,cursors:Un,types:ti,geojsonTypes:on,modes:Ln,events:io,updateActions:Ba,meta:yr,activeStates:Cr,interactions:go,LAT_MIN:-90,LAT_RENDERED_MIN:sa,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ns={Point:0,LineString:1,MultiLineString:1,Polygon:2};function ut(P,V){var te=ns[P.geometry.type]-ns[V.geometry.type];return 0===te&&P.geometry.type===on.POLYGON?P.area-V.area:te}function su(P){return P.map(function(V){return V.geometry.type===on.POLYGON&&(V.area=mc.geometry({type:on.FEATURE,property:{},geometry:V.geometry})),V}).sort(ut).map(function(V){return delete V.area,V})}function Ns(P,V){return void 0===V&&(V=0),[[P.point.x-V,P.point.y-V],[P.point.x+V,P.point.y+V]]}function wt(P){if(this._items={},this._nums={},this._length=P?P.length:0,P)for(var V=0,te=P.length;V<te;V++)this.add(P[V]),void 0!==P[V]&&("string"==typeof P[V]?this._items[P[V]]=V:this._nums[P[V]]=V)}wt.prototype.add=function(P){return this.has(P)||(this._length++,"string"==typeof P?this._items[P]=this._length:this._nums[P]=this._length),this},wt.prototype.delete=function(P){return!1===this.has(P)||(this._length--,delete this._items[P],delete this._nums[P]),this},wt.prototype.has=function(P){return!("string"!=typeof P&&"number"!=typeof P||void 0===this._items[P]&&void 0===this._nums[P])},wt.prototype.values=function(){var P=this,V=[];return Object.keys(this._items).forEach(function(te){V.push({k:te,v:P._items[te]})}),Object.keys(this._nums).forEach(function(te){V.push({k:JSON.parse(te),v:P._nums[te]})}),V.sort(function(te,ce){return te.v-ce.v}).map(function(te){return te.k})},wt.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Yi=[yr.FEATURE,yr.MIDPOINT,yr.VERTEX],zs={click:function(P,V,te){return gc(P,V,te,te.options.clickBuffer)},touch:function(P,V,te){return gc(P,V,te,te.options.touchBuffer)}};function gc(P,V,te,ce){if(null===te.map)return[];var xe=P?Ns(P,ce):V,we={};te.options.styles&&(we.layers=te.options.styles.map(function(jt){return jt.id}).filter(function(jt){return null!=te.map.getLayer(jt)}));var Te=te.map.queryRenderedFeatures(xe,we).filter(function(jt){return-1!==Yi.indexOf(jt.properties.meta)}),Le=new wt,nt=[];return Te.forEach(function(jt){var zt=jt.properties.id;Le.has(zt)||(Le.add(zt),nt.push(jt))}),su(nt)}function la(P,V){var te=zs.click(P,null,V),ce={mouse:Un.NONE};return te[0]&&(ce.mouse=te[0].properties.active===Cr.ACTIVE?Un.MOVE:Un.POINTER,ce.feature=te[0].properties.meta),-1!==V.events.currentModeName().indexOf("draw")&&(ce.mouse=Un.ADD),V.ui.queueMapClasses(ce),V.ui.updateMapClasses(),te[0]}function rs(P,V){var te=P.x-V.x,ce=P.y-V.y;return Math.sqrt(te*te+ce*ce)}function dn(P,V,te){void 0===te&&(te={});var ce=null!=te.fineTolerance?te.fineTolerance:4,xe=null!=te.grossTolerance?te.grossTolerance:12,we=null!=te.interval?te.interval:500;P.point=P.point||V.point,P.time=P.time||V.time;var Te=rs(P.point,V.point);return Te<ce||Te<xe&&V.time-P.time<we}function Bs(P,V,te){void 0===te&&(te={});var ce=null!=te.tolerance?te.tolerance:25,xe=null!=te.interval?te.interval:250;return P.point=P.point||V.point,P.time=P.time||V.time,rs(P.point,V.point)<ce&&V.time-P.time<xe}var fr={exports:{}},uo=fr.exports=function(P,V){if(V||(V=16),void 0===P&&(P=128),P<=0)return"0";for(var te=Math.log(Math.pow(2,P))/Math.log(V),ce=2;te===1/0;ce*=2)te=Math.log(Math.pow(2,P/ce))/Math.log(V)*ce;var xe=te-Math.floor(te),we="";for(ce=0;ce<Math.floor(te);ce++)we=Math.floor(Math.random()*V).toString(V)+we;if(xe){var Te=Math.pow(V,xe);we=Math.floor(Math.random()*Te).toString(V)+we}var Le=parseInt(we,V);return Le!==1/0&&Le>=Math.pow(2,P)?uo(P,V):we};uo.rack=function(P,V,te){var ce=function(we){var Te=0;do{if(Te++>10){if(!te)throw new Error("too many ID collisions, use more bits");P+=te}var Le=uo(P,V)}while(Object.hasOwnProperty.call(xe,Le));return xe[Le]=we,Le},xe=ce.hats={};return ce.get=function(we){return ce.hats[we]},ce.set=function(we,Te){return ce.hats[we]=Te,ce},ce.bits=P||128,ce.base=V||16,ce};var ca=es(fr.exports),mr=function(P,V){this.ctx=P,this.properties=V.properties||{},this.coordinates=V.geometry.coordinates,this.id=V.id||ca(),this.type=V.geometry.type};mr.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},mr.prototype.incomingCoords=function(P){this.setCoordinates(P)},mr.prototype.setCoordinates=function(P){this.coordinates=P,this.changed()},mr.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},mr.prototype.setProperty=function(P,V){this.properties[P]=V},mr.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:on.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},mr.prototype.internal=function(P){var V={id:this.id,meta:yr.FEATURE,"meta:type":this.type,active:Cr.INACTIVE,mode:P};if(this.ctx.options.userProperties)for(var te in this.properties)V["user_"+te]=this.properties[te];return{type:on.FEATURE,properties:V,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Vs=function(P,V){mr.call(this,P,V)};(Vs.prototype=Object.create(mr.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},Vs.prototype.updateCoordinate=function(P,V,te){this.coordinates=3===arguments.length?[V,te]:[P,V],this.changed()},Vs.prototype.getCoordinate=function(){return this.getCoordinates()};var ci=function(P,V){mr.call(this,P,V)};(ci.prototype=Object.create(mr.prototype)).isValid=function(){return this.coordinates.length>1},ci.prototype.addCoordinate=function(P,V,te){this.changed();var ce=parseInt(P,10);this.coordinates.splice(ce,0,[V,te])},ci.prototype.getCoordinate=function(P){var V=parseInt(P,10);return JSON.parse(JSON.stringify(this.coordinates[V]))},ci.prototype.removeCoordinate=function(P){this.changed(),this.coordinates.splice(parseInt(P,10),1)},ci.prototype.updateCoordinate=function(P,V,te){var ce=parseInt(P,10);this.coordinates[ce]=[V,te],this.changed()};var Ui=function(P,V){mr.call(this,P,V),this.coordinates=this.coordinates.map(function(te){return te.slice(0,-1)})};(Ui.prototype=Object.create(mr.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(P){return P.length>2})},Ui.prototype.incomingCoords=function(P){this.coordinates=P.map(function(V){return V.slice(0,-1)}),this.changed()},Ui.prototype.setCoordinates=function(P){this.coordinates=P,this.changed()},Ui.prototype.addCoordinate=function(P,V,te){this.changed();var ce=P.split(".").map(function(xe){return parseInt(xe,10)});this.coordinates[ce[0]].splice(ce[1],0,[V,te])},Ui.prototype.removeCoordinate=function(P){this.changed();var V=P.split(".").map(function(ce){return parseInt(ce,10)}),te=this.coordinates[V[0]];te&&(te.splice(V[1],1),te.length<3&&this.coordinates.splice(V[0],1))},Ui.prototype.getCoordinate=function(P){var V=P.split(".").map(function(ce){return parseInt(ce,10)});return JSON.parse(JSON.stringify(this.coordinates[V[0]][V[1]]))},Ui.prototype.getCoordinates=function(){return this.coordinates.map(function(P){return P.concat([P[0]])})},Ui.prototype.updateCoordinate=function(P,V,te){this.changed();var ce=P.split("."),xe=parseInt(ce[0],10),we=parseInt(ce[1],10);void 0===this.coordinates[xe]&&(this.coordinates[xe]=[]),this.coordinates[xe][we]=[V,te]};var Va={MultiPoint:Vs,MultiLineString:ci,MultiPolygon:Ui},ni=function(P,V,te,ce,xe){var we=te.split("."),Te=parseInt(we[0],10),Le=we[1]?we.slice(1).join("."):null;return P[Te][V](Le,ce,xe)},er=function(P,V){if(mr.call(this,P,V),delete this.coordinates,this.model=Va[V.geometry.type],void 0===this.model)throw new TypeError(V.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(V.geometry.coordinates)};function kn(P){this.map=P.map,this.drawConfig=JSON.parse(JSON.stringify(P.options||{})),this._ctx=P}(er.prototype=Object.create(mr.prototype))._coordinatesToFeatures=function(P){var V=this,te=this.model.bind(this);return P.map(function(ce){return new te(V.ctx,{id:ca(),type:on.FEATURE,properties:{},geometry:{coordinates:ce,type:V.type.replace("Multi","")}})})},er.prototype.isValid=function(){return this.features.every(function(P){return P.isValid()})},er.prototype.setCoordinates=function(P){this.features=this._coordinatesToFeatures(P),this.changed()},er.prototype.getCoordinate=function(P){return ni(this.features,"getCoordinate",P)},er.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(P){return P.type===on.POLYGON?P.getCoordinates():P.coordinates})))},er.prototype.updateCoordinate=function(P,V,te){ni(this.features,"updateCoordinate",P,V,te),this.changed()},er.prototype.addCoordinate=function(P,V,te){ni(this.features,"addCoordinate",P,V,te),this.changed()},er.prototype.removeCoordinate=function(P){ni(this.features,"removeCoordinate",P),this.changed()},er.prototype.getFeatures=function(){return this.features},kn.prototype.setSelected=function(P){return this._ctx.store.setSelected(P)},kn.prototype.setSelectedCoordinates=function(P){var V=this;this._ctx.store.setSelectedCoordinates(P),P.reduce(function(te,ce){return void 0===te[ce.feature_id]&&(te[ce.feature_id]=!0,V._ctx.store.get(ce.feature_id).changed()),te},{})},kn.prototype.getSelected=function(){return this._ctx.store.getSelected()},kn.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},kn.prototype.isSelected=function(P){return this._ctx.store.isSelected(P)},kn.prototype.getFeature=function(P){return this._ctx.store.get(P)},kn.prototype.select=function(P){return this._ctx.store.select(P)},kn.prototype.deselect=function(P){return this._ctx.store.deselect(P)},kn.prototype.deleteFeature=function(P,V){return void 0===V&&(V={}),this._ctx.store.delete(P,V)},kn.prototype.addFeature=function(P){return this._ctx.store.add(P)},kn.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},kn.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},kn.prototype.setActionableState=function(P){return void 0===P&&(P={}),this._ctx.events.actionable({trash:P.trash||!1,combineFeatures:P.combineFeatures||!1,uncombineFeatures:P.uncombineFeatures||!1})},kn.prototype.changeMode=function(P,V,te){return void 0===V&&(V={}),void 0===te&&(te={}),this._ctx.events.changeMode(P,V,te)},kn.prototype.updateUIClasses=function(P){return this._ctx.ui.queueMapClasses(P)},kn.prototype.activateUIButton=function(P){return this._ctx.ui.setActiveButton(P)},kn.prototype.featuresAt=function(P,V,te){if(void 0===te&&(te="click"),"click"!==te&&"touch"!==te)throw new Error("invalid buffer type");return zs[te](P,V,this._ctx)},kn.prototype.newFeature=function(P){var V=P.geometry.type;return V===on.POINT?new Vs(this._ctx,P):V===on.LINE_STRING?new ci(this._ctx,P):V===on.POLYGON?new Ui(this._ctx,P):new er(this._ctx,P)},kn.prototype.isInstanceOf=function(P,V){if(P===on.POINT)return V instanceof Vs;if(P===on.LINE_STRING)return V instanceof ci;if(P===on.POLYGON)return V instanceof Ui;if("MultiFeature"===P)return V instanceof er;throw new Error("Unknown feature class: "+P)},kn.prototype.doRender=function(P){return this._ctx.store.featureChanged(P)},kn.prototype.onSetup=function(){},kn.prototype.onDrag=function(){},kn.prototype.onClick=function(){},kn.prototype.onMouseMove=function(){},kn.prototype.onMouseDown=function(){},kn.prototype.onMouseUp=function(){},kn.prototype.onMouseOut=function(){},kn.prototype.onKeyUp=function(){},kn.prototype.onKeyDown=function(){},kn.prototype.onTouchStart=function(){},kn.prototype.onTouchMove=function(){},kn.prototype.onTouchEnd=function(){},kn.prototype.onTap=function(){},kn.prototype.onStop=function(){},kn.prototype.onTrash=function(){},kn.prototype.onCombineFeature=function(){},kn.prototype.onUncombineFeature=function(){},kn.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var _r={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},$l=Object.keys(_r);function js(P){return[].concat(P).filter(function(V){return void 0!==V})}function Rr(){var P=this;if(!P.ctx.map||void 0===P.ctx.map.getSource(hn.HOT))return nt();var V=P.ctx.events.currentModeName();P.ctx.ui.queueMapClasses({mode:V});var te=[],ce=[];P.isDirty?ce=P.getAllIds():(te=P.getChangedIds().filter(function(jt){return void 0!==P.get(jt)}),ce=P.sources.hot.filter(function(jt){return jt.properties.id&&-1===te.indexOf(jt.properties.id)&&void 0!==P.get(jt.properties.id)}).map(function(jt){return jt.properties.id})),P.sources.hot=[];var xe=P.sources.cold.length;P.sources.cold=P.isDirty?[]:P.sources.cold.filter(function(jt){return-1===te.indexOf(jt.properties.id||jt.properties.parent)});var we=xe!==P.sources.cold.length||ce.length>0;function Te(jt,zt){var Rt=P.get(jt).internal(V);P.ctx.events.currentModeRender(Rt,function($e){P.sources[zt].push($e)})}if(te.forEach(function(jt){return Te(jt,"hot")}),ce.forEach(function(jt){return Te(jt,"cold")}),we&&P.ctx.map.getSource(hn.COLD).setData({type:on.FEATURE_COLLECTION,features:P.sources.cold}),P.ctx.map.getSource(hn.HOT).setData({type:on.FEATURE_COLLECTION,features:P.sources.hot}),P._emitSelectionChange&&(P.ctx.map.fire(io.SELECTION_CHANGE,{features:P.getSelected().map(function(jt){return jt.toGeoJSON()}),points:P.getSelectedCoordinates().map(function(jt){return{type:on.FEATURE,properties:{},geometry:{type:on.POINT,coordinates:jt.coordinates}}})}),P._emitSelectionChange=!1),P._deletedFeaturesToEmit.length){var Le=P._deletedFeaturesToEmit.map(function(jt){return jt.toGeoJSON()});P._deletedFeaturesToEmit=[],P.ctx.map.fire(io.DELETE,{features:Le})}function nt(){P.isDirty=!1,P.clearChangedIds()}nt(),P.ctx.map.fire(io.RENDER,{})}function qe(P){var V,te=this;this._features={},this._featureIds=new wt,this._selectedFeatureIds=new wt,this._selectedCoordinates=[],this._changedFeatureIds=new wt,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=P,this.sources={hot:[],cold:[]},this.render=function(){V||(V=requestAnimationFrame(function(){V=null,Rr.call(te)}))},this.isDirty=!1}function le(P,V){var te=P._selectedCoordinates.filter(function(ce){return P._selectedFeatureIds.has(ce.feature_id)});P._selectedCoordinates.length===te.length||V.silent||(P._emitSelectionChange=!0),P._selectedCoordinates=te}qe.prototype.createRenderBatch=function(){var P=this,V=this.render,te=0;return this.render=function(){te++},function(){P.render=V,te>0&&P.render()}},qe.prototype.setDirty=function(){return this.isDirty=!0,this},qe.prototype.featureChanged=function(P){return this._changedFeatureIds.add(P),this},qe.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},qe.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},qe.prototype.getAllIds=function(){return this._featureIds.values()},qe.prototype.add=function(P){return this.featureChanged(P.id),this._features[P.id]=P,this._featureIds.add(P.id),this},qe.prototype.delete=function(P,V){var te=this;return void 0===V&&(V={}),js(P).forEach(function(ce){te._featureIds.has(ce)&&(te._featureIds.delete(ce),te._selectedFeatureIds.delete(ce),V.silent||-1===te._deletedFeaturesToEmit.indexOf(te._features[ce])&&te._deletedFeaturesToEmit.push(te._features[ce]),delete te._features[ce],te.isDirty=!0)}),le(this,V),this},qe.prototype.get=function(P){return this._features[P]},qe.prototype.getAll=function(){var P=this;return Object.keys(this._features).map(function(V){return P._features[V]})},qe.prototype.select=function(P,V){var te=this;return void 0===V&&(V={}),js(P).forEach(function(ce){te._selectedFeatureIds.has(ce)||(te._selectedFeatureIds.add(ce),te._changedFeatureIds.add(ce),V.silent||(te._emitSelectionChange=!0))}),this},qe.prototype.deselect=function(P,V){var te=this;return void 0===V&&(V={}),js(P).forEach(function(ce){te._selectedFeatureIds.has(ce)&&(te._selectedFeatureIds.delete(ce),te._changedFeatureIds.add(ce),V.silent||(te._emitSelectionChange=!0))}),le(this,V),this},qe.prototype.clearSelected=function(P){return void 0===P&&(P={}),this.deselect(this._selectedFeatureIds.values(),{silent:P.silent}),this},qe.prototype.setSelected=function(P,V){var te=this;return void 0===V&&(V={}),P=js(P),this.deselect(this._selectedFeatureIds.values().filter(function(ce){return-1===P.indexOf(ce)}),{silent:V.silent}),this.select(P.filter(function(ce){return!te._selectedFeatureIds.has(ce)}),{silent:V.silent}),this},qe.prototype.setSelectedCoordinates=function(P){return this._selectedCoordinates=P,this._emitSelectionChange=!0,this},qe.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},qe.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},qe.prototype.getSelected=function(){var P=this;return this._selectedFeatureIds.values().map(function(V){return P.get(V)})},qe.prototype.getSelectedCoordinates=function(){var P=this;return this._selectedCoordinates.map(function(V){return{coordinates:P.get(V.feature_id).getCoordinate(V.coord_path)}})},qe.prototype.isSelected=function(P){return this._selectedFeatureIds.has(P)},qe.prototype.setFeatureProperty=function(P,V,te){this.get(P).setProperty(V,te),this.featureChanged(P)},qe.prototype.storeMapConfig=function(){var P=this;go.forEach(function(V){P.ctx.map[V]&&(P._mapInitialConfig[V]=P.ctx.map[V].isEnabled())})},qe.prototype.restoreMapConfig=function(){var P=this;Object.keys(this._mapInitialConfig).forEach(function(V){P._mapInitialConfig[V]?P.ctx.map[V].enable():P.ctx.map[V].disable()})},qe.prototype.getInitialConfigValue=function(P){return void 0===this._mapInitialConfig[P]||this._mapInitialConfig[P]};var Ce=Object.prototype.hasOwnProperty,Ye=es(function(){for(var P=arguments,V={},te=0;te<arguments.length;te++){var ce=P[te];for(var xe in ce)Ce.call(ce,xe)&&(V[xe]=ce[xe])}return V}),Ke=["mode","feature","mouse"];function Ct(P){var V=null,te=null,ce={onRemove:function(){return P.map.off("load",ce.connect),clearInterval(te),ce.removeLayers(),P.store.restoreMapConfig(),P.ui.removeButtons(),P.events.removeEventListeners(),P.ui.clearMapClasses(),P.boxZoomInitial&&P.map.boxZoom.enable(),P.map=null,P.container=null,P.store=null,V&&V.parentNode&&V.parentNode.removeChild(V),V=null,this},connect:function(){P.map.off("load",ce.connect),clearInterval(te),ce.addLayers(),P.store.storeMapConfig(),P.events.addEventListeners()},onAdd:function(xe){var we=xe.fire;return xe.fire=function(Te,Le){var nt=arguments;return 1===we.length&&1!==arguments.length&&(nt=[Ye({},{type:Te},Le)]),we.apply(xe,nt)},P.map=xe,P.events=function(Te){var Le=Object.keys(Te.options.modes).reduce(function(ft,rn){return ft[rn]=function _s(P){var V=Object.keys(P);return function(te,ce){void 0===ce&&(ce={});var xe={},we=V.reduce(function(Te,Le){return Te[Le]=P[Le],Te},new kn(te));return{start:function(){var Te=this;xe=we.onSetup(ce),$l.forEach(function(Le){var nt,jt=_r[Le],zt=function(){return!1};P[jt]&&(zt=function(){return!0}),Te.on(Le,zt,(nt=jt,function(Rt){return we[nt](xe,Rt)}))})},stop:function(){we.onStop(xe)},trash:function(){we.onTrash(xe)},combineFeatures:function(){we.onCombineFeatures(xe)},uncombineFeatures:function(){we.onUncombineFeatures(xe)},render:function(Te,Le){we.toDisplayFeatures(xe,Te,Le)}}}}(Te.options.modes[rn]),ft},{}),nt={},jt={},zt={},Rt=null,$e=null;zt.drag=function(ft,rn){rn({point:ft.point,time:(new Date).getTime()})?(Te.ui.queueMapClasses({mouse:Un.DRAG}),$e.drag(ft)):ft.originalEvent.stopPropagation()},zt.mousedrag=function(ft){zt.drag(ft,function(rn){return!dn(nt,rn)})},zt.touchdrag=function(ft){zt.drag(ft,function(rn){return!Bs(jt,rn)})},zt.mousemove=function(ft){if(1===(void 0!==ft.originalEvent.buttons?ft.originalEvent.buttons:ft.originalEvent.which))return zt.mousedrag(ft);var rn=la(ft,Te);ft.featureTarget=rn,$e.mousemove(ft)},zt.mousedown=function(ft){nt={time:(new Date).getTime(),point:ft.point};var rn=la(ft,Te);ft.featureTarget=rn,$e.mousedown(ft)},zt.mouseup=function(ft){var rn=la(ft,Te);ft.featureTarget=rn,dn(nt,{point:ft.point,time:(new Date).getTime()})?$e.click(ft):$e.mouseup(ft)},zt.mouseout=function(ft){$e.mouseout(ft)},zt.touchstart=function(ft){if(Te.options.touchEnabled){jt={time:(new Date).getTime(),point:ft.point};var rn=zs.touch(ft,null,Te)[0];ft.featureTarget=rn,$e.touchstart(ft)}},zt.touchmove=function(ft){if(Te.options.touchEnabled)return $e.touchmove(ft),zt.touchdrag(ft)},zt.touchend=function(ft){if(ft.originalEvent.preventDefault(),Te.options.touchEnabled){var rn=zs.touch(ft,null,Te)[0];ft.featureTarget=rn,Bs(jt,{time:(new Date).getTime(),point:ft.point})?$e.tap(ft):$e.touchend(ft)}};var Tr=function(ft){return!(8===ft||46===ft||ft>=48&&ft<=57)};function Mt(ft,rn,xr){void 0===xr&&(xr={}),$e.stop();var pr=Le[ft];if(void 0===pr)throw new Error(ft+" is not valid");Rt=ft;var un=pr(Te,rn);$e=hl(un,Te),xr.silent||Te.map.fire(io.MODE_CHANGE,{mode:ft}),Te.store.setDirty(),Te.store.render()}zt.keydown=function(ft){(ft.srcElement||ft.target).classList.contains("mapboxgl-canvas")&&(8!==ft.keyCode&&46!==ft.keyCode||!Te.options.controls.trash?Tr(ft.keyCode)?$e.keydown(ft):49===ft.keyCode&&Te.options.controls.point?Mt(Ln.DRAW_POINT):50===ft.keyCode&&Te.options.controls.line_string?Mt(Ln.DRAW_LINE_STRING):51===ft.keyCode&&Te.options.controls.polygon&&Mt(Ln.DRAW_POLYGON):(ft.preventDefault(),$e.trash()))},zt.keyup=function(ft){Tr(ft.keyCode)&&$e.keyup(ft)},zt.zoomend=function(){Te.store.changeZoom()},zt.data=function(ft){if("style"===ft.dataType){var rn=Te.setup,xr=Te.map,un=Te.store;Te.options.styles.some(function(au){return xr.getLayer(au.id)})||(rn.addLayers(),un.setDirty(),un.render())}};var _n={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){$e=hl(Le[Rt=Te.options.defaultMode](Te),Te)},changeMode:Mt,actionable:function(ft){var rn=!1;Object.keys(ft).forEach(function(xr){if(void 0===_n[xr])throw new Error("Invalid action type");_n[xr]!==ft[xr]&&(rn=!0),_n[xr]=ft[xr]}),rn&&Te.map.fire(io.ACTIONABLE,{actions:_n})},currentModeName:function(){return Rt},currentModeRender:function(ft,rn){return $e.render(ft,rn)},fire:function(ft,rn){zt[ft]&&zt[ft](rn)},addEventListeners:function(){Te.map.on("mousemove",zt.mousemove),Te.map.on("mousedown",zt.mousedown),Te.map.on("mouseup",zt.mouseup),Te.map.on("data",zt.data),Te.map.on("touchmove",zt.touchmove),Te.map.on("touchstart",zt.touchstart),Te.map.on("touchend",zt.touchend),Te.container.addEventListener("mouseout",zt.mouseout),Te.options.keybindings&&(Te.container.addEventListener("keydown",zt.keydown),Te.container.addEventListener("keyup",zt.keyup))},removeEventListeners:function(){Te.map.off("mousemove",zt.mousemove),Te.map.off("mousedown",zt.mousedown),Te.map.off("mouseup",zt.mouseup),Te.map.off("data",zt.data),Te.map.off("touchmove",zt.touchmove),Te.map.off("touchstart",zt.touchstart),Te.map.off("touchend",zt.touchend),Te.container.removeEventListener("mouseout",zt.mouseout),Te.options.keybindings&&(Te.container.removeEventListener("keydown",zt.keydown),Te.container.removeEventListener("keyup",zt.keyup))},trash:function(ft){$e.trash(ft)},combineFeatures:function(){$e.combineFeatures()},uncombineFeatures:function(){$e.uncombineFeatures()},getMode:function(){return Rt}}}(P),P.ui=function(Te){var Le={},nt=null,jt={mode:null,feature:null,mouse:null},zt={mode:null,feature:null,mouse:null};function Rt(ft){zt=Ye(zt,ft)}function $e(){var ft,rn;if(Te.container){var xr=[],pr=[];Ke.forEach(function(un){zt[un]!==jt[un]&&(xr.push(un+"-"+jt[un]),null!==zt[un]&&pr.push(un+"-"+zt[un]))}),xr.length>0&&(ft=Te.container.classList).remove.apply(ft,xr),pr.length>0&&(rn=Te.container.classList).add.apply(rn,pr),jt=Ye(jt,zt)}}function Tr(ft,rn){void 0===rn&&(rn={});var xr=document.createElement("button");return xr.className=bi.CONTROL_BUTTON+" "+rn.className,xr.setAttribute("title",rn.title),rn.container.appendChild(xr),xr.addEventListener("click",function(pr){if(pr.preventDefault(),pr.stopPropagation(),pr.target===nt)return Mt(),void rn.onDeactivate();_n(ft),rn.onActivate()},!0),xr}function Mt(){nt&&(nt.classList.remove(bi.ACTIVE_BUTTON),nt=null)}function _n(ft){Mt();var rn=Le[ft];rn&&rn&&"trash"!==ft&&(rn.classList.add(bi.ACTIVE_BUTTON),nt=rn)}return{setActiveButton:_n,queueMapClasses:Rt,updateMapClasses:$e,clearMapClasses:function(){Rt({mode:null,feature:null,mouse:null}),$e()},addButtons:function(){var ft=Te.options.controls,rn=document.createElement("div");return rn.className=bi.CONTROL_GROUP+" "+bi.CONTROL_BASE,ft&&(ft[ti.LINE]&&(Le[ti.LINE]=Tr(ti.LINE,{container:rn,className:bi.CONTROL_BUTTON_LINE,title:"LineString tool "+(Te.options.keybindings?"(l)":""),onActivate:function(){return Te.events.changeMode(Ln.DRAW_LINE_STRING)},onDeactivate:function(){return Te.events.trash()}})),ft[ti.POLYGON]&&(Le[ti.POLYGON]=Tr(ti.POLYGON,{container:rn,className:bi.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Te.options.keybindings?"(p)":""),onActivate:function(){return Te.events.changeMode(Ln.DRAW_POLYGON)},onDeactivate:function(){return Te.events.trash()}})),ft[ti.POINT]&&(Le[ti.POINT]=Tr(ti.POINT,{container:rn,className:bi.CONTROL_BUTTON_POINT,title:"Marker tool "+(Te.options.keybindings?"(m)":""),onActivate:function(){return Te.events.changeMode(Ln.DRAW_POINT)},onDeactivate:function(){return Te.events.trash()}})),ft.trash&&(Le.trash=Tr("trash",{container:rn,className:bi.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Te.events.trash()}})),ft.combine_features&&(Le.combine_features=Tr("combineFeatures",{container:rn,className:bi.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Te.events.combineFeatures()}})),ft.uncombine_features&&(Le.uncombine_features=Tr("uncombineFeatures",{container:rn,className:bi.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Te.events.uncombineFeatures()}}))),rn},removeButtons:function(){Object.keys(Le).forEach(function(ft){var rn=Le[ft];rn.parentNode&&rn.parentNode.removeChild(rn),delete Le[ft]})}}}(P),P.container=xe.getContainer(),P.store=new qe(P),V=P.ui.addButtons(),P.options.boxSelect&&(P.boxZoomInitial=xe.boxZoom.isEnabled(),xe.boxZoom.disable(),xe.dragPan.disable(),xe.dragPan.enable()),xe.loaded()?ce.connect():(xe.on("load",ce.connect),te=setInterval(function(){xe.loaded()&&ce.connect()},16)),P.events.start(),V},addLayers:function(){P.map.addSource(hn.COLD,{data:{type:on.FEATURE_COLLECTION,features:[]},type:"geojson"}),P.map.addSource(hn.HOT,{data:{type:on.FEATURE_COLLECTION,features:[]},type:"geojson"}),P.options.styles.forEach(function(xe){P.map.addLayer(xe)}),P.store.setDirty(!0),P.store.render()},removeLayers:function(){P.options.styles.forEach(function(xe){P.map.getLayer(xe.id)&&P.map.removeLayer(xe.id)}),P.map.getSource(hn.COLD)&&P.map.removeSource(hn.COLD),P.map.getSource(hn.HOT)&&P.map.removeSource(hn.HOT)}};return P.setup=ce,ce}var Ot=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Qe(P){return function(V){var te=V.featureTarget;return!!te&&!!te.properties&&te.properties.meta===P}}function $t(P){return!!P.originalEvent&&!!P.originalEvent.shiftKey&&0===P.originalEvent.button}function Kt(P){return!!P.featureTarget&&!!P.featureTarget.properties&&P.featureTarget.properties.active===Cr.ACTIVE&&P.featureTarget.properties.meta===yr.FEATURE}function nn(P){return!!P.featureTarget&&!!P.featureTarget.properties&&P.featureTarget.properties.active===Cr.INACTIVE&&P.featureTarget.properties.meta===yr.FEATURE}function tr(P){return void 0===P.featureTarget}function vr(P){return!!P.featureTarget&&!!P.featureTarget.properties&&P.featureTarget.properties.meta===yr.FEATURE}function qr(P){var V=P.featureTarget;return!!V&&!!V.properties&&V.properties.meta===yr.VERTEX}function gr(P){return!!P.originalEvent&&!0===P.originalEvent.shiftKey}function Jn(P){return 27===P.keyCode}function nr(P){return 13===P.keyCode}var $i=Object.freeze({__proto__:null,isOfMetaType:Qe,isShiftMousedown:$t,isActiveFeature:Kt,isInactiveFeature:nn,noTarget:tr,isFeature:vr,isVertex:qr,isShiftDown:gr,isEscapeKey:Jn,isEnterKey:nr,isTrue:function(){return!0}}),Gi=oo;function oo(P,V){this.x=P,this.y=V}oo.prototype={clone:function(){return new oo(this.x,this.y)},add:function(P){return this.clone()._add(P)},sub:function(P){return this.clone()._sub(P)},multByPoint:function(P){return this.clone()._multByPoint(P)},divByPoint:function(P){return this.clone()._divByPoint(P)},mult:function(P){return this.clone()._mult(P)},div:function(P){return this.clone()._div(P)},rotate:function(P){return this.clone()._rotate(P)},rotateAround:function(P,V){return this.clone()._rotateAround(P,V)},matMult:function(P){return this.clone()._matMult(P)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(P){return this.x===P.x&&this.y===P.y},dist:function(P){return Math.sqrt(this.distSqr(P))},distSqr:function(P){var V=P.x-this.x,te=P.y-this.y;return V*V+te*te},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(P){return Math.atan2(this.y-P.y,this.x-P.x)},angleWith:function(P){return this.angleWithSep(P.x,P.y)},angleWithSep:function(P,V){return Math.atan2(this.x*V-this.y*P,this.x*P+this.y*V)},_matMult:function(P){var te=P[2]*this.x+P[3]*this.y;return this.x=P[0]*this.x+P[1]*this.y,this.y=te,this},_add:function(P){return this.x+=P.x,this.y+=P.y,this},_sub:function(P){return this.x-=P.x,this.y-=P.y,this},_mult:function(P){return this.x*=P,this.y*=P,this},_div:function(P){return this.x/=P,this.y/=P,this},_multByPoint:function(P){return this.x*=P.x,this.y*=P.y,this},_divByPoint:function(P){return this.x/=P.x,this.y/=P.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var P=this.y;return this.y=this.x,this.x=-P,this},_rotate:function(P){var V=Math.cos(P),te=Math.sin(P),xe=te*this.x+V*this.y;return this.x=V*this.x-te*this.y,this.y=xe,this},_rotateAround:function(P,V){var te=Math.cos(P),ce=Math.sin(P),we=V.y+ce*(this.x-V.x)+te*(this.y-V.y);return this.x=V.x+te*(this.x-V.x)-ce*(this.y-V.y),this.y=we,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oo.convert=function(P){return P instanceof oo?P:Array.isArray(P)?new oo(P[0],P[1]):P};var _o=es(Gi);function ys(P,V){var te=V.getBoundingClientRect();return new _o(P.clientX-te.left-(V.clientLeft||0),P.clientY-te.top-(V.clientTop||0))}function di(P,V,te,ce){return{type:on.FEATURE,properties:{meta:yr.VERTEX,parent:P,coord_path:te,active:ce?Cr.ACTIVE:Cr.INACTIVE},geometry:{type:on.POINT,coordinates:V}}}function Us(P,V,te){var ce=V.geometry.coordinates,xe=te.geometry.coordinates;if(ce[1]>85||ce[1]<sa||xe[1]>85||xe[1]<sa)return null;var we={lng:(ce[0]+xe[0])/2,lat:(ce[1]+xe[1])/2};return{type:on.FEATURE,properties:{meta:yr.MIDPOINT,parent:P,lng:we.lng,lat:we.lat,coord_path:te.properties.coord_path},geometry:{type:on.POINT,coordinates:[we.lng,we.lat]}}}function vs(P,V,te){void 0===V&&(V={}),void 0===te&&(te=null);var ce,xe=P.geometry,we=xe.type,Te=xe.coordinates,Le=P.properties&&P.properties.id,nt=[];function jt(Rt,$e){var Tr="",Mt=null;Rt.forEach(function(_n,ft){var rn=null!=$e?$e+"."+ft:String(ft),xr=di(Le,_n,rn,zt(rn));if(V.midpoints&&Mt){var pr=Us(Le,Mt,xr);pr&&nt.push(pr)}Mt=xr;var un=JSON.stringify(_n);Tr!==un&&nt.push(xr),0===ft&&(Tr=un)})}function zt(Rt){return!!V.selectedPaths&&-1!==V.selectedPaths.indexOf(Rt)}return we===on.POINT?nt.push(di(Le,Te,te,zt(te))):we===on.POLYGON?Te.forEach(function(Rt,$e){jt(Rt,null!==te?te+"."+$e:String($e))}):we===on.LINE_STRING?jt(Te,te):0===we.indexOf(on.MULTI_PREFIX)&&(ce=we.replace(on.MULTI_PREFIX,""),Te.forEach(function(Rt,$e){nt=nt.concat(vs({type:on.FEATURE,properties:P.properties,geometry:{type:ce,coordinates:Rt}},V,$e))})),nt}var Or={enable:function(P){setTimeout(function(){P.map&&P.map.doubleClickZoom&&P._ctx&&P._ctx.store&&P._ctx.store.getInitialConfigValue&&P._ctx.store.getInitialConfigValue("doubleClickZoom")&&P.map.doubleClickZoom.enable()},0)},disable:function(P){setTimeout(function(){P.map&&P.map.doubleClickZoom&&P.map.doubleClickZoom.disable()},0)}},Be={exports:{}},Ze=function(P){if(!P||!P.type)return null;var V=it[P.type];return V?"geometry"===V?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:P}]}:"feature"===V?{type:"FeatureCollection",features:[P]}:"featurecollection"===V?P:void 0:null},it={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},lt=es(Ze),ht=Object.freeze({__proto__:null,default:function P(V){switch(V&&V.type||null){case"FeatureCollection":return V.features=V.features.reduce(function(te,ce){return te.concat(P(ce))},[]),V;case"Feature":return V.geometry?P(V.geometry).map(function(te){var ce={type:"Feature",properties:JSON.parse(JSON.stringify(V.properties)),geometry:te};return void 0!==V.id&&(ce.id=V.id),ce}):[V];case"MultiPoint":return V.coordinates.map(function(te){return{type:"Point",coordinates:te}});case"MultiPolygon":return V.coordinates.map(function(te){return{type:"Polygon",coordinates:te}});case"MultiLineString":return V.coordinates.map(function(te){return{type:"LineString",coordinates:te}});case"GeometryCollection":return V.geometries.map(P).reduce(function(te,ce){return te.concat(ce)},[]);case"Point":case"Polygon":case"LineString":return[V]}}}),yt=Ze,gt=function zr(P){if(P.__esModule)return P;var V=P.default;if("function"==typeof V){var te=function ce(){if(this instanceof ce){var xe=[null];return xe.push.apply(xe,arguments),new(Function.bind.apply(V,xe))}return V.apply(this,arguments)};te.prototype=V.prototype}else te={};return Object.defineProperty(te,"__esModule",{value:!0}),Object.keys(P).forEach(function(ce){var xe=Object.getOwnPropertyDescriptor(P,ce);Object.defineProperty(te,ce,xe.get?xe:{enumerable:!0,get:function(){return P[ce]}})}),te}(ht);gt instanceof Function||(gt=gt.default);var Tt={exports:{}},dt=Tt.exports=function(P){return new tn(P)};function tn(P){this.value=P}function Wn(P,V,te){var ce=[],xe=[],we=!0;return function Te(Le){var nt=te?Ut(Le):Le,jt={},zt=!0,Rt={node:nt,node_:Le,path:[].concat(ce),parent:xe[xe.length-1],parents:xe,key:ce.slice(-1)[0],isRoot:0===ce.length,level:ce.length,circular:null,update:function(Mt,_n){Rt.isRoot||(Rt.parent.node[Rt.key]=Mt),Rt.node=Mt,_n&&(zt=!1)},delete:function(Mt){delete Rt.parent.node[Rt.key],Mt&&(zt=!1)},remove:function(Mt){Zr(Rt.parent.node)?Rt.parent.node.splice(Rt.key,1):delete Rt.parent.node[Rt.key],Mt&&(zt=!1)},keys:null,before:function(Mt){jt.before=Mt},after:function(Mt){jt.after=Mt},pre:function(Mt){jt.pre=Mt},post:function(Mt){jt.post=Mt},stop:function(){we=!1},block:function(){zt=!1}};if(!we)return Rt;function $e(){if("object"==typeof Rt.node&&null!==Rt.node){Rt.keys&&Rt.node_===Rt.node||(Rt.keys=Xn(Rt.node)),Rt.isLeaf=0==Rt.keys.length;for(var Mt=0;Mt<xe.length;Mt++)if(xe[Mt].node_===Le){Rt.circular=xe[Mt];break}}else Rt.isLeaf=!0,Rt.keys=null;Rt.notLeaf=!Rt.isLeaf,Rt.notRoot=!Rt.isRoot}$e();var Tr=V.call(Rt,Rt.node);return void 0!==Tr&&Rt.update&&Rt.update(Tr),jt.before&&jt.before.call(Rt,Rt.node),zt&&("object"!=typeof Rt.node||null===Rt.node||Rt.circular||(xe.push(Rt),$e(),Wr(Rt.keys,function(Mt,_n){ce.push(Mt),jt.pre&&jt.pre.call(Rt,Rt.node[Mt],Mt);var ft=Te(Rt.node[Mt]);te&&Li.call(Rt.node,Mt)&&(Rt.node[Mt]=ft.node),ft.isLast=_n==Rt.keys.length-1,ft.isFirst=0==_n,jt.post&&jt.post.call(Rt,ft),ce.pop()}),xe.pop()),jt.after&&jt.after.call(Rt,Rt.node)),Rt}(P).node}function Ut(P){if("object"==typeof P&&null!==P){var V;if(Zr(P))V=[];else if("[object Date]"===Vn(P))V=new Date(P.getTime?P.getTime():P);else if("[object RegExp]"===Vn(P))V=new RegExp(P);else if("[object Error]"===Vn(P))V={message:P.message};else if(function(xe){return"[object Boolean]"===Vn(xe)}(P))V=new Boolean(P);else if(function(xe){return"[object Number]"===Vn(xe)}(P))V=new Number(P);else if(function(xe){return"[object String]"===Vn(xe)}(P))V=new String(P);else if(Object.create&&Object.getPrototypeOf)V=Object.create(Object.getPrototypeOf(P));else if(P.constructor===Object)V={};else{var ce=function(){};ce.prototype=P.constructor&&P.constructor.prototype||P.__proto__||{},V=new ce}return Wr(Xn(P),function(xe){V[xe]=P[xe]}),V}return P}tn.prototype.get=function(P){for(var V=this.value,te=0;te<P.length;te++){var ce=P[te];if(!V||!Li.call(V,ce)){V=void 0;break}V=V[ce]}return V},tn.prototype.has=function(P){for(var V=this.value,te=0;te<P.length;te++){var ce=P[te];if(!V||!Li.call(V,ce))return!1;V=V[ce]}return!0},tn.prototype.set=function(P,V){for(var te=this.value,ce=0;ce<P.length-1;ce++){var xe=P[ce];Li.call(te,xe)||(te[xe]={}),te=te[xe]}return te[P[ce]]=V,V},tn.prototype.map=function(P){return Wn(this.value,P,!0)},tn.prototype.forEach=function(P){return this.value=Wn(this.value,P,!1),this.value},tn.prototype.reduce=function(P,V){var te=1===arguments.length,ce=te?this.value:V;return this.forEach(function(xe){this.isRoot&&te||(ce=P.call(this,ce,xe))}),ce},tn.prototype.paths=function(){var P=[];return this.forEach(function(V){P.push(this.path)}),P},tn.prototype.nodes=function(){var P=[];return this.forEach(function(V){P.push(this.node)}),P},tn.prototype.clone=function(){var P=[],V=[];return function te(ce){for(var xe=0;xe<P.length;xe++)if(P[xe]===ce)return V[xe];if("object"==typeof ce&&null!==ce){var we=Ut(ce);return P.push(ce),V.push(we),Wr(Xn(ce),function(Te){we[Te]=te(ce[Te])}),P.pop(),V.pop(),we}return ce}(this.value)};var Xn=Object.keys||function(P){var V=[];for(var te in P)V.push(te);return V};function Vn(P){return Object.prototype.toString.call(P)}var Zr=Array.isArray||function(P){return"[object Array]"===Object.prototype.toString.call(P)},Wr=function(P,V){if(P.forEach)return P.forEach(V);for(var te=0;te<P.length;te++)V(P[te],te,P)};Wr(Xn(tn.prototype),function(P){dt[P]=function(V){var te=[].slice.call(arguments,1),ce=new tn(V);return ce[P].apply(ce,te)}});var Li=Object.hasOwnProperty||function(P,V){return V in P},Go=Tt.exports,Ho=Br;function Br(P){if(!(this instanceof Br))return new Br(P);this._bbox=P||[1/0,1/0,-1/0,-1/0],this._valid=!!P}Br.prototype.include=function(P){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],P[0]),this._bbox[1]=Math.min(this._bbox[1],P[1]),this._bbox[2]=Math.max(this._bbox[2],P[0]),this._bbox[3]=Math.max(this._bbox[3],P[1]),this},Br.prototype.equals=function(P){var V;return V=P instanceof Br?P.bbox():P,this._bbox[0]==V[0]&&this._bbox[1]==V[1]&&this._bbox[2]==V[2]&&this._bbox[3]==V[3]},Br.prototype.center=function(P){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Br.prototype.union=function(P){var V;return this._valid=!0,V=P instanceof Br?P.bbox():P,this._bbox[0]=Math.min(this._bbox[0],V[0]),this._bbox[1]=Math.min(this._bbox[1],V[1]),this._bbox[2]=Math.max(this._bbox[2],V[2]),this._bbox[3]=Math.max(this._bbox[3],V[3]),this},Br.prototype.bbox=function(){return this._valid?this._bbox:null},Br.prototype.contains=function(P){if(!P)return this._fastContains();if(!this._valid)return null;var V=P[0],te=P[1];return this._bbox[0]<=V&&this._bbox[1]<=te&&this._bbox[2]>=V&&this._bbox[3]>=te},Br.prototype.intersect=function(P){return this._valid?(V=P instanceof Br?P.bbox():P,!(this._bbox[0]>V[2]||this._bbox[2]<V[0]||this._bbox[3]<V[1]||this._bbox[1]>V[3])):null;var V},Br.prototype._fastContains=function(){return this._valid?new Function("ll","return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]"):new Function("return null;")},Br.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var so=function(P){if(!P)return[];var V=gt(yt(P)),te=[];return V.features.forEach(function(ce){ce.geometry&&(te=te.concat(function(P){return function V(te){return Array.isArray(te)&&te.length&&"number"==typeof te[0]?[te]:te.reduce(function(ce,xe){return Array.isArray(xe)&&Array.isArray(xe[0])?ce.concat(V(xe)):(ce.push(xe),ce)},[])}(P)}(ce.geometry.coordinates)))}),te},yi=Go,ua=Ho,fi={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},ja=Object.keys(fi);function yo(P){for(var V=ua(),te=so(P),ce=0;ce<te.length;ce++)V.include(te[ce]);return V}Be.exports=function(P){return yo(P).bbox()},Be.exports.polygon=function(P){return yo(P).polygon()},Be.exports.bboxify=function(P){return yi(P).map(function(V){V&&ja.some(function(te){return!!V[te]&&-1!==fi[te].indexOf(V.type)})&&(V.bbox=yo(V).bbox(),this.update(V))})};var eh=es(Be.exports),Gl=-90;function dl(P,V){var te=Gl,ce=90,xe=Gl,we=90,Te=270,Le=-270;P.forEach(function(jt){var zt=eh(jt),Rt=zt[1],$e=zt[3],Tr=zt[0],Mt=zt[2];Rt>te&&(te=Rt),$e<ce&&(ce=$e),$e>xe&&(xe=$e),Rt<we&&(we=Rt),Tr<Te&&(Te=Tr),Mt>Le&&(Le=Mt)});var nt=V;return te+nt.lat>85&&(nt.lat=85-te),xe+nt.lat>90&&(nt.lat=90-xe),ce+nt.lat<-85&&(nt.lat=-85-ce),we+nt.lat<Gl&&(nt.lat=Gl-we),Te+nt.lng<=-270&&(nt.lng+=360*Math.ceil(Math.abs(nt.lng)/360)),Le+nt.lng>=270&&(nt.lng-=360*Math.ceil(Math.abs(nt.lng)/360)),nt}function xs(P,V){var te=dl(P.map(function(ce){return ce.toGeoJSON()}),V);P.forEach(function(ce){var xe,we=ce.getCoordinates(),Te=function(nt){var jt={lng:nt[0]+te.lng,lat:nt[1]+te.lat};return[jt.lng,jt.lat]},Le=function(nt){return nt.map(function(jt){return Te(jt)})};ce.type===on.POINT?xe=Te(we):ce.type===on.LINE_STRING||ce.type===on.MULTI_POINT?xe=we.map(Te):ce.type===on.POLYGON||ce.type===on.MULTI_LINE_STRING?xe=we.map(Le):ce.type===on.MULTI_POLYGON&&(xe=we.map(function(nt){return nt.map(function(jt){return Le(jt)})})),ce.incomingCoords(xe)})}var wi={onSetup:function(P){var V=this,te={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:P.featureIds||[]};return this.setSelected(te.initiallySelectedFeatureIds.filter(function(ce){return void 0!==V.getFeature(ce)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),te},fireUpdate:function(){this.map.fire(io.UPDATE,{action:Ba.MOVE,features:this.getSelected().map(function(P){return P.toGeoJSON()})})},fireActionable:function(){var P=this,V=this.getSelected(),te=V.filter(function(Le){return P.isInstanceOf("MultiFeature",Le)}),ce=!1;if(V.length>1){ce=!0;var xe=V[0].type.replace("Multi","");V.forEach(function(Le){Le.type.replace("Multi","")!==xe&&(ce=!1)})}this.setActionableState({combineFeatures:ce,uncombineFeatures:te.length>0,trash:V.length>0})},getUniqueIds:function(P){return P.length?P.map(function(V){return V.properties.id}).filter(function(V){return void 0!==V}).reduce(function(V,te){return V.add(te),V},new wt).values():[]},stopExtendedInteractions:function(P){P.boxSelectElement&&(P.boxSelectElement.parentNode&&P.boxSelectElement.parentNode.removeChild(P.boxSelectElement),P.boxSelectElement=null),this.map.dragPan.enable(),P.boxSelecting=!1,P.canBoxSelect=!1,P.dragMoving=!1,P.canDragMove=!1},onStop:function(){Or.enable(this)},onMouseMove:function(P,V){return vr(V)&&P.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(P),!0},onMouseOut:function(P){return!P.dragMoving||this.fireUpdate()}};wi.onTap=wi.onClick=function(P,V){return tr(V)?this.clickAnywhere(P,V):Qe(yr.VERTEX)(V)?this.clickOnVertex(P,V):vr(V)?this.clickOnFeature(P,V):void 0},wi.clickAnywhere=function(P){var V=this,te=this.getSelectedIds();te.length&&(this.clearSelectedFeatures(),te.forEach(function(ce){return V.doRender(ce)})),Or.enable(this),this.stopExtendedInteractions(P)},wi.clickOnVertex=function(P,V){this.changeMode(Ln.DIRECT_SELECT,{featureId:V.featureTarget.properties.parent,coordPath:V.featureTarget.properties.coord_path,startPos:V.lngLat}),this.updateUIClasses({mouse:Un.MOVE})},wi.startOnActiveFeature=function(P,V){this.stopExtendedInteractions(P),this.map.dragPan.disable(),this.doRender(V.featureTarget.properties.id),P.canDragMove=!0,P.dragMoveLocation=V.lngLat},wi.clickOnFeature=function(P,V){var te=this;Or.disable(this),this.stopExtendedInteractions(P);var ce=gr(V),xe=this.getSelectedIds(),we=V.featureTarget.properties.id,Te=this.isSelected(we);if(!ce&&Te&&this.getFeature(we).type!==on.POINT)return this.changeMode(Ln.DIRECT_SELECT,{featureId:we});Te&&ce?(this.deselect(we),this.updateUIClasses({mouse:Un.POINTER}),1===xe.length&&Or.enable(this)):!Te&&ce?(this.select(we),this.updateUIClasses({mouse:Un.MOVE})):Te||ce||(xe.forEach(function(Le){return te.doRender(Le)}),this.setSelected(we),this.updateUIClasses({mouse:Un.MOVE})),this.doRender(we)},wi.onMouseDown=function(P,V){return Kt(V)?this.startOnActiveFeature(P,V):this.drawConfig.boxSelect&&$t(V)?this.startBoxSelect(P,V):void 0},wi.startBoxSelect=function(P,V){this.stopExtendedInteractions(P),this.map.dragPan.disable(),P.boxSelectStartLocation=ys(V.originalEvent,this.map.getContainer()),P.canBoxSelect=!0},wi.onTouchStart=function(P,V){if(Kt(V))return this.startOnActiveFeature(P,V)},wi.onDrag=function(P,V){return P.canDragMove?this.dragMove(P,V):this.drawConfig.boxSelect&&P.canBoxSelect?this.whileBoxSelect(P,V):void 0},wi.whileBoxSelect=function(P,V){P.boxSelecting=!0,this.updateUIClasses({mouse:Un.ADD}),P.boxSelectElement||(P.boxSelectElement=document.createElement("div"),P.boxSelectElement.classList.add(bi.BOX_SELECT),this.map.getContainer().appendChild(P.boxSelectElement));var te=ys(V.originalEvent,this.map.getContainer()),ce=Math.min(P.boxSelectStartLocation.x,te.x),xe=Math.max(P.boxSelectStartLocation.x,te.x),we=Math.min(P.boxSelectStartLocation.y,te.y),Te=Math.max(P.boxSelectStartLocation.y,te.y),Le="translate("+ce+"px, "+we+"px)";P.boxSelectElement.style.transform=Le,P.boxSelectElement.style.WebkitTransform=Le,P.boxSelectElement.style.width=xe-ce+"px",P.boxSelectElement.style.height=Te-we+"px"},wi.dragMove=function(P,V){P.dragMoving=!0,V.originalEvent.stopPropagation();var te={lng:V.lngLat.lng-P.dragMoveLocation.lng,lat:V.lngLat.lat-P.dragMoveLocation.lat};xs(this.getSelected(),te),P.dragMoveLocation=V.lngLat},wi.onTouchEnd=wi.onMouseUp=function(P,V){var te=this;if(P.dragMoving)this.fireUpdate();else if(P.boxSelecting){var ce=[P.boxSelectStartLocation,ys(V.originalEvent,this.map.getContainer())],xe=this.featuresAt(null,ce,"click"),we=this.getUniqueIds(xe).filter(function(Te){return!te.isSelected(Te)});we.length&&(this.select(we),we.forEach(function(Te){return te.doRender(Te)}),this.updateUIClasses({mouse:Un.MOVE}))}this.stopExtendedInteractions(P)},wi.toDisplayFeatures=function(P,V,te){V.properties.active=this.isSelected(V.properties.id)?Cr.ACTIVE:Cr.INACTIVE,te(V),this.fireActionable(),V.properties.active===Cr.ACTIVE&&V.geometry.type!==on.POINT&&vs(V).forEach(te)},wi.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},wi.onCombineFeatures=function(){var P=this.getSelected();if(!(0===P.length||P.length<2)){for(var V=[],te=[],ce=P[0].type.replace("Multi",""),xe=0;xe<P.length;xe++){var we=P[xe];if(we.type.replace("Multi","")!==ce)return;we.type.includes("Multi")?we.getCoordinates().forEach(function(Le){V.push(Le)}):V.push(we.getCoordinates()),te.push(we.toGeoJSON())}if(te.length>1){var Te=this.newFeature({type:on.FEATURE,properties:te[0].properties,geometry:{type:"Multi"+ce,coordinates:V}});this.addFeature(Te),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Te.id]),this.map.fire(io.COMBINE_FEATURES,{createdFeatures:[Te.toGeoJSON()],deletedFeatures:te})}this.fireActionable()}},wi.onUncombineFeatures=function(){var P=this,V=this.getSelected();if(0!==V.length){for(var te=[],ce=[],xe=function(Te){var Le=V[Te];P.isInstanceOf("MultiFeature",Le)&&(Le.getFeatures().forEach(function(nt){P.addFeature(nt),nt.properties=Le.properties,te.push(nt.toGeoJSON()),P.select([nt.id])}),P.deleteFeature(Le.id,{silent:!0}),ce.push(Le.toGeoJSON()))},we=0;we<V.length;we++)xe(we);te.length>1&&this.map.fire(io.UNCOMBINE_FEATURES,{createdFeatures:te,deletedFeatures:ce}),this.fireActionable()}};var ki=Qe(yr.VERTEX),_c=Qe(yr.MIDPOINT),vo={fireUpdate:function(){this.map.fire(io.UPDATE,{action:Ba.CHANGE_COORDINATES,features:this.getSelected().map(function(P){return P.toGeoJSON()})})},fireActionable:function(P){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:P.selectedCoordPaths.length>0})},startDragging:function(P,V){this.map.dragPan.disable(),P.canDragMove=!0,P.dragMoveLocation=V.lngLat},stopDragging:function(P){this.map.dragPan.enable(),P.dragMoving=!1,P.canDragMove=!1,P.dragMoveLocation=null},onVertex:function(P,V){this.startDragging(P,V);var te=V.featureTarget.properties,ce=P.selectedCoordPaths.indexOf(te.coord_path);gr(V)||-1!==ce?gr(V)&&-1===ce&&P.selectedCoordPaths.push(te.coord_path):P.selectedCoordPaths=[te.coord_path];var xe=this.pathsToCoordinates(P.featureId,P.selectedCoordPaths);this.setSelectedCoordinates(xe)},onMidpoint:function(P,V){this.startDragging(P,V);var te=V.featureTarget.properties;P.feature.addCoordinate(te.coord_path,te.lng,te.lat),this.fireUpdate(),P.selectedCoordPaths=[te.coord_path]},pathsToCoordinates:function(P,V){return V.map(function(te){return{feature_id:P,coord_path:te}})},onFeature:function(P,V){0===P.selectedCoordPaths.length?this.startDragging(P,V):this.stopDragging(P)},dragFeature:function(P,V,te){xs(this.getSelected(),te),P.dragMoveLocation=V.lngLat},dragVertex:function(P,V,te){for(var ce=P.selectedCoordPaths.map(function(Le){return P.feature.getCoordinate(Le)}),xe=dl(ce.map(function(Le){return{type:on.FEATURE,properties:{},geometry:{type:on.POINT,coordinates:Le}}}),te),we=0;we<ce.length;we++){var Te=ce[we];P.feature.updateCoordinate(P.selectedCoordPaths[we],Te[0]+xe.lng,Te[1]+xe.lat)}},clickNoTarget:function(){this.changeMode(Ln.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Ln.SIMPLE_SELECT)},clickActiveFeature:function(P){P.selectedCoordPaths=[],this.clearSelectedCoordinates(),P.feature.changed()},onSetup:function(P){var V=P.featureId,te=this.getFeature(V);if(!te)throw new Error("You must provide a featureId to enter direct_select mode");if(te.type===on.POINT)throw new TypeError("direct_select mode doesn't handle point features");var ce={featureId:V,feature:te,dragMoveLocation:P.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:P.coordPath?[P.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(V,ce.selectedCoordPaths)),this.setSelected(V),Or.disable(this),this.setActionableState({trash:!0}),ce},onStop:function(){Or.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(P,V,te){P.featureId===V.properties.id?(V.properties.active=Cr.ACTIVE,te(V),vs(V,{map:this.map,midpoints:!0,selectedPaths:P.selectedCoordPaths}).forEach(te)):(V.properties.active=Cr.INACTIVE,te(V)),this.fireActionable(P)},onTrash:function(P){P.selectedCoordPaths.sort(function(V,te){return te.localeCompare(V,"en",{numeric:!0})}).forEach(function(V){return P.feature.removeCoordinate(V)}),this.fireUpdate(),P.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(P),!1===P.feature.isValid()&&(this.deleteFeature([P.featureId]),this.changeMode(Ln.SIMPLE_SELECT,{}))},onMouseMove:function(P,V){var te=Kt(V),ce=ki(V),xe=_c(V),we=0===P.selectedCoordPaths.length;return this.updateUIClasses(te&&we||ce&&!we?{mouse:Un.MOVE}:{mouse:Un.NONE}),(ce||te||xe)&&P.dragMoving&&this.fireUpdate(),this.stopDragging(P),!0},onMouseOut:function(P){return P.dragMoving&&this.fireUpdate(),!0}};vo.onTouchStart=vo.onMouseDown=function(P,V){return ki(V)?this.onVertex(P,V):Kt(V)?this.onFeature(P,V):_c(V)?this.onMidpoint(P,V):void 0},vo.onDrag=function(P,V){if(!0===P.canDragMove){P.dragMoving=!0,V.originalEvent.stopPropagation();var te={lng:V.lngLat.lng-P.dragMoveLocation.lng,lat:V.lngLat.lat-P.dragMoveLocation.lat};P.selectedCoordPaths.length>0?this.dragVertex(P,V,te):this.dragFeature(P,V,te),P.dragMoveLocation=V.lngLat}},vo.onClick=function(P,V){return tr(V)?this.clickNoTarget(P,V):Kt(V)?this.clickActiveFeature(P,V):nn(V)?this.clickInactive(P,V):void this.stopDragging(P)},vo.onTap=function(P,V){return tr(V)?this.clickNoTarget(P,V):Kt(V)?this.clickActiveFeature(P,V):nn(V)?this.clickInactive(P,V):void 0},vo.onTouchEnd=vo.onMouseUp=function(P){P.dragMoving&&this.fireUpdate(),this.stopDragging(P)};var Ei={};function $s(P,V){return!!P.lngLat&&P.lngLat.lng===V[0]&&P.lngLat.lat===V[1]}Ei.onSetup=function(){var P=this.newFeature({type:on.FEATURE,properties:{},geometry:{type:on.POINT,coordinates:[]}});return this.addFeature(P),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Un.ADD}),this.activateUIButton(ti.POINT),this.setActionableState({trash:!0}),{point:P}},Ei.stopDrawingAndRemove=function(P){this.deleteFeature([P.point.id],{silent:!0}),this.changeMode(Ln.SIMPLE_SELECT)},Ei.onTap=Ei.onClick=function(P,V){this.updateUIClasses({mouse:Un.MOVE}),P.point.updateCoordinate("",V.lngLat.lng,V.lngLat.lat),this.map.fire(io.CREATE,{features:[P.point.toGeoJSON()]}),this.changeMode(Ln.SIMPLE_SELECT,{featureIds:[P.point.id]})},Ei.onStop=function(P){this.activateUIButton(),P.point.getCoordinate().length||this.deleteFeature([P.point.id],{silent:!0})},Ei.toDisplayFeatures=function(P,V,te){var ce=V.properties.id===P.point.id;if(V.properties.active=ce?Cr.ACTIVE:Cr.INACTIVE,!ce)return te(V)},Ei.onTrash=Ei.stopDrawingAndRemove,Ei.onKeyUp=function(P,V){if(Jn(V)||nr(V))return this.stopDrawingAndRemove(P,V)};var ho={onSetup:function(){var P=this.newFeature({type:on.FEATURE,properties:{},geometry:{type:on.POLYGON,coordinates:[[]]}});return this.addFeature(P),this.clearSelectedFeatures(),Or.disable(this),this.updateUIClasses({mouse:Un.ADD}),this.activateUIButton(ti.POLYGON),this.setActionableState({trash:!0}),{polygon:P,currentVertexPosition:0}},clickAnywhere:function(P,V){if(P.currentVertexPosition>0&&$s(V,P.polygon.coordinates[0][P.currentVertexPosition-1]))return this.changeMode(Ln.SIMPLE_SELECT,{featureIds:[P.polygon.id]});this.updateUIClasses({mouse:Un.ADD}),P.polygon.updateCoordinate("0."+P.currentVertexPosition,V.lngLat.lng,V.lngLat.lat),P.currentVertexPosition++,P.polygon.updateCoordinate("0."+P.currentVertexPosition,V.lngLat.lng,V.lngLat.lat)},clickOnVertex:function(P){return this.changeMode(Ln.SIMPLE_SELECT,{featureIds:[P.polygon.id]})},onMouseMove:function(P,V){P.polygon.updateCoordinate("0."+P.currentVertexPosition,V.lngLat.lng,V.lngLat.lat),qr(V)&&this.updateUIClasses({mouse:Un.POINTER})}};ho.onTap=ho.onClick=function(P,V){return qr(V)?this.clickOnVertex(P,V):this.clickAnywhere(P,V)},ho.onKeyUp=function(P,V){Jn(V)?(this.deleteFeature([P.polygon.id],{silent:!0}),this.changeMode(Ln.SIMPLE_SELECT)):nr(V)&&this.changeMode(Ln.SIMPLE_SELECT,{featureIds:[P.polygon.id]})},ho.onStop=function(P){this.updateUIClasses({mouse:Un.NONE}),Or.enable(this),this.activateUIButton(),void 0!==this.getFeature(P.polygon.id)&&(P.polygon.removeCoordinate("0."+P.currentVertexPosition),P.polygon.isValid()?this.map.fire(io.CREATE,{features:[P.polygon.toGeoJSON()]}):(this.deleteFeature([P.polygon.id],{silent:!0}),this.changeMode(Ln.SIMPLE_SELECT,{},{silent:!0})))},ho.toDisplayFeatures=function(P,V,te){var ce=V.properties.id===P.polygon.id;if(V.properties.active=ce?Cr.ACTIVE:Cr.INACTIVE,!ce)return te(V);if(0!==V.geometry.coordinates.length){var xe=V.geometry.coordinates[0].length;if(!(xe<3)){if(V.properties.meta=yr.FEATURE,te(di(P.polygon.id,V.geometry.coordinates[0][0],"0.0",!1)),xe>3){var we=V.geometry.coordinates[0].length-3;te(di(P.polygon.id,V.geometry.coordinates[0][we],"0."+we,!1))}if(xe<=4&&(te({type:on.FEATURE,properties:V.properties,geometry:{coordinates:[[V.geometry.coordinates[0][0][0],V.geometry.coordinates[0][0][1]],[V.geometry.coordinates[0][1][0],V.geometry.coordinates[0][1][1]]],type:on.LINE_STRING}}),3===xe))return;return te(V)}}},ho.onTrash=function(P){this.deleteFeature([P.polygon.id],{silent:!0}),this.changeMode(Ln.SIMPLE_SELECT)};var De={onSetup:function(P){var V,te,ce=(P=P||{}).featureId,xe="forward";if(ce){if(!(V=this.getFeature(ce)))throw new Error("Could not find a feature with the provided featureId");var we=P.from;if(we&&"Feature"===we.type&&we.geometry&&"Point"===we.geometry.type&&(we=we.geometry),we&&"Point"===we.type&&we.coordinates&&2===we.coordinates.length&&(we=we.coordinates),!we||!Array.isArray(we))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Te=V.coordinates.length-1;if(V.coordinates[Te][0]===we[0]&&V.coordinates[Te][1]===we[1])V.addCoordinate.apply(V,[te=Te+1].concat(V.coordinates[Te]));else{if(V.coordinates[0][0]!==we[0]||V.coordinates[0][1]!==we[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");xe="backwards",V.addCoordinate.apply(V,[te=0].concat(V.coordinates[0]))}}else V=this.newFeature({type:on.FEATURE,properties:{},geometry:{type:on.LINE_STRING,coordinates:[]}}),te=0,this.addFeature(V);return this.clearSelectedFeatures(),Or.disable(this),this.updateUIClasses({mouse:Un.ADD}),this.activateUIButton(ti.LINE),this.setActionableState({trash:!0}),{line:V,currentVertexPosition:te,direction:xe}},clickAnywhere:function(P,V){if(P.currentVertexPosition>0&&$s(V,P.line.coordinates[P.currentVertexPosition-1])||"backwards"===P.direction&&$s(V,P.line.coordinates[P.currentVertexPosition+1]))return this.changeMode(Ln.SIMPLE_SELECT,{featureIds:[P.line.id]});this.updateUIClasses({mouse:Un.ADD}),P.line.updateCoordinate(P.currentVertexPosition,V.lngLat.lng,V.lngLat.lat),"forward"===P.direction?(P.currentVertexPosition++,P.line.updateCoordinate(P.currentVertexPosition,V.lngLat.lng,V.lngLat.lat)):P.line.addCoordinate(0,V.lngLat.lng,V.lngLat.lat)},clickOnVertex:function(P){return this.changeMode(Ln.SIMPLE_SELECT,{featureIds:[P.line.id]})},onMouseMove:function(P,V){P.line.updateCoordinate(P.currentVertexPosition,V.lngLat.lng,V.lngLat.lat),qr(V)&&this.updateUIClasses({mouse:Un.POINTER})}};De.onTap=De.onClick=function(P,V){if(qr(V))return this.clickOnVertex(P,V);this.clickAnywhere(P,V)},De.onKeyUp=function(P,V){nr(V)?this.changeMode(Ln.SIMPLE_SELECT,{featureIds:[P.line.id]}):Jn(V)&&(this.deleteFeature([P.line.id],{silent:!0}),this.changeMode(Ln.SIMPLE_SELECT))},De.onStop=function(P){Or.enable(this),this.activateUIButton(),void 0!==this.getFeature(P.line.id)&&(P.line.removeCoordinate(""+P.currentVertexPosition),P.line.isValid()?this.map.fire(io.CREATE,{features:[P.line.toGeoJSON()]}):(this.deleteFeature([P.line.id],{silent:!0}),this.changeMode(Ln.SIMPLE_SELECT,{},{silent:!0})))},De.onTrash=function(P){this.deleteFeature([P.line.id],{silent:!0}),this.changeMode(Ln.SIMPLE_SELECT)},De.toDisplayFeatures=function(P,V,te){var ce=V.properties.id===P.line.id;if(V.properties.active=ce?Cr.ACTIVE:Cr.INACTIVE,!ce)return te(V);V.geometry.coordinates.length<2||(V.properties.meta=yr.FEATURE,te(di(P.line.id,V.geometry.coordinates["forward"===P.direction?V.geometry.coordinates.length-2:1],""+("forward"===P.direction?V.geometry.coordinates.length-2:1),!1)),te(V))};var Pt={simple_select:wi,direct_select:vo,draw_point:Ei,draw_polygon:ho,draw_line_string:De},bs={defaultMode:Ln.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Ot,modes:Pt,controls:{},userProperties:!1},ws={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},pi={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Vr(P,V){return P.map(function(te){return te.source?te:Ye(te,{id:te.id+"."+V,source:"hot"===V?hn.HOT:hn.COLD})})}var th={exports:{}};!function(P,V){var te="__lodash_hash_undefined__",ce=9007199254740991,xe="[object Arguments]",we="[object Array]",Te="[object Boolean]",Le="[object Date]",nt="[object Error]",jt="[object Function]",zt="[object Map]",Rt="[object Number]",$e="[object Object]",Tr="[object Promise]",Mt="[object RegExp]",_n="[object Set]",ft="[object String]",xr="[object WeakMap]",pr="[object ArrayBuffer]",un="[object DataView]",au=/^\[object .+?Constructor\]$/,fl=/^(?:0|[1-9]\d*)$/,rr={};rr["[object Float32Array]"]=rr["[object Float64Array]"]=rr["[object Int8Array]"]=rr["[object Int16Array]"]=rr["[object Int32Array]"]=rr["[object Uint8Array]"]=rr["[object Uint8ClampedArray]"]=rr["[object Uint16Array]"]=rr["[object Uint32Array]"]=!0,rr[xe]=rr[we]=rr[pr]=rr[Te]=rr[un]=rr[Le]=rr[nt]=rr[jt]=rr[zt]=rr[Rt]=rr[$e]=rr[Mt]=rr[_n]=rr[ft]=rr[xr]=!1;var Hi="object"==typeof global&&global&&global.Object===Object&&global,Nf="object"==typeof self&&self&&self.Object===Object&&self,qo=Hi||Nf||Function("return this")(),Ci=V&&!V.nodeType&&V,yc=Ci&&P&&!P.nodeType&&P,lu=yc&&yc.exports===Ci,pl=lu&&Hi.process,ui=function(){try{return pl&&pl.binding&&pl.binding("util")}catch{}}(),nh=ui&&ui.isTypedArray;function Ao(Ie,We){for(var Bt=-1,an=null==Ie?0:Ie.length;++Bt<an;)if(We(Ie[Bt],Bt,Ie))return!0;return!1}function fn(Ie){var We=-1,Bt=Array(Ie.size);return Ie.forEach(function(an,Fn){Bt[++We]=[Fn,an]}),Bt}function cu(Ie){var We=-1,Bt=Array(Ie.size);return Ie.forEach(function(an){Bt[++We]=an}),Bt}var vc,Kn,Cn,rh=Array.prototype,Ua=Object.prototype,xc=qo["__core-js_shared__"],Gs=Function.prototype.toString,Es=Ua.hasOwnProperty,xo=(vc=/[^.]+$/.exec(xc&&xc.keys&&xc.keys.IE_PROTO||""))?"Symbol(src)_1."+vc:"",da=Ua.toString,bc=RegExp("^"+Gs.call(Es).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),uu=lu?qo.Buffer:void 0,ml=qo.Symbol,Pn=qo.Uint8Array,Cs=Ua.propertyIsEnumerable,ih=rh.splice,Xr=ml?ml.toStringTag:void 0,wc=Object.getOwnPropertySymbols,$a=uu?uu.isBuffer:void 0,Wt=(Kn=Object.keys,Cn=Object,function(Ie){return Kn(Cn(Ie))}),ud=ya(qo,"DataView"),hu=ya(qo,"Map"),sn=ya(qo,"Promise"),gl=ya(qo,"Set"),Ec=ya(qo,"WeakMap"),fa=ya(Object,"create"),Cc=yl(ud),oh=yl(hu),pa=yl(sn),hd=yl(gl),ma=yl(Ec),du=ml?ml.prototype:void 0,fu=du?du.valueOf:void 0;function Ga(Ie){var We=-1,Bt=null==Ie?0:Ie.length;for(this.clear();++We<Bt;){var an=Ie[We];this.set(an[0],an[1])}}function fo(Ie){var We=-1,Bt=null==Ie?0:Ie.length;for(this.clear();++We<Bt;){var an=Ie[We];this.set(an[0],an[1])}}function is(Ie){var We=-1,Bt=null==Ie?0:Ie.length;for(this.clear();++We<Bt;){var an=Ie[We];this.set(an[0],an[1])}}function ct(Ie){var We=-1,Bt=null==Ie?0:Ie.length;for(this.__data__=new is;++We<Bt;)this.add(Ie[We])}function ga(Ie){var We=this.__data__=new fo(Ie);this.size=We.size}function Hl(Ie,We){for(var Bt=Ie.length;Bt--;)if(dd(Ie[Bt][0],We))return Bt;return-1}function _l(Ie){return null==Ie?void 0===Ie?"[object Undefined]":"[object Null]":Xr&&Xr in Object(Ie)?function(We){var Bt=Es.call(We,Xr),an=We[Xr];try{We[Xr]=void 0;var Fn=!0}catch{}var Hn=da.call(We);return Fn&&(Bt?We[Xr]=an:delete We[Xr]),Hn}(Ie):da.call(Ie)}function Hs(Ie){return qa(Ie)&&_l(Ie)==xe}function qs(Ie,We,Bt,an,Fn){return Ie===We||(null==Ie||null==We||!qa(Ie)&&!qa(We)?Ie!=Ie&&We!=We:function(Hn,Mr,jr,Zo,ri,Ti){var Oo=vl(Hn),ss=vl(Mr),ao=Oo?we:Po(Hn),Mi=ss?we:Po(Mr),mn=(ao=ao==xe?$e:ao)==$e,Za=(Mi=Mi==xe?$e:Mi)==$e,Ws=ao==Mi;if(Ws&&Ro(Hn)){if(!Ro(Mr))return!1;Oo=!0,mn=!1}if(Ws&&!mn)return Ti||(Ti=new ga),Oo||xl(Hn)?yn(Hn,Mr,jr,Zo,ri,Ti):function(Lr,Dr,mu,as,Dc,Lo,Ms){switch(mu){case un:if(Lr.byteLength!=Dr.byteLength||Lr.byteOffset!=Dr.byteOffset)return!1;Lr=Lr.buffer,Dr=Dr.buffer;case pr:return!(Lr.byteLength!=Dr.byteLength||!Lo(new Pn(Lr),new Pn(Dr)));case Te:case Le:case Rt:return dd(+Lr,+Dr);case nt:return Lr.name==Dr.name&&Lr.message==Dr.message;case Mt:case ft:return Lr==Dr+"";case zt:var qi=fn;case _n:if(qi||(qi=cu),Lr.size!=Dr.size&&!(1&as))return!1;var Ds=Ms.get(Lr);if(Ds)return Ds==Dr;as|=2,Ms.set(Lr,Dr);var xn=yn(qi(Lr),qi(Dr),as,Dc,Lo,Ms);return Ms.delete(Lr),xn;case"[object Symbol]":if(fu)return fu.call(Lr)==fu.call(Dr)}return!1}(Hn,Mr,ao,jr,Zo,ri,Ti);if(!(1&jr)){var va=mn&&Es.call(Hn,"__wrapped__"),Wa=Za&&Es.call(Mr,"__wrapped__");if(va||Wa){var fd=va?Hn.value():Hn,bl=Wa?Mr.value():Mr;return Ti||(Ti=new ga),ri(fd,bl,jr,Zo,Ti)}}return!!Ws&&(Ti||(Ti=new ga),function(Lr,Dr,mu,as,Dc,Lo){var Ms=1&mu,qi=_a(Lr),Zl=qi.length;if(Zl!=_a(Dr).length&&!Ms)return!1;for(var xn=Zl;xn--;){var ii=qi[xn];if(!(Ms?ii in Dr:Es.call(Dr,ii)))return!1}var $n=Lo.get(Lr);if($n&&Lo.get(Dr))return $n==Dr;var Di=!0;Lo.set(Lr,Dr),Lo.set(Dr,Lr);for(var Fi=Ms;++xn<Zl;){var Ki=Lr[ii=qi[xn]],Yr=Dr[ii];if(as)var Xs=Ms?as(Yr,Ki,ii,Dr,Lr,Lo):as(Ki,Yr,ii,Lr,Dr,Lo);if(!(void 0===Xs?Ki===Yr||Dc(Ki,Yr,mu,as,Lo):Xs)){Di=!1;break}Fi||(Fi="constructor"==ii)}if(Di&&!Fi){var Wl=Lr.constructor,xa=Dr.constructor;Wl==xa||!("constructor"in Lr)||!("constructor"in Dr)||"function"==typeof Wl&&Wl instanceof Wl&&"function"==typeof xa&&xa instanceof xa||(Di=!1)}return Lo.delete(Lr),Lo.delete(Dr),Di}(Hn,Mr,jr,Zo,ri,Ti))}(Ie,We,Bt,an,qs,Fn))}function yn(Ie,We,Bt,an,Fn,Hn){var Mr=1&Bt,jr=Ie.length,Zo=We.length;if(jr!=Zo&&!(Mr&&Zo>jr))return!1;var ri=Hn.get(Ie);if(ri&&Hn.get(We))return ri==We;var Ti=-1,Oo=!0,ss=2&Bt?new ct:void 0;for(Hn.set(Ie,We),Hn.set(We,Ie);++Ti<jr;){var ao=Ie[Ti],Mi=We[Ti];if(an)var mn=Mr?an(Mi,ao,Ti,We,Ie,Hn):an(ao,Mi,Ti,Ie,We,Hn);if(void 0!==mn){if(mn)continue;Oo=!1;break}if(ss){if(!Ao(We,function(Za,Ws){if(!ss.has(Ws)&&(ao===Za||Fn(ao,Za,Bt,an,Hn)))return ss.push(Ws)})){Oo=!1;break}}else if(ao!==Mi&&!Fn(ao,Mi,Bt,an,Hn)){Oo=!1;break}}return Hn.delete(Ie),Hn.delete(We),Oo}function _a(Ie){return an=Tc,Fn=function ql(Ie){return null!=(We=Ie)&&or(We.length)&&!os(We)?function pu(Ie,We){var Bt=vl(Ie),an=!Bt&&Zs(Ie),Fn=!Bt&&!an&&Ro(Ie),Hn=!Bt&&!an&&!Fn&&xl(Ie),Mr=Bt||an||Fn||Hn,jr=Mr?function(Ti,Oo){for(var ss=-1,ao=Array(Ti);++ss<Ti;)ao[ss]=Oo(ss);return ao}(Ie.length,String):[],Zo=jr.length;for(var ri in Ie)!We&&!Es.call(Ie,ri)||Mr&&("length"==ri||Fn&&("offset"==ri||"parent"==ri)||Hn&&("buffer"==ri||"byteLength"==ri||"byteOffset"==ri)||sh(ri,Zo))||jr.push(ri);return jr}(Ie):function Ha(Ie){if(Bt=(We=Ie)&&We.constructor,We!==("function"==typeof Bt&&Bt.prototype||Ua))return Wt(Ie);var We,Bt,Fn=[];for(var Hn in Object(Ie))Es.call(Ie,Hn)&&"constructor"!=Hn&&Fn.push(Hn);return Fn}(Ie);var We}(We=Ie),vl(We)?Fn:function(Hn,Mr){for(var jr=-1,Zo=Mr.length,ri=Hn.length;++jr<Zo;)Hn[ri+jr]=Mr[jr];return Hn}(Fn,an(We));var We,an,Fn}function Qt(Ie,We){var Bt,an,Fn=Ie.__data__;return("string"==(an=typeof(Bt=We))||"number"==an||"symbol"==an||"boolean"==an?"__proto__"!==Bt:null===Bt)?Fn["string"==typeof We?"string":"hash"]:Fn.map}function ya(Ie,We){var an,Fn,Bt=(an=Ie,Fn=We,an?.[Fn]);return function Ts(Ie){return!(!Mc(Ie)||(We=Ie,xo&&xo in We))&&(os(Ie)?bc:au).test(yl(Ie));var We}(Bt)?Bt:void 0}Ga.prototype.clear=function(){this.__data__=fa?fa(null):{},this.size=0},Ga.prototype.delete=function(Ie){var We=this.has(Ie)&&delete this.__data__[Ie];return this.size-=We?1:0,We},Ga.prototype.get=function(Ie){var We=this.__data__;if(fa){var Bt=We[Ie];return Bt===te?void 0:Bt}return Es.call(We,Ie)?We[Ie]:void 0},Ga.prototype.has=function(Ie){var We=this.__data__;return fa?void 0!==We[Ie]:Es.call(We,Ie)},Ga.prototype.set=function(Ie,We){var Bt=this.__data__;return this.size+=this.has(Ie)?0:1,Bt[Ie]=fa&&void 0===We?te:We,this},fo.prototype.clear=function(){this.__data__=[],this.size=0},fo.prototype.delete=function(Ie){var We=this.__data__,Bt=Hl(We,Ie);return!(Bt<0||(Bt==We.length-1?We.pop():ih.call(We,Bt,1),--this.size,0))},fo.prototype.get=function(Ie){var We=this.__data__,Bt=Hl(We,Ie);return Bt<0?void 0:We[Bt][1]},fo.prototype.has=function(Ie){return Hl(this.__data__,Ie)>-1},fo.prototype.set=function(Ie,We){var Bt=this.__data__,an=Hl(Bt,Ie);return an<0?(++this.size,Bt.push([Ie,We])):Bt[an][1]=We,this},is.prototype.clear=function(){this.size=0,this.__data__={hash:new Ga,map:new(hu||fo),string:new Ga}},is.prototype.delete=function(Ie){var We=Qt(this,Ie).delete(Ie);return this.size-=We?1:0,We},is.prototype.get=function(Ie){return Qt(this,Ie).get(Ie)},is.prototype.has=function(Ie){return Qt(this,Ie).has(Ie)},is.prototype.set=function(Ie,We){var Bt=Qt(this,Ie),an=Bt.size;return Bt.set(Ie,We),this.size+=Bt.size==an?0:1,this},ct.prototype.add=ct.prototype.push=function(Ie){return this.__data__.set(Ie,te),this},ct.prototype.has=function(Ie){return this.__data__.has(Ie)},ga.prototype.clear=function(){this.__data__=new fo,this.size=0},ga.prototype.delete=function(Ie){var We=this.__data__,Bt=We.delete(Ie);return this.size=We.size,Bt},ga.prototype.get=function(Ie){return this.__data__.get(Ie)},ga.prototype.has=function(Ie){return this.__data__.has(Ie)},ga.prototype.set=function(Ie,We){var Bt=this.__data__;if(Bt instanceof fo){var an=Bt.__data__;if(!hu||an.length<199)return an.push([Ie,We]),this.size=++Bt.size,this;Bt=this.__data__=new is(an)}return Bt.set(Ie,We),this.size=Bt.size,this};var Tc=wc?function(Ie){return null==Ie?[]:(Ie=Object(Ie),function(We,Bt){for(var an=-1,Fn=null==We?0:We.length,Hn=0,Mr=[];++an<Fn;){var jr=We[an];Bt(jr)&&(Mr[Hn++]=jr)}return Mr}(wc(Ie),function(We){return Cs.call(Ie,We)}))}:function(){return[]},Po=_l;function sh(Ie,We){return!!(We=We??ce)&&("number"==typeof Ie||fl.test(Ie))&&Ie>-1&&Ie%1==0&&Ie<We}function yl(Ie){if(null!=Ie){try{return Gs.call(Ie)}catch{}try{return Ie+""}catch{}}return""}function dd(Ie,We){return Ie===We||Ie!=Ie&&We!=We}(ud&&Po(new ud(new ArrayBuffer(1)))!=un||hu&&Po(new hu)!=zt||sn&&Po(sn.resolve())!=Tr||gl&&Po(new gl)!=_n||Ec&&Po(new Ec)!=xr)&&(Po=function(Ie){var We=_l(Ie),Bt=We==$e?Ie.constructor:void 0,an=Bt?yl(Bt):"";if(an)switch(an){case Cc:return un;case oh:return zt;case pa:return Tr;case hd:return _n;case ma:return xr}return We});var Zs=Hs(function(){return arguments}())?Hs:function(Ie){return qa(Ie)&&Es.call(Ie,"callee")&&!Cs.call(Ie,"callee")},vl=Array.isArray,Ro=$a||function(){return!1};function os(Ie){if(!Mc(Ie))return!1;var We=_l(Ie);return We==jt||"[object GeneratorFunction]"==We||"[object AsyncFunction]"==We||"[object Proxy]"==We}function or(Ie){return"number"==typeof Ie&&Ie>-1&&Ie%1==0&&Ie<=ce}function Mc(Ie){var We=typeof Ie;return null!=Ie&&("object"==We||"function"==We)}function qa(Ie){return null!=Ie&&"object"==typeof Ie}var Ie,xl=nh?(Ie=nh,function(We){return Ie(We)}):function(Ie){return qa(Ie)&&or(Ie.length)&&!!rr[_l(Ie)]};P.exports=function(Ie,We){return qs(Ie,We)}}(th,th.exports);var mi=es(th.exports);function Tn(P,V){return P.length===V.length&&JSON.stringify(P.map(function(te){return te}).sort())===JSON.stringify(V.map(function(te){return te}).sort())}var cd={Polygon:Ui,LineString:ci,Point:Vs,MultiPolygon:er,MultiLineString:er,MultiPoint:er},ha=Object.freeze({__proto__:null,CommonSelectors:$i,constrainFeatureMovement:dl,createMidPoint:Us,createSupplementaryPoints:vs,createVertex:di,doubleClickZoom:Or,euclideanDistance:rs,featuresAt:zs,getFeatureAtAndSetCursors:la,isClick:dn,isEventAtCoordinates:$s,isTap:Bs,mapEventToBoundingBox:Ns,ModeHandler:hl,moveFeatures:xs,sortFeatures:su,stringSetsAreEqual:Tn,StringSet:wt,theme:Ot,toDenseArray:js});function Mn(P){!function(P,V){var xe,we,te={options:P=function(xe){void 0===xe&&(xe={});var we=Ye(xe);return xe.controls||(we.controls={}),we.controls=Ye(!1===xe.displayControlsDefault?pi:ws,xe.controls),(we=Ye(bs,we)).styles=Vr(we.styles,"cold").concat(Vr(we.styles,"hot")),we}(P)};xe=te,(we=V).modes=Ln,we.getFeatureIdsAt=function(Te){return zs.click({point:Te},null,xe).map(function(Le){return Le.properties.id})},we.getSelectedIds=function(){return xe.store.getSelectedIds()},we.getSelected=function(){return{type:on.FEATURE_COLLECTION,features:xe.store.getSelectedIds().map(function(Te){return xe.store.get(Te)}).map(function(Te){return Te.toGeoJSON()})}},we.getSelectedPoints=function(){return{type:on.FEATURE_COLLECTION,features:xe.store.getSelectedCoordinates().map(function(Te){return{type:on.FEATURE,properties:{},geometry:{type:on.POINT,coordinates:Te.coordinates}}})}},we.set=function(Te){if(void 0===Te.type||Te.type!==on.FEATURE_COLLECTION||!Array.isArray(Te.features))throw new Error("Invalid FeatureCollection");var Le=xe.store.createRenderBatch(),nt=xe.store.getAllIds().slice(),jt=we.add(Te),zt=new wt(jt);return(nt=nt.filter(function(Rt){return!zt.has(Rt)})).length&&we.delete(nt),Le(),jt},we.add=function(Te){var Le=JSON.parse(JSON.stringify(lt(Te))).features.map(function(nt){if(nt.id=nt.id||ca(),null===nt.geometry)throw new Error("Invalid geometry: null");if(void 0===xe.store.get(nt.id)||xe.store.get(nt.id).type!==nt.geometry.type){var jt=cd[nt.geometry.type];if(void 0===jt)throw new Error("Invalid geometry type: "+nt.geometry.type+".");var zt=new jt(xe,nt);xe.store.add(zt)}else{var Rt=xe.store.get(nt.id);Rt.properties=nt.properties,mi(Rt.properties,nt.properties)||xe.store.featureChanged(Rt.id),mi(Rt.getCoordinates(),nt.geometry.coordinates)||Rt.incomingCoords(nt.geometry.coordinates)}return nt.id});return xe.store.render(),Le},we.get=function(Te){var Le=xe.store.get(Te);if(Le)return Le.toGeoJSON()},we.getAll=function(){return{type:on.FEATURE_COLLECTION,features:xe.store.getAll().map(function(Te){return Te.toGeoJSON()})}},we.delete=function(Te){return xe.store.delete(Te,{silent:!0}),we.getMode()!==Ln.DIRECT_SELECT||xe.store.getSelectedIds().length?xe.store.render():xe.events.changeMode(Ln.SIMPLE_SELECT,void 0,{silent:!0}),we},we.deleteAll=function(){return xe.store.delete(xe.store.getAllIds(),{silent:!0}),we.getMode()===Ln.DIRECT_SELECT?xe.events.changeMode(Ln.SIMPLE_SELECT,void 0,{silent:!0}):xe.store.render(),we},we.changeMode=function(Te,Le){return void 0===Le&&(Le={}),Te===Ln.SIMPLE_SELECT&&we.getMode()===Ln.SIMPLE_SELECT?(Tn(Le.featureIds||[],xe.store.getSelectedIds())||(xe.store.setSelected(Le.featureIds,{silent:!0}),xe.store.render()),we):(Te===Ln.DIRECT_SELECT&&we.getMode()===Ln.DIRECT_SELECT&&Le.featureId===xe.store.getSelectedIds()[0]||xe.events.changeMode(Te,Le,{silent:!0}),we)},we.getMode=function(){return xe.events.getMode()},we.trash=function(){return xe.events.trash({silent:!0}),we},we.combineFeatures=function(){return xe.events.combineFeatures({silent:!0}),we},we.uncombineFeatures=function(){return xe.events.uncombineFeatures({silent:!0}),we},we.setFeatureProperty=function(Te,Le,nt){return xe.store.setFeatureProperty(Te,Le,nt),we},te.api=V=we;var ce=Ct(te);V.onAdd=ce.onAdd,V.onRemove=ce.onRemove,V.types=ti,V.options=P}(P,this)}return Mn.modes=Pt,Mn.constants=aa,Mn.lib=ha,Mn}()},985:(kf,hl,es)=>{"use strict";function zr(t){return"function"==typeof t}function mc(t){const i=t(s=>{Error.call(s),s.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}const Ff=mc(t=>function(i){t(this),this.message=i?`${i.length} errors occurred during unsubscription:\n${i.map((s,u)=>`${u+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=i});function f(t,r){if(t){const i=t.indexOf(r);0<=i&&t.splice(i,1)}}class en{constructor(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let r;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const g of i)g.remove(this);else i.remove(this);const{initialTeardown:s}=this;if(zr(s))try{s()}catch(g){r=g instanceof Ff?g.errors:[g]}const{_finalizers:u}=this;if(u){this._finalizers=null;for(const g of u)try{bi(g)}catch(E){r=r??[],E instanceof Ff?r=[...r,...E.errors]:r.push(E)}}if(r)throw new Ff(r)}}add(r){var i;if(r&&r!==this)if(this.closed)bi(r);else{if(r instanceof en){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(r)}}_hasParent(r){const{_parentage:i}=this;return i===r||Array.isArray(i)&&i.includes(r)}_addParent(r){const{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(r),i):i?[i,r]:r}_removeParent(r){const{_parentage:i}=this;i===r?this._parentage=null:Array.isArray(i)&&f(i,r)}remove(r){const{_finalizers:i}=this;i&&f(i,r),r instanceof en&&r._removeParent(this)}}en.EMPTY=(()=>{const t=new en;return t.closed=!0,t})();const ts=en.EMPTY;function vn(t){return t instanceof en||t&&"closed"in t&&zr(t.remove)&&zr(t.add)&&zr(t.unsubscribe)}function bi(t){zr(t)?t():t.unsubscribe()}const hn={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Un={setTimeout(t,r,...i){const{delegate:s}=Un;return s?.setTimeout?s.setTimeout(t,r,...i):setTimeout(t,r,...i)},clearTimeout(t){const{delegate:r}=Un;return(r?.clearTimeout||clearTimeout)(t)},delegate:void 0};function ti(t){Un.setTimeout(()=>{const{onUnhandledError:r}=hn;if(!r)throw t;r(t)})}function on(){}const Ln=yr("C",void 0,void 0);function yr(t,r,i){return{kind:t,value:r,error:i}}let Cr=null;function go(t){if(hn.useDeprecatedSynchronousErrorHandling){const r=!Cr;if(r&&(Cr={errorThrown:!1,error:null}),t(),r){const{errorThrown:i,error:s}=Cr;if(Cr=null,i)throw s}}else t()}class aa extends en{constructor(r){super(),this.isStopped=!1,r?(this.destination=r,vn(r)&&r.add(this)):this.destination=gc}static create(r,i,s){return new Ns(r,i,s)}next(r){this.isStopped?zs(function Ba(t){return yr("N",t,void 0)}(r),this):this._next(r)}error(r){this.isStopped?zs(function io(t){return yr("E",void 0,t)}(r),this):(this.isStopped=!0,this._error(r))}complete(){this.isStopped?zs(Ln,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ns=Function.prototype.bind;function ut(t,r){return ns.call(t,r)}class su{constructor(r){this.partialObserver=r}next(r){const{partialObserver:i}=this;if(i.next)try{i.next(r)}catch(s){wt(s)}}error(r){const{partialObserver:i}=this;if(i.error)try{i.error(r)}catch(s){wt(s)}else wt(r)}complete(){const{partialObserver:r}=this;if(r.complete)try{r.complete()}catch(i){wt(i)}}}class Ns extends aa{constructor(r,i,s){let u;if(super(),zr(r)||!r)u={next:r??void 0,error:i??void 0,complete:s??void 0};else{let g;this&&hn.useDeprecatedNextContext?(g=Object.create(r),g.unsubscribe=()=>this.unsubscribe(),u={next:r.next&&ut(r.next,g),error:r.error&&ut(r.error,g),complete:r.complete&&ut(r.complete,g)}):u=r}this.destination=new su(u)}}function wt(t){hn.useDeprecatedSynchronousErrorHandling?function sa(t){hn.useDeprecatedSynchronousErrorHandling&&Cr&&(Cr.errorThrown=!0,Cr.error=t)}(t):ti(t)}function zs(t,r){const{onStoppedNotification:i}=hn;i&&Un.setTimeout(()=>i(t,r))}const gc={closed:!0,next:on,error:function Yi(t){throw t},complete:on},la="function"==typeof Symbol&&Symbol.observable||"@@observable";function rs(t){return t}function Bs(t){return 0===t.length?rs:1===t.length?t[0]:function(i){return t.reduce((s,u)=>u(s),i)}}let fr=(()=>{class t{constructor(i){i&&(this._subscribe=i)}lift(i){const s=new t;return s.source=this,s.operator=i,s}subscribe(i,s,u){const g=function mr(t){return t&&t instanceof aa||function ca(t){return t&&zr(t.next)&&zr(t.error)&&zr(t.complete)}(t)&&vn(t)}(i)?i:new Ns(i,s,u);return go(()=>{const{operator:E,source:D}=this;g.add(E?E.call(g,D):D?this._subscribe(g):this._trySubscribe(g))}),g}_trySubscribe(i){try{return this._subscribe(i)}catch(s){i.error(s)}}forEach(i,s){return new(s=uo(s))((u,g)=>{const E=new Ns({next:D=>{try{i(D)}catch(A){g(A),E.unsubscribe()}},error:g,complete:u});this.subscribe(E)})}_subscribe(i){var s;return null===(s=this.source)||void 0===s?void 0:s.subscribe(i)}[la](){return this}pipe(...i){return Bs(i)(this)}toPromise(i){return new(i=uo(i))((s,u)=>{let g;this.subscribe(E=>g=E,E=>u(E),()=>s(g))})}}return t.create=r=>new t(r),t})();function uo(t){var r;return null!==(r=t??hn.Promise)&&void 0!==r?r:Promise}const Vs=mc(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let ci=(()=>{class t extends fr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){const s=new Ui(this,this);return s.operator=i,s}_throwIfClosed(){if(this.closed)throw new Vs}next(i){go(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const s of this.currentObservers)s.next(i)}})}error(i){go(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;const{observers:s}=this;for(;s.length;)s.shift().error(i)}})}complete(){go(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return(null===(i=this.observers)||void 0===i?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){const{hasError:s,isStopped:u,observers:g}=this;return s||u?ts:(this.currentObservers=null,g.push(i),new en(()=>{this.currentObservers=null,f(g,i)}))}_checkFinalizedStatuses(i){const{hasError:s,thrownError:u,isStopped:g}=this;s?i.error(u):g&&i.complete()}asObservable(){const i=new fr;return i.source=this,i}}return t.create=(r,i)=>new Ui(r,i),t})();class Ui extends ci{constructor(r,i){super(),this.destination=r,this.source=i}next(r){var i,s;null===(s=null===(i=this.destination)||void 0===i?void 0:i.next)||void 0===s||s.call(i,r)}error(r){var i,s;null===(s=null===(i=this.destination)||void 0===i?void 0:i.error)||void 0===s||s.call(i,r)}complete(){var r,i;null===(i=null===(r=this.destination)||void 0===r?void 0:r.complete)||void 0===i||i.call(r)}_subscribe(r){var i,s;return null!==(s=null===(i=this.source)||void 0===i?void 0:i.subscribe(r))&&void 0!==s?s:ts}}function Va(t){return zr(t?.lift)}function ni(t){return r=>{if(Va(r))return r.lift(function(i){try{return t(i,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function er(t,r,i,s,u){return new kn(t,r,i,s,u)}class kn extends aa{constructor(r,i,s,u,g,E){super(r),this.onFinalize=g,this.shouldUnsubscribe=E,this._next=i?function(D){try{i(D)}catch(A){r.error(A)}}:super._next,this._error=u?function(D){try{u(D)}catch(A){r.error(A)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(D){r.error(D)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:i}=this;super.unsubscribe(),!i&&(null===(r=this.onFinalize)||void 0===r||r.call(this))}}}function _r(t,r){return ni((i,s)=>{let u=0;i.subscribe(er(s,g=>{s.next(t.call(r,g,u++))}))})}function Jn(t){return this instanceof Jn?(this.v=t,this):new Jn(t)}function Gi(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=t[Symbol.asyncIterator];return r?r.call(t):(t=function nn(t){var r="function"==typeof Symbol&&Symbol.iterator,i=r&&t[r],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i);function s(g){i[g]=t[g]&&function(E){return new Promise(function(D,A){!function u(g,E,D,A){Promise.resolve(A).then(function(N){g({value:N,done:D})},E)}(D,A,(E=t[g](E)).done,E.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const ht=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function yt(t){return zr(t?.then)}function gt(t){return zr(t[la])}function pt(t){return Symbol.asyncIterator&&zr(t?.[Symbol.asyncIterator])}function Tt(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const tn=function dt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Wn(t){return zr(t?.[tn])}function Ut(t){return function nr(t,r,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,s=i.apply(t,r||[]),g=[];return u={},E("next"),E("throw"),E("return"),u[Symbol.asyncIterator]=function(){return this},u;function E(fe){s[fe]&&(u[fe]=function(ve){return new Promise(function(ze,et){g.push([fe,ve,ze,et])>1||D(fe,ve)})})}function D(fe,ve){try{!function A(fe){fe.value instanceof Jn?Promise.resolve(fe.value.v).then(N,H):ne(g[0][2],fe)}(s[fe](ve))}catch(ze){ne(g[0][3],ze)}}function N(fe){D("next",fe)}function H(fe){D("throw",fe)}function ne(fe,ve){fe(ve),g.shift(),g.length&&D(g[0][0],g[0][1])}}(this,arguments,function*(){const i=t.getReader();try{for(;;){const{value:s,done:u}=yield Jn(i.read());if(u)return yield Jn(void 0);yield yield Jn(s)}}finally{i.releaseLock()}})}function Xn(t){return zr(t?.getReader)}function Vn(t){if(t instanceof fr)return t;if(null!=t){if(gt(t))return function Zr(t){return new fr(r=>{const i=t[la]();if(zr(i.subscribe))return i.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(ht(t))return function Wr(t){return new fr(r=>{for(let i=0;i<t.length&&!r.closed;i++)r.next(t[i]);r.complete()})}(t);if(yt(t))return function Li(t){return new fr(r=>{t.then(i=>{r.closed||(r.next(i),r.complete())},i=>r.error(i)).then(null,ti)})}(t);if(pt(t))return Ho(t);if(Wn(t))return function Go(t){return new fr(r=>{for(const i of t)if(r.next(i),r.closed)return;r.complete()})}(t);if(Xn(t))return function Br(t){return Ho(Ut(t))}(t)}throw Tt(t)}function Ho(t){return new fr(r=>{(function so(t,r){var i,s,u,g;return function Ot(t,r,i,s){return new(i||(i=Promise))(function(g,E){function D(H){try{N(s.next(H))}catch(ne){E(ne)}}function A(H){try{N(s.throw(H))}catch(ne){E(ne)}}function N(H){H.done?g(H.value):function u(g){return g instanceof i?g:new i(function(E){E(g)})}(H.value).then(D,A)}N((s=s.apply(t,r||[])).next())})}(this,void 0,void 0,function*(){try{for(i=Gi(t);!(s=yield i.next()).done;)if(r.next(s.value),r.closed)return}catch(E){u={error:E}}finally{try{s&&!s.done&&(g=i.return)&&(yield g.call(i))}finally{if(u)throw u.error}}r.complete()})})(t,r).catch(i=>r.error(i))})}function yi(t,r,i,s=0,u=!1){const g=r.schedule(function(){i(),u?t.add(this.schedule(null,s)):this.unsubscribe()},s);if(t.add(g),!u)return g}function fi(t,r,i=1/0){return zr(r)?fi((s,u)=>_r((g,E)=>r(s,g,u,E))(Vn(t(s,u))),i):("number"==typeof r&&(i=r),ni((s,u)=>function ua(t,r,i,s,u,g,E,D){const A=[];let N=0,H=0,ne=!1;const fe=()=>{ne&&!A.length&&!N&&r.complete()},ve=et=>N<s?ze(et):A.push(et),ze=et=>{g&&r.next(et),N++;let bt=!1;Vn(i(et,H++)).subscribe(er(r,kt=>{u?.(kt),g?ve(kt):r.next(kt)},()=>{bt=!0},void 0,()=>{if(bt)try{for(N--;A.length&&N<s;){const kt=A.shift();E?yi(r,E,()=>ze(kt)):ze(kt)}fe()}catch(kt){r.error(kt)}}))};return t.subscribe(er(r,ve,()=>{ne=!0,fe()})),()=>{D?.()}}(s,u,t,i)))}function ja(t=1/0){return fi(rs,t)}const yo=new fr(t=>t.complete());function xs(t){return t[t.length-1]}function wi(t){return zr(xs(t))?t.pop():void 0}function ki(t){return function dl(t){return t&&zr(t.schedule)}(xs(t))?t.pop():void 0}function vo(t,r=0){return ni((i,s)=>{i.subscribe(er(s,u=>yi(s,t,()=>s.next(u),r),()=>yi(s,t,()=>s.complete(),r),u=>yi(s,t,()=>s.error(u),r)))})}function Ei(t,r=0){return ni((i,s)=>{s.add(t.schedule(()=>i.subscribe(s),r))})}function bs(t,r){if(!t)throw new Error("Iterable cannot be null");return new fr(i=>{yi(i,r,()=>{const s=t[Symbol.asyncIterator]();yi(i,r,()=>{s.next().then(u=>{u.done?i.complete():i.next(u.value)})},0,!0)})})}function Vr(t,r){return r?function pi(t,r){if(null!=t){if(gt(t))return function $s(t,r){return Vn(t).pipe(Ei(r),vo(r))}(t,r);if(ht(t))return function De(t,r){return new fr(i=>{let s=0;return r.schedule(function(){s===t.length?i.complete():(i.next(t[s++]),i.closed||this.schedule())})})}(t,r);if(yt(t))return function ho(t,r){return Vn(t).pipe(Ei(r),vo(r))}(t,r);if(pt(t))return bs(t,r);if(Wn(t))return function Pt(t,r){return new fr(i=>{let s;return yi(i,r,()=>{s=t[tn](),yi(i,r,()=>{let u,g;try{({value:u,done:g}=s.next())}catch(E){return void i.error(E)}g?i.complete():i.next(u)},0,!0)}),()=>zr(s?.return)&&s.return()})}(t,r);if(Xn(t))return function ws(t,r){return bs(Ut(t),r)}(t,r)}throw Tt(t)}(t,r):Vn(t)}class mi extends ci{constructor(r){super(),this._value=r}get value(){return this.getValue()}_subscribe(r){const i=super._subscribe(r);return!i.closed&&r.next(this._value),i}getValue(){const{hasError:r,thrownError:i,_value:s}=this;if(r)throw i;return this._throwIfClosed(),s}next(r){super.next(this._value=r)}}function Tn(...t){return Vr(t,ki(t))}function cd(t={}){const{connector:r=(()=>new ci),resetOnError:i=!0,resetOnComplete:s=!0,resetOnRefCountZero:u=!0}=t;return g=>{let E,D,A,N=0,H=!1,ne=!1;const fe=()=>{D?.unsubscribe(),D=void 0},ve=()=>{fe(),E=A=void 0,H=ne=!1},ze=()=>{const et=E;ve(),et?.unsubscribe()};return ni((et,bt)=>{N++,!ne&&!H&&fe();const kt=A=A??r();bt.add(()=>{N--,0===N&&!ne&&!H&&(D=ha(ze,u))}),kt.subscribe(bt),!E&&N>0&&(E=new Ns({next:st=>kt.next(st),error:st=>{ne=!0,fe(),D=ha(ve,i,st),kt.error(st)},complete:()=>{H=!0,fe(),D=ha(ve,s),kt.complete()}}),Vn(et).subscribe(E))})(g)}}function ha(t,r,...i){if(!0===r)return void t();if(!1===r)return;const s=new Ns({next:()=>{s.unsubscribe(),t()}});return Vn(r(...i)).subscribe(s)}function He(t,r){return ni((i,s)=>{let u=null,g=0,E=!1;const D=()=>E&&!u&&s.complete();i.subscribe(er(s,A=>{u?.unsubscribe();let N=0;const H=g++;Vn(t(A,H)).subscribe(u=er(s,ne=>s.next(r?r(A,ne,H,N++):ne),()=>{u=null,D()}))},()=>{E=!0,D()}))})}function P(t,r){return t===r}function V(t){for(let r in t)if(t[r]===V)return r;throw Error("Could not find renamed property on target object.")}function te(t,r){for(const i in r)r.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=r[i])}function ce(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(ce).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const r=t.toString();if(null==r)return""+r;const i=r.indexOf("\n");return-1===i?r:r.substring(0,i)}function xe(t,r){return null==t||""===t?null===r?"":r:null==r||""===r?t:t+" "+r}const we=V({__forward_ref__:V});function Te(t){return t.__forward_ref__=Te,t.toString=function(){return ce(this())},t}function Le(t){return nt(t)?t():t}function nt(t){return"function"==typeof t&&t.hasOwnProperty(we)&&t.__forward_ref__===Te}function jt(t){return t&&!!t.\u0275providers}class $e extends Error{constructor(r,i){super(function Tr(t,r){return`NG0${Math.abs(t)}${r?": "+r:""}`}(r,i)),this.code=r}}function Mt(t){return"string"==typeof t?t:null==t?"":String(t)}function pr(t,r){throw new $e(-201,!1)}function Ao(t,r){null==t&&function fn(t,r,i,s){throw new Error(`ASSERTION ERROR: ${t}`+(null==s?"":` [Expected=> ${i} ${s} ${r} <=Actual]`))}(r,t,null,"!=")}function Cn(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Ji(t){return{providers:t.providers||[],imports:t.imports||[]}}function Ua(t){return Gs(t,da)||Gs(t,uu)}function Gs(t,r){return t.hasOwnProperty(r)?t[r]:null}function xo(t){return t&&(t.hasOwnProperty(bc)||t.hasOwnProperty(ml))?t[bc]:null}const da=V({\u0275prov:V}),bc=V({\u0275inj:V}),uu=V({ngInjectableDef:V}),ml=V({ngInjectorDef:V});var Pn=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(Pn||{});let Cs;function Xr(t){const r=Cs;return Cs=t,r}function wc(t,r,i){const s=Ua(t);return s&&"root"==s.providedIn?void 0===s.value?s.value=s.factory():s.value:i&Pn.Optional?null:void 0!==r?r:void pr(ce(t))}const Wt=globalThis;class sn{constructor(r,i){this._desc=r,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=Cn({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const fo={},is="__NG_DI_FLAG__",ct="ngTempTokenPath",pu=/\n/gm,_l="__source";let Hs;function Ts(t){const r=Hs;return Hs=t,r}function Ha(t,r=Pn.Default){if(void 0===Hs)throw new $e(-203,!1);return null===Hs?wc(t,void 0,r):Hs.get(t,r&Pn.Optional?null:void 0,r)}function yn(t,r=Pn.Default){return(function ih(){return Cs}()||Ha)(Le(t),r)}function Qt(t,r=Pn.Default){return yn(t,ya(r))}function ya(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Tc(t){const r=[];for(let i=0;i<t.length;i++){const s=Le(t[i]);if(Array.isArray(s)){if(0===s.length)throw new $e(900,!1);let u,g=Pn.Default;for(let E=0;E<s.length;E++){const D=s[E],A=sh(D);"number"==typeof A?-1===A?u=D.token:g|=A:u=D}r.push(yn(u,g))}else r.push(yn(s))}return r}function Po(t,r){return t[is]=r,t.prototype[is]=r,t}function sh(t){return t[is]}function Zs(t){return{toString:t}.toString()}var vl=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(vl||{}),Ro=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Ro||{});const os={},or=[],Mc=V({\u0275cmp:V}),qa=V({\u0275dir:V}),xl=V({\u0275pipe:V}),ql=V({\u0275mod:V}),Ie=V({\u0275fac:V}),We=V({__NG_ELEMENT_ID__:V}),Bt=V({__NG_ENV_ID__:V});function an(t,r,i){let s=t.length;for(;;){const u=t.indexOf(r,i);if(-1===u)return u;if(0===u||t.charCodeAt(u-1)<=32){const g=r.length;if(u+g===s||t.charCodeAt(u+g)<=32)return u}i=u+1}}function Fn(t,r,i){let s=0;for(;s<i.length;){const u=i[s];if("number"==typeof u){if(0!==u)break;s++;const g=i[s++],E=i[s++],D=i[s++];t.setAttribute(r,E,D,g)}else{const g=u,E=i[++s];Mr(g)?t.setProperty(r,g,E):t.setAttribute(r,g,E),s++}}return s}function Hn(t){return 3===t||4===t||6===t}function Mr(t){return 64===t.charCodeAt(0)}function jr(t,r){if(null!==r&&0!==r.length)if(null===t||0===t.length)t=r.slice();else{let i=-1;for(let s=0;s<r.length;s++){const u=r[s];"number"==typeof u?i=u:0===i||Zo(t,i,u,null,-1===i||2===i?r[++s]:null)}}return t}function Zo(t,r,i,s,u){let g=0,E=t.length;if(-1===r)E=-1;else for(;g<t.length;){const D=t[g++];if("number"==typeof D){if(D===r){E=-1;break}if(D>r){E=g-1;break}}}for(;g<t.length;){const D=t[g];if("number"==typeof D)break;if(D===i){if(null===s)return void(null!==u&&(t[g+1]=u));if(s===t[g+1])return void(t[g+2]=u)}g++,null!==s&&g++,null!==u&&g++}-1!==E&&(t.splice(E,0,r),g=E+1),t.splice(g++,0,i),null!==s&&t.splice(g++,0,s),null!==u&&t.splice(g++,0,u)}const ri="ng-template";function Ti(t,r,i){let s=0,u=!0;for(;s<t.length;){let g=t[s++];if("string"==typeof g&&u){const E=t[s++];if(i&&"class"===g&&-1!==an(E.toLowerCase(),r,0))return!0}else{if(1===g){for(;s<t.length&&"string"==typeof(g=t[s++]);)if(g.toLowerCase()===r)return!0;return!1}"number"==typeof g&&(u=!1)}}return!1}function Oo(t){return 4===t.type&&t.value!==ri}function ss(t,r,i){return r===(4!==t.type||i?t.value:ri)}function ao(t,r,i){let s=4;const u=t.attrs||[],g=function va(t){for(let r=0;r<t.length;r++)if(Hn(t[r]))return r;return t.length}(u);let E=!1;for(let D=0;D<r.length;D++){const A=r[D];if("number"!=typeof A){if(!E)if(4&s){if(s=2|1&s,""!==A&&!ss(t,A,i)||""===A&&1===r.length){if(Mi(s))return!1;E=!0}}else{const N=8&s?A:r[++D];if(8&s&&null!==t.attrs){if(!Ti(t.attrs,N,i)){if(Mi(s))return!1;E=!0}continue}const ne=mn(8&s?"class":A,u,Oo(t),i);if(-1===ne){if(Mi(s))return!1;E=!0;continue}if(""!==N){let fe;fe=ne>g?"":u[ne+1].toLowerCase();const ve=8&s?fe:null;if(ve&&-1!==an(ve,N,0)||2&s&&N!==fe){if(Mi(s))return!1;E=!0}}}}else{if(!E&&!Mi(s)&&!Mi(A))return!1;if(E&&Mi(A))continue;E=!1,s=A|1&s}}return Mi(s)||E}function Mi(t){return 0==(1&t)}function mn(t,r,i,s){if(null===r)return-1;let u=0;if(s||!i){let g=!1;for(;u<r.length;){const E=r[u];if(E===t)return u;if(3===E||6===E)g=!0;else{if(1===E||2===E){let D=r[++u];for(;"string"==typeof D;)D=r[++u];continue}if(4===E)break;if(0===E){u+=4;continue}}u+=g?1:2}return-1}return function Wa(t,r){let i=t.indexOf(4);if(i>-1)for(i++;i<t.length;){const s=t[i];if("number"==typeof s)return-1;if(s===r)return i;i++}return-1}(r,t)}function Za(t,r,i=!1){for(let s=0;s<r.length;s++)if(ao(t,r[s],i))return!0;return!1}function bl(t,r){return t?":not("+r.trim()+")":r}function Lr(t){let r=t[0],i=1,s=2,u="",g=!1;for(;i<t.length;){let E=t[i];if("string"==typeof E)if(2&s){const D=t[++i];u+="["+E+(D.length>0?'="'+D+'"':"")+"]"}else 8&s?u+="."+E:4&s&&(u+=" "+E);else""!==u&&!Mi(E)&&(r+=bl(g,u),u=""),s=E,g=g||!Mi(s);i++}return""!==u&&(r+=bl(g,u)),r}function as(t){return Zs(()=>{const r=Xs(t),i={...r,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===vl.OnPush,directiveDefs:null,pipeDefs:null,dependencies:r.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Ro.Emulated,styles:t.styles||or,_:null,schemas:t.schemas||null,tView:null,id:""};Wl(i);const s=t.dependencies;return i.directiveDefs=xa(s,!1),i.pipeDefs=xa(s,!0),i.id=function zf(t){let r=0;const i=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const u of i)r=Math.imul(31,r)+u.charCodeAt(0)<<0;return r+=2147483648,"c"+r}(i),i})}function Lo(t){return $n(t)||Di(t)}function Ms(t){return null!==t}function qi(t){return Zs(()=>({type:t.type,bootstrap:t.bootstrap||or,declarations:t.declarations||or,imports:t.imports||or,exports:t.exports||or,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function Ds(t,r){if(null==t)return os;const i={};for(const s in t)if(t.hasOwnProperty(s)){let u=t[s],g=u;Array.isArray(u)&&(g=u[1],u=u[0]),i[u]=s,r&&(r[u]=g)}return i}function xn(t){return Zs(()=>{const r=Xs(t);return Wl(r),r})}function $n(t){return t[Mc]||null}function Di(t){return t[qa]||null}function Fi(t){return t[xl]||null}function Yr(t,r){const i=t[ql]||null;if(!i&&!0===r)throw new Error(`Type ${ce(t)} does not have '\u0275mod' property.`);return i}function Xs(t){const r={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:r,inputTransforms:null,inputConfig:t.inputs||os,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||or,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Ds(t.inputs,r),outputs:Ds(t.outputs)}}function Wl(t){t.features?.forEach(r=>r(t))}function xa(t,r){if(!t)return null;const i=r?Fi:Lo;return()=>("function"==typeof t?t():t).map(s=>i(s)).filter(Ms)}const Ni=0,Zt=1,jn=2,kr=3,Ys=4,wl=5,ko=6,bo=7,Zi=8,Js=9,gu=10,Nn=11,_u=12,Sc=13,Ic=14,Si=15,yu=16,vu=17,Ii=18,ah=19,pd=20,Xa=21,Ss=22,Ac=23,Xl=24,sr=25,El=1,Bf=2,ba=7,Is=9,Jr=11;function Wo(t){return Array.isArray(t)&&"object"==typeof t[El]}function zi(t){return Array.isArray(t)&&!0===t[El]}function Rc(t){return 0!=(4&t.flags)}function Tl(t){return t.componentOffset>-1}function bu(t){return 1==(1&t.flags)}function ls(t){return!!t.template}function Vf(t){return 0!=(512&t[jn])}function Ya(t,r){return t.hasOwnProperty(Ie)?t[Ie]:null}let wo=null,xd=!1;function Rs(t){const r=wo;return wo=t,r}const ch={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function Zf(t){if(!Dl(t)||t.dirty){if(!t.producerMustRecompute(t)&&!Xf(t))return void(t.dirty=!1);t.producerRecomputeValue(t),t.dirty=!1}}function bd(t){t.dirty=!0,function Wf(t){if(void 0===t.liveConsumerNode)return;const r=xd;xd=!0;try{for(const i of t.liveConsumerNode)i.dirty||bd(i)}finally{xd=r}}(t),t.consumerMarkedDirty?.(t)}function wd(t){return t&&(t.nextProducerIndex=0),Rs(t)}function Ed(t,r){if(Rs(r),t&&void 0!==t.producerNode&&void 0!==t.producerIndexOfThis&&void 0!==t.producerLastReadVersion){if(Dl(t))for(let i=t.nextProducerIndex;i<t.producerNode.length;i++)Ml(t.producerNode[i],t.producerIndexOfThis[i]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function Xf(t){Lc(t);for(let r=0;r<t.producerNode.length;r++){const i=t.producerNode[r],s=t.producerLastReadVersion[r];if(s!==i.version||(Zf(i),s!==i.version))return!0}return!1}function Cu(t){if(Lc(t),Dl(t))for(let r=0;r<t.producerNode.length;r++)Ml(t.producerNode[r],t.producerIndexOfThis[r]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function Ml(t,r){if(function Jf(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}(t),Lc(t),1===t.liveConsumerNode.length)for(let s=0;s<t.producerNode.length;s++)Ml(t.producerNode[s],t.producerIndexOfThis[s]);const i=t.liveConsumerNode.length-1;if(t.liveConsumerNode[r]=t.liveConsumerNode[i],t.liveConsumerIndexOfThis[r]=t.liveConsumerIndexOfThis[i],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,r<t.liveConsumerNode.length){const s=t.liveConsumerIndexOfThis[r],u=t.liveConsumerNode[r];Lc(u),u.producerIndexOfThis[s]=r}}function Dl(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Lc(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}let Bi=null;const m=()=>{},l=(()=>({...ch,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule(t.ref)},hasRun:!1,cleanupFn:m}))();class y{constructor(r,i,s){this.previousValue=r,this.currentValue=i,this.firstChange=s}isFirstChange(){return this.firstChange}}function x(){return w}function w(t){return t.type.prototype.ngOnChanges&&(t.setInput=S),T}function T(){const t=k(this),r=t?.current;if(r){const i=t.previous;if(i===os)t.previous=r;else for(let s in r)i[s]=r[s];t.current=null,this.ngOnChanges(r)}}function S(t,r,i,s){const u=this.declaredInputs[i],g=k(t)||function z(t,r){return t[O]=r}(t,{previous:os,current:null}),E=g.current||(g.current={}),D=g.previous,A=D[u];E[u]=new y(A&&A.currentValue,r,D===os),t[s]=r}x.ngInherit=!0;const O="__ngSimpleChanges__";function k(t){return t[O]||null}const G=function(t,r,i){};function q(t){for(;Array.isArray(t);)t=t[Ni];return t}function ee(t,r){return q(r[t])}function se(t,r){return q(r[t.index])}function K(t,r){return t.data[r]}function he(t,r){const i=r[t];return Wo(i)?i:i[Ni]}function Ne(t,r){return null==r?null:t[r]}function Ae(t){t[vu]=0}function Oe(t){1024&t[jn]||(t[jn]|=1024,Ve(t,1))}function be(t){1024&t[jn]&&(t[jn]&=-1025,Ve(t,-1))}function Ve(t,r){let i=t[kr];if(null===i)return;i[wl]+=r;let s=i;for(i=i[kr];null!==i&&(1===r&&1===s[wl]||-1===r&&0===s[wl]);)i[wl]+=r,s=i,i=i[kr]}const re={lFrame:H_(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Vt(){return re.bindingsEnabled}function ke(){return re.lFrame.lView}function ln(){return re.lFrame.tView}function ar(t){return re.lFrame.contextLView=t,t[Zi]}function Eo(t){return re.lFrame.contextLView=null,t}function Kr(){let t=lr();for(;null!==t&&64===t.type;)t=t.parent;return t}function lr(){return re.lFrame.currentTNode}function In(t,r){const i=re.lFrame;i.currentTNode=t,i.isParent=r}function Sr(){return re.lFrame.isParent}function zo(){return re.lFrame.bindingIndex++}function Sl(t,r){const i=re.lFrame;i.bindingIndex=i.bindingRootIndex=t,rp(r)}function rp(t){re.lFrame.currentDirectiveIndex=t}function kc(t){re.lFrame.currentQueryIndex=t}function op(t){const r=t[Zt];return 2===r.type?r.declTNode:1===r.type?t[ko]:null}function zm(t,r,i){if(i&Pn.SkipSelf){let u=r,g=t;for(;!(u=u.parent,null!==u||i&Pn.Host||(u=op(g),null===u||(g=g[Ic],10&u.type))););if(null===u)return!1;r=u,t=g}const s=re.lFrame=Bm();return s.currentTNode=r,s.lView=t,!0}function Td(t){const r=Bm(),i=t[Zt];re.lFrame=r,r.currentTNode=i.firstChild,r.lView=t,r.tView=i,r.contextLView=t,r.bindingIndex=i.bindingStartIndex,r.inI18n=!1}function Bm(){const t=re.lFrame,r=null===t?null:t.child;return null===r?H_(t):r}function H_(t){const r={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=r),r}function Vm(){const t=re.lFrame;return re.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const q_=Vm;function jm(){const t=Vm();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function cs(){return re.lFrame.selectedIndex}function Mu(t){re.lFrame.selectedIndex=t}let Z_=!0;function Um(){return Z_}function Du(t){Z_=t}function sp(t,r){for(let i=r.directiveStart,s=r.directiveEnd;i<s;i++){const g=t.data[i].type.prototype,{ngAfterContentInit:E,ngAfterContentChecked:D,ngAfterViewInit:A,ngAfterViewChecked:N,ngOnDestroy:H}=g;E&&(t.contentHooks??=[]).push(-i,E),D&&((t.contentHooks??=[]).push(i,D),(t.contentCheckHooks??=[]).push(i,D)),A&&(t.viewHooks??=[]).push(-i,A),N&&((t.viewHooks??=[]).push(i,N),(t.viewCheckHooks??=[]).push(i,N)),null!=H&&(t.destroyHooks??=[]).push(i,H)}}function Gm(t,r,i){N0(t,r,3,i)}function ap(t,r,i,s){(3&t[jn])===i&&N0(t,r,i,s)}function Hm(t,r){let i=t[jn];(3&i)===r&&(i&=8191,i+=1,t[jn]=i)}function N0(t,r,i,s){const g=s??-1,E=r.length-1;let D=0;for(let A=void 0!==s?65535&t[vu]:0;A<E;A++)if("number"==typeof r[A+1]){if(D=r[A],null!=s&&D>=s)break}else r[A]<0&&(t[vu]+=65536),(D<g||-1==g)&&(lp(t,i,r,A),t[vu]=(4294901760&t[vu])+A+2),A++}function qm(t,r){G(4,t,r);const i=Rs(null);try{r.call(t)}finally{Rs(i),G(5,t,r)}}function lp(t,r,i,s){const u=i[s]<0,g=i[s+1],D=t[u?-i[s]:i[s]];u?t[jn]>>13<t[vu]>>16&&(3&t[jn])===r&&(t[jn]+=8192,qm(D,g)):qm(D,g)}const ph=-1;class mh{constructor(r,i,s){this.factory=r,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=s}}function X_(t){return t!==ph}function Fc(t){return 32767&t}function cp(t,r){let i=function fw(t){return t>>16}(t),s=r;for(;i>0;)s=s[Ic],i--;return s}let up=!0;function Dd(t){const r=up;return up=t,r}const _h=255,Ql=5;let Il=0;const Xo={};function Al(t,r){const i=z0(t,r);if(-1!==i)return i;const s=r[Zt];s.firstCreatePass&&(t.injectorIndex=r.length,Y_(s.data,t),Y_(r,null),Y_(s.blueprint,null));const u=Xm(t,r),g=t.injectorIndex;if(X_(u)){const E=Fc(u),D=cp(u,r),A=D[Zt].data;for(let N=0;N<8;N++)r[g+N]=D[E+N]|A[E+N]}return r[g+8]=u,g}function Y_(t,r){t.push(0,0,0,0,0,0,0,0,r)}function z0(t,r){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===r[t.injectorIndex+8]?-1:t.injectorIndex}function Xm(t,r){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let i=0,s=null,u=r;for(;null!==u;){if(s=Q_(u),null===s)return ph;if(i++,u=u[Ic],-1!==s.injectorIndex)return s.injectorIndex|i<<16}return ph}function J_(t,r,i){!function yh(t,r,i){let s;"string"==typeof i?s=i.charCodeAt(0)||0:i.hasOwnProperty(We)&&(s=i[We]),null==s&&(s=i[We]=Il++);const u=s&_h;r.data[t+(u>>Ql)]|=1<<u}(t,r,i)}function Nc(t,r,i){if(i&Pn.Optional||void 0!==t)return t;pr()}function eo(t,r,i,s){if(i&Pn.Optional&&void 0===s&&(s=null),!(i&(Pn.Self|Pn.Host))){const u=t[Js],g=Xr(void 0);try{return u?u.get(r,s,i&Pn.Optional):wc(r,s,i&Pn.Optional)}finally{Xr(g)}}return Nc(s,0,i)}function to(t,r,i,s=Pn.Default,u){if(null!==t){if(2048&r[jn]&&!(s&Pn.Self)){const E=function U0(t,r,i,s,u){let g=t,E=r;for(;null!==g&&null!==E&&2048&E[jn]&&!(512&E[jn]);){const D=K_(g,E,i,s|Pn.Self,Xo);if(D!==Xo)return D;let A=g.parent;if(!A){const N=E[pd];if(N){const H=N.get(i,Xo,s);if(H!==Xo)return H}A=Q_(E),E=E[Ic]}g=A}return u}(t,r,i,s,Xo);if(E!==Xo)return E}const g=K_(t,r,i,s,Xo);if(g!==Xo)return g}return eo(r,i,s,u)}function K_(t,r,i,s,u){const g=function Qr(t){if("string"==typeof t)return t.charCodeAt(0)||0;const r=t.hasOwnProperty(We)?t[We]:void 0;return"number"==typeof r?r>=0?r&_h:oi:r}(i);if("function"==typeof g){if(!zm(r,t,s))return s&Pn.Host?Nc(u,0,s):eo(r,i,s,u);try{let E;if(E=g(s),null!=E||s&Pn.Optional)return E;pr()}finally{q_()}}else if("number"==typeof g){let E=null,D=z0(t,r),A=ph,N=s&Pn.Host?r[Si][ko]:null;for((-1===D||s&Pn.SkipSelf)&&(A=-1===D?Xm(t,r):r[D+8],A!==ph&&zc(s,!1)?(E=r[Zt],D=Fc(A),r=cp(A,r)):D=-1);-1!==D;){const H=r[Zt];if(Jm(g,D,H.data)){const ne=V0(D,r,i,E,s,N);if(ne!==Xo)return ne}A=r[D+8],A!==ph&&zc(s,r[Zt].data[D+8]===N)&&Jm(g,D,r)?(E=H,D=Fc(A),r=cp(A,r)):D=-1}}return u}function V0(t,r,i,s,u,g){const E=r[Zt],D=E.data[t+8],H=function Ym(t,r,i,s,u){const g=t.providerIndexes,E=r.data,D=1048575&g,A=t.directiveStart,H=g>>20,fe=u?D+H:t.directiveEnd;for(let ve=s?D:D+H;ve<fe;ve++){const ze=E[ve];if(ve<A&&i===ze||ve>=A&&ze.type===i)return ve}if(u){const ve=E[A];if(ve&&ls(ve)&&ve.type===i)return A}return null}(D,E,i,null==s?Tl(D)&&up:s!=E&&0!=(3&D.type),u&Pn.Host&&g===D);return null!==H?vh(r,E,H,D):Xo}function vh(t,r,i,s){let u=t[i];const g=r.data;if(function Zm(t){return t instanceof mh}(u)){const E=u;E.resolving&&function ft(t,r){const i=r?`. Dependency path: ${r.join(" > ")} > ${t}`:"";throw new $e(-200,`Circular dependency in DI detected for ${t}${i}`)}(function _n(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Mt(t)}(g[i]));const D=Dd(E.canSeeViewProviders);E.resolving=!0;const N=E.injectImpl?Xr(E.injectImpl):null;zm(t,s,Pn.Default);try{u=t[i]=E.factory(void 0,g,t,s),r.firstCreatePass&&i>=s.directiveStart&&function $m(t,r,i){const{ngOnChanges:s,ngOnInit:u,ngDoCheck:g}=r.type.prototype;if(s){const E=w(r);(i.preOrderHooks??=[]).push(t,E),(i.preOrderCheckHooks??=[]).push(t,E)}u&&(i.preOrderHooks??=[]).push(0-t,u),g&&((i.preOrderHooks??=[]).push(t,g),(i.preOrderCheckHooks??=[]).push(t,g))}(i,g[i],r)}finally{null!==N&&Xr(N),Dd(D),E.resolving=!1,q_()}}return u}function Jm(t,r,i){return!!(i[r+(t>>Ql)]&1<<t)}function zc(t,r){return!(t&Pn.Self||t&Pn.Host&&r)}class us{constructor(r,i){this._tNode=r,this._lView=i}get(r,i,s){return to(this._tNode,this._lView,r,ya(s),i)}}function oi(){return new us(Kr(),ke())}function Co(t){return Zs(()=>{const r=t.prototype.constructor,i=r[Ie]||el(r),s=Object.prototype;let u=Object.getPrototypeOf(t.prototype).constructor;for(;u&&u!==s;){const g=u[Ie]||el(u);if(g&&g!==i)return g;u=Object.getPrototypeOf(u)}return g=>new g})}function el(t){return nt(t)?()=>{const r=el(Le(t));return r&&r()}:Ya(t)}function Q_(t){const r=t[Zt],i=r.type;return 2===i?r.declTNode:1===i?t[ko]:null}const Iu="__parameters__";function xh(t,r,i){return Zs(()=>{const s=function Km(t){return function(...i){if(t){const s=t(...i);for(const u in s)this[u]=s[u]}}}(r);function u(...g){if(this instanceof u)return s.apply(this,g),this;const E=new u(...g);return D.annotation=E,D;function D(A,N,H){const ne=A.hasOwnProperty(Iu)?A[Iu]:Object.defineProperty(A,Iu,{value:[]})[Iu];for(;ne.length<=H;)ne.push(null);return(ne[H]=ne[H]||[]).push(E),A}}return i&&(u.prototype=Object.create(i.prototype)),u.prototype.ngMetadataName=t,u.annotationCls=u,u})}function Eh(t,r){t.forEach(i=>Array.isArray(i)?Eh(i,r):r(i))}function ny(t,r,i){r>=t.length?t.push(i):t.splice(r,0,i)}function dp(t,r){return r>=t.length-1?t.pop():t.splice(r,1)[0]}function Ks(t,r,i){let s=Ad(t,r);return s>=0?t[1|s]=i:(s=~s,function q0(t,r,i,s){let u=t.length;if(u==r)t.push(i,s);else if(1===u)t.push(s,t[0]),t[0]=i;else{for(u--,t.push(t[u-1],t[u]);u>r;)t[u]=t[u-2],u--;t[r]=i,t[r+1]=s}}(t,s,r,i)),s}function Pl(t,r){const i=Ad(t,r);if(i>=0)return t[1|i]}function Ad(t,r){return function Qm(t,r,i){let s=0,u=t.length>>i;for(;u!==s;){const g=s+(u-s>>1),E=t[g<<i];if(r===E)return g<<i;E>r?u=g:s=g+1}return~(u<<i)}(t,r,1)}const pp=Po(xh("Optional"),8),Pd=Po(xh("SkipSelf"),4);function vp(t){return 128==(128&t.flags)}var Vc=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Vc||{});const rg=new Map;let Sw=0;const dy="__ngContext__";function ds(t,r){Wo(r)?(t[dy]=r[ah],function Iw(t){rg.set(t[ah],t)}(r)):t[dy]=r}let no;function Dh(t,r){return no(t,r)}function Sh(t){const r=t[kr];return zi(r)?r[kr]:r}function my(t){return _y(t[_u])}function gy(t){return _y(t[Ys])}function _y(t){for(;null!==t&&!zi(t);)t=t[Ys];return t}function Ou(t,r,i,s,u){if(null!=s){let g,E=!1;zi(s)?g=s:Wo(s)&&(E=!0,s=s[Ni]);const D=q(s);0===t&&null!==i?null==u?Dp(r,i,D):Lu(r,i,D,u||null,!0):1===t&&null!==i?Lu(r,i,D,u||null,!0):2===t?function Pp(t,r,i){const s=ku(t,r);s&&function Fd(t,r,i,s){t.removeChild(r,i,s)}(t,s,r,i)}(r,D,E):3===t&&r.destroyNode(D),null!=g&&function hr(t,r,i,s,u){const g=i[ba];g!==q(i)&&Ou(r,t,s,g,u);for(let D=Jr;D<i.length;D++){const A=i[D];Uc(A[Zt],A,t,r,s,g)}}(r,t,g,i,u)}}function fs(t,r,i){return t.createElement(r,i)}function Cp(t,r){const i=t[Is],s=i.indexOf(r);be(r),i.splice(s,1)}function Tp(t,r){if(t.length<=Jr)return;const i=Jr+r,s=t[i];if(s){const u=s[yu];null!==u&&u!==t&&Cp(u,s),r>0&&(t[i-1][Ys]=s[Ys]);const g=dp(t,Jr+r);!function Lw(t,r){Uc(t,r,r[Nn],2,null,null),r[Ni]=null,r[ko]=null}(s[Zt],s);const E=g[Ii];null!==E&&E.detachView(g[Zt]),s[kr]=null,s[Ys]=null,s[jn]&=-129}return s}function vy(t,r){if(!(256&r[jn])){const i=r[Nn];r[Ac]&&Cu(r[Ac]),r[Xl]&&Cu(r[Xl]),i.destroyNode&&Uc(t,r,i,3,null,null),function rl(t){let r=t[_u];if(!r)return Mp(t[Zt],t);for(;r;){let i=null;if(Wo(r))i=r[_u];else{const s=r[Jr];s&&(i=s)}if(!i){for(;r&&!r[Ys]&&r!==t;)Wo(r)&&Mp(r[Zt],r),r=r[kr];null===r&&(r=t),Wo(r)&&Mp(r[Zt],r),i=r&&r[Ys]}r=i}}(r)}}function Mp(t,r){if(!(256&r[jn])){r[jn]&=-129,r[jn]|=256,function jc(t,r){let i;if(null!=t&&null!=(i=t.destroyHooks))for(let s=0;s<i.length;s+=2){const u=r[i[s]];if(!(u instanceof mh)){const g=i[s+1];if(Array.isArray(g))for(let E=0;E<g.length;E+=2){const D=u[g[E]],A=g[E+1];G(4,D,A);try{A.call(D)}finally{G(5,D,A)}}else{G(4,u,g);try{g.call(u)}finally{G(5,u,g)}}}}}(t,r),function ec(t,r){const i=t.cleanup,s=r[bo];if(null!==i)for(let g=0;g<i.length-1;g+=2)if("string"==typeof i[g]){const E=i[g+3];E>=0?s[E]():s[-E].unsubscribe(),g+=2}else i[g].call(s[i[g+1]]);null!==s&&(r[bo]=null);const u=r[Xa];if(null!==u){r[Xa]=null;for(let g=0;g<u.length;g++)(0,u[g])()}}(t,r),1===r[Zt].type&&r[Nn].destroy();const i=r[yu];if(null!==i&&zi(r[kr])){i!==r[kr]&&Cp(i,r);const s=r[Ii];null!==s&&s.detachView(t)}!function Aw(t){rg.delete(t[ah])}(r)}}function sg(t,r,i){return function xy(t,r,i){let s=r;for(;null!==s&&40&s.type;)s=(r=s).parent;if(null===s)return i[Ni];{const{componentOffset:u}=s;if(u>-1){const{encapsulation:g}=t.data[s.directiveStart+u];if(g===Ro.None||g===Ro.Emulated)return null}return se(s,i)}}(t,r.parent,i)}function Lu(t,r,i,s,u){t.insertBefore(r,i,s,u)}function Dp(t,r,i){t.appendChild(r,i)}function ag(t,r,i,s,u){null!==s?Lu(t,r,i,s,u):Dp(t,r,i)}function ku(t,r){return t.parentNode(r)}let Sp,Gc,cg=function zd(t,r,i){return 40&t.type?se(t,i):null};function Ip(t,r,i,s){const u=sg(t,s,r),g=r[Nn],D=function by(t,r,i){return cg(t,r,i)}(s.parent||r[ko],s,r);if(null!=u)if(Array.isArray(i))for(let A=0;A<i.length;A++)ag(g,u,i[A],D,!1);else ag(g,u,i,D,!1);void 0!==Sp&&Sp(g,s,r,i,u)}function Ma(t,r){if(null!==r){const i=r.type;if(3&i)return se(r,t);if(4&i)return Ap(-1,t[r.index]);if(8&i){const s=r.child;if(null!==s)return Ma(t,s);{const u=t[r.index];return zi(u)?Ap(-1,u):q(u)}}if(32&i)return Dh(r,t)()||q(t[r.index]);{const s=Ey(t,r);return null!==s?Array.isArray(s)?s[0]:Ma(Sh(t[Si]),s):Ma(t,r.next)}}return null}function Ey(t,r){return null!==r?t[Si][ko].projection[r.projection]:null}function Ap(t,r){const i=Jr+t+1;if(i<r.length){const s=r[i],u=s[Zt].firstChild;if(null!==u)return Ma(s,u)}return r[ba]}function Cy(t,r,i,s,u,g,E){for(;null!=i;){const D=s[i.index],A=i.type;if(E&&0===r&&(D&&ds(q(D),s),i.flags|=2),32!=(32&i.flags))if(8&A)Cy(t,r,i.child,s,u,g,!1),Ou(r,t,u,D,g);else if(32&A){const N=Dh(i,s);let H;for(;H=N();)Ou(r,t,u,H,g);Ou(r,t,u,D,g)}else 16&A?$c(t,r,s,i,u,g):Ou(r,t,u,D,g);i=E?i.projectionNext:i.next}}function Uc(t,r,i,s,u,g){Cy(i,s,t.firstChild,r,u,g,!1)}function $c(t,r,i,s,u,g){const E=i[Si],A=E[ko].projection[s.projection];if(Array.isArray(A))for(let N=0;N<A.length;N++)Ou(r,t,u,A[N],g);else{let N=A;const H=E[kr];vp(s)&&(N.flags|=128),Cy(t,r,N,H,u,g,!0)}}function ug(t,r,i){""===i?t.removeAttribute(r,"class"):t.setAttribute(r,"class",i)}function kl(t,r,i){const{mergedAttrs:s,classes:u,styles:g}=i;null!==s&&Fn(t,r,s),null!==u&&ug(t,r,u),null!==g&&function Nw(t,r,i){t.setAttribute(r,"style",i)}(t,r,g)}class dg{constructor(r){this.changingThisBreaksApplicationSecurity=r}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const kp=new sn("ENVIRONMENT_INITIALIZER"),kx=new sn("INJECTOR",-1),Fx=new sn("INJECTOR_DEF_TYPES");class Ly{get(r,i=fo){if(i===fo){const s=new Error(`NullInjectorError: No provider for ${ce(r)}!`);throw s.name="NullInjectorError",s}return i}}function Zw(...t){return{\u0275providers:vg(0,t),\u0275fromNgModule:!0}}function vg(t,...r){const i=[],s=new Set;let u;const g=E=>{i.push(E)};return Eh(r,E=>{const D=E;Zc(D,g,[],s)&&(u||=[],u.push(D))}),void 0!==u&&zx(u,g),i}function zx(t,r){for(let i=0;i<t.length;i++){const{ngModule:s,providers:u}=t[i];Pi(u,g=>{r(g,s)})}}function Zc(t,r,i,s){if(!(t=Le(t)))return!1;let u=null,g=xo(t);const E=!g&&$n(t);if(g||E){if(E&&!E.standalone)return!1;u=t}else{const A=t.ngModule;if(g=xo(A),!g)return!1;u=A}const D=s.has(u);if(E){if(D)return!1;if(s.add(u),E.dependencies){const A="function"==typeof E.dependencies?E.dependencies():E.dependencies;for(const N of A)Zc(N,r,i,s)}}else{if(!g)return!1;{if(null!=g.imports&&!D){let N;s.add(u);try{Eh(g.imports,H=>{Zc(H,r,i,s)&&(N||=[],N.push(H))})}finally{}void 0!==N&&zx(N,r)}if(!D){const N=Ya(u)||(()=>new u);r({provide:u,useFactory:N,deps:or},u),r({provide:Fx,useValue:u,multi:!0},u),r({provide:kp,useValue:()=>yn(u),multi:!0},u)}const A=g.providers;if(null!=A&&!D){const N=t;Pi(A,H=>{r(H,N)})}}}return u!==t&&void 0!==t.providers}function Pi(t,r){for(let i of t)jt(i)&&(i=i.\u0275providers),Array.isArray(i)?Pi(i,r):r(i)}const xg=V({provide:String,useValue:V});function bg(t){return null!==t&&"object"==typeof t&&xg in t}function Nl(t){return"function"==typeof t}const wg=new sn("Set Injector scope."),Nu={},ky={};let zp;function Oh(){return void 0===zp&&(zp=new Ly),zp}class ta{}class Ud extends ta{get destroyed(){return this._destroyed}constructor(r,i,s,u){super(),this.parent=i,this.source=s,this.scopes=u,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ny(r,E=>this.processProvider(E)),this.records.set(kx,$d(void 0,this)),u.has("environment")&&this.records.set(ta,$d(void 0,this));const g=this.records.get(wg);null!=g&&"string"==typeof g.value&&this.scopes.add(g.value),this.injectorDefTypes=new Set(this.get(Fx.multi,or,Pn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const r=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of r)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(r){return this.assertNotDestroyed(),this._onDestroyHooks.push(r),()=>this.removeOnDestroy(r)}runInContext(r){this.assertNotDestroyed();const i=Ts(this),s=Xr(void 0);try{return r()}finally{Ts(i),Xr(s)}}get(r,i=fo,s=Pn.Default){if(this.assertNotDestroyed(),r.hasOwnProperty(Bt))return r[Bt](this);s=ya(s);const g=Ts(this),E=Xr(void 0);try{if(!(s&Pn.SkipSelf)){let A=this.records.get(r);if(void 0===A){const N=function Yw(t){return"function"==typeof t||"object"==typeof t&&t instanceof sn}(r)&&Ua(r);A=N&&this.injectableDefInScope(N)?$d(Bp(r),Nu):null,this.records.set(r,A)}if(null!=A)return this.hydrate(r,A)}return(s&Pn.Self?Oh():this.parent).get(r,i=s&Pn.Optional&&i===fo?null:i)}catch(D){if("NullInjectorError"===D.name){if((D[ct]=D[ct]||[]).unshift(ce(r)),g)throw D;return function yl(t,r,i,s){const u=t[ct];throw r[_l]&&u.unshift(r[_l]),t.message=function dd(t,r,i,s=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let u=ce(r);if(Array.isArray(r))u=r.map(ce).join(" -> ");else if("object"==typeof r){let g=[];for(let E in r)if(r.hasOwnProperty(E)){let D=r[E];g.push(E+":"+("string"==typeof D?JSON.stringify(D):ce(D)))}u=`{${g.join(", ")}}`}return`${i}${s?"("+s+")":""}[${u}]: ${t.replace(pu,"\n  ")}`}("\n"+t.message,u,i,s),t.ngTokenPath=u,t[ct]=null,t}(D,r,"R3InjectorError",this.source)}throw D}finally{Xr(E),Ts(g)}}resolveInjectorInitializers(){const r=Ts(this),i=Xr(void 0);try{const u=this.get(kp.multi,or,Pn.Self);for(const g of u)g()}finally{Ts(r),Xr(i)}}toString(){const r=[],i=this.records;for(const s of i.keys())r.push(ce(s));return`R3Injector[${r.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new $e(205,!1)}processProvider(r){let i=Nl(r=Le(r))?r:Le(r&&r.provide);const s=function Eg(t){return bg(t)?$d(void 0,t.useValue):$d(Vx(t),Nu)}(r);if(Nl(r)||!0!==r.multi)this.records.get(i);else{let u=this.records.get(i);u||(u=$d(void 0,Nu,!0),u.factory=()=>Tc(u.multi),this.records.set(i,u)),i=r,u.multi.push(r)}this.records.set(i,s)}hydrate(r,i){return i.value===Nu&&(i.value=ky,i.value=i.factory()),"object"==typeof i.value&&i.value&&function Xw(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(r){if(!r.providedIn)return!1;const i=Le(r.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(r){const i=this._onDestroyHooks.indexOf(r);-1!==i&&this._onDestroyHooks.splice(i,1)}}function Bp(t){const r=Ua(t),i=null!==r?r.factory:Ya(t);if(null!==i)return i;if(t instanceof sn)throw new $e(204,!1);if(t instanceof Function)return function Fy(t){const r=t.length;if(r>0)throw function Id(t,r){const i=[];for(let s=0;s<t;s++)i.push(r);return i}(r,"?"),new $e(204,!1);const i=function Es(t){return t&&(t[da]||t[uu])||null}(t);return null!==i?()=>i.factory(t):()=>new t}(t);throw new $e(204,!1)}function Vx(t,r,i){let s;if(Nl(t)){const u=Le(t);return Ya(u)||Bp(u)}if(bg(t))s=()=>Le(t.useValue);else if(function Np(t){return!(!t||!t.useFactory)}(t))s=()=>t.useFactory(...Tc(t.deps||[]));else if(function Fp(t){return!(!t||!t.useExisting)}(t))s=()=>yn(Le(t.useExisting));else{const u=Le(t&&(t.useClass||t.provide));if(!function Ww(t){return!!t.deps}(t))return Ya(u)||Bp(u);s=()=>new u(...Tc(t.deps))}return s}function $d(t,r,i=!1){return{factory:t,value:r,multi:i?[]:void 0}}function Ny(t,r){for(const i of t)Array.isArray(i)?Ny(i,r):i&&jt(i)?Ny(i.\u0275providers,r):r(i)}const Cg=new sn("AppId",{providedIn:"root",factory:()=>Jw}),Jw="ng",Vp=new sn("Platform Initializer"),Gd=new sn("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),jx=new sn("CSP nonce",{providedIn:"root",factory:()=>function Hc(){if(void 0!==Gc)return Gc;if(typeof document<"u")return document;throw new $e(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Vy=(t,r,i)=>null;function jy(t,r,i=!1){return Vy(t,r,i)}class $x{}class Gx{}class qx{resolveComponentFactory(r){throw function Hx(t){const r=Error(`No component factory found for ${ce(t)}.`);return r.ngComponent=t,r}(r)}}let $p=(()=>{class t{static#e=this.NULL=new qx}return t})();function Zx(){return kh(Kr(),ke())}function kh(t,r){return new po(se(t,r))}let po=(()=>{class t{constructor(i){this.nativeElement=i}static#e=this.__NG_ELEMENT_ID__=Zx}return t})();class Wx{}let Wc=(()=>{class t{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function Ig(){const t=ke(),i=he(Kr().index,t);return(Wo(i)?i:t)[Nn]}()}return t})(),ef=(()=>{class t{static#e=this.\u0275prov=Cn({token:t,providedIn:"root",factory:()=>null})}return t})();class Fh{constructor(r){this.full=r,this.major=r.split(".")[0],this.minor=r.split(".")[1],this.patch=r.split(".").slice(2).join(".")}}const Xx=new Fh("16.2.12"),Gy={};function Ag(t,r=null,i=null,s){const u=Gp(t,r,i,s);return u.resolveInjectorInitializers(),u}function Gp(t,r=null,i=null,s,u=new Set){const g=[i||or,Zw(t)];return s=s||("object"==typeof t?void 0:ce(t)),new Ud(g,r||Oh(),s||null,u)}let jo=(()=>{class t{static#e=this.THROW_IF_NOT_FOUND=fo;static#t=this.NULL=new Ly;static create(i,s){if(Array.isArray(i))return Ag({name:""},s,i,"");{const u=i.name??"";return Ag({name:u},i.parent,i.providers,u)}}static#n=this.\u0275prov=Cn({token:t,providedIn:"any",factory:()=>yn(kx)});static#r=this.__NG_ELEMENT_ID__=-1}return t})();function Nh(t){return t.ngOriginalError}class Xc{constructor(){this._console=console}handleError(r){const i=this._findOriginalError(r);this._console.error("ERROR",r),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(r){let i=r&&Nh(r);for(;i&&Nh(i);)i=Nh(i);return i||null}}function Xy(t){return r=>{setTimeout(t,void 0,r)}}const Xi=class pE extends ci{constructor(r=!1){super(),this.__isAsync=r}emit(r){super.next(r)}subscribe(r,i,s){let u=r,g=i||(()=>null),E=s;if(r&&"object"==typeof r){const A=r;u=A.next?.bind(A),g=A.error?.bind(A),E=A.complete?.bind(A)}this.__isAsync&&(g=Xy(g),u&&(u=Xy(u)),E&&(E=Xy(E)));const D=super.subscribe({next:u,error:g,complete:E});return r instanceof en&&r.add(D),D}};function na(...t){}class $r{constructor({enableLongStackTrace:r=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:s=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Xi(!1),this.onMicrotaskEmpty=new Xi(!1),this.onStable=new Xi(!1),this.onError=new Xi(!1),typeof Zone>"u")throw new $e(908,!1);Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),r&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!s&&i,u.shouldCoalesceRunChangeDetection=s,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function Qx(){const t="function"==typeof Wt.requestAnimationFrame;let r=Wt[t?"requestAnimationFrame":"setTimeout"],i=Wt[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&r&&i){const s=r[Zone.__symbol__("OriginalDelegate")];s&&(r=s);const u=i[Zone.__symbol__("OriginalDelegate")];u&&(i=u)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function e1(t){const r=()=>{!function mE(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Wt,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Rg(t),t.isCheckStableRunning=!0,tf(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Rg(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,s,u,g,E,D)=>{if(function gE(t){return!(!Array.isArray(t)||1!==t.length)&&!0===t[0].data?.__ignore_ng_zone__}(D))return i.invokeTask(u,g,E,D);try{return t1(t),i.invokeTask(u,g,E,D)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===g.type||t.shouldCoalesceRunChangeDetection)&&r(),Jy(t)}},onInvoke:(i,s,u,g,E,D,A)=>{try{return t1(t),i.invoke(u,g,E,D,A)}finally{t.shouldCoalesceRunChangeDetection&&r(),Jy(t)}},onHasTask:(i,s,u,g)=>{i.hasTask(u,g),s===u&&("microTask"==g.change?(t._hasPendingMicrotasks=g.microTask,Rg(t),tf(t)):"macroTask"==g.change&&(t.hasPendingMacrotasks=g.macroTask))},onHandleError:(i,s,u,g)=>(i.handleError(u,g),t.runOutsideAngular(()=>t.onError.emit(g)),!1)})}(u)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!$r.isInAngularZone())throw new $e(909,!1)}static assertNotInAngularZone(){if($r.isInAngularZone())throw new $e(909,!1)}run(r,i,s){return this._inner.run(r,i,s)}runTask(r,i,s,u){const g=this._inner,E=g.scheduleEventTask("NgZoneEvent: "+u,r,Yy,na,na);try{return g.runTask(E,i,s)}finally{g.cancelTask(E)}}runGuarded(r,i,s){return this._inner.runGuarded(r,i,s)}runOutsideAngular(r){return this._outer.run(r)}}const Yy={};function tf(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Rg(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function t1(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Jy(t){t._nesting--,tf(t)}class n1{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Xi,this.onMicrotaskEmpty=new Xi,this.onStable=new Xi,this.onError=new Xi}run(r,i,s){return r.apply(i,s)}runGuarded(r,i,s){return r.apply(i,s)}runOutsideAngular(r){return r()}runTask(r,i,s,u){return r.apply(i,s)}}const Og=new sn("",{providedIn:"root",factory:Ky});function Ky(){const t=Qt($r);let r=!0;return function th(...t){const r=ki(t),i=function _c(t,r){return"number"==typeof xs(t)?t.pop():r}(t,1/0),s=t;return s.length?1===s.length?Vn(s[0]):ja(i)(Vr(s,r)):yo}(new fr(u=>{r=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{u.next(r),u.complete()})}),new fr(u=>{let g;t.runOutsideAngular(()=>{g=t.onStable.subscribe(()=>{$r.assertNotInAngularZone(),queueMicrotask(()=>{!r&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(r=!0,u.next(!0))})})});const E=t.onUnstable.subscribe(()=>{$r.assertInAngularZone(),r&&(r=!1,t.runOutsideAngular(()=>{u.next(!1)}))});return()=>{g.unsubscribe(),E.unsubscribe()}}).pipe(cd()))}function rc(t){return t instanceof Function?t():t}let Hp=(()=>{class t{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=Cn({token:t,providedIn:"root",factory:()=>new t})}return t})();function Uo(t){for(;t;){t[jn]|=64;const r=Sh(t);if(Vf(t)&&!r)return t;t=r}return null}const rf=new sn("",{providedIn:"root",factory:()=>!1});let Lg=null;function a1(t,r){return t[r]??l1()}function Uh(t,r){const i=l1();i.producerNode?.length&&(t[r]=Lg,i.lView=t,Lg=kg())}const sf={...ch,consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{Uo(t.lView)},lView:null};function kg(){return Object.create(sf)}function l1(){return Lg??=kg(),Lg}const Zn={};function Wp(t){Fg(ln(),ke(),cs()+t,!1)}function Fg(t,r,i,s){if(!s)if(3==(3&r[jn])){const g=t.preOrderCheckHooks;null!==g&&Gm(r,g,i)}else{const g=t.preOrderHooks;null!==g&&ap(r,g,0,i)}Mu(i)}function Dt(t,r=Pn.Default){const i=ke();return null===i?yn(t,r):to(Kr(),i,Le(t),r)}function Xp(t,r,i,s,u,g,E,D,A,N,H){const ne=r.blueprint.slice();return ne[Ni]=u,ne[jn]=140|s,(null!==N||t&&2048&t[jn])&&(ne[jn]|=2048),Ae(ne),ne[kr]=ne[Ic]=t,ne[Zi]=i,ne[gu]=E||t&&t[gu],ne[Nn]=D||t&&t[Nn],ne[Js]=A||t&&t[Js]||null,ne[ko]=g,ne[ah]=function uy(){return Sw++}(),ne[Ss]=H,ne[pd]=N,ne[Si]=2==r.type?t[Si]:ne,ne}function $h(t,r,i,s,u){let g=t.data[r];if(null===g)g=function lf(t,r,i,s,u){const g=lr(),E=Sr(),A=t.data[r]=function wE(t,r,i,s,u,g){let E=r?r.injectorIndex:-1,D=0;return function xt(){return null!==re.skipHydrationRootTNode}()&&(D|=128),{type:i,index:s,insertBeforeIndex:null,injectorIndex:E,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:D,providerIndexes:0,value:u,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:r,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,E?g:g&&g.parent,i,r,s,u);return null===t.firstChild&&(t.firstChild=A),null!==g&&(E?null==g.child&&null!==A.parent&&(g.child=A):null===g.next&&(g.next=A,A.prev=g)),A}(t,r,i,s,u),function Ea(){return re.lFrame.inI18n}()&&(g.flags|=32);else if(64&g.type){g.type=i,g.value=s,g.attrs=u;const E=function Rn(){const t=re.lFrame,r=t.currentTNode;return t.isParent?r:r.parent}();g.injectorIndex=null===E?-1:E.injectorIndex}return In(g,!0),g}function Gh(t,r,i,s){if(0===i)return-1;const u=r.length;for(let g=0;g<i;g++)r.push(s),t.blueprint.push(s),t.data.push(null);return u}function c1(t,r,i,s,u){const g=a1(r,Ac),E=cs(),D=2&s;try{Mu(-1),D&&r.length>sr&&Fg(t,r,sr,!1),G(D?2:0,u);const N=D?g:null,H=wd(N);try{null!==N&&(N.dirty=!1),i(s,u)}finally{Ed(N,H)}}finally{D&&null===r[Ac]&&Uh(r,Ac),Mu(E),G(D?3:1,u)}}function Ng(t,r,i){if(Rc(r)){const s=Rs(null);try{const g=r.directiveEnd;for(let E=r.directiveStart;E<g;E++){const D=t.data[E];D.contentQueries&&D.contentQueries(1,i[E],E)}}finally{Rs(s)}}}function ic(t,r,i){Vt()&&(function ov(t,r,i,s){const u=i.directiveStart,g=i.directiveEnd;Tl(i)&&function DE(t,r,i){const s=se(r,t),u=u1(i);let E=16;i.signals?E=4096:i.onPush&&(E=64);const D=Zg(t,Xp(t,u,null,E,s,r,null,t[gu].rendererFactory.createRenderer(s,i),null,null,null));t[r.index]=D}(r,i,t.data[u+i.componentOffset]),t.firstCreatePass||Al(i,r),ds(s,r);const E=i.initialInputs;for(let D=u;D<g;D++){const A=t.data[D],N=vh(r,t,D,i);ds(N,r),null!==E&&qg(0,D-u,N,A,0,E),ls(A)&&(he(i.index,r)[Zi]=vh(r,t,D,i))}}(t,r,i,se(i,r)),64==(64&i.flags)&&sv(t,r,i))}function zg(t,r,i=se){const s=r.localNames;if(null!==s){let u=r.index+1;for(let g=0;g<s.length;g+=2){const E=s[g+1],D=-1===E?i(r,t):t[E];t[u++]=D}}}function u1(t){const r=t.tView;return null===r||r.incompleteFirstPass?t.tView=oc(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):r}function oc(t,r,i,s,u,g,E,D,A,N,H){const ne=sr+s,fe=ne+u,ve=function xE(t,r){const i=[];for(let s=0;s<r;s++)i.push(s<t?null:Zn);return i}(ne,fe),ze="function"==typeof N?N():N;return ve[Zt]={type:t,blueprint:ve,template:i,queries:null,viewQuery:D,declTNode:r,data:ve.slice().fill(null,ne),bindingStartIndex:ne,expandoStartIndex:fe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof g?g():g,pipeRegistry:"function"==typeof E?E():E,firstChild:null,schemas:A,consts:ze,incompleteFirstPass:!1,ssrId:H}}let cf=t=>null;function Hh(t,r,i,s){for(let u in t)if(t.hasOwnProperty(u)){i=null===i?{}:i;const g=t[u];null===s?Qp(i,r,u,g):s.hasOwnProperty(u)&&Qp(i,r,s[u],g)}return i}function Qp(t,r,i,s){t.hasOwnProperty(i)?t[i].push(r,s):t[i]=[r,s]}function Vg(t,r,i,s){if(Vt()){const u=null===s?null:{"":-1},g=function ME(t,r){const i=t.directiveRegistry;let s=null,u=null;if(i)for(let g=0;g<i.length;g++){const E=i[g];if(Za(r,E.selectors,!1))if(s||(s=[]),ls(E))if(null!==E.findHostDirectiveDefs){const D=[];u=u||new Map,E.findHostDirectiveDefs(E,D,u),s.unshift(...D,E),av(t,r,D.length)}else s.unshift(E),av(t,r,0);else u=u||new Map,E.findHostDirectiveDefs?.(E,s,u),s.push(E)}return null===s?null:[s,u]}(t,i);let E,D;null===g?E=D=null:[E,D]=g,null!==E&&f1(t,r,i,E,u,D),u&&function Ug(t,r,i){if(r){const s=t.localNames=[];for(let u=0;u<r.length;u+=2){const g=i[r[u+1]];if(null==g)throw new $e(-301,!1);s.push(r[u],g)}}}(i,s,u)}i.mergedAttrs=jr(i.mergedAttrs,i.attrs)}function f1(t,r,i,s,u,g){for(let N=0;N<s.length;N++)J_(Al(i,r),t,s[N].type);!function Gg(t,r,i){t.flags|=1,t.directiveStart=r,t.directiveEnd=r+i,t.providerIndexes=r}(i,t.data.length,s.length);for(let N=0;N<s.length;N++){const H=s[N];H.providersResolver&&H.providersResolver(H)}let E=!1,D=!1,A=Gh(t,r,s.length,null);for(let N=0;N<s.length;N++){const H=s[N];i.mergedAttrs=jr(i.mergedAttrs,H.hostAttrs),Hg(t,i,r,A,H),$g(A,H,u),null!==H.contentQueries&&(i.flags|=4),(null!==H.hostBindings||null!==H.hostAttrs||0!==H.hostVars)&&(i.flags|=64);const ne=H.type.prototype;!E&&(ne.ngOnChanges||ne.ngOnInit||ne.ngDoCheck)&&((t.preOrderHooks??=[]).push(i.index),E=!0),!D&&(ne.ngOnChanges||ne.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(i.index),D=!0),A++}!function EE(t,r,i){const u=r.directiveEnd,g=t.data,E=r.attrs,D=[];let A=null,N=null;for(let H=r.directiveStart;H<u;H++){const ne=g[H],fe=i?i.get(ne):null,ze=fe?fe.outputs:null;A=Hh(ne.inputs,H,A,fe?fe.inputs:null),N=Hh(ne.outputs,H,N,ze);const et=null===A||null===E||Oo(r)?null:SE(A,H,E);D.push(et)}null!==A&&(A.hasOwnProperty("class")&&(r.flags|=8),A.hasOwnProperty("style")&&(r.flags|=16)),r.initialInputs=D,r.inputs=A,r.outputs=N}(t,i,g)}function sv(t,r,i){const s=i.directiveStart,u=i.directiveEnd,g=i.index,E=function fh(){return re.lFrame.currentDirectiveIndex}();try{Mu(g);for(let D=s;D<u;D++){const A=t.data[D],N=r[D];rp(D),(null!==A.hostBindings||0!==A.hostVars||null!==A.hostAttrs)&&jg(A,N)}}finally{Mu(-1),rp(E)}}function jg(t,r){null!==t.hostBindings&&t.hostBindings(1,r)}function av(t,r,i){r.componentOffset=i,(t.components??=[]).push(r.index)}function $g(t,r,i){if(i){if(r.exportAs)for(let s=0;s<r.exportAs.length;s++)i[r.exportAs[s]]=t;ls(r)&&(i[""]=t)}}function Hg(t,r,i,s,u){t.data[s]=u;const g=u.factory||(u.factory=Ya(u.type)),E=new mh(g,ls(u),Dt);t.blueprint[s]=E,i[s]=E,function p1(t,r,i,s,u){const g=u.hostBindings;if(g){let E=t.hostBindingOpCodes;null===E&&(E=t.hostBindingOpCodes=[]);const D=~r.index;(function TE(t){let r=t.length;for(;r>0;){const i=t[--r];if("number"==typeof i&&i<0)return i}return 0})(E)!=D&&E.push(D),E.push(i,s,g)}}(t,r,s,Gh(t,i,u.hostVars,Zn),u)}function qg(t,r,i,s,u,g){const E=g[r];if(null!==E)for(let D=0;D<E.length;)uf(s,i,E[D++],E[D++],E[D++])}function uf(t,r,i,s,u){const g=Rs(null);try{const E=t.inputTransforms;null!==E&&E.hasOwnProperty(s)&&(u=E[s].call(r,u)),null!==t.setInput?t.setInput(r,u,i,s):r[s]=u}finally{Rs(g)}}function SE(t,r,i){let s=null,u=0;for(;u<i.length;){const g=i[u];if(0!==g)if(5!==g){if("number"==typeof g)break;if(t.hasOwnProperty(g)){null===s&&(s=[]);const E=t[g];for(let D=0;D<E.length;D+=2)if(E[D]===r){s.push(g,E[D+1],i[u+1]);break}}u+=2}else u+=2;else u+=4}return s}function m1(t,r,i,s){return[t,!0,!1,r,null,0,s,i,null,null,null]}function g1(t,r){const i=t.contentQueries;if(null!==i)for(let s=0;s<i.length;s+=2){const g=i[s+1];if(-1!==g){const E=t.data[g];kc(i[s]),E.contentQueries(2,r[g],g)}}}function Zg(t,r){return t[_u]?t[Sc][Ys]=r:t[_u]=r,t[Sc]=r,r}function lv(t,r,i){kc(0);const s=Rs(null);try{r(t,i)}finally{Rs(s)}}function Ia(t,r){const i=t[Js],s=i?i.get(Xc,null):null;s&&s.handleError(r)}function sl(t,r,i,s,u){for(let g=0;g<i.length;){const E=i[g++],D=i[g++];uf(t.data[E],r[E],s,D,u)}}function ac(t,r){const i=he(r,t),s=i[Zt];!function Vu(t,r){for(let i=r.length;i<t.blueprint.length;i++)r.push(t.blueprint[i])}(s,i);const u=i[Ni];null!==u&&null===i[Ss]&&(i[Ss]=jy(u,i[Js])),hf(s,i,i[Zi])}function hf(t,r,i){Td(r);try{const s=t.viewQuery;null!==s&&lv(1,s,i);const u=t.template;null!==u&&c1(t,r,u,1,i),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&g1(t,r),t.staticViewQueries&&lv(2,t.viewQuery,i);const g=t.components;null!==g&&function _1(t,r){for(let i=0;i<r.length;i++)ac(t,r[i])}(r,g)}catch(s){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),s}finally{r[jn]&=-5,jm()}}let rm=(()=>{class t{constructor(){this.all=new Set,this.queue=new Map}create(i,s,u){const g=typeof Zone>"u"?null:Zone.current,E=function It(t,r,i){const s=Object.create(l);i&&(s.consumerAllowSignalWrites=!0),s.fn=t,s.schedule=r;const u=E=>{s.cleanupFn=E};return s.ref={notify:()=>bd(s),run:()=>{if(s.dirty=!1,s.hasRun&&!Xf(s))return;s.hasRun=!0;const E=wd(s);try{s.cleanupFn(),s.cleanupFn=m,s.fn(u)}finally{Ed(s,E)}},cleanup:()=>s.cleanupFn()},s.ref}(i,N=>{this.all.has(N)&&this.queue.set(N,g)},u);let D;this.all.add(E),E.notify();const A=()=>{E.cleanup(),D?.(),this.all.delete(E),this.queue.delete(E)};return D=s?.onDestroy(A),{destroy:A}}flush(){if(0!==this.queue.size)for(const[i,s]of this.queue)this.queue.delete(i),s?s.run(()=>i.run()):i.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=Cn({token:t,providedIn:"root",factory:()=>new t})}return t})();function df(t,r,i){let s=i?t.styles:null,u=i?t.classes:null,g=0;if(null!==r)for(let E=0;E<r.length;E++){const D=r[E];"number"==typeof D?g=D:1==g?u=xe(u,D):2==g&&(s=xe(s,D+": "+r[++E]+";"))}i?t.styles=s:t.stylesWithoutHost=s,i?t.classes=u:t.classesWithoutHost=u}function im(t,r,i,s,u=!1){for(;null!==i;){const g=r[i.index];null!==g&&s.push(q(g)),zi(g)&&v1(g,s);const E=i.type;if(8&E)im(t,r,i.child,s);else if(32&E){const D=Dh(i,r);let A;for(;A=D();)s.push(A)}else if(16&E){const D=Ey(r,i);if(Array.isArray(D))s.push(...D);else{const A=Sh(r[Si]);im(A[Zt],A,D,s,!0)}}i=u?i.projectionNext:i.next}return s}function v1(t,r){for(let i=Jr;i<t.length;i++){const s=t[i],u=s[Zt].firstChild;null!==u&&im(s[Zt],s,u,r)}t[ba]!==t[Ni]&&r.push(t[ba])}function Jc(t,r,i,s=!0){const u=r[gu],g=u.rendererFactory,E=u.afterRenderEventManager;g.begin?.(),E?.begin();try{Aa(t,r,t.template,i)}catch(A){throw s&&Ia(r,A),A}finally{g.end?.(),u.effectManager?.flush(),E?.end()}}function Aa(t,r,i,s){const u=r[jn];if(256!=(256&u)){r[gu].effectManager?.flush(),Td(r);try{Ae(r),function Qa(t){return re.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==i&&c1(t,r,i,2,s);const E=3==(3&u);if(E){const N=t.preOrderCheckHooks;null!==N&&Gm(r,N,null)}else{const N=t.preOrderHooks;null!==N&&ap(r,N,0,null),Hm(r,0)}if(function uv(t){for(let r=my(t);null!==r;r=gy(r)){if(!r[Bf])continue;const i=r[Is];for(let s=0;s<i.length;s++){Oe(i[s])}}}(r),Wg(r,2),null!==t.contentQueries&&g1(t,r),E){const N=t.contentCheckHooks;null!==N&&Gm(r,N)}else{const N=t.contentHooks;null!==N&&ap(r,N,1),Hm(r,1)}!function Bu(t,r){const i=t.hostBindingOpCodes;if(null===i)return;const s=a1(r,Xl);try{for(let u=0;u<i.length;u++){const g=i[u];if(g<0)Mu(~g);else{const E=g,D=i[++u],A=i[++u];Sl(D,E),s.dirty=!1;const N=wd(s);try{A(2,r[E])}finally{Ed(s,N)}}}}finally{null===r[Xl]&&Uh(r,Xl),Mu(-1)}}(t,r);const D=t.components;null!==D&&hv(r,D,0);const A=t.viewQuery;if(null!==A&&lv(2,A,s),E){const N=t.viewCheckHooks;null!==N&&Gm(r,N)}else{const N=t.viewHooks;null!==N&&ap(r,N,2),Hm(r,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),r[jn]&=-73,be(r)}finally{jm()}}}function Wg(t,r){for(let i=my(t);null!==i;i=gy(i))for(let s=Jr;s<i.length;s++)ju(i[s],r)}function Bl(t,r,i){ju(he(r,t),i)}function ju(t,r){if(!function pe(t){return 128==(128&t[jn])}(t))return;const i=t[Zt],s=t[jn];if(80&s&&0===r||1024&s||2===r)Aa(i,t,i.template,t[Zi]);else if(t[wl]>0){Wg(t,1);const u=i.components;null!==u&&hv(t,u,1)}}function hv(t,r,i){for(let s=0;s<r.length;s++)Bl(t,r[s],i)}class qh{get rootNodes(){const r=this._lView,i=r[Zt];return im(i,r,i.firstChild,[])}constructor(r,i){this._lView=r,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Zi]}set context(r){this._lView[Zi]=r}get destroyed(){return 256==(256&this._lView[jn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const r=this._lView[kr];if(zi(r)){const i=r[8],s=i?i.indexOf(this):-1;s>-1&&(Tp(r,s),dp(i,s))}this._attachedToViewContainer=!1}vy(this._lView[Zt],this._lView)}onDestroy(r){!function Re(t,r){if(256==(256&t[jn]))throw new $e(911,!1);null===t[Xa]&&(t[Xa]=[]),t[Xa].push(r)}(this._lView,r)}markForCheck(){Uo(this._cdRefInjectingView||this._lView)}detach(){this._lView[jn]&=-129}reattach(){this._lView[jn]|=128}detectChanges(){Jc(this._lView[Zt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new $e(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function yy(t,r){Uc(t,r,r[Nn],2,null,null)}(this._lView[Zt],this._lView)}attachToAppRef(r){if(this._attachedToViewContainer)throw new $e(902,!1);this._appRef=r}}class om extends qh{constructor(r){super(r),this._view=r}detectChanges(){const r=this._view;Jc(r[Zt],r,r[Zi],!1)}checkNoChanges(){}get context(){return null}}class b1 extends $p{constructor(r){super(),this.ngModule=r}resolveComponentFactory(r){const i=$n(r);return new sm(i,this.ngModule)}}function w1(t){const r=[];for(let i in t)t.hasOwnProperty(i)&&r.push({propName:t[i],templateName:i});return r}class AE{constructor(r,i){this.injector=r,this.parentInjector=i}get(r,i,s){s=ya(s);const u=this.injector.get(r,Gy,s);return u!==Gy||i===Gy?u:this.parentInjector.get(r,i,s)}}class sm extends Gx{get inputs(){const r=this.componentDef,i=r.inputTransforms,s=w1(r.inputs);if(null!==i)for(const u of s)i.hasOwnProperty(u.propName)&&(u.transform=i[u.propName]);return s}get outputs(){return w1(this.componentDef.outputs)}constructor(r,i){super(),this.componentDef=r,this.ngModule=i,this.componentType=r.type,this.selector=function Dr(t){return t.map(Lr).join(",")}(r.selectors),this.ngContentSelectors=r.ngContentSelectors?r.ngContentSelectors:[],this.isBoundToModule=!!i}create(r,i,s,u){let g=(u=u||this.ngModule)instanceof ta?u:u?.injector;g&&null!==this.componentDef.getStandaloneInjector&&(g=this.componentDef.getStandaloneInjector(g)||g);const E=g?new AE(r,g):r,D=E.get(Wx,null);if(null===D)throw new $e(407,!1);const ne={rendererFactory:D,sanitizer:E.get(ef,null),effectManager:E.get(rm,null),afterRenderEventManager:E.get(Hp,null)},fe=D.createRenderer(null,this.componentDef),ve=this.componentDef.selectors[0][0]||"div",ze=s?function Yp(t,r,i,s){const g=s.get(rf,!1)||i===Ro.ShadowDom,E=t.selectRootElement(r,g);return function Jp(t){cf(t)}(E),E}(fe,s,this.componentDef.encapsulation,E):fs(fe,ve,function IE(t){const r=t.toLowerCase();return"svg"===r?"svg":"math"===r?"math":null}(ve)),kt=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let st=null;null!==ze&&(st=jy(ze,E,!0));const Sn=oc(0,null,null,1,0,null,null,null,null,null,null),Gn=Xp(null,Sn,null,kt,null,null,ne,fe,E,null,st);let Er,ul;Td(Gn);try{const ld=this.componentDef;let V_,KT=null;ld.findHostDirectiveDefs?(V_=[],KT=new Map,ld.findHostDirectiveDefs(ld,V_,KT),V_.push(ld)):V_=[ld];const sB=function RE(t,r){const i=t[Zt],s=sr;return t[s]=r,$h(i,s,2,"#host",null)}(Gn,ze),aB=function E1(t,r,i,s,u,g,E){const D=u[Zt];!function C1(t,r,i,s){for(const u of t)r.mergedAttrs=jr(r.mergedAttrs,u.hostAttrs);null!==r.mergedAttrs&&(df(r,r.mergedAttrs,!0),null!==i&&kl(s,i,r))}(s,t,r,E);let A=null;null!==r&&(A=jy(r,u[Js]));const N=g.rendererFactory.createRenderer(r,i);let H=16;i.signals?H=4096:i.onPush&&(H=64);const ne=Xp(u,u1(i),null,H,u[t.index],t,g,N,null,null,A);return D.firstCreatePass&&av(D,t,s.length-1),Zg(u,ne),u[t.index]=ne}(sB,ze,ld,V_,Gn,ne,fe);ul=K(Sn,sr),ze&&function Uu(t,r,i,s){if(s)Fn(t,i,["ng-version",Xx.full]);else{const{attrs:u,classes:g}=function mu(t){const r=[],i=[];let s=1,u=2;for(;s<t.length;){let g=t[s];if("string"==typeof g)2===u?""!==g&&r.push(g,t[++s]):8===u&&i.push(g);else{if(!Mi(u))break;u=g}s++}return{attrs:r,classes:i}}(r.selectors[0]);u&&Fn(t,i,u),g&&g.length>0&&ug(t,i,g.join(" "))}}(fe,ld,ze,s),void 0!==i&&function T1(t,r,i){const s=t.projection=[];for(let u=0;u<r.length;u++){const g=i[u];s.push(null!=g?Array.from(g):null)}}(ul,this.ngContentSelectors,i),Er=function Xg(t,r,i,s,u,g){const E=Kr(),D=u[Zt],A=se(E,u);f1(D,u,E,i,null,s);for(let H=0;H<i.length;H++)ds(vh(u,D,E.directiveStart+H,E),u);sv(D,u,E),A&&ds(A,u);const N=vh(u,D,E.directiveStart+E.componentOffset,E);if(t[Zi]=u[Zi]=N,null!==g)for(const H of g)H(N,r);return Ng(D,E,t),N}(aB,ld,V_,KT,Gn,[M1]),hf(Sn,Gn,null)}finally{jm()}return new PE(this.componentType,Er,kh(ul,Gn),Gn,ul)}}class PE extends $x{constructor(r,i,s,u,g){super(),this.location=s,this._rootLView=u,this._tNode=g,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new om(u),this.componentType=r}setInput(r,i){const s=this._tNode.inputs;let u;if(null!==s&&(u=s[r])){if(this.previousInputValues??=new Map,this.previousInputValues.has(r)&&Object.is(this.previousInputValues.get(r),i))return;const g=this._rootLView;sl(g[Zt],g,u,r,i),this.previousInputValues.set(r,i),Uo(he(this._tNode.index,g))}}get injector(){return new us(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(r){this.hostView.onDestroy(r)}}function M1(){const t=Kr();sp(ke()[Zt],t)}function ei(t){let r=function dv(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),i=!0;const s=[t];for(;r;){let u;if(ls(t))u=r.\u0275cmp||r.\u0275dir;else{if(r.\u0275cmp)throw new $e(903,!1);u=r.\u0275dir}if(u){if(i){s.push(u);const E=t;E.inputs=am(t.inputs),E.inputTransforms=am(t.inputTransforms),E.declaredInputs=am(t.declaredInputs),E.outputs=am(t.outputs);const D=u.hostBindings;D&&lm(t,D);const A=u.viewQuery,N=u.contentQueries;if(A&&Zh(t,A),N&&Jg(t,N),te(t.inputs,u.inputs),te(t.declaredInputs,u.declaredInputs),te(t.outputs,u.outputs),null!==u.inputTransforms&&(null===E.inputTransforms&&(E.inputTransforms={}),te(E.inputTransforms,u.inputTransforms)),ls(u)&&u.data.animation){const H=t.data;H.animation=(H.animation||[]).concat(u.data.animation)}}const g=u.features;if(g)for(let E=0;E<g.length;E++){const D=g[E];D&&D.ngInherit&&D(t),D===ei&&(i=!1)}}r=Object.getPrototypeOf(r)}!function Yg(t){let r=0,i=null;for(let s=t.length-1;s>=0;s--){const u=t[s];u.hostVars=r+=u.hostVars,u.hostAttrs=jr(u.hostAttrs,i=jr(i,u.hostAttrs))}}(s)}function am(t){return t===os?{}:t===or?[]:t}function Zh(t,r){const i=t.viewQuery;t.viewQuery=i?(s,u)=>{r(s,u),i(s,u)}:r}function Jg(t,r){const i=t.contentQueries;t.contentQueries=i?(s,u,g)=>{r(s,u,g),i(s,u,g)}:r}function lm(t,r){const i=t.hostBindings;t.hostBindings=i?(s,u)=>{r(s,u),i(s,u)}:r}function cm(t){return!!function t_(t){return null!==t&&("function"==typeof t||"object"==typeof t)}(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function So(t,r,i){return!Object.is(t[r],i)&&(t[r]=i,!0)}function c_(t,r,i,s,u,g,E,D){const A=ke(),N=ln(),H=t+sr,ne=N.firstCreatePass?function VE(t,r,i,s,u,g,E,D,A){const N=r.consts,H=$h(r,t,4,E||null,Ne(N,D));Vg(r,i,H,Ne(N,A)),sp(r,H);const ne=H.tView=oc(2,H,s,u,g,r.directiveRegistry,r.pipeRegistry,null,r.schemas,N,null);return null!==r.queries&&(r.queries.template(r,H),ne.queries=r.queries.embeddedTView(H)),H}(H,N,A,r,i,s,u,g,E):N.data[H];In(ne,!1);const fe=u_(N,A,ne,t);Um()&&Ip(N,A,fe,ne),ds(fe,A),Zg(A,A[H]=m1(fe,A,fe,ne)),bu(ne)&&ic(N,A,ne),null!=E&&zg(A,ne,D)}let u_=function $1(t,r,i,s){return Du(!0),r[Nn].createComment("")};function qu(t,r,i){const s=ke();return So(s,zo(),r)&&function ra(t,r,i,s,u,g,E,D){const A=se(r,i);let H,N=r.inputs;!D&&null!=N&&(H=N[s])?(sl(t,i,H,s,u),Tl(r)&&function CE(t,r){const i=he(r,t);16&i[jn]||(i[jn]|=64)}(i,r.index)):3&r.type&&(s=function h1(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(s),u=null!=E?E(u,r.value||"",s):u,g.setProperty(A,s,u))}(ln(),function Vi(){const t=re.lFrame;return K(t.tView,t.selectedIndex)}(),s,t,r,s[Nn],i,!1),qu}function h_(t,r,i,s,u){const E=u?"class":"style";sl(t,i,r.inputs[E],E,s)}function al(t,r,i,s){const u=ke(),g=ln(),E=sr+t,D=u[Nn],A=g.firstCreatePass?function H1(t,r,i,s,u,g){const E=r.consts,A=$h(r,t,2,s,Ne(E,u));return Vg(r,i,A,Ne(E,g)),null!==A.attrs&&df(A,A.attrs,!1),null!==A.mergedAttrs&&df(A,A.mergedAttrs,!0),null!==r.queries&&r.queries.elementStart(r,A),A}(E,g,u,r,i,s):g.data[E],N=Cv(g,u,A,D,r,t);u[E]=N;const H=bu(A);return In(A,!0),kl(D,N,A),32!=(32&A.flags)&&Um()&&Ip(g,u,N,A),0===function Xe(){return re.lFrame.elementDepthCount}()&&ds(N,u),function At(){re.lFrame.elementDepthCount++}(),H&&(ic(g,u,A),Ng(g,A,u)),null!==s&&zg(u,A),al}function uc(){let t=Kr();Sr()?function Wi(){re.lFrame.isParent=!1}():(t=t.parent,In(t,!1));const r=t;(function Xt(t){return re.skipHydrationRootTNode===t})(r)&&function zn(){re.skipHydrationRootTNode=null}(),function vt(){re.lFrame.elementDepthCount--}();const i=ln();return i.firstCreatePass&&(sp(i,t),Rc(t)&&i.queries.elementEnd(t)),null!=r.classesWithoutHost&&function gh(t){return 0!=(8&t.flags)}(r)&&h_(i,r,ke(),r.classesWithoutHost,!0),null!=r.stylesWithoutHost&&function W_(t){return 0!=(16&t.flags)}(r)&&h_(i,r,ke(),r.stylesWithoutHost,!1),uc}function Zu(t,r,i,s){return al(t,r,i,s),uc(),Zu}let Cv=(t,r,i,s,u,g)=>(Du(!0),fs(s,u,function Ur(){return re.lFrame.currentNamespace}()));function Oa(){return ke()}function Kh(t){return!!t&&"function"==typeof t.then}function Mv(t){return!!t&&"function"==typeof t.subscribe}function Jo(t,r,i,s){const u=ke(),g=ln(),E=Kr();return function Z1(t,r,i,s,u,g,E){const D=bu(s),N=t.firstCreatePass&&function sc(t){return t.cleanup||(t.cleanup=[])}(t),H=r[Zi],ne=function tm(t){return t[bo]||(t[bo]=[])}(r);let fe=!0;if(3&s.type||E){const et=se(s,r),bt=E?E(et):et,kt=ne.length,st=E?Gn=>E(q(Gn[s.index])):s.index;let Sn=null;if(!E&&D&&(Sn=function Dv(t,r,i,s){const u=t.cleanup;if(null!=u)for(let g=0;g<u.length-1;g+=2){const E=u[g];if(E===i&&u[g+1]===s){const D=r[bo],A=u[g+2];return D.length>A?D[A]:null}"string"==typeof E&&(g+=2)}return null}(t,r,u,s.index)),null!==Sn)(Sn.__ngLastListenerFn__||Sn).__ngNextListenerFn__=g,Sn.__ngLastListenerFn__=g,fe=!1;else{g=Sv(s,r,H,g,!1);const Gn=i.listen(bt,u,g);ne.push(g,Gn),N&&N.push(u,st,kt,kt+1)}}else g=Sv(s,r,H,g,!1);const ve=s.outputs;let ze;if(fe&&null!==ve&&(ze=ve[u])){const et=ze.length;if(et)for(let bt=0;bt<et;bt+=2){const Er=r[ze[bt]][ze[bt+1]].subscribe(g),ul=ne.length;ne.push(g,Er),N&&N.push(u,s.index,ul,-(ul+1))}}}(g,u,u[Nn],E,t,r,s),Jo}function m_(t,r,i,s){try{return G(6,r,i),!1!==i(s)}catch(u){return Ia(t,u),!1}finally{G(7,r,i)}}function Sv(t,r,i,s,u){return function g(E){if(E===Function)return s;Uo(t.componentOffset>-1?he(t.index,r):r);let A=m_(r,i,s,E),N=g.__ngNextListenerFn__;for(;N;)A=m_(r,i,N,E)&&A,N=N.__ngNextListenerFn__;return u&&!1===A&&E.preventDefault(),A}}function Cf(t=1){return function O0(t){return(re.lFrame.contextLView=function L0(t,r){for(;t>0;)r=r[Ic],t--;return r}(t,re.lFrame.contextLView))[Zi]}(t)}function g_(t,r){return t<<17|r<<2}function Xu(t){return t>>17&32767}function kv(t){return 2|t}function Qh(t){return(131068&t)>>2}function __(t,r){return-131069&t|r<<2}function ym(t){return 1|t}function n(t,r,i,s,u){const g=t[i+1],E=null===r;let D=s?Xu(g):Qh(g),A=!1;for(;0!==D&&(!1===A||E);){const H=t[D+1];e(t[D],r)&&(A=!0,t[D+1]=s?ym(H):kv(H)),D=s?Xu(H):Qh(H)}A&&(t[i+1]=s?kv(g):ym(g))}function e(t,r){return null===t||null==r||(Array.isArray(t)?t[1]:t)===r||!(!Array.isArray(t)||"string"!=typeof r)&&Ad(t,r)>=0}function Y(t,r){return function me(t,r,i,s){const u=ke(),g=ln(),E=function qn(t){const r=re.lFrame,i=r.bindingIndex;return r.bindingIndex=r.bindingIndex+t,i}(2);g.firstUpdatePass&&function Pe(t,r,i,s){const u=t.data;if(null===u[i+1]){const g=u[cs()],E=function Ee(t,r){return r>=t.expandoStartIndex}(t,i);(function Gt(t,r){return 0!=(t.flags&(r?8:16))})(g,s)&&null===r&&!E&&(r=!1),r=function Se(t,r,i,s){const u=function ip(t){const r=re.lFrame.currentDirectiveIndex;return-1===r?null:t[r]}(t);let g=s?r.residualClasses:r.residualStyles;if(null===u)0===(s?r.classBindings:r.styleBindings)&&(i=Fe(i=Je(null,t,r,i,s),r.attrs,s),g=null);else{const E=r.directiveStylingLast;if(-1===E||t[E]!==u)if(i=Je(u,t,r,i,s),null===g){let A=function Ue(t,r,i){const s=i?r.classBindings:r.styleBindings;if(0!==Qh(s))return t[Xu(s)]}(t,r,s);void 0!==A&&Array.isArray(A)&&(A=Je(null,t,r,A[1],s),A=Fe(A,r.attrs,s),function ot(t,r,i,s){t[Xu(i?r.classBindings:r.styleBindings)]=s}(t,r,s,A))}else g=function je(t,r,i){let s;const u=r.directiveEnd;for(let g=1+r.directiveStylingLast;g<u;g++)s=Fe(s,t[g].hostAttrs,i);return Fe(s,r.attrs,i)}(t,r,s)}return void 0!==g&&(s?r.residualClasses=g:r.residualStyles=g),i}(u,g,r,s),function Nv(t,r,i,s,u,g){let E=g?r.classBindings:r.styleBindings,D=Xu(E),A=Qh(E);t[s]=i;let H,N=!1;if(Array.isArray(i)?(H=i[1],(null===H||Ad(i,H)>0)&&(N=!0)):H=i,u)if(0!==A){const fe=Xu(t[D+1]);t[s+1]=g_(fe,D),0!==fe&&(t[fe+1]=__(t[fe+1],s)),t[D+1]=function K1(t,r){return 131071&t|r<<17}(t[D+1],s)}else t[s+1]=g_(D,0),0!==D&&(t[D+1]=__(t[D+1],s)),D=s;else t[s+1]=g_(A,0),0===D?D=s:t[A+1]=__(t[A+1],s),A=s;N&&(t[s+1]=kv(t[s+1])),n(t,H,s,!0),n(t,H,s,!1),function Q1(t,r,i,s,u){const g=u?t.residualClasses:t.residualStyles;null!=g&&"string"==typeof r&&Ad(g,r)>=0&&(i[s+1]=ym(i[s+1]))}(r,H,t,s,g),E=g_(D,A),g?r.classBindings=E:r.styleBindings=E}(u,g,r,i,E,s)}}(g,t,E,s),r!==Zn&&So(u,E,r)&&function St(t,r,i,s,u,g,E,D){if(!(3&r.type))return;const A=t.data,N=A[D+1],H=function Fv(t){return 1==(1&t)}(N)?mt(A,r,i,u,Qh(N),E):void 0;Ht(H)||(Ht(g)||function qE(t){return 2==(2&t)}(N)&&(g=mt(A,null,i,u,D,E)),function Fw(t,r,i,s,u){if(r)u?t.addClass(i,s):t.removeClass(i,s);else{let g=-1===s.indexOf("-")?void 0:Vc.DashCase;null==u?t.removeStyle(i,s,g):("string"==typeof u&&u.endsWith("!important")&&(u=u.slice(0,-10),g|=Vc.Important),t.setStyle(i,s,u,g))}}(s,E,ee(cs(),i),u,g))}(g,g.data[cs()],u,u[Nn],t,u[E+1]=function Nt(t,r){return null==t||""===t||("string"==typeof r?t+=r:"object"==typeof t&&(t=ce(function Fl(t){return t instanceof dg?t.changingThisBreaksApplicationSecurity:t}(t)))),t}(r,i),s,E)}(t,r,null,!0),Y}function Je(t,r,i,s,u){let g=null;const E=i.directiveEnd;let D=i.directiveStylingLast;for(-1===D?D=i.directiveStart:D++;D<E&&(g=r[D],s=Fe(s,g.hostAttrs,u),g!==t);)D++;return null!==t&&(i.directiveStylingLast=D),s}function Fe(t,r,i){const s=i?1:2;let u=-1;if(null!==r)for(let g=0;g<r.length;g++){const E=r[g];"number"==typeof E?u=E:u===s&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Ks(t,E,!!i||r[++g]))}return void 0===t?null:t}function mt(t,r,i,s,u,g){const E=null===r;let D;for(;u>0;){const A=t[u],N=Array.isArray(A),H=N?A[1]:A,ne=null===H;let fe=i[u+1];fe===Zn&&(fe=ne?or:void 0);let ve=ne?Pl(fe,s):H===s?fe:void 0;if(N&&!Ht(ve)&&(ve=Pl(A,s)),Ht(ve)&&(D=ve,E))return D;const ze=t[u+1];u=E?Xu(ze):Qh(ze)}if(null!==r){let A=g?r.residualClasses:r.residualStyles;null!=A&&(D=Pl(A,s))}return D}function Ht(t){return void 0!==t}function at(t,r=""){const i=ke(),s=ln(),u=t+sr,g=s.firstCreatePass?$h(s,u,1,r,null):s.data[u],E=cn(s,i,g,r,t);i[u]=E,Um()&&Ip(s,i,E,g),In(g,!1)}let cn=(t,r,i,s,u)=>(Du(!0),function hi(t,r){return t.createText(r)}(r[Nn],s));function Dn(t){return Yn("",t,""),Dn}function Yn(t,r,i){const s=ke(),u=function Xh(t,r,i,s){return So(t,zo(),i)?r+Mt(i)+s:Zn}(s,t,r,i);return u!==Zn&&function ps(t,r,i){const s=ee(r,t);!function ig(t,r,i){t.setValue(r,i)}(t[Nn],s,i)}(s,cs(),u),Yn}const w_="en-US";let yM=w_;function JE(t,r,i,s,u){if(t=Le(t),Array.isArray(t))for(let g=0;g<t.length;g++)JE(t[g],r,i,s,u);else{const g=ln(),E=ke(),D=Kr();let A=Nl(t)?t:Le(t.provide);const N=Vx(t),H=1048575&D.providerIndexes,ne=D.directiveStart,fe=D.providerIndexes>>20;if(Nl(t)||!t.multi){const ve=new mh(N,u,Dt),ze=QE(A,r,u?H:H+fe,ne);-1===ze?(J_(Al(D,E),g,A),KE(g,t,r.length),r.push(A),D.directiveStart++,D.directiveEnd++,u&&(D.providerIndexes+=1048576),i.push(ve),E.push(ve)):(i[ze]=ve,E[ze]=ve)}else{const ve=QE(A,r,H+fe,ne),ze=QE(A,r,H,H+fe),bt=ze>=0&&i[ze];if(u&&!bt||!u&&!(ve>=0&&i[ve])){J_(Al(D,E),g,A);const kt=function EP(t,r,i,s,u){const g=new mh(t,i,Dt);return g.multi=[],g.index=r,g.componentProviders=0,$M(g,u,s&&!i),g}(u?wP:bP,i.length,u,s,N);!u&&bt&&(i[ze].providerFactory=kt),KE(g,t,r.length,0),r.push(A),D.directiveStart++,D.directiveEnd++,u&&(D.providerIndexes+=1048576),i.push(kt),E.push(kt)}else KE(g,t,ve>-1?ve:ze,$M(i[u?ze:ve],N,!u&&s));!u&&s&&bt&&i[ze].componentProviders++}}}function KE(t,r,i,s){const u=Nl(r),g=function Bx(t){return!!t.useClass}(r);if(u||g){const A=(g?Le(r.useClass):r).prototype.ngOnDestroy;if(A){const N=t.destroyHooks||(t.destroyHooks=[]);if(!u&&r.multi){const H=N.indexOf(i);-1===H?N.push(i,[s,A]):N[H+1].push(s,A)}else N.push(i,A)}}}function $M(t,r,i){return i&&t.componentProviders++,t.multi.push(r)-1}function QE(t,r,i,s){for(let u=i;u<s;u++)if(r[u]===t)return u;return-1}function bP(t,r,i,s){return eC(this.multi,[])}function wP(t,r,i,s){const u=this.multi;let g;if(this.providerFactory){const E=this.providerFactory.componentProviders,D=vh(i,i[Zt],this.providerFactory.index,s);g=D.slice(0,E),eC(u,g);for(let A=E;A<D.length;A++)g.push(D[A])}else g=[],eC(u,g);return g}function eC(t,r){for(let i=0;i<t.length;i++)r.push((0,t[i])());return r}function ro(t,r=[]){return i=>{i.providersResolver=(s,u)=>function xP(t,r,i){const s=ln();if(s.firstCreatePass){const u=ls(t);JE(i,s.data,s.blueprint,u,!0),JE(r,s.data,s.blueprint,u,!1)}}(s,u?u(t):t,r)}}class bm{}class GM{}class tC extends bm{constructor(r,i,s){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new b1(this);const u=Yr(r);this._bootstrapComponents=rc(u.bootstrap),this._r3Injector=Gp(r,i,[{provide:bm,useValue:this},{provide:$p,useValue:this.componentFactoryResolver},...s],ce(r),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(r)}get injector(){return this._r3Injector}destroy(){const r=this._r3Injector;!r.destroyed&&r.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(r){this.destroyCbs.push(r)}}class nC extends GM{constructor(r){super(),this.moduleType=r}create(r){return new tC(this.moduleType,r,[])}}class HM extends bm{constructor(r){super(),this.componentFactoryResolver=new b1(this),this.instance=null;const i=new Ud([...r.providers,{provide:bm,useValue:this},{provide:$p,useValue:this.componentFactoryResolver}],r.parent||Oh(),r.debugName,new Set(["environment"]));this.injector=i,r.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(r){this.injector.onDestroy(r)}}function rC(t,r,i=null){return new HM({providers:t,parent:r,debugName:i,runEnvironmentInitializers:!0}).injector}let MP=(()=>{class t{constructor(i){this._injector=i,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){const s=vg(0,i.type),u=s.length>0?rC([s],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,u)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(const i of this.cachedInjectors.values())null!==i&&i.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=Cn({token:t,providedIn:"environment",factory:()=>new t(yn(ta))})}return t})();function qM(t){t.getStandaloneInjector=r=>r.get(MP).getOrCreateStandaloneInjector(t)}function eR(t,r,i,s=!0){const u=r[Zt];if(function il(t,r,i,s){const u=Jr+s,g=i.length;s>0&&(i[u-1][Ys]=r),s<g-Jr?(r[Ys]=i[u],ny(i,Jr+s,r)):(i.push(r),r[Ys]=null),r[kr]=i;const E=r[yu];null!==E&&i!==E&&function kw(t,r){const i=t[Is];r[Si]!==r[kr][kr][Si]&&(t[Bf]=!0),null===i?t[Is]=[r]:i.push(r)}(E,r);const D=r[Ii];null!==D&&D.insertView(t),r[jn]|=128}(u,r,t,i),s){const g=Ap(i,t),E=r[Nn],D=ku(E,t[ba]);null!==D&&function kd(t,r,i,s,u,g){s[Ni]=u,s[ko]=r,Uc(t,s,i,1,u,g)}(u,t[ko],E,r,D,g)}}Symbol;let td=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=rR}return t})();const tR=td,nR=class extends tR{constructor(r,i,s){super(),this._declarationLView=r,this._declarationTContainer=i,this.elementRef=s}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(r,i){return this.createEmbeddedViewImpl(r,i)}createEmbeddedViewImpl(r,i,s){const u=function QP(t,r,i,s){const u=r.tView,D=Xp(t,u,i,4096&t[jn]?4096:16,null,r,null,null,null,s?.injector??null,s?.hydrationInfo??null);D[yu]=t[r.index];const N=t[Ii];return null!==N&&(D[Ii]=N.createEmbeddedView(u)),hf(u,D,i),D}(this._declarationLView,this._declarationTContainer,r,{injector:i,hydrationInfo:s});return new qh(u)}};function rR(){return function sb(t,r){return 4&t.type?new nR(r,t,kh(t,r)):null}(Kr(),ke())}let nu=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=cR}return t})();function cR(){return function uD(t,r){let i;const s=r[t.index];return zi(s)?i=s:(i=m1(s,r,null,t),r[t.index]=i,Zg(r,i)),hD(i,r,t,s),new lD(i,t,r)}(Kr(),ke())}const uR=nu,lD=class extends uR{constructor(r,i,s){super(),this._lContainer=r,this._hostTNode=i,this._hostLView=s}get element(){return kh(this._hostTNode,this._hostLView)}get injector(){return new us(this._hostTNode,this._hostLView)}get parentInjector(){const r=Xm(this._hostTNode,this._hostLView);if(X_(r)){const i=cp(r,this._hostLView),s=Fc(r);return new us(i[Zt].data[s+8],i)}return new us(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(r){const i=cD(this._lContainer);return null!==i&&i[r]||null}get length(){return this._lContainer.length-Jr}createEmbeddedView(r,i,s){let u,g;"number"==typeof s?u=s:null!=s&&(u=s.index,g=s.injector);const D=r.createEmbeddedViewImpl(i||{},g,null);return this.insertImpl(D,u,false),D}createComponent(r,i,s,u,g){const E=r&&!function wh(t){return"function"==typeof t}(r);let D;if(E)D=i;else{const et=i||{};D=et.index,s=et.injector,u=et.projectableNodes,g=et.environmentInjector||et.ngModuleRef}const A=E?r:new sm($n(r)),N=s||this.parentInjector;if(!g&&null==A.ngModule){const bt=(E?N:this.parentInjector).get(ta,null);bt&&(g=bt)}$n(A.componentType??{});const ve=A.create(N,u,null,g);return this.insertImpl(ve.hostView,D,false),ve}insert(r,i){return this.insertImpl(r,i,!1)}insertImpl(r,i,s){const u=r._lView;if(function ye(t){return zi(t[kr])}(u)){const A=this.indexOf(r);if(-1!==A)this.detach(A);else{const N=u[kr],H=new lD(N,N[ko],N[kr]);H.detach(H.indexOf(r))}}const E=this._adjustIndex(i),D=this._lContainer;return eR(D,u,E,!s),r.attachToViewContainerRef(),ny(sC(D),E,r),r}move(r,i){return this.insert(r,i)}indexOf(r){const i=cD(this._lContainer);return null!==i?i.indexOf(r):-1}remove(r){const i=this._adjustIndex(r,-1),s=Tp(this._lContainer,i);s&&(dp(sC(this._lContainer),i),vy(s[Zt],s))}detach(r){const i=this._adjustIndex(r,-1),s=Tp(this._lContainer,i);return s&&null!=dp(sC(this._lContainer),i)?new qh(s):null}_adjustIndex(r,i=0){return r??this.length+i}};function cD(t){return t[8]}function sC(t){return t[8]||(t[8]=[])}let hD=function dD(t,r,i,s){if(t[ba])return;let u;u=8&i.type?q(s):function hR(t,r){const i=t[Nn],s=i.createComment(""),u=se(r,t);return Lu(i,ku(i,u),s,function lg(t,r){return t.nextSibling(r)}(i,u),!1),s}(r,i),t[ba]=u};const _C=new sn("Application Initializer");let yC=(()=>{class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,s)=>{this.resolve=i,this.reject=s}),this.appInits=Qt(_C,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const i=[];for(const u of this.appInits){const g=u();if(Kh(g))i.push(g);else if(Mv(g)){const E=new Promise((D,A)=>{g.subscribe({complete:D,error:A})});i.push(E)}}const s=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{s()}).catch(u=>{this.reject(u)}),0===i.length&&s(),this.initialized=!0}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),ND=(()=>{class t{log(i){console.log(i)}warn(i){console.warn(i)}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();const nd=new sn("LocaleId",{providedIn:"root",factory:()=>Qt(nd,Pn.Optional|Pn.SkipSelf)||function UR(){return typeof $localize<"u"&&$localize.locale||w_}()});let zD=(()=>{class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new mi(!1)}add(){this.hasPendingTasks.next(!0);const i=this.taskId++;return this.pendingTasks.add(i),i}remove(i){this.pendingTasks.delete(i),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class HR{constructor(r,i){this.ngModuleFactory=r,this.componentFactories=i}}let BD=(()=>{class t{compileModuleSync(i){return new nC(i)}compileModuleAsync(i){return Promise.resolve(this.compileModuleSync(i))}compileModuleAndAllComponentsSync(i){const s=this.compileModuleSync(i),g=rc(Yr(i).declarations).reduce((E,D)=>{const A=$n(D);return A&&E.push(new sm(A)),E},[]);return new HR(s,g)}compileModuleAndAllComponentsAsync(i){return Promise.resolve(this.compileModuleAndAllComponentsSync(i))}clearCache(){}clearCacheFor(i){}getModuleId(i){}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const $D=new sn(""),ub=new sn("");let EC,bC=(()=>{class t{constructor(i,s,u){this._ngZone=i,this.registry=s,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,EC||(function fO(t){EC=t}(u),u.addToWindow(s)),this._watchAngularEvents(),i.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{$r.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb(this._didWork)}this._didWork=!1});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(s=>!s.updateCb||!s.updateCb(i)||(clearTimeout(s.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,s,u){let g=-1;s&&s>0&&(g=setTimeout(()=>{this._callbacks=this._callbacks.filter(E=>E.timeoutId!==g),i(this._didWork,this.getPendingTasks())},s)),this._callbacks.push({doneCb:i,timeoutId:g,updateCb:u})}whenStable(i,s,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,s,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(i){this.registry.registerApplication(i,this)}unregisterApplication(i){this.registry.unregisterApplication(i)}findProviders(i,s,u){return[]}static#e=this.\u0275fac=function(s){return new(s||t)(yn($r),yn(wC),yn(ub))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})(),wC=(()=>{class t{constructor(){this._applications=new Map}registerApplication(i,s){this._applications.set(i,s)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,s=!0){return EC?.findTestabilityInTree(this,i,s)??null}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})(),Mf=null;const GD=new sn("AllowMultipleToken"),CC=new sn("PlatformDestroyListeners"),TC=new sn("appBootstrapListener");class qD{constructor(r,i){this.name=r,this.token=i}}function WD(t,r,i=[]){const s=`Platform: ${r}`,u=new sn(s);return(g=[])=>{let E=MC();if(!E||E.injector.get(GD,!1)){const D=[...i,...g,{provide:u,useValue:!0}];t?t(D):function gO(t){if(Mf&&!Mf.get(GD,!1))throw new $e(400,!1);(function HD(){!function Fm(t){Bi=t}(()=>{throw new $e(600,!1)})})(),Mf=t;const r=t.get(YD);(function ZD(t){t.get(Vp,null)?.forEach(i=>i())})(t)}(function XD(t=[],r){return jo.create({name:r,providers:[{provide:wg,useValue:"platform"},{provide:CC,useValue:new Set([()=>Mf=null])},...t]})}(D,s))}return function yO(t){const r=MC();if(!r)throw new $e(401,!1);return r}()}}function MC(){return Mf?.get(YD)??null}let YD=(()=>{class t{constructor(i){this._injector=i,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(i,s){const u=function vO(t="zone.js",r){return"noop"===t?new n1:"zone.js"===t?new $r(r):t}(s?.ngZone,function JD(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}({eventCoalescing:s?.ngZoneEventCoalescing,runCoalescing:s?.ngZoneRunCoalescing}));return u.run(()=>{const g=function TP(t,r,i){return new tC(t,r,i)}(i.moduleType,this.injector,function nS(t){return[{provide:$r,useFactory:t},{provide:kp,multi:!0,useFactory:()=>{const r=Qt(bO,{optional:!0});return()=>r.initialize()}},{provide:tS,useFactory:xO},{provide:Og,useFactory:Ky}]}(()=>u)),E=g.injector.get(Xc,null);return u.runOutsideAngular(()=>{const D=u.onError.subscribe({next:A=>{E.handleError(A)}});g.onDestroy(()=>{hb(this._modules,g),D.unsubscribe()})}),function KD(t,r,i){try{const s=i();return Kh(s)?s.catch(u=>{throw r.runOutsideAngular(()=>t.handleError(u)),u}):s}catch(s){throw r.runOutsideAngular(()=>t.handleError(s)),s}}(E,u,()=>{const D=g.injector.get(yC);return D.runInitializers(),D.donePromise.then(()=>(function vM(t){Ao(t,"Expected localeId to be defined"),"string"==typeof t&&(yM=t.toLowerCase().replace(/_/g,"-"))}(g.injector.get(nd,w_)||w_),this._moduleDoBootstrap(g),g))})})}bootstrapModule(i,s=[]){const u=QD({},s);return function pO(t,r,i){const s=new nC(i);return Promise.resolve(s)}(0,0,i).then(g=>this.bootstrapModuleFactory(g,u))}_moduleDoBootstrap(i){const s=i.injector.get(T_);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(u=>s.bootstrap(u));else{if(!i.instance.ngDoBootstrap)throw new $e(-403,!1);i.instance.ngDoBootstrap(s)}this._modules.push(i)}onDestroy(i){this._destroyListeners.push(i)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new $e(404,!1);this._modules.slice().forEach(s=>s.destroy()),this._destroyListeners.forEach(s=>s());const i=this._injector.get(CC,null);i&&(i.forEach(s=>s()),i.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(s){return new(s||t)(yn(jo))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();function QD(t,r){return Array.isArray(r)?r.reduce(QD,t):{...t,...r}}let T_=(()=>{class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Qt(tS),this.zoneIsStable=Qt(Og),this.componentTypes=[],this.components=[],this.isStable=Qt(zD).hasPendingTasks.pipe(He(i=>i?Tn(!1):this.zoneIsStable),function Mn(t,r=rs){return t=t??P,ni((i,s)=>{let u,g=!0;i.subscribe(er(s,E=>{const D=r(E);(g||!t(u,D))&&(g=!1,u=D,s.next(E))}))})}(),cd()),this._injector=Qt(ta)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(i,s){const u=i instanceof Gx;if(!this._injector.get(yC).done)throw!u&&function Ki(t){const r=$n(t)||Di(t)||Fi(t);return null!==r&&r.standalone}(i),new $e(405,!1);let E;E=u?i:this._injector.get($p).resolveComponentFactory(i),this.componentTypes.push(E.componentType);const D=function mO(t){return t.isBoundToModule}(E)?void 0:this._injector.get(bm),N=E.create(jo.NULL,[],s||E.selector,D),H=N.location.nativeElement,ne=N.injector.get($D,null);return ne?.registerApplication(H),N.onDestroy(()=>{this.detachView(N.hostView),hb(this.components,N),ne?.unregisterApplication(H)}),this._loadComponent(N),N}tick(){if(this._runningTick)throw new $e(101,!1);try{this._runningTick=!0;for(let i of this._views)i.detectChanges()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1}}attachView(i){const s=i;this._views.push(s),s.attachToAppRef(this)}detachView(i){const s=i;hb(this._views,s),s.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i);const s=this._injector.get(TC,[]);s.push(...this._bootstrapListeners),s.forEach(u=>u(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>hb(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new $e(406,!1);const i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function hb(t,r){const i=t.indexOf(r);i>-1&&t.splice(i,1)}const tS=new sn("",{providedIn:"root",factory:()=>Qt(Xc).handleError.bind(void 0)});function xO(){const t=Qt($r),r=Qt(Xc);return i=>t.runOutsideAngular(()=>r.handleError(i))}let bO=(()=>{class t{constructor(){this.zone=Qt($r),this.applicationRef=Qt(T_)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();let db=(()=>{class t{static#e=this.__NG_ELEMENT_ID__=EO}return t})();function EO(t){return function CO(t,r,i){if(Tl(t)&&!i){const s=he(t.index,r);return new qh(s,s)}return 47&t.type?new qh(r[Si],r):null}(Kr(),ke(),16==(16&t))}class sS{constructor(){}supports(r){return cm(r)}create(r){return new AO(r)}}const IO=(t,r)=>r;class AO{constructor(r){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=r||IO}forEachItem(r){let i;for(i=this._itHead;null!==i;i=i._next)r(i)}forEachOperation(r){let i=this._itHead,s=this._removalsHead,u=0,g=null;for(;i||s;){const E=!s||i&&i.currentIndex<lS(s,u,g)?i:s,D=lS(E,u,g),A=E.currentIndex;if(E===s)u--,s=s._nextRemoved;else if(i=i._next,null==E.previousIndex)u++;else{g||(g=[]);const N=D-u,H=A-u;if(N!=H){for(let fe=0;fe<N;fe++){const ve=fe<g.length?g[fe]:g[fe]=0,ze=ve+fe;H<=ze&&ze<N&&(g[fe]=ve+1)}g[E.previousIndex]=H-N}}D!==A&&r(E,D,A)}}forEachPreviousItem(r){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)r(i)}forEachAddedItem(r){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)r(i)}forEachMovedItem(r){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)r(i)}forEachRemovedItem(r){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)r(i)}forEachIdentityChange(r){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)r(i)}diff(r){if(null==r&&(r=[]),!cm(r))throw new $e(900,!1);return this.check(r)?this:null}onDestroy(){}check(r){this._reset();let u,g,E,i=this._itHead,s=!1;if(Array.isArray(r)){this.length=r.length;for(let D=0;D<this.length;D++)g=r[D],E=this._trackByFn(D,g),null!==i&&Object.is(i.trackById,E)?(s&&(i=this._verifyReinsertion(i,g,E,D)),Object.is(i.item,g)||this._addIdentityChange(i,g)):(i=this._mismatch(i,g,E,D),s=!0),i=i._next}else u=0,function A1(t,r){if(Array.isArray(t))for(let i=0;i<t.length;i++)r(t[i]);else{const i=t[Symbol.iterator]();let s;for(;!(s=i.next()).done;)r(s.value)}}(r,D=>{E=this._trackByFn(u,D),null!==i&&Object.is(i.trackById,E)?(s&&(i=this._verifyReinsertion(i,D,E,u)),Object.is(i.item,D)||this._addIdentityChange(i,D)):(i=this._mismatch(i,D,E,u),s=!0),i=i._next,u++}),this.length=u;return this._truncate(i),this.collection=r,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let r;for(r=this._previousItHead=this._itHead;null!==r;r=r._next)r._nextPrevious=r._next;for(r=this._additionsHead;null!==r;r=r._nextAdded)r.previousIndex=r.currentIndex;for(this._additionsHead=this._additionsTail=null,r=this._movesHead;null!==r;r=r._nextMoved)r.previousIndex=r.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(r,i,s,u){let g;return null===r?g=this._itTail:(g=r._prev,this._remove(r)),null!==(r=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null))?(Object.is(r.item,i)||this._addIdentityChange(r,i),this._reinsertAfter(r,g,u)):null!==(r=null===this._linkedRecords?null:this._linkedRecords.get(s,u))?(Object.is(r.item,i)||this._addIdentityChange(r,i),this._moveAfter(r,g,u)):r=this._addAfter(new PO(i,s),g,u),r}_verifyReinsertion(r,i,s,u){let g=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null);return null!==g?r=this._reinsertAfter(g,r._prev,u):r.currentIndex!=u&&(r.currentIndex=u,this._addToMoves(r,u)),r}_truncate(r){for(;null!==r;){const i=r._next;this._addToRemovals(this._unlink(r)),r=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(r,i,s){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(r);const u=r._prevRemoved,g=r._nextRemoved;return null===u?this._removalsHead=g:u._nextRemoved=g,null===g?this._removalsTail=u:g._prevRemoved=u,this._insertAfter(r,i,s),this._addToMoves(r,s),r}_moveAfter(r,i,s){return this._unlink(r),this._insertAfter(r,i,s),this._addToMoves(r,s),r}_addAfter(r,i,s){return this._insertAfter(r,i,s),this._additionsTail=null===this._additionsTail?this._additionsHead=r:this._additionsTail._nextAdded=r,r}_insertAfter(r,i,s){const u=null===i?this._itHead:i._next;return r._next=u,r._prev=i,null===u?this._itTail=r:u._prev=r,null===i?this._itHead=r:i._next=r,null===this._linkedRecords&&(this._linkedRecords=new aS),this._linkedRecords.put(r),r.currentIndex=s,r}_remove(r){return this._addToRemovals(this._unlink(r))}_unlink(r){null!==this._linkedRecords&&this._linkedRecords.remove(r);const i=r._prev,s=r._next;return null===i?this._itHead=s:i._next=s,null===s?this._itTail=i:s._prev=i,r}_addToMoves(r,i){return r.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=r:this._movesTail._nextMoved=r),r}_addToRemovals(r){return null===this._unlinkedRecords&&(this._unlinkedRecords=new aS),this._unlinkedRecords.put(r),r.currentIndex=null,r._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=r,r._prevRemoved=null):(r._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=r),r}_addIdentityChange(r,i){return r.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=r:this._identityChangesTail._nextIdentityChange=r,r}}class PO{constructor(r,i){this.item=r,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class RO{constructor(){this._head=null,this._tail=null}add(r){null===this._head?(this._head=this._tail=r,r._nextDup=null,r._prevDup=null):(this._tail._nextDup=r,r._prevDup=this._tail,r._nextDup=null,this._tail=r)}get(r,i){let s;for(s=this._head;null!==s;s=s._nextDup)if((null===i||i<=s.currentIndex)&&Object.is(s.trackById,r))return s;return null}remove(r){const i=r._prevDup,s=r._nextDup;return null===i?this._head=s:i._nextDup=s,null===s?this._tail=i:s._prevDup=i,null===this._head}}class aS{constructor(){this.map=new Map}put(r){const i=r.trackById;let s=this.map.get(i);s||(s=new RO,this.map.set(i,s)),s.add(r)}get(r,i){const u=this.map.get(r);return u?u.get(r,i):null}remove(r){const i=r.trackById;return this.map.get(i).remove(r)&&this.map.delete(i),r}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function lS(t,r,i){const s=t.previousIndex;if(null===s)return s;let u=0;return i&&s<i.length&&(u=i[s]),s+r+u}function uS(){return new mb([new sS])}let mb=(()=>{class t{static#e=this.\u0275prov=Cn({token:t,providedIn:"root",factory:uS});constructor(i){this.factories=i}static create(i,s){if(null!=s){const u=s.factories.slice();i=i.concat(u)}return new t(i)}static extend(i){return{provide:t,useFactory:s=>t.create(i,s||uS()),deps:[[t,new Pd,new pp]]}}find(i){const s=this.factories.find(u=>u.supports(i));if(null!=s)return s;throw new $e(901,!1)}}return t})();const NO=WD(null,"core",[]);let zO=(()=>{class t{constructor(i){}static#e=this.\u0275fac=function(s){return new(s||t)(yn(T_))};static#t=this.\u0275mod=qi({type:t});static#n=this.\u0275inj=Ji({})}return t})(),RC=null;function Df(){return RC}class KO{}const hc=new sn("DocumentToken");let OC=(()=>{class t{historyGo(i){throw new Error("Not implemented")}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:function(){return Qt(eL)},providedIn:"platform"})}return t})();const QO=new sn("Location Initialized");let eL=(()=>{class t extends OC{constructor(){super(),this._doc=Qt(hc),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Df().getBaseHref(this._doc)}onPopState(i){const s=Df().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",i,!1),()=>s.removeEventListener("popstate",i)}onHashChange(i){const s=Df().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",i,!1),()=>s.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,s,u){this._history.pushState(i,s,u)}replaceState(i,s,u){this._history.replaceState(i,s,u)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:function(){return new t},providedIn:"platform"})}return t})();function LC(t,r){if(0==t.length)return r;if(0==r.length)return t;let i=0;return t.endsWith("/")&&i++,r.startsWith("/")&&i++,2==i?t+r.substring(1):1==i?t+r:t+"/"+r}function xS(t){const r=t.match(/#|\?|$/),i=r&&r.index||t.length;return t.slice(0,i-("/"===t[i-1]?1:0))+t.slice(i)}function rd(t){return t&&"?"!==t[0]?"?"+t:t}let Em=(()=>{class t{historyGo(i){throw new Error("Not implemented")}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:function(){return Qt(wS)},providedIn:"root"})}return t})();const bS=new sn("appBaseHref");let wS=(()=>{class t extends Em{constructor(i,s){super(),this._platformLocation=i,this._removeListenerFns=[],this._baseHref=s??this._platformLocation.getBaseHrefFromDOM()??Qt(hc).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return LC(this._baseHref,i)}path(i=!1){const s=this._platformLocation.pathname+rd(this._platformLocation.search),u=this._platformLocation.hash;return u&&i?`${s}${u}`:s}pushState(i,s,u,g){const E=this.prepareExternalUrl(u+rd(g));this._platformLocation.pushState(i,s,E)}replaceState(i,s,u,g){const E=this.prepareExternalUrl(u+rd(g));this._platformLocation.replaceState(i,s,E)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#e=this.\u0275fac=function(s){return new(s||t)(yn(OC),yn(bS,8))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),tL=(()=>{class t extends Em{constructor(i,s){super(),this._platformLocation=i,this._baseHref="",this._removeListenerFns=[],null!=s&&(this._baseHref=s)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}path(i=!1){let s=this._platformLocation.hash;return null==s&&(s="#"),s.length>0?s.substring(1):s}prepareExternalUrl(i){const s=LC(this._baseHref,i);return s.length>0?"#"+s:s}pushState(i,s,u,g){let E=this.prepareExternalUrl(u+rd(g));0==E.length&&(E=this._platformLocation.pathname),this._platformLocation.pushState(i,s,E)}replaceState(i,s,u,g){let E=this.prepareExternalUrl(u+rd(g));0==E.length&&(E=this._platformLocation.pathname),this._platformLocation.replaceState(i,s,E)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static#e=this.\u0275fac=function(s){return new(s||t)(yn(OC),yn(bS,8))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})(),kC=(()=>{class t{constructor(i){this._subject=new Xi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=i;const s=this._locationStrategy.getBaseHref();this._basePath=function iL(t){if(new RegExp("^(https?:)?//").test(t)){const[,i]=t.split(/\/\/[^\/]+/);return i}return t}(xS(ES(s))),this._locationStrategy.onPopState(u=>{this._subject.emit({url:this.path(!0),pop:!0,state:u.state,type:u.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,s=""){return this.path()==this.normalize(i+rd(s))}normalize(i){return t.stripTrailingSlash(function rL(t,r){if(!t||!r.startsWith(t))return r;const i=r.substring(t.length);return""===i||["/",";","?","#"].includes(i[0])?i:r}(this._basePath,ES(i)))}prepareExternalUrl(i){return i&&"/"!==i[0]&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,s="",u=null){this._locationStrategy.pushState(u,"",i,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+rd(s)),u)}replaceState(i,s="",u=null){this._locationStrategy.replaceState(u,"",i,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+rd(s)),u)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)})),()=>{const s=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(s,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",s){this._urlChangeListeners.forEach(u=>u(i,s))}subscribe(i,s,u){return this._subject.subscribe({next:i,error:s,complete:u})}static#e=this.normalizeQueryParams=rd;static#t=this.joinWithSlash=LC;static#n=this.stripTrailingSlash=xS;static#r=this.\u0275fac=function(s){return new(s||t)(yn(Em))};static#i=this.\u0275prov=Cn({token:t,factory:function(){return function nL(){return new kC(yn(Em))}()},providedIn:"root"})}return t})();function ES(t){return t.replace(/\/index.html$/,"")}class HL{constructor(r,i,s,u){this.$implicit=r,this.ngForOf=i,this.index=s,this.count=u}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let LS=(()=>{class t{set ngForOf(i){this._ngForOf=i,this._ngForOfDirty=!0}set ngForTrackBy(i){this._trackByFn=i}get ngForTrackBy(){return this._trackByFn}constructor(i,s,u){this._viewContainer=i,this._template=s,this._differs=u,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(i){i&&(this._template=i)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const i=this._ngForOf;!this._differ&&i&&(this._differ=this._differs.find(i).create(this.ngForTrackBy))}if(this._differ){const i=this._differ.diff(this._ngForOf);i&&this._applyChanges(i)}}_applyChanges(i){const s=this._viewContainer;i.forEachOperation((u,g,E)=>{if(null==u.previousIndex)s.createEmbeddedView(this._template,new HL(u.item,this._ngForOf,-1,-1),null===E?void 0:E);else if(null==E)s.remove(null===g?void 0:g);else if(null!==g){const D=s.get(g);s.move(D,E),kS(D,u)}});for(let u=0,g=s.length;u<g;u++){const D=s.get(u).context;D.index=u,D.count=g,D.ngForOf=this._ngForOf}i.forEachIdentityChange(u=>{kS(s.get(u.currentIndex),u)})}static ngTemplateContextGuard(i,s){return!0}static#e=this.\u0275fac=function(s){return new(s||t)(Dt(nu),Dt(td),Dt(mb))};static#t=this.\u0275dir=xn({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return t})();function kS(t,r){t.context.$implicit=r.item}let FS=(()=>{class t{constructor(i,s){this._viewContainer=i,this._context=new qL,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=s}set ngIf(i){this._context.$implicit=this._context.ngIf=i,this._updateView()}set ngIfThen(i){NS("ngIfThen",i),this._thenTemplateRef=i,this._thenViewRef=null,this._updateView()}set ngIfElse(i){NS("ngIfElse",i),this._elseTemplateRef=i,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(i,s){return!0}static#e=this.\u0275fac=function(s){return new(s||t)(Dt(nu),Dt(td))};static#t=this.\u0275dir=xn({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return t})();class qL{constructor(){this.$implicit=null,this.ngIf=null}}function NS(t,r){if(r&&!r.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${ce(r)}'.`)}let _k=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275mod=qi({type:t});static#n=this.\u0275inj=Ji({})}return t})();function jS(t){return"server"===t}let bk=(()=>{class t{static#e=this.\u0275prov=Cn({token:t,providedIn:"root",factory:()=>new wk(yn(hc),window)})}return t})();class wk{constructor(r,i){this.document=r,this.window=i,this.offset=()=>[0,0]}setOffset(r){this.offset=Array.isArray(r)?()=>r:r}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(r){this.supportsScrolling()&&this.window.scrollTo(r[0],r[1])}scrollToAnchor(r){if(!this.supportsScrolling())return;const i=function Ek(t,r){const i=t.getElementById(r)||t.getElementsByName(r)[0];if(i)return i;if("function"==typeof t.createTreeWalker&&t.body&&"function"==typeof t.body.attachShadow){const s=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let u=s.currentNode;for(;u;){const g=u.shadowRoot;if(g){const E=g.getElementById(r)||g.querySelector(`[name="${r}"]`);if(E)return E}u=s.nextNode()}}return null}(this.document,r);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(r){this.supportsScrolling()&&(this.window.history.scrollRestoration=r)}scrollToElement(r){const i=r.getBoundingClientRect(),s=i.left+this.window.pageXOffset,u=i.top+this.window.pageYOffset,g=this.offset();this.window.scrollTo(s-g[0],u-g[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class Zk extends KO{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class KC extends Zk{static makeCurrent(){!function JO(t){RC||(RC=t)}(new KC)}onAndCancel(r,i,s){return r.addEventListener(i,s),()=>{r.removeEventListener(i,s)}}dispatchEvent(r,i){r.dispatchEvent(i)}remove(r){r.parentNode&&r.parentNode.removeChild(r)}createElement(r,i){return(i=i||this.getDefaultDocument()).createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,i){return"window"===i?window:"document"===i?r:"body"===i?r.body:null}getBaseHref(r){const i=function Wk(){return a0=a0||document.querySelector("base"),a0?a0.getAttribute("href"):null}();return null==i?null:function Xk(t){Ib=Ib||document.createElement("a"),Ib.setAttribute("href",t);const r=Ib.pathname;return"/"===r.charAt(0)?r:`/${r}`}(i)}resetBaseElement(){a0=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return function UL(t,r){r=encodeURIComponent(r);for(const i of t.split(";")){const s=i.indexOf("="),[u,g]=-1==s?[i,""]:[i.slice(0,s),i.slice(s+1)];if(u.trim()===r)return decodeURIComponent(g)}return null}(document.cookie,r)}}let Ib,a0=null,Jk=(()=>{class t{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})();const QC=new sn("EventManagerPlugins");let qS=(()=>{class t{constructor(i,s){this._zone=s,this._eventNameToPlugin=new Map,i.forEach(u=>{u.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,s,u){return this._findPluginFor(s).addEventListener(i,s,u)}getZone(){return this._zone}_findPluginFor(i){let s=this._eventNameToPlugin.get(i);if(s)return s;if(s=this._plugins.find(g=>g.supports(i)),!s)throw new $e(5101,!1);return this._eventNameToPlugin.set(i,s),s}static#e=this.\u0275fac=function(s){return new(s||t)(yn(QC),yn($r))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})();class ZS{constructor(r){this._doc=r}}const eT="ng-app-id";let WS=(()=>{class t{constructor(i,s,u,g={}){this.doc=i,this.appId=s,this.nonce=u,this.platformId=g,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=jS(g),this.resetHostNodes()}addStyles(i){for(const s of i)1===this.changeUsageCount(s,1)&&this.onStyleAdded(s)}removeStyles(i){for(const s of i)this.changeUsageCount(s,-1)<=0&&this.onStyleRemoved(s)}ngOnDestroy(){const i=this.styleNodesInDOM;i&&(i.forEach(s=>s.remove()),i.clear());for(const s of this.getAllStyles())this.onStyleRemoved(s);this.resetHostNodes()}addHost(i){this.hostNodes.add(i);for(const s of this.getAllStyles())this.addStyleToHost(i,s)}removeHost(i){this.hostNodes.delete(i)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(i){for(const s of this.hostNodes)this.addStyleToHost(s,i)}onStyleRemoved(i){const s=this.styleRef;s.get(i)?.elements?.forEach(u=>u.remove()),s.delete(i)}collectServerRenderedStyles(){const i=this.doc.head?.querySelectorAll(`style[${eT}="${this.appId}"]`);if(i?.length){const s=new Map;return i.forEach(u=>{null!=u.textContent&&s.set(u.textContent,u)}),s}return null}changeUsageCount(i,s){const u=this.styleRef;if(u.has(i)){const g=u.get(i);return g.usage+=s,g.usage}return u.set(i,{usage:s,elements:[]}),s}getStyleElement(i,s){const u=this.styleNodesInDOM,g=u?.get(s);if(g?.parentNode===i)return u.delete(s),g.removeAttribute(eT),g;{const E=this.doc.createElement("style");return this.nonce&&E.setAttribute("nonce",this.nonce),E.textContent=s,this.platformIsServer&&E.setAttribute(eT,this.appId),E}}addStyleToHost(i,s){const u=this.getStyleElement(i,s);i.appendChild(u);const g=this.styleRef,E=g.get(s)?.elements;E?E.push(u):g.set(s,{elements:[u],usage:1})}resetHostNodes(){const i=this.hostNodes;i.clear(),i.add(this.doc.head)}static#e=this.\u0275fac=function(s){return new(s||t)(yn(hc),yn(Cg),yn(jx,8),yn(Gd))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})();const tT={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},nT=/%COMP%/g,tF=new sn("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function YS(t,r){return r.map(i=>i.replace(nT,t))}let JS=(()=>{class t{constructor(i,s,u,g,E,D,A,N=null){this.eventManager=i,this.sharedStylesHost=s,this.appId=u,this.removeStylesOnCompDestroy=g,this.doc=E,this.platformId=D,this.ngZone=A,this.nonce=N,this.rendererByCompId=new Map,this.platformIsServer=jS(D),this.defaultRenderer=new rT(i,E,A,this.platformIsServer)}createRenderer(i,s){if(!i||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===Ro.ShadowDom&&(s={...s,encapsulation:Ro.Emulated});const u=this.getOrCreateRenderer(i,s);return u instanceof QS?u.applyToHost(i):u instanceof iT&&u.applyStyles(),u}getOrCreateRenderer(i,s){const u=this.rendererByCompId;let g=u.get(s.id);if(!g){const E=this.doc,D=this.ngZone,A=this.eventManager,N=this.sharedStylesHost,H=this.removeStylesOnCompDestroy,ne=this.platformIsServer;switch(s.encapsulation){case Ro.Emulated:g=new QS(A,N,s,this.appId,H,E,D,ne);break;case Ro.ShadowDom:return new oF(A,N,i,s,E,D,this.nonce,ne);default:g=new iT(A,N,s,H,E,D,ne)}u.set(s.id,g)}return g}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(s){return new(s||t)(yn(qS),yn(WS),yn(Cg),yn(tF),yn(hc),yn(Gd),yn($r),yn(jx))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})();class rT{constructor(r,i,s,u){this.eventManager=r,this.doc=i,this.ngZone=s,this.platformIsServer=u,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(r,i){return i?this.doc.createElementNS(tT[i]||i,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,i){(KS(r)?r.content:r).appendChild(i)}insertBefore(r,i,s){r&&(KS(r)?r.content:r).insertBefore(i,s)}removeChild(r,i){r&&r.removeChild(i)}selectRootElement(r,i){let s="string"==typeof r?this.doc.querySelector(r):r;if(!s)throw new $e(-5104,!1);return i||(s.textContent=""),s}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,i,s,u){if(u){i=u+":"+i;const g=tT[u];g?r.setAttributeNS(g,i,s):r.setAttribute(i,s)}else r.setAttribute(i,s)}removeAttribute(r,i,s){if(s){const u=tT[s];u?r.removeAttributeNS(u,i):r.removeAttribute(`${s}:${i}`)}else r.removeAttribute(i)}addClass(r,i){r.classList.add(i)}removeClass(r,i){r.classList.remove(i)}setStyle(r,i,s,u){u&(Vc.DashCase|Vc.Important)?r.style.setProperty(i,s,u&Vc.Important?"important":""):r.style[i]=s}removeStyle(r,i,s){s&Vc.DashCase?r.style.removeProperty(i):r.style[i]=""}setProperty(r,i,s){r[i]=s}setValue(r,i){r.nodeValue=i}listen(r,i,s){if("string"==typeof r&&!(r=Df().getGlobalEventTarget(this.doc,r)))throw new Error(`Unsupported event target ${r} for event ${i}`);return this.eventManager.addEventListener(r,i,this.decoratePreventDefault(s))}decoratePreventDefault(r){return i=>{if("__ngUnwrap__"===i)return r;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>r(i)):r(i))&&i.preventDefault()}}}function KS(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class oF extends rT{constructor(r,i,s,u,g,E,D,A){super(r,g,E,A),this.sharedStylesHost=i,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const N=YS(u.id,u.styles);for(const H of N){const ne=document.createElement("style");D&&ne.setAttribute("nonce",D),ne.textContent=H,this.shadowRoot.appendChild(ne)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,i){return super.appendChild(this.nodeOrShadowRoot(r),i)}insertBefore(r,i,s){return super.insertBefore(this.nodeOrShadowRoot(r),i,s)}removeChild(r,i){return super.removeChild(this.nodeOrShadowRoot(r),i)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class iT extends rT{constructor(r,i,s,u,g,E,D,A){super(r,g,E,D),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=u,this.styles=A?YS(A,s.styles):s.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class QS extends iT{constructor(r,i,s,u,g,E,D,A){const N=u+"-"+s.id;super(r,i,s,g,E,D,A,N),this.contentAttr=function nF(t){return"_ngcontent-%COMP%".replace(nT,t)}(N),this.hostAttr=function rF(t){return"_nghost-%COMP%".replace(nT,t)}(N)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,i){const s=super.createElement(r,i);return super.setAttribute(s,this.contentAttr,""),s}}let sF=(()=>{class t extends ZS{constructor(i){super(i)}supports(i){return!0}addEventListener(i,s,u){return i.addEventListener(s,u,!1),()=>this.removeEventListener(i,s,u)}removeEventListener(i,s,u){return i.removeEventListener(s,u)}static#e=this.\u0275fac=function(s){return new(s||t)(yn(hc))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})();const eI=["alt","control","meta","shift"],aF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},lF={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let cF=(()=>{class t extends ZS{constructor(i){super(i)}supports(i){return null!=t.parseEventName(i)}addEventListener(i,s,u){const g=t.parseEventName(s),E=t.eventCallback(g.fullKey,u,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Df().onAndCancel(i,g.domEventName,E))}static parseEventName(i){const s=i.toLowerCase().split("."),u=s.shift();if(0===s.length||"keydown"!==u&&"keyup"!==u)return null;const g=t._normalizeKey(s.pop());let E="",D=s.indexOf("code");if(D>-1&&(s.splice(D,1),E="code."),eI.forEach(N=>{const H=s.indexOf(N);H>-1&&(s.splice(H,1),E+=N+".")}),E+=g,0!=s.length||0===g.length)return null;const A={};return A.domEventName=u,A.fullKey=E,A}static matchEventFullKeyCode(i,s){let u=aF[i.key]||i.key,g="";return s.indexOf("code.")>-1&&(u=i.code,g="code."),!(null==u||!u)&&(u=u.toLowerCase()," "===u?u="space":"."===u&&(u="dot"),eI.forEach(E=>{E!==u&&(0,lF[E])(i)&&(g+=E+".")}),g+=u,g===s)}static eventCallback(i,s,u){return g=>{t.matchEventFullKeyCode(g,i)&&u.runGuarded(()=>s(g))}}static _normalizeKey(i){return"esc"===i?"escape":i}static#e=this.\u0275fac=function(s){return new(s||t)(yn(hc))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})();const fF=WD(NO,"browser",[{provide:Gd,useValue:"browser"},{provide:Vp,useValue:function uF(){KC.makeCurrent()},multi:!0},{provide:hc,useFactory:function dF(){return function wx(t){Gc=t}(document),document},deps:[]}]),pF=new sn(""),rI=[{provide:ub,useClass:class Yk{addToWindow(r){Wt.getAngularTestability=(s,u=!0)=>{const g=r.findTestabilityInTree(s,u);if(null==g)throw new $e(5103,!1);return g},Wt.getAllAngularTestabilities=()=>r.getAllTestabilities(),Wt.getAllAngularRootElements=()=>r.getAllRootElements(),Wt.frameworkStabilizers||(Wt.frameworkStabilizers=[]),Wt.frameworkStabilizers.push(s=>{const u=Wt.getAllAngularTestabilities();let g=u.length,E=!1;const D=function(A){E=E||A,g--,0==g&&s(E)};u.forEach(A=>{A.whenStable(D)})})}findTestabilityInTree(r,i,s){return null==i?null:r.getTestability(i)??(s?Df().isShadowRoot(i)?this.findTestabilityInTree(r,i.host,!0):this.findTestabilityInTree(r,i.parentElement,!0):null)}},deps:[]},{provide:$D,useClass:bC,deps:[$r,wC,ub]},{provide:bC,useClass:bC,deps:[$r,wC,ub]}],iI=[{provide:wg,useValue:"root"},{provide:Xc,useFactory:function hF(){return new Xc},deps:[]},{provide:QC,useClass:sF,multi:!0,deps:[hc,$r,Gd]},{provide:QC,useClass:cF,multi:!0,deps:[hc]},JS,WS,qS,{provide:Wx,useExisting:JS},{provide:class Ck{},useClass:Jk,deps:[]},[]];let mF=(()=>{class t{constructor(i){}static withServerTransition(i){return{ngModule:t,providers:[{provide:Cg,useValue:i.appId}]}}static#e=this.\u0275fac=function(s){return new(s||t)(yn(pF,12))};static#t=this.\u0275mod=qi({type:t});static#n=this.\u0275inj=Ji({providers:[...iI,...rI],imports:[_k,zO]})}return t})(),oI=(()=>{class t{constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}static#e=this.\u0275fac=function(s){return new(s||t)(yn(hc))};static#t=this.\u0275prov=Cn({token:t,factory:function(s){let u=null;return u=s?new s:function _F(){return new oI(yn(hc))}(),u},providedIn:"root"})}return t})();typeof window<"u"&&window;const{isArray:EF}=Array,{getPrototypeOf:CF,prototype:TF,keys:MF}=Object;function cI(t){if(1===t.length){const r=t[0];if(EF(r))return{args:r,keys:null};if(function DF(t){return t&&"object"==typeof t&&CF(t)===TF}(r)){const i=MF(r);return{args:i.map(s=>r[s]),keys:i}}}return{args:t,keys:null}}const{isArray:SF}=Array;function uI(t){return _r(r=>function IF(t,r){return SF(r)?t(...r):t(r)}(t,r))}function hI(t,r){return t.reduce((i,s,u)=>(i[s]=r[u],i),{})}function sT(...t){const r=ki(t),i=wi(t),{args:s,keys:u}=cI(t);if(0===s.length)return Vr([],r);const g=new fr(function AF(t,r,i=rs){return s=>{dI(r,()=>{const{length:u}=t,g=new Array(u);let E=u,D=u;for(let A=0;A<u;A++)dI(r,()=>{const N=Vr(t[A],r);let H=!1;N.subscribe(er(s,ne=>{g[A]=ne,H||(H=!0,D--),D||s.next(i(g.slice()))},()=>{--E||s.complete()}))},s)},s)}}(s,r,u?E=>hI(u,E):rs));return i?g.pipe(uI(i)):g}function dI(t,r,i){t?yi(i,t,r):r()}const Ab=mc(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function aT(...t){return function PF(){return ja(1)}()(Vr(t,ki(t)))}function fI(t){return new fr(r=>{Vn(t()).subscribe(r)})}function l0(t,r){const i=zr(t)?t:()=>t,s=u=>u.error(i());return new fr(r?u=>r.schedule(s,0,u):s)}function lT(){return ni((t,r)=>{let i=null;t._refCount++;const s=er(r,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(i=null);const u=t._connection,g=i;i=null,u&&(!g||u===g)&&u.unsubscribe(),r.unsubscribe()});t.subscribe(s),s.closed||(i=t.connect())})}class pI extends fr{constructor(r,i){super(),this.source=r,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,Va(r)&&(this.lift=r.lift)}_subscribe(r){return this.getSubject().subscribe(r)}getSubject(){const r=this._subject;return(!r||r.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:r}=this;this._subject=this._connection=null,r?.unsubscribe()}connect(){let r=this._connection;if(!r){r=this._connection=new en;const i=this.getSubject();r.add(this.source.subscribe(er(i,void 0,()=>{this._teardown(),i.complete()},s=>{this._teardown(),i.error(s)},()=>this._teardown()))),r.closed&&(this._connection=null,r=en.EMPTY)}return r}refCount(){return lT()(this)}}function S_(t){return t<=0?()=>yo:ni((r,i)=>{let s=0;r.subscribe(er(i,u=>{++s<=t&&(i.next(u),t<=s&&i.complete())}))})}function If(t,r){return ni((i,s)=>{let u=0;i.subscribe(er(s,g=>t.call(r,g,u++)&&s.next(g)))})}function Pb(t){return ni((r,i)=>{let s=!1;r.subscribe(er(i,u=>{s=!0,i.next(u)},()=>{s||i.next(t),i.complete()}))})}function mI(t=OF){return ni((r,i)=>{let s=!1;r.subscribe(er(i,u=>{s=!0,i.next(u)},()=>s?i.complete():i.error(t())))})}function OF(){return new Ab}function Cm(t,r){const i=arguments.length>=2;return s=>s.pipe(t?If((u,g)=>t(u,g,s)):rs,S_(1),i?Pb(r):mI(()=>new Ab))}function c0(t,r){return zr(r)?fi(t,r,1):fi(t,1)}function ia(t,r,i){const s=zr(t)||r||i?{next:t,error:r,complete:i}:t;return s?ni((u,g)=>{var E;null===(E=s.subscribe)||void 0===E||E.call(s);let D=!0;u.subscribe(er(g,A=>{var N;null===(N=s.next)||void 0===N||N.call(s,A),g.next(A)},()=>{var A;D=!1,null===(A=s.complete)||void 0===A||A.call(s),g.complete()},A=>{var N;D=!1,null===(N=s.error)||void 0===N||N.call(s,A),g.error(A)},()=>{var A,N;D&&(null===(A=s.unsubscribe)||void 0===A||A.call(s)),null===(N=s.finalize)||void 0===N||N.call(s)}))}):rs}function Tm(t){return ni((r,i)=>{let g,s=null,u=!1;s=r.subscribe(er(i,void 0,void 0,E=>{g=Vn(t(E,Tm(t)(r))),s?(s.unsubscribe(),s=null,g.subscribe(i)):u=!0})),u&&(s.unsubscribe(),s=null,g.subscribe(i))})}function cT(t){return t<=0?()=>yo:ni((r,i)=>{let s=[];r.subscribe(er(i,u=>{s.push(u),t<s.length&&s.shift()},()=>{for(const u of s)i.next(u);i.complete()},void 0,()=>{s=null}))})}function uT(t){return ni((r,i)=>{try{r.subscribe(i)}finally{i.add(t)}})}const ur="primary",u0=Symbol("RouteTitle");class BF{constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){const i=this.params[r];return Array.isArray(i)?i[0]:i}return null}getAll(r){if(this.has(r)){const i=this.params[r];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}}function I_(t){return new BF(t)}function VF(t,r,i){const s=i.path.split("/");if(s.length>t.length||"full"===i.pathMatch&&(r.hasChildren()||s.length<t.length))return null;const u={};for(let g=0;g<s.length;g++){const E=s[g],D=t[g];if(E.startsWith(":"))u[E.substring(1)]=D;else if(E!==D.path)return null}return{consumed:t.slice(0,s.length),posParams:u}}function Ju(t,r){const i=t?Object.keys(t):void 0,s=r?Object.keys(r):void 0;if(!i||!s||i.length!=s.length)return!1;let u;for(let g=0;g<i.length;g++)if(u=i[g],!gI(t[u],r[u]))return!1;return!0}function gI(t,r){if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return!1;const i=[...t].sort(),s=[...r].sort();return i.every((u,g)=>s[g]===u)}return t===r}function _I(t){return t.length>0?t[t.length-1]:null}function Af(t){return function wF(t){return!!t&&(t instanceof fr||zr(t.lift)&&zr(t.subscribe))}(t)?t:Kh(t)?Vr(Promise.resolve(t)):Tn(t)}const UF={exact:function xI(t,r,i){if(!Mm(t.segments,r.segments)||!Rb(t.segments,r.segments,i)||t.numberOfChildren!==r.numberOfChildren)return!1;for(const s in r.children)if(!t.children[s]||!xI(t.children[s],r.children[s],i))return!1;return!0},subset:bI},yI={exact:function $F(t,r){return Ju(t,r)},subset:function GF(t,r){return Object.keys(r).length<=Object.keys(t).length&&Object.keys(r).every(i=>gI(t[i],r[i]))},ignored:()=>!0};function vI(t,r,i){return UF[i.paths](t.root,r.root,i.matrixParams)&&yI[i.queryParams](t.queryParams,r.queryParams)&&!("exact"===i.fragment&&t.fragment!==r.fragment)}function bI(t,r,i){return wI(t,r,r.segments,i)}function wI(t,r,i,s){if(t.segments.length>i.length){const u=t.segments.slice(0,i.length);return!(!Mm(u,i)||r.hasChildren()||!Rb(u,i,s))}if(t.segments.length===i.length){if(!Mm(t.segments,i)||!Rb(t.segments,i,s))return!1;for(const u in r.children)if(!t.children[u]||!bI(t.children[u],r.children[u],s))return!1;return!0}{const u=i.slice(0,t.segments.length),g=i.slice(t.segments.length);return!!(Mm(t.segments,u)&&Rb(t.segments,u,s)&&t.children[ur])&&wI(t.children[ur],r,g,s)}}function Rb(t,r,i){return r.every((s,u)=>yI[i](t[u].parameters,s.parameters))}class A_{constructor(r=new _i([],{}),i={},s=null){this.root=r,this.queryParams=i,this.fragment=s}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=I_(this.queryParams)),this._queryParamMap}toString(){return ZF.serialize(this)}}class _i{constructor(r,i){this.segments=r,this.children=i,this.parent=null,Object.values(i).forEach(s=>s.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ob(this)}}class h0{constructor(r,i){this.path=r,this.parameters=i}get parameterMap(){return this._parameterMap||(this._parameterMap=I_(this.parameters)),this._parameterMap}toString(){return TI(this)}}function Mm(t,r){return t.length===r.length&&t.every((i,s)=>i.path===r[s].path)}let d0=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:function(){return new hT},providedIn:"root"})}return t})();class hT{parse(r){const i=new iN(r);return new A_(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(r){const i=`/${f0(r.root,!0)}`,s=function YF(t){const r=Object.keys(t).map(i=>{const s=t[i];return Array.isArray(s)?s.map(u=>`${Lb(i)}=${Lb(u)}`).join("&"):`${Lb(i)}=${Lb(s)}`}).filter(i=>!!i);return r.length?`?${r.join("&")}`:""}(r.queryParams);return`${i}${s}${"string"==typeof r.fragment?`#${function WF(t){return encodeURI(t)}(r.fragment)}`:""}`}}const ZF=new hT;function Ob(t){return t.segments.map(r=>TI(r)).join("/")}function f0(t,r){if(!t.hasChildren())return Ob(t);if(r){const i=t.children[ur]?f0(t.children[ur],!1):"",s=[];return Object.entries(t.children).forEach(([u,g])=>{u!==ur&&s.push(`${u}:${f0(g,!1)}`)}),s.length>0?`${i}(${s.join("//")})`:i}{const i=function qF(t,r){let i=[];return Object.entries(t.children).forEach(([s,u])=>{s===ur&&(i=i.concat(r(u,s)))}),Object.entries(t.children).forEach(([s,u])=>{s!==ur&&(i=i.concat(r(u,s)))}),i}(t,(s,u)=>u===ur?[f0(t.children[ur],!1)]:[`${u}:${f0(s,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[ur]?`${Ob(t)}/${i[0]}`:`${Ob(t)}/(${i.join("//")})`}}function EI(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Lb(t){return EI(t).replace(/%3B/gi,";")}function dT(t){return EI(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function kb(t){return decodeURIComponent(t)}function CI(t){return kb(t.replace(/\+/g,"%20"))}function TI(t){return`${dT(t.path)}${function XF(t){return Object.keys(t).map(r=>`;${dT(r)}=${dT(t[r])}`).join("")}(t.parameters)}`}const JF=/^[^\/()?;#]+/;function fT(t){const r=t.match(JF);return r?r[0]:""}const KF=/^[^\/()?;=#]+/,eN=/^[^=?&#]+/,nN=/^[^&#]+/;class iN{constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new _i([],{}):new _i([],this.parseChildren())}parseQueryParams(){const r={};if(this.consumeOptional("?"))do{this.parseQueryParam(r)}while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let s={};return this.peekStartsWith("(")&&(s=this.parseParens(!1)),(r.length>0||Object.keys(i).length>0)&&(s[ur]=new _i(r,i)),s}parseSegment(){const r=fT(this.remaining);if(""===r&&this.peekStartsWith(";"))throw new $e(4009,!1);return this.capture(r),new h0(kb(r),this.parseMatrixParams())}parseMatrixParams(){const r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){const i=function QF(t){const r=t.match(KF);return r?r[0]:""}(this.remaining);if(!i)return;this.capture(i);let s="";if(this.consumeOptional("=")){const u=fT(this.remaining);u&&(s=u,this.capture(s))}r[kb(i)]=kb(s)}parseQueryParam(r){const i=function tN(t){const r=t.match(eN);return r?r[0]:""}(this.remaining);if(!i)return;this.capture(i);let s="";if(this.consumeOptional("=")){const E=function rN(t){const r=t.match(nN);return r?r[0]:""}(this.remaining);E&&(s=E,this.capture(s))}const u=CI(i),g=CI(s);if(r.hasOwnProperty(u)){let E=r[u];Array.isArray(E)||(E=[E],r[u]=E),E.push(g)}else r[u]=g}parseParens(r){const i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const s=fT(this.remaining),u=this.remaining[s.length];if("/"!==u&&")"!==u&&";"!==u)throw new $e(4010,!1);let g;s.indexOf(":")>-1?(g=s.slice(0,s.indexOf(":")),this.capture(g),this.capture(":")):r&&(g=ur);const E=this.parseChildren();i[g]=1===Object.keys(E).length?E[ur]:new _i([],E),this.consumeOptional("//")}return i}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return!!this.peekStartsWith(r)&&(this.remaining=this.remaining.substring(r.length),!0)}capture(r){if(!this.consumeOptional(r))throw new $e(4011,!1)}}function MI(t){return t.segments.length>0?new _i([],{[ur]:t}):t}function DI(t){const r={};for(const s of Object.keys(t.children)){const g=DI(t.children[s]);if(s===ur&&0===g.segments.length&&g.hasChildren())for(const[E,D]of Object.entries(g.children))r[E]=D;else(g.segments.length>0||g.hasChildren())&&(r[s]=g)}return function oN(t){if(1===t.numberOfChildren&&t.children[ur]){const r=t.children[ur];return new _i(t.segments.concat(r.segments),r.children)}return t}(new _i(t.segments,r))}function Dm(t){return t instanceof A_}function SI(t){let r;const u=MI(function i(g){const E={};for(const A of g.children){const N=i(A);E[A.outlet]=N}const D=new _i(g.url,E);return g===t&&(r=D),D}(t.root));return r??u}function II(t,r,i,s){let u=t;for(;u.parent;)u=u.parent;if(0===r.length)return pT(u,u,u,i,s);const g=function aN(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new PI(!0,0,t);let r=0,i=!1;const s=t.reduce((u,g,E)=>{if("object"==typeof g&&null!=g){if(g.outlets){const D={};return Object.entries(g.outlets).forEach(([A,N])=>{D[A]="string"==typeof N?N.split("/"):N}),[...u,{outlets:D}]}if(g.segmentPath)return[...u,g.segmentPath]}return"string"!=typeof g?[...u,g]:0===E?(g.split("/").forEach((D,A)=>{0==A&&"."===D||(0==A&&""===D?i=!0:".."===D?r++:""!=D&&u.push(D))}),u):[...u,g]},[]);return new PI(i,r,s)}(r);if(g.toRoot())return pT(u,u,new _i([],{}),i,s);const E=function lN(t,r,i){if(t.isAbsolute)return new Nb(r,!0,0);if(!i)return new Nb(r,!1,NaN);if(null===i.parent)return new Nb(i,!0,0);const s=Fb(t.commands[0])?0:1;return function cN(t,r,i){let s=t,u=r,g=i;for(;g>u;){if(g-=u,s=s.parent,!s)throw new $e(4005,!1);u=s.segments.length}return new Nb(s,!1,u-g)}(i,i.segments.length-1+s,t.numberOfDoubleDots)}(g,u,t),D=E.processChildren?m0(E.segmentGroup,E.index,g.commands):RI(E.segmentGroup,E.index,g.commands);return pT(u,E.segmentGroup,D,i,s)}function Fb(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function p0(t){return"object"==typeof t&&null!=t&&t.outlets}function pT(t,r,i,s,u){let E,g={};s&&Object.entries(s).forEach(([A,N])=>{g[A]=Array.isArray(N)?N.map(H=>`${H}`):`${N}`}),E=t===r?i:AI(t,r,i);const D=MI(DI(E));return new A_(D,g,u)}function AI(t,r,i){const s={};return Object.entries(t.children).forEach(([u,g])=>{s[u]=g===r?i:AI(g,r,i)}),new _i(t.segments,s)}class PI{constructor(r,i,s){if(this.isAbsolute=r,this.numberOfDoubleDots=i,this.commands=s,r&&s.length>0&&Fb(s[0]))throw new $e(4003,!1);const u=s.find(p0);if(u&&u!==_I(s))throw new $e(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Nb{constructor(r,i,s){this.segmentGroup=r,this.processChildren=i,this.index=s}}function RI(t,r,i){if(t||(t=new _i([],{})),0===t.segments.length&&t.hasChildren())return m0(t,r,i);const s=function hN(t,r,i){let s=0,u=r;const g={match:!1,pathIndex:0,commandIndex:0};for(;u<t.segments.length;){if(s>=i.length)return g;const E=t.segments[u],D=i[s];if(p0(D))break;const A=`${D}`,N=s<i.length-1?i[s+1]:null;if(u>0&&void 0===A)break;if(A&&N&&"object"==typeof N&&void 0===N.outlets){if(!LI(A,N,E))return g;s+=2}else{if(!LI(A,{},E))return g;s++}u++}return{match:!0,pathIndex:u,commandIndex:s}}(t,r,i),u=i.slice(s.commandIndex);if(s.match&&s.pathIndex<t.segments.length){const g=new _i(t.segments.slice(0,s.pathIndex),{});return g.children[ur]=new _i(t.segments.slice(s.pathIndex),t.children),m0(g,0,u)}return s.match&&0===u.length?new _i(t.segments,{}):s.match&&!t.hasChildren()?mT(t,r,i):s.match?m0(t,0,u):mT(t,r,i)}function m0(t,r,i){if(0===i.length)return new _i(t.segments,{});{const s=function uN(t){return p0(t[0])?t[0].outlets:{[ur]:t}}(i),u={};if(Object.keys(s).some(g=>g!==ur)&&t.children[ur]&&1===t.numberOfChildren&&0===t.children[ur].segments.length){const g=m0(t.children[ur],r,i);return new _i(t.segments,g.children)}return Object.entries(s).forEach(([g,E])=>{"string"==typeof E&&(E=[E]),null!==E&&(u[g]=RI(t.children[g],r,E))}),Object.entries(t.children).forEach(([g,E])=>{void 0===s[g]&&(u[g]=E)}),new _i(t.segments,u)}}function mT(t,r,i){const s=t.segments.slice(0,r);let u=0;for(;u<i.length;){const g=i[u];if(p0(g)){const A=dN(g.outlets);return new _i(s,A)}if(0===u&&Fb(i[0])){s.push(new h0(t.segments[r].path,OI(i[0]))),u++;continue}const E=p0(g)?g.outlets[ur]:`${g}`,D=u<i.length-1?i[u+1]:null;E&&D&&Fb(D)?(s.push(new h0(E,OI(D))),u+=2):(s.push(new h0(E,{})),u++)}return new _i(s,{})}function dN(t){const r={};return Object.entries(t).forEach(([i,s])=>{"string"==typeof s&&(s=[s]),null!==s&&(r[i]=mT(new _i([],{}),0,s))}),r}function OI(t){const r={};return Object.entries(t).forEach(([i,s])=>r[i]=`${s}`),r}function LI(t,r,i){return t==i.path&&Ju(r,i.parameters)}const g0="imperative";class Ku{constructor(r,i){this.id=r,this.url=i}}class zb extends Ku{constructor(r,i,s="imperative",u=null){super(r,i),this.type=0,this.navigationTrigger=s,this.restoredState=u}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Pf extends Ku{constructor(r,i,s){super(r,i),this.urlAfterRedirects=s,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class _0 extends Ku{constructor(r,i,s,u){super(r,i),this.reason=s,this.code=u,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class P_ extends Ku{constructor(r,i,s,u){super(r,i),this.reason=s,this.code=u,this.type=16}}class Bb extends Ku{constructor(r,i,s,u){super(r,i),this.error=s,this.target=u,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class kI extends Ku{constructor(r,i,s,u){super(r,i),this.urlAfterRedirects=s,this.state=u,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fN extends Ku{constructor(r,i,s,u){super(r,i),this.urlAfterRedirects=s,this.state=u,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class pN extends Ku{constructor(r,i,s,u,g){super(r,i),this.urlAfterRedirects=s,this.state=u,this.shouldActivate=g,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class mN extends Ku{constructor(r,i,s,u){super(r,i),this.urlAfterRedirects=s,this.state=u,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gN extends Ku{constructor(r,i,s,u){super(r,i),this.urlAfterRedirects=s,this.state=u,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _N{constructor(r){this.route=r,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class yN{constructor(r){this.route=r,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class vN{constructor(r){this.snapshot=r,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xN{constructor(r){this.snapshot=r,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bN{constructor(r){this.snapshot=r,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wN{constructor(r){this.snapshot=r,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class FI{constructor(r,i,s){this.routerEvent=r,this.position=i,this.anchor=s,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class gT{}class _T{constructor(r){this.url=r}}class EN{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new y0,this.attachRef=null}}let y0=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(i,s){const u=this.getOrCreateContext(i);u.outlet=s,this.contexts.set(i,u)}onChildOutletDestroyed(i){const s=this.getContext(i);s&&(s.outlet=null,s.attachRef=null)}onOutletDeactivated(){const i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let s=this.getContext(i);return s||(s=new EN,this.contexts.set(i,s)),s}getContext(i){return this.contexts.get(i)||null}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();class NI{constructor(r){this._root=r}get root(){return this._root.value}parent(r){const i=this.pathFromRoot(r);return i.length>1?i[i.length-2]:null}children(r){const i=yT(r,this._root);return i?i.children.map(s=>s.value):[]}firstChild(r){const i=yT(r,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(r){const i=vT(r,this._root);return i.length<2?[]:i[i.length-2].children.map(u=>u.value).filter(u=>u!==r)}pathFromRoot(r){return vT(r,this._root).map(i=>i.value)}}function yT(t,r){if(t===r.value)return r;for(const i of r.children){const s=yT(t,i);if(s)return s}return null}function vT(t,r){if(t===r.value)return[r];for(const i of r.children){const s=vT(t,i);if(s.length)return s.unshift(r),s}return[]}class sd{constructor(r,i){this.value=r,this.children=i}toString(){return`TreeNode(${this.value})`}}function R_(t){const r={};return t&&t.children.forEach(i=>r[i.value.outlet]=i),r}class zI extends NI{constructor(r,i){super(r),this.snapshot=i,xT(this,r)}toString(){return this.snapshot.toString()}}function BI(t,r){const i=function CN(t,r){const E=new Vb([],{},{},"",{},ur,r,null,{});return new jI("",new sd(E,[]))}(0,r),s=new mi([new h0("",{})]),u=new mi({}),g=new mi({}),E=new mi({}),D=new mi(""),A=new O_(s,u,E,D,g,ur,r,i.root);return A.snapshot=i.root,new zI(new sd(A,[]),i)}class O_{constructor(r,i,s,u,g,E,D,A){this.urlSubject=r,this.paramsSubject=i,this.queryParamsSubject=s,this.fragmentSubject=u,this.dataSubject=g,this.outlet=E,this.component=D,this._futureSnapshot=A,this.title=this.dataSubject?.pipe(_r(N=>N[u0]))??Tn(void 0),this.url=r,this.params=i,this.queryParams=s,this.fragment=u,this.data=g}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(_r(r=>I_(r)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(_r(r=>I_(r)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function VI(t,r="emptyOnly"){const i=t.pathFromRoot;let s=0;if("always"!==r)for(s=i.length-1;s>=1;){const u=i[s],g=i[s-1];if(u.routeConfig&&""===u.routeConfig.path)s--;else{if(g.component)break;s--}}return function TN(t){return t.reduce((r,i)=>({params:{...r.params,...i.params},data:{...r.data,...i.data},resolve:{...i.data,...r.resolve,...i.routeConfig?.data,...i._resolvedData}}),{params:{},data:{},resolve:{}})}(i.slice(s))}class Vb{get title(){return this.data?.[u0]}constructor(r,i,s,u,g,E,D,A,N){this.url=r,this.params=i,this.queryParams=s,this.fragment=u,this.data=g,this.outlet=E,this.component=D,this.routeConfig=A,this._resolve=N}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=I_(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=I_(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(s=>s.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class jI extends NI{constructor(r,i){super(i),this.url=r,xT(this,i)}toString(){return UI(this._root)}}function xT(t,r){r.value._routerState=t,r.children.forEach(i=>xT(t,i))}function UI(t){const r=t.children.length>0?` { ${t.children.map(UI).join(", ")} } `:"";return`${t.value}${r}`}function bT(t){if(t.snapshot){const r=t.snapshot,i=t._futureSnapshot;t.snapshot=i,Ju(r.queryParams,i.queryParams)||t.queryParamsSubject.next(i.queryParams),r.fragment!==i.fragment&&t.fragmentSubject.next(i.fragment),Ju(r.params,i.params)||t.paramsSubject.next(i.params),function jF(t,r){if(t.length!==r.length)return!1;for(let i=0;i<t.length;++i)if(!Ju(t[i],r[i]))return!1;return!0}(r.url,i.url)||t.urlSubject.next(i.url),Ju(r.data,i.data)||t.dataSubject.next(i.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function wT(t,r){const i=Ju(t.params,r.params)&&function HF(t,r){return Mm(t,r)&&t.every((i,s)=>Ju(i.parameters,r[s].parameters))}(t.url,r.url);return i&&!(!t.parent!=!r.parent)&&(!t.parent||wT(t.parent,r.parent))}let ET=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=ur,this.activateEvents=new Xi,this.deactivateEvents=new Xi,this.attachEvents=new Xi,this.detachEvents=new Xi,this.parentContexts=Qt(y0),this.location=Qt(nu),this.changeDetector=Qt(db),this.environmentInjector=Qt(ta),this.inputBinder=Qt(jb,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(i){if(i.name){const{firstChange:s,previousValue:u}=i.name;if(s)return;this.isTrackedInParentContexts(u)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(u)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new $e(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new $e(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new $e(4012,!1);this.location.detach();const i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,s){this.activated=i,this._activatedRoute=s,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){const i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,s){if(this.isActivated)throw new $e(4013,!1);this._activatedRoute=i;const u=this.location,E=i.snapshot.component,D=this.parentContexts.getOrCreateContext(this.name).children,A=new MN(i,D,u.injector);this.activated=u.createComponent(E,{index:u.length,injector:A,environmentInjector:s??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275dir=xn({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[x]})}return t})();class MN{constructor(r,i,s){this.route=r,this.childContexts=i,this.parent=s}get(r,i){return r===O_?this.route:r===y0?this.childContexts:this.parent.get(r,i)}}const jb=new sn("");let $I=(()=>{class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(i){this.unsubscribeFromRouteData(i),this.subscribeToRouteData(i)}unsubscribeFromRouteData(i){this.outletDataSubscriptions.get(i)?.unsubscribe(),this.outletDataSubscriptions.delete(i)}subscribeToRouteData(i){const{activatedRoute:s}=i,u=sT([s.queryParams,s.params,s.data]).pipe(He(([g,E,D],A)=>(D={...g,...E,...D},0===A?Tn(D):Promise.resolve(D)))).subscribe(g=>{if(!i.isActivated||!i.activatedComponentRef||i.activatedRoute!==s||null===s.component)return void this.unsubscribeFromRouteData(i);const E=function YO(t){const r=$n(t);if(!r)return null;const i=new sm(r);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return r.standalone},get isSignal(){return r.signals}}}(s.component);if(E)for(const{templateName:D}of E.inputs)i.activatedComponentRef.setInput(D,g[D]);else this.unsubscribeFromRouteData(i)});this.outletDataSubscriptions.set(i,u)}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})();function v0(t,r,i){if(i&&t.shouldReuseRoute(r.value,i.value.snapshot)){const s=i.value;s._futureSnapshot=r.value;const u=function SN(t,r,i){return r.children.map(s=>{for(const u of i.children)if(t.shouldReuseRoute(s.value,u.value.snapshot))return v0(t,s,u);return v0(t,s)})}(t,r,i);return new sd(s,u)}{if(t.shouldAttach(r.value)){const g=t.retrieve(r.value);if(null!==g){const E=g.route;return E.value._futureSnapshot=r.value,E.children=r.children.map(D=>v0(t,D)),E}}const s=function IN(t){return new O_(new mi(t.url),new mi(t.params),new mi(t.queryParams),new mi(t.fragment),new mi(t.data),t.outlet,t.component,t)}(r.value),u=r.children.map(g=>v0(t,g));return new sd(s,u)}}const CT="ngNavigationCancelingError";function GI(t,r){const{redirectTo:i,navigationBehaviorOptions:s}=Dm(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,u=HI(!1,0,r);return u.url=i,u.navigationBehaviorOptions=s,u}function HI(t,r,i){const s=new Error("NavigationCancelingError: "+(t||""));return s[CT]=!0,s.cancellationCode=r,i&&(s.url=i),s}function qI(t){return t&&t[CT]}let ZI=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275cmp=as({type:t,selectors:[["ng-component"]],standalone:!0,features:[qM],decls:1,vars:0,template:function(s,u){1&s&&Zu(0,"router-outlet")},dependencies:[ET],encapsulation:2})}return t})();function TT(t){const r=t.children&&t.children.map(TT),i=r?{...t,children:r}:{...t};return!i.component&&!i.loadComponent&&(r||i.loadChildren)&&i.outlet&&i.outlet!==ur&&(i.component=ZI),i}function ou(t){return t.outlet||ur}function x0(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let r=t.parent;r;r=r.parent){const i=r.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}class NN{constructor(r,i,s,u,g){this.routeReuseStrategy=r,this.futureState=i,this.currState=s,this.forwardEvent=u,this.inputBindingEnabled=g}activate(r){const i=this.futureState._root,s=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,s,r),bT(this.futureState.root),this.activateChildRoutes(i,s,r)}deactivateChildRoutes(r,i,s){const u=R_(i);r.children.forEach(g=>{const E=g.value.outlet;this.deactivateRoutes(g,u[E],s),delete u[E]}),Object.values(u).forEach(g=>{this.deactivateRouteAndItsChildren(g,s)})}deactivateRoutes(r,i,s){const u=r.value,g=i?i.value:null;if(u===g)if(u.component){const E=s.getContext(u.outlet);E&&this.deactivateChildRoutes(r,i,E.children)}else this.deactivateChildRoutes(r,i,s);else g&&this.deactivateRouteAndItsChildren(i,s)}deactivateRouteAndItsChildren(r,i){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,i):this.deactivateRouteAndOutlet(r,i)}detachAndStoreRouteSubtree(r,i){const s=i.getContext(r.value.outlet),u=s&&r.value.component?s.children:i,g=R_(r);for(const E of Object.keys(g))this.deactivateRouteAndItsChildren(g[E],u);if(s&&s.outlet){const E=s.outlet.detach(),D=s.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:E,route:r,contexts:D})}}deactivateRouteAndOutlet(r,i){const s=i.getContext(r.value.outlet),u=s&&r.value.component?s.children:i,g=R_(r);for(const E of Object.keys(g))this.deactivateRouteAndItsChildren(g[E],u);s&&(s.outlet&&(s.outlet.deactivate(),s.children.onOutletDeactivated()),s.attachRef=null,s.route=null)}activateChildRoutes(r,i,s){const u=R_(i);r.children.forEach(g=>{this.activateRoutes(g,u[g.value.outlet],s),this.forwardEvent(new wN(g.value.snapshot))}),r.children.length&&this.forwardEvent(new xN(r.value.snapshot))}activateRoutes(r,i,s){const u=r.value,g=i?i.value:null;if(bT(u),u===g)if(u.component){const E=s.getOrCreateContext(u.outlet);this.activateChildRoutes(r,i,E.children)}else this.activateChildRoutes(r,i,s);else if(u.component){const E=s.getOrCreateContext(u.outlet);if(this.routeReuseStrategy.shouldAttach(u.snapshot)){const D=this.routeReuseStrategy.retrieve(u.snapshot);this.routeReuseStrategy.store(u.snapshot,null),E.children.onOutletReAttached(D.contexts),E.attachRef=D.componentRef,E.route=D.route.value,E.outlet&&E.outlet.attach(D.componentRef,D.route.value),bT(D.route.value),this.activateChildRoutes(r,null,E.children)}else{const D=x0(u.snapshot);E.attachRef=null,E.route=u,E.injector=D,E.outlet&&E.outlet.activateWith(u,E.injector),this.activateChildRoutes(r,null,E.children)}}else this.activateChildRoutes(r,null,s)}}class WI{constructor(r){this.path=r,this.route=this.path[this.path.length-1]}}class Ub{constructor(r,i){this.component=r,this.route=i}}function zN(t,r,i){const s=t._root;return b0(s,r?r._root:null,i,[s.value])}function L_(t,r){const i=Symbol(),s=r.get(t,i);return s===i?"function"!=typeof t||function xc(t){return null!==Ua(t)}(t)?r.get(t):t:s}function b0(t,r,i,s,u={canDeactivateChecks:[],canActivateChecks:[]}){const g=R_(r);return t.children.forEach(E=>{(function VN(t,r,i,s,u={canDeactivateChecks:[],canActivateChecks:[]}){const g=t.value,E=r?r.value:null,D=i?i.getContext(t.value.outlet):null;if(E&&g.routeConfig===E.routeConfig){const A=function jN(t,r,i){if("function"==typeof i)return i(t,r);switch(i){case"pathParamsChange":return!Mm(t.url,r.url);case"pathParamsOrQueryParamsChange":return!Mm(t.url,r.url)||!Ju(t.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!wT(t,r)||!Ju(t.queryParams,r.queryParams);default:return!wT(t,r)}}(E,g,g.routeConfig.runGuardsAndResolvers);A?u.canActivateChecks.push(new WI(s)):(g.data=E.data,g._resolvedData=E._resolvedData),b0(t,r,g.component?D?D.children:null:i,s,u),A&&D&&D.outlet&&D.outlet.isActivated&&u.canDeactivateChecks.push(new Ub(D.outlet.component,E))}else E&&w0(r,D,u),u.canActivateChecks.push(new WI(s)),b0(t,null,g.component?D?D.children:null:i,s,u)})(E,g[E.value.outlet],i,s.concat([E.value]),u),delete g[E.value.outlet]}),Object.entries(g).forEach(([E,D])=>w0(D,i.getContext(E),u)),u}function w0(t,r,i){const s=R_(t),u=t.value;Object.entries(s).forEach(([g,E])=>{w0(E,u.component?r?r.children.getContext(g):null:r,i)}),i.canDeactivateChecks.push(new Ub(u.component&&r&&r.outlet&&r.outlet.isActivated?r.outlet.component:null,u))}function E0(t){return"function"==typeof t}function XI(t){return t instanceof Ab||"EmptyError"===t?.name}const $b=Symbol("INITIAL_VALUE");function k_(){return He(t=>sT(t.map(r=>r.pipe(S_(1),function RF(...t){const r=ki(t);return ni((i,s)=>{(r?aT(t,i,r):aT(t,i)).subscribe(s)})}($b)))).pipe(_r(r=>{for(const i of r)if(!0!==i){if(i===$b)return $b;if(!1===i||i instanceof A_)return i}return!0}),If(r=>r!==$b),S_(1)))}function YI(t){return function dn(...t){return Bs(t)}(ia(r=>{if(Dm(r))throw GI(0,r)}),_r(r=>!0===r))}class Gb{constructor(r){this.segmentGroup=r||null}}class JI{constructor(r){this.urlTree=r}}function F_(t){return l0(new Gb(t))}function KI(t){return l0(new JI(t))}class a3{constructor(r,i){this.urlSerializer=r,this.urlTree=i}noMatchError(r){return new $e(4002,!1)}lineralizeSegments(r,i){let s=[],u=i.root;for(;;){if(s=s.concat(u.segments),0===u.numberOfChildren)return Tn(s);if(u.numberOfChildren>1||!u.children[ur])return l0(new $e(4e3,!1));u=u.children[ur]}}applyRedirectCommands(r,i,s){return this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),r,s)}applyRedirectCreateUrlTree(r,i,s,u){const g=this.createSegmentGroup(r,i.root,s,u);return new A_(g,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(r,i){const s={};return Object.entries(r).forEach(([u,g])=>{if("string"==typeof g&&g.startsWith(":")){const D=g.substring(1);s[u]=i[D]}else s[u]=g}),s}createSegmentGroup(r,i,s,u){const g=this.createSegments(r,i.segments,s,u);let E={};return Object.entries(i.children).forEach(([D,A])=>{E[D]=this.createSegmentGroup(r,A,s,u)}),new _i(g,E)}createSegments(r,i,s,u){return i.map(g=>g.path.startsWith(":")?this.findPosParam(r,g,u):this.findOrReturn(g,s))}findPosParam(r,i,s){const u=s[i.path.substring(1)];if(!u)throw new $e(4001,!1);return u}findOrReturn(r,i){let s=0;for(const u of i){if(u.path===r.path)return i.splice(s),u;s++}return r}}const MT={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function l3(t,r,i,s,u){const g=DT(t,r,i);return g.matched?(s=function PN(t,r){return t.providers&&!t._injector&&(t._injector=rC(t.providers,r,`Route: ${t.path}`)),t._injector??r}(r,s),function i3(t,r,i,s){const u=r.canMatch;return u&&0!==u.length?Tn(u.map(E=>{const D=L_(E,t);return Af(function ZN(t){return t&&E0(t.canMatch)}(D)?D.canMatch(r,i):t.runInContext(()=>D(r,i)))})).pipe(k_(),YI()):Tn(!0)}(s,r,i).pipe(_r(E=>!0===E?g:{...MT}))):Tn(g)}function DT(t,r,i){if(""===r.path)return"full"===r.pathMatch&&(t.hasChildren()||i.length>0)?{...MT}:{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};const u=(r.matcher||VF)(i,t,r);if(!u)return{...MT};const g={};Object.entries(u.posParams??{}).forEach(([D,A])=>{g[D]=A.path});const E=u.consumed.length>0?{...g,...u.consumed[u.consumed.length-1].parameters}:g;return{matched:!0,consumedSegments:u.consumed,remainingSegments:i.slice(u.consumed.length),parameters:E,positionalParamSegments:u.posParams??{}}}function QI(t,r,i,s){return i.length>0&&function h3(t,r,i){return i.some(s=>Hb(t,r,s)&&ou(s)!==ur)}(t,i,s)?{segmentGroup:new _i(r,u3(s,new _i(i,t.children))),slicedSegments:[]}:0===i.length&&function d3(t,r,i){return i.some(s=>Hb(t,r,s))}(t,i,s)?{segmentGroup:new _i(t.segments,c3(t,0,i,s,t.children)),slicedSegments:i}:{segmentGroup:new _i(t.segments,t.children),slicedSegments:i}}function c3(t,r,i,s,u){const g={};for(const E of s)if(Hb(t,i,E)&&!u[ou(E)]){const D=new _i([],{});g[ou(E)]=D}return{...u,...g}}function u3(t,r){const i={};i[ur]=r;for(const s of t)if(""===s.path&&ou(s)!==ur){const u=new _i([],{});i[ou(s)]=u}return i}function Hb(t,r,i){return(!(t.hasChildren()||r.length>0)||"full"!==i.pathMatch)&&""===i.path}class g3{constructor(r,i,s,u,g,E,D){this.injector=r,this.configLoader=i,this.rootComponentType=s,this.config=u,this.urlTree=g,this.paramsInheritanceStrategy=E,this.urlSerializer=D,this.allowRedirects=!0,this.applyRedirects=new a3(this.urlSerializer,this.urlTree)}noMatchError(r){return new $e(4002,!1)}recognize(){const r=QI(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,r,ur).pipe(Tm(i=>{if(i instanceof JI)return this.allowRedirects=!1,this.urlTree=i.urlTree,this.match(i.urlTree);throw i instanceof Gb?this.noMatchError(i):i}),_r(i=>{const s=new Vb([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},ur,this.rootComponentType,null,{}),u=new sd(s,i),g=new jI("",u),E=function sN(t,r,i=null,s=null){return II(SI(t),r,i,s)}(s,[],this.urlTree.queryParams,this.urlTree.fragment);return E.queryParams=this.urlTree.queryParams,g.url=this.urlSerializer.serialize(E),this.inheritParamsAndData(g._root),{state:g,tree:E}}))}match(r){return this.processSegmentGroup(this.injector,this.config,r.root,ur).pipe(Tm(s=>{throw s instanceof Gb?this.noMatchError(s):s}))}inheritParamsAndData(r){const i=r.value,s=VI(i,this.paramsInheritanceStrategy);i.params=Object.freeze(s.params),i.data=Object.freeze(s.data),r.children.forEach(u=>this.inheritParamsAndData(u))}processSegmentGroup(r,i,s,u){return 0===s.segments.length&&s.hasChildren()?this.processChildren(r,i,s):this.processSegment(r,i,s,s.segments,u,!0)}processChildren(r,i,s){const u=[];for(const g of Object.keys(s.children))"primary"===g?u.unshift(g):u.push(g);return Vr(u).pipe(c0(g=>{const E=s.children[g],D=function kN(t,r){const i=t.filter(s=>ou(s)===r);return i.push(...t.filter(s=>ou(s)!==r)),i}(i,g);return this.processSegmentGroup(r,D,E,g)}),function kF(t,r){return ni(function LF(t,r,i,s,u){return(g,E)=>{let D=i,A=r,N=0;g.subscribe(er(E,H=>{const ne=N++;A=D?t(A,H,ne):(D=!0,H),s&&E.next(A)},u&&(()=>{D&&E.next(A),E.complete()})))}}(t,r,arguments.length>=2,!0))}((g,E)=>(g.push(...E),g)),Pb(null),function FF(t,r){const i=arguments.length>=2;return s=>s.pipe(t?If((u,g)=>t(u,g,s)):rs,cT(1),i?Pb(r):mI(()=>new Ab))}(),fi(g=>{if(null===g)return F_(s);const E=eA(g);return function _3(t){t.sort((r,i)=>r.value.outlet===ur?-1:i.value.outlet===ur?1:r.value.outlet.localeCompare(i.value.outlet))}(E),Tn(E)}))}processSegment(r,i,s,u,g,E){return Vr(i).pipe(c0(D=>this.processSegmentAgainstRoute(D._injector??r,i,D,s,u,g,E).pipe(Tm(A=>{if(A instanceof Gb)return Tn(null);throw A}))),Cm(D=>!!D),Tm(D=>{if(XI(D))return function p3(t,r,i){return 0===r.length&&!t.children[i]}(s,u,g)?Tn([]):F_(s);throw D}))}processSegmentAgainstRoute(r,i,s,u,g,E,D){return function f3(t,r,i,s){return!!(ou(t)===s||s!==ur&&Hb(r,i,t))&&("**"===t.path||DT(r,t,i).matched)}(s,u,g,E)?void 0===s.redirectTo?this.matchSegmentAgainstRoute(r,u,s,g,E,D):D&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(r,u,i,s,g,E):F_(u):F_(u)}expandSegmentAgainstRouteUsingRedirect(r,i,s,u,g,E){return"**"===u.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(r,s,u,E):this.expandRegularSegmentAgainstRouteUsingRedirect(r,i,s,u,g,E)}expandWildCardWithParamsAgainstRouteUsingRedirect(r,i,s,u){const g=this.applyRedirects.applyRedirectCommands([],s.redirectTo,{});return s.redirectTo.startsWith("/")?KI(g):this.applyRedirects.lineralizeSegments(s,g).pipe(fi(E=>{const D=new _i(E,{});return this.processSegment(r,i,D,E,u,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(r,i,s,u,g,E){const{matched:D,consumedSegments:A,remainingSegments:N,positionalParamSegments:H}=DT(i,u,g);if(!D)return F_(i);const ne=this.applyRedirects.applyRedirectCommands(A,u.redirectTo,H);return u.redirectTo.startsWith("/")?KI(ne):this.applyRedirects.lineralizeSegments(u,ne).pipe(fi(fe=>this.processSegment(r,s,i,fe.concat(N),E,!1)))}matchSegmentAgainstRoute(r,i,s,u,g,E){let D;if("**"===s.path){const A=u.length>0?_I(u).parameters:{};D=Tn({snapshot:new Vb(u,A,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,tA(s),ou(s),s.component??s._loadedComponent??null,s,nA(s)),consumedSegments:[],remainingSegments:[]}),i.children={}}else D=l3(i,s,u,r).pipe(_r(({matched:A,consumedSegments:N,remainingSegments:H,parameters:ne})=>A?{snapshot:new Vb(N,ne,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,tA(s),ou(s),s.component??s._loadedComponent??null,s,nA(s)),consumedSegments:N,remainingSegments:H}:null));return D.pipe(He(A=>null===A?F_(i):this.getChildConfig(r=s._injector??r,s,u).pipe(He(({routes:N})=>{const H=s._loadedInjector??r,{snapshot:ne,consumedSegments:fe,remainingSegments:ve}=A,{segmentGroup:ze,slicedSegments:et}=QI(i,fe,ve,N);if(0===et.length&&ze.hasChildren())return this.processChildren(H,N,ze).pipe(_r(kt=>null===kt?null:[new sd(ne,kt)]));if(0===N.length&&0===et.length)return Tn([new sd(ne,[])]);const bt=ou(s)===g;return this.processSegment(H,N,ze,et,bt?ur:g,!0).pipe(_r(kt=>[new sd(ne,kt)]))}))))}getChildConfig(r,i,s){return i.children?Tn({routes:i.children,injector:r}):i.loadChildren?void 0!==i._loadedRoutes?Tn({routes:i._loadedRoutes,injector:i._loadedInjector}):function r3(t,r,i,s){const u=r.canLoad;return void 0===u||0===u.length?Tn(!0):Tn(u.map(E=>{const D=L_(E,t);return Af(function $N(t){return t&&E0(t.canLoad)}(D)?D.canLoad(r,i):t.runInContext(()=>D(r,i)))})).pipe(k_(),YI())}(r,i,s).pipe(fi(u=>u?this.configLoader.loadChildren(r,i).pipe(ia(g=>{i._loadedRoutes=g.routes,i._loadedInjector=g.injector})):function s3(t){return l0(HI(!1,3))}())):Tn({routes:[],injector:r})}}function y3(t){const r=t.value.routeConfig;return r&&""===r.path}function eA(t){const r=[],i=new Set;for(const s of t){if(!y3(s)){r.push(s);continue}const u=r.find(g=>s.value.routeConfig===g.value.routeConfig);void 0!==u?(u.children.push(...s.children),i.add(u)):r.push(s)}for(const s of i){const u=eA(s.children);r.push(new sd(s.value,u))}return r.filter(s=>!i.has(s))}function tA(t){return t.data||{}}function nA(t){return t.resolve||{}}function rA(t){return"string"==typeof t.title||null===t.title}function ST(t){return He(r=>{const i=t(r);return i?Vr(i).pipe(_r(()=>r)):Tn(r)})}const N_=new sn("ROUTES");let IT=(()=>{class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Qt(BD)}loadComponent(i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return Tn(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);const s=Af(i.loadComponent()).pipe(_r(iA),ia(g=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=g}),uT(()=>{this.componentLoaders.delete(i)})),u=new pI(s,()=>new ci).pipe(lT());return this.componentLoaders.set(i,u),u}loadChildren(i,s){if(this.childrenLoaders.get(s))return this.childrenLoaders.get(s);if(s._loadedRoutes)return Tn({routes:s._loadedRoutes,injector:s._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(s);const g=function T3(t,r,i,s){return Af(t.loadChildren()).pipe(_r(iA),fi(u=>u instanceof GM||Array.isArray(u)?Tn(u):Vr(r.compileModuleAsync(u))),_r(u=>{s&&s(t);let g,E,D=!1;return Array.isArray(u)?(E=u,!0):(g=u.create(i).injector,E=g.get(N_,[],{optional:!0,self:!0}).flat()),{routes:E.map(TT),injector:g}}))}(s,this.compiler,i,this.onLoadEndListener).pipe(uT(()=>{this.childrenLoaders.delete(s)})),E=new pI(g,()=>new ci).pipe(lT());return this.childrenLoaders.set(s,E),E}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function iA(t){return function M3(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let qb=(()=>{class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new ci,this.transitionAbortSubject=new ci,this.configLoader=Qt(IT),this.environmentInjector=Qt(ta),this.urlSerializer=Qt(d0),this.rootContexts=Qt(y0),this.inputBindingEnabled=null!==Qt(jb,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Tn(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=u=>this.events.next(new yN(u)),this.configLoader.onLoadStartListener=u=>this.events.next(new _N(u))}complete(){this.transitions?.complete()}handleNavigationRequest(i){const s=++this.navigationId;this.transitions?.next({...this.transitions.value,...i,id:s})}setupNavigations(i,s,u){return this.transitions=new mi({id:0,currentUrlTree:s,currentRawUrl:s,currentBrowserUrl:s,extractedUrl:i.urlHandlingStrategy.extract(s),urlAfterRedirects:i.urlHandlingStrategy.extract(s),rawUrl:s,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:g0,restoredState:null,currentSnapshot:u.snapshot,targetSnapshot:null,currentRouterState:u,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(If(g=>0!==g.id),_r(g=>({...g,extractedUrl:i.urlHandlingStrategy.extract(g.rawUrl)})),He(g=>{this.currentTransition=g;let E=!1,D=!1;return Tn(g).pipe(ia(A=>{this.currentNavigation={id:A.id,initialUrl:A.rawUrl,extractedUrl:A.extractedUrl,trigger:A.source,extras:A.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),He(A=>{const N=A.currentBrowserUrl.toString(),H=!i.navigated||A.extractedUrl.toString()!==N||N!==A.currentUrlTree.toString();if(!H&&"reload"!==(A.extras.onSameUrlNavigation??i.onSameUrlNavigation)){const fe="";return this.events.next(new P_(A.id,this.urlSerializer.serialize(A.rawUrl),fe,0)),A.resolve(null),yo}if(i.urlHandlingStrategy.shouldProcessUrl(A.rawUrl))return Tn(A).pipe(He(fe=>{const ve=this.transitions?.getValue();return this.events.next(new zb(fe.id,this.urlSerializer.serialize(fe.extractedUrl),fe.source,fe.restoredState)),ve!==this.transitions?.getValue()?yo:Promise.resolve(fe)}),function v3(t,r,i,s,u,g){return fi(E=>function m3(t,r,i,s,u,g,E="emptyOnly"){return new g3(t,r,i,s,u,E,g).recognize()}(t,r,i,s,E.extractedUrl,u,g).pipe(_r(({state:D,tree:A})=>({...E,targetSnapshot:D,urlAfterRedirects:A}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,i.paramsInheritanceStrategy),ia(fe=>{g.targetSnapshot=fe.targetSnapshot,g.urlAfterRedirects=fe.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:fe.urlAfterRedirects};const ve=new kI(fe.id,this.urlSerializer.serialize(fe.extractedUrl),this.urlSerializer.serialize(fe.urlAfterRedirects),fe.targetSnapshot);this.events.next(ve)}));if(H&&i.urlHandlingStrategy.shouldProcessUrl(A.currentRawUrl)){const{id:fe,extractedUrl:ve,source:ze,restoredState:et,extras:bt}=A,kt=new zb(fe,this.urlSerializer.serialize(ve),ze,et);this.events.next(kt);const st=BI(0,this.rootComponentType).snapshot;return this.currentTransition=g={...A,targetSnapshot:st,urlAfterRedirects:ve,extras:{...bt,skipLocationChange:!1,replaceUrl:!1}},Tn(g)}{const fe="";return this.events.next(new P_(A.id,this.urlSerializer.serialize(A.extractedUrl),fe,1)),A.resolve(null),yo}}),ia(A=>{const N=new fN(A.id,this.urlSerializer.serialize(A.extractedUrl),this.urlSerializer.serialize(A.urlAfterRedirects),A.targetSnapshot);this.events.next(N)}),_r(A=>(this.currentTransition=g={...A,guards:zN(A.targetSnapshot,A.currentSnapshot,this.rootContexts)},g)),function XN(t,r){return fi(i=>{const{targetSnapshot:s,currentSnapshot:u,guards:{canActivateChecks:g,canDeactivateChecks:E}}=i;return 0===E.length&&0===g.length?Tn({...i,guardsResult:!0}):function YN(t,r,i,s){return Vr(t).pipe(fi(u=>function n3(t,r,i,s,u){const g=r&&r.routeConfig?r.routeConfig.canDeactivate:null;return g&&0!==g.length?Tn(g.map(D=>{const A=x0(r)??u,N=L_(D,A);return Af(function qN(t){return t&&E0(t.canDeactivate)}(N)?N.canDeactivate(t,r,i,s):A.runInContext(()=>N(t,r,i,s))).pipe(Cm())})).pipe(k_()):Tn(!0)}(u.component,u.route,i,r,s)),Cm(u=>!0!==u,!0))}(E,s,u,t).pipe(fi(D=>D&&function UN(t){return"boolean"==typeof t}(D)?function JN(t,r,i,s){return Vr(r).pipe(c0(u=>aT(function QN(t,r){return null!==t&&r&&r(new vN(t)),Tn(!0)}(u.route.parent,s),function KN(t,r){return null!==t&&r&&r(new bN(t)),Tn(!0)}(u.route,s),function t3(t,r,i){const s=r[r.length-1],g=r.slice(0,r.length-1).reverse().map(E=>function BN(t){const r=t.routeConfig?t.routeConfig.canActivateChild:null;return r&&0!==r.length?{node:t,guards:r}:null}(E)).filter(E=>null!==E).map(E=>fI(()=>Tn(E.guards.map(A=>{const N=x0(E.node)??i,H=L_(A,N);return Af(function HN(t){return t&&E0(t.canActivateChild)}(H)?H.canActivateChild(s,t):N.runInContext(()=>H(s,t))).pipe(Cm())})).pipe(k_())));return Tn(g).pipe(k_())}(t,u.path,i),function e3(t,r,i){const s=r.routeConfig?r.routeConfig.canActivate:null;if(!s||0===s.length)return Tn(!0);const u=s.map(g=>fI(()=>{const E=x0(r)??i,D=L_(g,E);return Af(function GN(t){return t&&E0(t.canActivate)}(D)?D.canActivate(r,t):E.runInContext(()=>D(r,t))).pipe(Cm())}));return Tn(u).pipe(k_())}(t,u.route,i))),Cm(u=>!0!==u,!0))}(s,g,t,r):Tn(D)),_r(D=>({...i,guardsResult:D})))})}(this.environmentInjector,A=>this.events.next(A)),ia(A=>{if(g.guardsResult=A.guardsResult,Dm(A.guardsResult))throw GI(0,A.guardsResult);const N=new pN(A.id,this.urlSerializer.serialize(A.extractedUrl),this.urlSerializer.serialize(A.urlAfterRedirects),A.targetSnapshot,!!A.guardsResult);this.events.next(N)}),If(A=>!!A.guardsResult||(this.cancelNavigationTransition(A,"",3),!1)),ST(A=>{if(A.guards.canActivateChecks.length)return Tn(A).pipe(ia(N=>{const H=new mN(N.id,this.urlSerializer.serialize(N.extractedUrl),this.urlSerializer.serialize(N.urlAfterRedirects),N.targetSnapshot);this.events.next(H)}),He(N=>{let H=!1;return Tn(N).pipe(function x3(t,r){return fi(i=>{const{targetSnapshot:s,guards:{canActivateChecks:u}}=i;if(!u.length)return Tn(i);let g=0;return Vr(u).pipe(c0(E=>function b3(t,r,i,s){const u=t.routeConfig,g=t._resolve;return void 0!==u?.title&&!rA(u)&&(g[u0]=u.title),function w3(t,r,i,s){const u=function E3(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===u.length)return Tn({});const g={};return Vr(u).pipe(fi(E=>function C3(t,r,i,s){const u=x0(r)??s,g=L_(t,u);return Af(g.resolve?g.resolve(r,i):u.runInContext(()=>g(r,i)))}(t[E],r,i,s).pipe(Cm(),ia(D=>{g[E]=D}))),cT(1),function NF(t){return _r(()=>t)}(g),Tm(E=>XI(E)?yo:l0(E)))}(g,t,r,s).pipe(_r(E=>(t._resolvedData=E,t.data=VI(t,i).resolve,u&&rA(u)&&(t.data[u0]=u.title),null)))}(E.route,s,t,r)),ia(()=>g++),cT(1),fi(E=>g===u.length?Tn(i):yo))})}(i.paramsInheritanceStrategy,this.environmentInjector),ia({next:()=>H=!0,complete:()=>{H||this.cancelNavigationTransition(N,"",2)}}))}),ia(N=>{const H=new gN(N.id,this.urlSerializer.serialize(N.extractedUrl),this.urlSerializer.serialize(N.urlAfterRedirects),N.targetSnapshot);this.events.next(H)}))}),ST(A=>{const N=H=>{const ne=[];H.routeConfig?.loadComponent&&!H.routeConfig._loadedComponent&&ne.push(this.configLoader.loadComponent(H.routeConfig).pipe(ia(fe=>{H.component=fe}),_r(()=>{})));for(const fe of H.children)ne.push(...N(fe));return ne};return sT(N(A.targetSnapshot.root)).pipe(Pb(),S_(1))}),ST(()=>this.afterPreactivation()),_r(A=>{const N=function DN(t,r,i){const s=v0(t,r._root,i?i._root:void 0);return new zI(s,r)}(i.routeReuseStrategy,A.targetSnapshot,A.currentRouterState);return this.currentTransition=g={...A,targetRouterState:N},g}),ia(()=>{this.events.next(new gT)}),((t,r,i,s)=>_r(u=>(new NN(r,u.targetRouterState,u.currentRouterState,i,s).activate(t),u)))(this.rootContexts,i.routeReuseStrategy,A=>this.events.next(A),this.inputBindingEnabled),S_(1),ia({next:A=>{E=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Pf(A.id,this.urlSerializer.serialize(A.extractedUrl),this.urlSerializer.serialize(A.urlAfterRedirects))),i.titleStrategy?.updateTitle(A.targetRouterState.snapshot),A.resolve(!0)},complete:()=>{E=!0}}),function zF(t){return ni((r,i)=>{Vn(t).subscribe(er(i,()=>i.complete(),on)),!i.closed&&r.subscribe(i)})}(this.transitionAbortSubject.pipe(ia(A=>{throw A}))),uT(()=>{E||D||this.cancelNavigationTransition(g,"",1),this.currentNavigation?.id===g.id&&(this.currentNavigation=null)}),Tm(A=>{if(D=!0,qI(A))this.events.next(new _0(g.id,this.urlSerializer.serialize(g.extractedUrl),A.message,A.cancellationCode)),function AN(t){return qI(t)&&Dm(t.url)}(A)?this.events.next(new _T(A.url)):g.resolve(!1);else{this.events.next(new Bb(g.id,this.urlSerializer.serialize(g.extractedUrl),A,g.targetSnapshot??void 0));try{g.resolve(i.errorHandler(A))}catch(N){g.reject(N)}}return yo}))}))}cancelNavigationTransition(i,s,u){const g=new _0(i.id,this.urlSerializer.serialize(i.extractedUrl),s,u);this.events.next(g),i.resolve(!1)}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function oA(t){return t!==g0}let sA=(()=>{class t{buildTitle(i){let s,u=i.root;for(;void 0!==u;)s=this.getResolvedTitleForRoute(u)??s,u=u.children.find(g=>g.outlet===ur);return s}getResolvedTitleForRoute(i){return i.data[u0]}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:function(){return Qt(D3)},providedIn:"root"})}return t})(),D3=(()=>{class t extends sA{constructor(i){super(),this.title=i}updateTitle(i){const s=this.buildTitle(i);void 0!==s&&this.title.setTitle(s)}static#e=this.\u0275fac=function(s){return new(s||t)(yn(oI))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),S3=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:function(){return Qt(A3)},providedIn:"root"})}return t})();class I3{shouldDetach(r){return!1}store(r,i){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,i){return r.routeConfig===i.routeConfig}}let A3=(()=>{class t extends I3{static#e=this.\u0275fac=function(){let i;return function(u){return(i||(i=Co(t)))(u||t)}}();static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const Zb=new sn("",{providedIn:"root",factory:()=>({})});let P3=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:function(){return Qt(R3)},providedIn:"root"})}return t})(),R3=(()=>{class t{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,s){return i}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var C0=function(t){return t[t.COMPLETE=0]="COMPLETE",t[t.FAILED=1]="FAILED",t[t.REDIRECTING=2]="REDIRECTING",t}(C0||{});function aA(t,r){t.events.pipe(If(i=>i instanceof Pf||i instanceof _0||i instanceof Bb||i instanceof P_),_r(i=>i instanceof Pf||i instanceof P_?C0.COMPLETE:i instanceof _0&&(0===i.code||1===i.code)?C0.REDIRECTING:C0.FAILED),If(i=>i!==C0.REDIRECTING),S_(1)).subscribe(()=>{r()})}function O3(t){throw t}function L3(t,r,i){return r.parse("/")}const k3={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},F3={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let pc=(()=>{class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Qt(ND),this.isNgZoneEnabled=!1,this._events=new ci,this.options=Qt(Zb,{optional:!0})||{},this.pendingTasks=Qt(zD),this.errorHandler=this.options.errorHandler||O3,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||L3,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Qt(P3),this.routeReuseStrategy=Qt(S3),this.titleStrategy=Qt(sA),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Qt(N_,{optional:!0})?.flat()??[],this.navigationTransitions=Qt(qb),this.urlSerializer=Qt(d0),this.location=Qt(kC),this.componentInputBindingEnabled=!!Qt(jb,{optional:!0}),this.eventsSubscription=new en,this.isNgZoneEnabled=Qt($r)instanceof $r&&$r.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new A_,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=BI(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(i=>{this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId},i=>{this.console.warn(`Unhandled Navigation Error: ${i}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const i=this.navigationTransitions.events.subscribe(s=>{try{const{currentTransition:u}=this.navigationTransitions;if(null===u)return void(lA(s)&&this._events.next(s));if(s instanceof zb)oA(u.source)&&(this.browserUrlTree=u.extractedUrl);else if(s instanceof P_)this.rawUrlTree=u.rawUrl;else if(s instanceof kI){if("eager"===this.urlUpdateStrategy){if(!u.extras.skipLocationChange){const g=this.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl);this.setBrowserUrl(g,u)}this.browserUrlTree=u.urlAfterRedirects}}else if(s instanceof gT)this.currentUrlTree=u.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl),this.routerState=u.targetRouterState,"deferred"===this.urlUpdateStrategy&&(u.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,u),this.browserUrlTree=u.urlAfterRedirects);else if(s instanceof _0)0!==s.code&&1!==s.code&&(this.navigated=!0),(3===s.code||2===s.code)&&this.restoreHistory(u);else if(s instanceof _T){const g=this.urlHandlingStrategy.merge(s.url,u.currentRawUrl),E={skipLocationChange:u.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||oA(u.source)};this.scheduleNavigation(g,g0,null,E,{resolve:u.resolve,reject:u.reject,promise:u.promise})}s instanceof Bb&&this.restoreHistory(u,!0),s instanceof Pf&&(this.navigated=!0),lA(s)&&this._events.next(s)}catch(u){this.navigationTransitions.transitionAbortSubject.next(u)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const i=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),g0,i)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(i=>{const s="popstate"===i.type?"popstate":"hashchange";"popstate"===s&&setTimeout(()=>{this.navigateToSyncWithBrowser(i.url,s,i.state)},0)}))}navigateToSyncWithBrowser(i,s,u){const g={replaceUrl:!0},E=u?.navigationId?u:null;if(u){const A={...u};delete A.navigationId,delete A.\u0275routerPageId,0!==Object.keys(A).length&&(g.state=A)}const D=this.parseUrl(i);this.scheduleNavigation(D,s,E,g)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map(TT),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,s={}){const{relativeTo:u,queryParams:g,fragment:E,queryParamsHandling:D,preserveFragment:A}=s,N=A?this.currentUrlTree.fragment:E;let ne,H=null;switch(D){case"merge":H={...this.currentUrlTree.queryParams,...g};break;case"preserve":H=this.currentUrlTree.queryParams;break;default:H=g||null}null!==H&&(H=this.removeEmptyProps(H));try{ne=SI(u?u.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof i[0]||!i[0].startsWith("/"))&&(i=[]),ne=this.currentUrlTree.root}return II(ne,i,H,N??null)}navigateByUrl(i,s={skipLocationChange:!1}){const u=Dm(i)?i:this.parseUrl(i),g=this.urlHandlingStrategy.merge(u,this.rawUrlTree);return this.scheduleNavigation(g,g0,null,s)}navigate(i,s={skipLocationChange:!1}){return function N3(t){for(let r=0;r<t.length;r++)if(null==t[r])throw new $e(4008,!1)}(i),this.navigateByUrl(this.createUrlTree(i,s),s)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){let s;try{s=this.urlSerializer.parse(i)}catch(u){s=this.malformedUriErrorHandler(u,this.urlSerializer,i)}return s}isActive(i,s){let u;if(u=!0===s?{...k3}:!1===s?{...F3}:s,Dm(i))return vI(this.currentUrlTree,i,u);const g=this.parseUrl(i);return vI(this.currentUrlTree,g,u)}removeEmptyProps(i){return Object.keys(i).reduce((s,u)=>{const g=i[u];return null!=g&&(s[u]=g),s},{})}scheduleNavigation(i,s,u,g,E){if(this.disposed)return Promise.resolve(!1);let D,A,N;E?(D=E.resolve,A=E.reject,N=E.promise):N=new Promise((ne,fe)=>{D=ne,A=fe});const H=this.pendingTasks.add();return aA(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(H))}),this.navigationTransitions.handleNavigationRequest({source:s,restoredState:u,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:i,extras:g,resolve:D,reject:A,promise:N,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),N.catch(ne=>Promise.reject(ne))}setBrowserUrl(i,s){const u=this.urlSerializer.serialize(i);if(this.location.isCurrentPathEqualTo(u)||s.extras.replaceUrl){const E={...s.extras.state,...this.generateNgRouterState(s.id,this.browserPageId)};this.location.replaceState(u,"",E)}else{const g={...s.extras.state,...this.generateNgRouterState(s.id,this.browserPageId+1)};this.location.go(u,"",g)}}restoreHistory(i,s=!1){if("computed"===this.canceledNavigationResolution){const g=this.currentPageId-this.browserPageId;0!==g?this.location.historyGo(g):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===g&&(this.resetState(i),this.browserUrlTree=i.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(s&&this.resetState(i),this.resetUrlToCurrentUrlTree())}resetState(i){this.routerState=i.currentRouterState,this.currentUrlTree=i.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,s){return"computed"===this.canceledNavigationResolution?{navigationId:i,\u0275routerPageId:s}:{navigationId:i}}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function lA(t){return!(t instanceof gT||t instanceof _T)}class cA{}let V3=(()=>{class t{constructor(i,s,u,g,E){this.router=i,this.injector=u,this.preloadingStrategy=g,this.loader=E}setUpPreloading(){this.subscription=this.router.events.pipe(If(i=>i instanceof Pf),c0(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(i,s){const u=[];for(const g of s){g.providers&&!g._injector&&(g._injector=rC(g.providers,i,`Route: ${g.path}`));const E=g._injector??i,D=g._loadedInjector??E;(g.loadChildren&&!g._loadedRoutes&&void 0===g.canLoad||g.loadComponent&&!g._loadedComponent)&&u.push(this.preloadConfig(E,g)),(g.children||g._loadedRoutes)&&u.push(this.processRoutes(D,g.children??g._loadedRoutes))}return Vr(u).pipe(ja())}preloadConfig(i,s){return this.preloadingStrategy.preload(s,()=>{let u;u=s.loadChildren&&void 0===s.canLoad?this.loader.loadChildren(i,s):Tn(null);const g=u.pipe(fi(E=>null===E?Tn(void 0):(s._loadedRoutes=E.routes,s._loadedInjector=E.injector,this.processRoutes(E.injector??i,E.routes))));return s.loadComponent&&!s._loadedComponent?Vr([g,this.loader.loadComponent(s)]).pipe(ja()):g})}static#e=this.\u0275fac=function(s){return new(s||t)(yn(pc),yn(BD),yn(ta),yn(cA),yn(IT))};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const PT=new sn("");let uA=(()=>{class t{constructor(i,s,u,g,E={}){this.urlSerializer=i,this.transitions=s,this.viewportScroller=u,this.zone=g,this.options=E,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},E.scrollPositionRestoration=E.scrollPositionRestoration||"disabled",E.anchorScrolling=E.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof zb?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=i.navigationTrigger,this.restoredId=i.restoredState?i.restoredState.navigationId:0):i instanceof Pf?(this.lastId=i.id,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.urlAfterRedirects).fragment)):i instanceof P_&&0===i.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof FI&&(i.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(i.position):i.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(i.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(i,s){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new FI(i,"popstate"===this.lastSource?this.store[this.restoredId]:null,s))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(s){!function af(){throw new Error("invalid")}()};static#t=this.\u0275prov=Cn({token:t,factory:t.\u0275fac})}return t})();function ad(t,r){return{\u0275kind:t,\u0275providers:r}}function dA(){const t=Qt(jo);return r=>{const i=t.get(T_);if(r!==i.components[0])return;const s=t.get(pc),u=t.get(fA);1===t.get(RT)&&s.initialNavigation(),t.get(pA,null,Pn.Optional)?.setUpPreloading(),t.get(PT,null,Pn.Optional)?.init(),s.resetRootComponentType(i.componentTypes[0]),u.closed||(u.next(),u.complete(),u.unsubscribe())}}const fA=new sn("",{factory:()=>new ci}),RT=new sn("",{providedIn:"root",factory:()=>1}),pA=new sn("");function G3(t){return ad(0,[{provide:pA,useExisting:V3},{provide:cA,useExisting:t}])}const mA=new sn("ROUTER_FORROOT_GUARD"),q3=[kC,{provide:d0,useClass:hT},pc,y0,{provide:O_,useFactory:function hA(t){return t.routerState.root},deps:[pc]},IT,[]];function Z3(){return new qD("Router",pc)}let gA=(()=>{class t{constructor(i){}static forRoot(i,s){return{ngModule:t,providers:[q3,[],{provide:N_,multi:!0,useValue:i},{provide:mA,useFactory:J3,deps:[[pc,new pp,new Pd]]},{provide:Zb,useValue:s||{}},s?.useHash?{provide:Em,useClass:tL}:{provide:Em,useClass:wS},{provide:PT,useFactory:()=>{const t=Qt(bk),r=Qt($r),i=Qt(Zb),s=Qt(qb),u=Qt(d0);return i.scrollOffset&&t.setOffset(i.scrollOffset),new uA(u,s,t,r,i)}},s?.preloadingStrategy?G3(s.preloadingStrategy).\u0275providers:[],{provide:qD,multi:!0,useFactory:Z3},s?.initialNavigation?K3(s):[],s?.bindToComponentInputs?ad(8,[$I,{provide:jb,useExisting:$I}]).\u0275providers:[],[{provide:_A,useFactory:dA},{provide:TC,multi:!0,useExisting:_A}]]}}static forChild(i){return{ngModule:t,providers:[{provide:N_,multi:!0,useValue:i}]}}static#e=this.\u0275fac=function(s){return new(s||t)(yn(mA,8))};static#t=this.\u0275mod=qi({type:t});static#n=this.\u0275inj=Ji({})}return t})();function J3(t){return"guarded"}function K3(t){return["disabled"===t.initialNavigation?ad(3,[{provide:_C,multi:!0,useFactory:()=>{const r=Qt(pc);return()=>{r.setUpLocationChangeListener()}}},{provide:RT,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?ad(2,[{provide:RT,useValue:0},{provide:_C,multi:!0,deps:[jo],useFactory:r=>{const i=r.get(QO,Promise.resolve());return()=>i.then(()=>new Promise(s=>{const u=r.get(pc),g=r.get(fA);aA(u,()=>{s(!0)}),r.get(qb).afterPreactivation=()=>(s(!0),g.closed?Tn(void 0):g),u.initialNavigation()}))}}]).\u0275providers:[]]}const _A=new sn("");var yA=es(574),ez=es(357);let vA=(()=>{class t{constructor(i,s){this._renderer=i,this._elementRef=s,this.onChange=u=>{},this.onTouched=()=>{}}setProperty(i,s){this._renderer.setProperty(this._elementRef.nativeElement,i,s)}registerOnTouched(i){this.onTouched=i}registerOnChange(i){this.onChange=i}setDisabledState(i){this.setProperty("disabled",i)}static#e=this.\u0275fac=function(s){return new(s||t)(Dt(Wc),Dt(po))};static#t=this.\u0275dir=xn({type:t})}return t})(),Sm=(()=>{class t extends vA{static#e=this.\u0275fac=function(){let i;return function(u){return(i||(i=Co(t)))(u||t)}}();static#t=this.\u0275dir=xn({type:t,features:[ei]})}return t})();const Qu=new sn("NgValueAccessor"),iz={provide:Qu,useExisting:Te(()=>Wb),multi:!0},sz=new sn("CompositionEventMode");let Wb=(()=>{class t extends vA{constructor(i,s,u){super(i,s),this._compositionMode=u,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function oz(){const t=Df()?Df().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(i){this.setProperty("value",i??"")}_handleInput(i){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(i)}_compositionStart(){this._composing=!0}_compositionEnd(i){this._composing=!1,this._compositionMode&&this.onChange(i)}static#e=this.\u0275fac=function(s){return new(s||t)(Dt(Wc),Dt(po),Dt(sz,8))};static#t=this.\u0275dir=xn({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(s,u){1&s&&Jo("input",function(E){return u._handleInput(E.target.value)})("blur",function(){return u.onTouched()})("compositionstart",function(){return u._compositionStart()})("compositionend",function(E){return u._compositionEnd(E.target.value)})},features:[ro([iz]),ei]})}return t})();const oa=new sn("NgValidators"),Of=new sn("NgAsyncValidators");function AA(t){return null!=t}function PA(t){return Kh(t)?Vr(t):t}function RA(t){let r={};return t.forEach(i=>{r=null!=i?{...r,...i}:r}),0===Object.keys(r).length?null:r}function OA(t,r){return r.map(i=>i(t))}function LA(t){return t.map(r=>function lz(t){return!t.validate}(r)?r:i=>r.validate(i))}function OT(t){return null!=t?function kA(t){if(!t)return null;const r=t.filter(AA);return 0==r.length?null:function(i){return RA(OA(i,r))}}(LA(t)):null}function LT(t){return null!=t?function FA(t){if(!t)return null;const r=t.filter(AA);return 0==r.length?null:function(i){return function nz(...t){const r=wi(t),{args:i,keys:s}=cI(t),u=new fr(g=>{const{length:E}=i;if(!E)return void g.complete();const D=new Array(E);let A=E,N=E;for(let H=0;H<E;H++){let ne=!1;Vn(i[H]).subscribe(er(g,fe=>{ne||(ne=!0,N--),D[H]=fe},()=>A--,void 0,()=>{(!A||!ne)&&(N||g.next(s?hI(s,D):D),g.complete())}))}});return r?u.pipe(uI(r)):u}(OA(i,r).map(PA)).pipe(_r(RA))}}(LA(t)):null}function NA(t,r){return null===t?[r]:Array.isArray(t)?[...t,r]:[t,r]}function zA(t){return t._rawValidators}function BA(t){return t._rawAsyncValidators}function kT(t){return t?Array.isArray(t)?t:[t]:[]}function Yb(t,r){return Array.isArray(t)?t.includes(r):t===r}function VA(t,r){const i=kT(r);return kT(t).forEach(u=>{Yb(i,u)||i.push(u)}),i}function jA(t,r){return kT(r).filter(i=>!Yb(t,i))}class UA{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(r){this._rawValidators=r||[],this._composedValidatorFn=OT(this._rawValidators)}_setAsyncValidators(r){this._rawAsyncValidators=r||[],this._composedAsyncValidatorFn=LT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(r){this._onDestroyCallbacks.push(r)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(r=>r()),this._onDestroyCallbacks=[]}reset(r=void 0){this.control&&this.control.reset(r)}hasError(r,i){return!!this.control&&this.control.hasError(r,i)}getError(r,i){return this.control?this.control.getError(r,i):null}}class za extends UA{get formDirective(){return null}get path(){return null}}class Lf extends UA{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class $A{constructor(r){this._cd=r}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let GA=(()=>{class t extends $A{constructor(i){super(i)}static#e=this.\u0275fac=function(s){return new(s||t)(Dt(Lf,2))};static#t=this.\u0275dir=xn({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(s,u){2&s&&Y("ng-untouched",u.isUntouched)("ng-touched",u.isTouched)("ng-pristine",u.isPristine)("ng-dirty",u.isDirty)("ng-valid",u.isValid)("ng-invalid",u.isInvalid)("ng-pending",u.isPending)},features:[ei]})}return t})(),HA=(()=>{class t extends $A{constructor(i){super(i)}static#e=this.\u0275fac=function(s){return new(s||t)(Dt(za,10))};static#t=this.\u0275dir=xn({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(s,u){2&s&&Y("ng-untouched",u.isUntouched)("ng-touched",u.isTouched)("ng-pristine",u.isPristine)("ng-dirty",u.isDirty)("ng-valid",u.isValid)("ng-invalid",u.isInvalid)("ng-pending",u.isPending)("ng-submitted",u.isSubmitted)},features:[ei]})}return t})();const T0="VALID",Kb="INVALID",z_="PENDING",M0="DISABLED";function zT(t){return(Qb(t)?t.validators:t)||null}function BT(t,r){return(Qb(r)?r.asyncValidators:t)||null}function Qb(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class XA{constructor(r,i){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(r),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(r){this._rawValidators=this._composedValidatorFn=r}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(r){this._rawAsyncValidators=this._composedAsyncValidatorFn=r}get parent(){return this._parent}get valid(){return this.status===T0}get invalid(){return this.status===Kb}get pending(){return this.status==z_}get disabled(){return this.status===M0}get enabled(){return this.status!==M0}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(r){this._assignValidators(r)}setAsyncValidators(r){this._assignAsyncValidators(r)}addValidators(r){this.setValidators(VA(r,this._rawValidators))}addAsyncValidators(r){this.setAsyncValidators(VA(r,this._rawAsyncValidators))}removeValidators(r){this.setValidators(jA(r,this._rawValidators))}removeAsyncValidators(r){this.setAsyncValidators(jA(r,this._rawAsyncValidators))}hasValidator(r){return Yb(this._rawValidators,r)}hasAsyncValidator(r){return Yb(this._rawAsyncValidators,r)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(r={}){this.touched=!0,this._parent&&!r.onlySelf&&this._parent.markAsTouched(r)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(r=>r.markAllAsTouched())}markAsUntouched(r={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0})}),this._parent&&!r.onlySelf&&this._parent._updateTouched(r)}markAsDirty(r={}){this.pristine=!1,this._parent&&!r.onlySelf&&this._parent.markAsDirty(r)}markAsPristine(r={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(i=>{i.markAsPristine({onlySelf:!0})}),this._parent&&!r.onlySelf&&this._parent._updatePristine(r)}markAsPending(r={}){this.status=z_,!1!==r.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!r.onlySelf&&this._parent.markAsPending(r)}disable(r={}){const i=this._parentMarkedDirty(r.onlySelf);this.status=M0,this.errors=null,this._forEachChild(s=>{s.disable({...r,onlySelf:!0})}),this._updateValue(),!1!==r.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...r,skipPristineCheck:i}),this._onDisabledChange.forEach(s=>s(!0))}enable(r={}){const i=this._parentMarkedDirty(r.onlySelf);this.status=T0,this._forEachChild(s=>{s.enable({...r,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:r.emitEvent}),this._updateAncestors({...r,skipPristineCheck:i}),this._onDisabledChange.forEach(s=>s(!1))}_updateAncestors(r){this._parent&&!r.onlySelf&&(this._parent.updateValueAndValidity(r),r.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(r){this._parent=r}getRawValue(){return this.value}updateValueAndValidity(r={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===T0||this.status===z_)&&this._runAsyncValidator(r.emitEvent)),!1!==r.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!r.onlySelf&&this._parent.updateValueAndValidity(r)}_updateTreeValidity(r={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(r)),this.updateValueAndValidity({onlySelf:!0,emitEvent:r.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?M0:T0}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(r){if(this.asyncValidator){this.status=z_,this._hasOwnPendingAsyncValidator=!0;const i=PA(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(s=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(s,{emitEvent:r})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(r,i={}){this.errors=r,this._updateControlsErrors(!1!==i.emitEvent)}get(r){let i=r;return null==i||(Array.isArray(i)||(i=i.split(".")),0===i.length)?null:i.reduce((s,u)=>s&&s._find(u),this)}getError(r,i){const s=i?this.get(i):this;return s&&s.errors?s.errors[r]:null}hasError(r,i){return!!this.getError(r,i)}get root(){let r=this;for(;r._parent;)r=r._parent;return r}_updateControlsErrors(r){this.status=this._calculateStatus(),r&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(r)}_initObservables(){this.valueChanges=new Xi,this.statusChanges=new Xi}_calculateStatus(){return this._allControlsDisabled()?M0:this.errors?Kb:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(z_)?z_:this._anyControlsHaveStatus(Kb)?Kb:T0}_anyControlsHaveStatus(r){return this._anyControls(i=>i.status===r)}_anyControlsDirty(){return this._anyControls(r=>r.dirty)}_anyControlsTouched(){return this._anyControls(r=>r.touched)}_updatePristine(r={}){this.pristine=!this._anyControlsDirty(),this._parent&&!r.onlySelf&&this._parent._updatePristine(r)}_updateTouched(r={}){this.touched=this._anyControlsTouched(),this._parent&&!r.onlySelf&&this._parent._updateTouched(r)}_registerOnCollectionChange(r){this._onCollectionChange=r}_setUpdateStrategy(r){Qb(r)&&null!=r.updateOn&&(this._updateOn=r.updateOn)}_parentMarkedDirty(r){return!r&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(r){return null}_assignValidators(r){this._rawValidators=Array.isArray(r)?r.slice():r,this._composedValidatorFn=function dz(t){return Array.isArray(t)?OT(t):t||null}(this._rawValidators)}_assignAsyncValidators(r){this._rawAsyncValidators=Array.isArray(r)?r.slice():r,this._composedAsyncValidatorFn=function fz(t){return Array.isArray(t)?LT(t):t||null}(this._rawAsyncValidators)}}class ew extends XA{constructor(r,i,s){super(zT(i),BT(s,i)),this.controls=r,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(r,i){return this.controls[r]?this.controls[r]:(this.controls[r]=i,i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange),i)}addControl(r,i,s={}){this.registerControl(r,i),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}removeControl(r,i={}){this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),delete this.controls[r],this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}setControl(r,i,s={}){this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),delete this.controls[r],i&&this.registerControl(r,i),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}contains(r){return this.controls.hasOwnProperty(r)&&this.controls[r].enabled}setValue(r,i={}){(function WA(t,r,i){t._forEachChild((s,u)=>{if(void 0===i[u])throw new $e(1002,"")})})(this,0,r),Object.keys(r).forEach(s=>{(function ZA(t,r,i){const s=t.controls;if(!(r?Object.keys(s):s).length)throw new $e(1e3,"");if(!s[i])throw new $e(1001,"")})(this,!0,s),this.controls[s].setValue(r[s],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(r,i={}){null!=r&&(Object.keys(r).forEach(s=>{const u=this.controls[s];u&&u.patchValue(r[s],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(r={},i={}){this._forEachChild((s,u)=>{s.reset(r?r[u]:null,{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i),this._updateTouched(i),this.updateValueAndValidity(i)}getRawValue(){return this._reduceChildren({},(r,i,s)=>(r[s]=i.getRawValue(),r))}_syncPendingControls(){let r=this._reduceChildren(!1,(i,s)=>!!s._syncPendingControls()||i);return r&&this.updateValueAndValidity({onlySelf:!0}),r}_forEachChild(r){Object.keys(this.controls).forEach(i=>{const s=this.controls[i];s&&r(s,i)})}_setUpControls(){this._forEachChild(r=>{r.setParent(this),r._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(r){for(const[i,s]of Object.entries(this.controls))if(this.contains(i)&&r(s))return!0;return!1}_reduceValue(){return this._reduceChildren({},(i,s,u)=>((s.enabled||this.disabled)&&(i[u]=s.value),i))}_reduceChildren(r,i){let s=r;return this._forEachChild((u,g)=>{s=i(s,u,g)}),s}_allControlsDisabled(){for(const r of Object.keys(this.controls))if(this.controls[r].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(r){return this.controls.hasOwnProperty(r)?this.controls[r]:null}}const B_=new sn("CallSetDisabledState",{providedIn:"root",factory:()=>tw}),tw="always";function D0(t,r,i=tw){VT(t,r),r.valueAccessor.writeValue(t.value),(t.disabled||"always"===i)&&r.valueAccessor.setDisabledState?.(t.disabled),function gz(t,r){r.valueAccessor.registerOnChange(i=>{t._pendingValue=i,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&YA(t,r)})}(t,r),function yz(t,r){const i=(s,u)=>{r.valueAccessor.writeValue(s),u&&r.viewToModelUpdate(s)};t.registerOnChange(i),r._registerOnDestroy(()=>{t._unregisterOnChange(i)})}(t,r),function _z(t,r){r.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&YA(t,r),"submit"!==t.updateOn&&t.markAsTouched()})}(t,r),function mz(t,r){if(r.valueAccessor.setDisabledState){const i=s=>{r.valueAccessor.setDisabledState(s)};t.registerOnDisabledChange(i),r._registerOnDestroy(()=>{t._unregisterOnDisabledChange(i)})}}(t,r)}function rw(t,r,i=!0){const s=()=>{};r.valueAccessor&&(r.valueAccessor.registerOnChange(s),r.valueAccessor.registerOnTouched(s)),ow(t,r),t&&(r._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function iw(t,r){t.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(r)})}function VT(t,r){const i=zA(t);null!==r.validator?t.setValidators(NA(i,r.validator)):"function"==typeof i&&t.setValidators([i]);const s=BA(t);null!==r.asyncValidator?t.setAsyncValidators(NA(s,r.asyncValidator)):"function"==typeof s&&t.setAsyncValidators([s]);const u=()=>t.updateValueAndValidity();iw(r._rawValidators,u),iw(r._rawAsyncValidators,u)}function ow(t,r){let i=!1;if(null!==t){if(null!==r.validator){const u=zA(t);if(Array.isArray(u)&&u.length>0){const g=u.filter(E=>E!==r.validator);g.length!==u.length&&(i=!0,t.setValidators(g))}}if(null!==r.asyncValidator){const u=BA(t);if(Array.isArray(u)&&u.length>0){const g=u.filter(E=>E!==r.asyncValidator);g.length!==u.length&&(i=!0,t.setAsyncValidators(g))}}}const s=()=>{};return iw(r._rawValidators,s),iw(r._rawAsyncValidators,s),i}function YA(t,r){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),r.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function QA(t,r){const i=t.indexOf(r);i>-1&&t.splice(i,1)}function e2(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}const I0=class extends XA{constructor(r=null,i,s){super(zT(i),BT(s,i)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(r),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Qb(i)&&(i.nonNullable||i.initialValueIsDefault)&&(this.defaultValue=e2(r)?r.value:r)}setValue(r,i={}){this.value=this._pendingValue=r,this._onChange.length&&!1!==i.emitModelToViewChange&&this._onChange.forEach(s=>s(this.value,!1!==i.emitViewToModelChange)),this.updateValueAndValidity(i)}patchValue(r,i={}){this.setValue(r,i)}reset(r=this.defaultValue,i={}){this._applyFormState(r),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(r){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(r){this._onChange.push(r)}_unregisterOnChange(r){QA(this._onChange,r)}registerOnDisabledChange(r){this._onDisabledChange.push(r)}_unregisterOnDisabledChange(r){QA(this._onDisabledChange,r)}_forEachChild(r){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(r){e2(r)?(this.value=this._pendingValue=r.value,r.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=r}};let o2=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275dir=xn({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return t})();const Dz={provide:Qu,useExisting:Te(()=>HT),multi:!0};let HT=(()=>{class t extends Sm{writeValue(i){this.setProperty("value",i??"")}registerOnChange(i){this.onChange=s=>{i(""==s?null:parseFloat(s))}}static#e=this.\u0275fac=function(){let i;return function(u){return(i||(i=Co(t)))(u||t)}}();static#t=this.\u0275dir=xn({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(s,u){1&s&&Jo("input",function(E){return u.onChange(E.target.value)})("blur",function(){return u.onTouched()})},features:[ro([Dz]),ei]})}return t})(),s2=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275mod=qi({type:t});static#n=this.\u0275inj=Ji({})}return t})();const qT=new sn("NgModelWithFormControlWarning"),Rz={provide:za,useExisting:Te(()=>sw)};let sw=(()=>{class t extends za{constructor(i,s,u){super(),this.callSetDisabledState=u,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Xi,this._setValidators(i),this._setAsyncValidators(s)}ngOnChanges(i){this._checkFormPresent(),i.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(ow(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(i){const s=this.form.get(i.path);return D0(s,i,this.callSetDisabledState),s.updateValueAndValidity({emitEvent:!1}),this.directives.push(i),s}getControl(i){return this.form.get(i.path)}removeControl(i){rw(i.control||null,i,!1),function wz(t,r){const i=t.indexOf(r);i>-1&&t.splice(i,1)}(this.directives,i)}addFormGroup(i){this._setUpFormContainer(i)}removeFormGroup(i){this._cleanUpFormContainer(i)}getFormGroup(i){return this.form.get(i.path)}addFormArray(i){this._setUpFormContainer(i)}removeFormArray(i){this._cleanUpFormContainer(i)}getFormArray(i){return this.form.get(i.path)}updateModel(i,s){this.form.get(i.path).setValue(s)}onSubmit(i){return this.submitted=!0,function KA(t,r){t._syncPendingControls(),r.forEach(i=>{const s=i.control;"submit"===s.updateOn&&s._pendingChange&&(i.viewToModelUpdate(s._pendingValue),s._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(i),"dialog"===i?.target?.method}onReset(){this.resetForm()}resetForm(i=void 0){this.form.reset(i),this.submitted=!1}_updateDomValue(){this.directives.forEach(i=>{const s=i.control,u=this.form.get(i.path);s!==u&&(rw(s||null,i),(t=>t instanceof I0)(u)&&(D0(u,i,this.callSetDisabledState),i.control=u))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(i){const s=this.form.get(i.path);(function JA(t,r){VT(t,r)})(s,i),s.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(i){if(this.form){const s=this.form.get(i.path);s&&function vz(t,r){return ow(t,r)}(s,i)&&s.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){VT(this.form,this),this._oldForm&&ow(this._oldForm,this)}_checkFormPresent(){}static#e=this.\u0275fac=function(s){return new(s||t)(Dt(oa,10),Dt(Of,10),Dt(B_,8))};static#t=this.\u0275dir=xn({type:t,selectors:[["","formGroup",""]],hostBindings:function(s,u){1&s&&Jo("submit",function(E){return u.onSubmit(E)})("reset",function(){return u.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ro([Rz]),ei,x]})}return t})();const kz={provide:Lf,useExisting:Te(()=>XT)};let XT=(()=>{class t extends Lf{set isDisabled(i){}static#e=this._ngModelWarningSentOnce=!1;constructor(i,s,u,g,E){super(),this._ngModelWarningConfig=E,this._added=!1,this.name=null,this.update=new Xi,this._ngModelWarningSent=!1,this._parent=i,this._setValidators(s),this._setAsyncValidators(u),this.valueAccessor=function $T(t,r){if(!r)return null;let i,s,u;return Array.isArray(r),r.forEach(g=>{g.constructor===Wb?i=g:function bz(t){return Object.getPrototypeOf(t.constructor)===Sm}(g)?s=g:u=g}),u||s||i||null}(0,g)}ngOnChanges(i){this._added||this._setUpControl(),function UT(t,r){if(!t.hasOwnProperty("model"))return!1;const i=t.model;return!!i.isFirstChange()||!Object.is(r,i.currentValue)}(i,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(i){this.viewModel=i,this.update.emit(i)}get path(){return function nw(t,r){return[...r.path,t]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static#t=this.\u0275fac=function(s){return new(s||t)(Dt(za,13),Dt(oa,10),Dt(Of,10),Dt(Qu,10),Dt(qT,8))};static#n=this.\u0275dir=xn({type:t,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[ro([kz]),ei,x]})}return t})();const Fz={provide:Qu,useExisting:Te(()=>aw),multi:!0};function h2(t,r){return null==t?`${r}`:(r&&"object"==typeof r&&(r="Object"),`${t}: ${r}`.slice(0,50))}let aw=(()=>{class t extends Sm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(i){this._compareWith=i}writeValue(i){this.value=i;const u=h2(this._getOptionId(i),i);this.setProperty("value",u)}registerOnChange(i){this.onChange=s=>{this.value=this._getOptionValue(s),i(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(i){for(const s of this._optionMap.keys())if(this._compareWith(this._optionMap.get(s),i))return s;return null}_getOptionValue(i){const s=function Nz(t){return t.split(":")[0]}(i);return this._optionMap.has(s)?this._optionMap.get(s):i}static#e=this.\u0275fac=function(){let i;return function(u){return(i||(i=Co(t)))(u||t)}}();static#t=this.\u0275dir=xn({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(s,u){1&s&&Jo("change",function(E){return u.onChange(E.target.value)})("blur",function(){return u.onTouched()})},inputs:{compareWith:"compareWith"},features:[ro([Fz]),ei]})}return t})(),d2=(()=>{class t{constructor(i,s,u){this._element=i,this._renderer=s,this._select=u,this._select&&(this.id=this._select._registerOption())}set ngValue(i){null!=this._select&&(this._select._optionMap.set(this.id,i),this._setElementValue(h2(this.id,i)),this._select.writeValue(this._select.value))}set value(i){this._setElementValue(i),this._select&&this._select.writeValue(this._select.value)}_setElementValue(i){this._renderer.setProperty(this._element.nativeElement,"value",i)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(s){return new(s||t)(Dt(po),Dt(Wc),Dt(aw,9))};static#t=this.\u0275dir=xn({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return t})();const zz={provide:Qu,useExisting:Te(()=>YT),multi:!0};function f2(t,r){return null==t?`${r}`:("string"==typeof r&&(r=`'${r}'`),r&&"object"==typeof r&&(r="Object"),`${t}: ${r}`.slice(0,50))}let YT=(()=>{class t extends Sm{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(i){this._compareWith=i}writeValue(i){let s;if(this.value=i,Array.isArray(i)){const u=i.map(g=>this._getOptionId(g));s=(g,E)=>{g._setSelected(u.indexOf(E.toString())>-1)}}else s=(u,g)=>{u._setSelected(!1)};this._optionMap.forEach(s)}registerOnChange(i){this.onChange=s=>{const u=[],g=s.selectedOptions;if(void 0!==g){const E=g;for(let D=0;D<E.length;D++){const N=this._getOptionValue(E[D].value);u.push(N)}}else{const E=s.options;for(let D=0;D<E.length;D++){const A=E[D];if(A.selected){const N=this._getOptionValue(A.value);u.push(N)}}}this.value=u,i(u)}}_registerOption(i){const s=(this._idCounter++).toString();return this._optionMap.set(s,i),s}_getOptionId(i){for(const s of this._optionMap.keys())if(this._compareWith(this._optionMap.get(s)._value,i))return s;return null}_getOptionValue(i){const s=function Bz(t){return t.split(":")[0]}(i);return this._optionMap.has(s)?this._optionMap.get(s)._value:i}static#e=this.\u0275fac=function(){let i;return function(u){return(i||(i=Co(t)))(u||t)}}();static#t=this.\u0275dir=xn({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(s,u){1&s&&Jo("change",function(E){return u.onChange(E.target)})("blur",function(){return u.onTouched()})},inputs:{compareWith:"compareWith"},features:[ro([zz]),ei]})}return t})(),p2=(()=>{class t{constructor(i,s,u){this._element=i,this._renderer=s,this._select=u,this._select&&(this.id=this._select._registerOption(this))}set ngValue(i){null!=this._select&&(this._value=i,this._setElementValue(f2(this.id,i)),this._select.writeValue(this._select.value))}set value(i){this._select?(this._value=i,this._setElementValue(f2(this.id,i)),this._select.writeValue(this._select.value)):this._setElementValue(i)}_setElementValue(i){this._renderer.setProperty(this._element.nativeElement,"value",i)}_setSelected(i){this._renderer.setProperty(this._element.nativeElement,"selected",i)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(s){return new(s||t)(Dt(po),Dt(Wc),Dt(YT,9))};static#t=this.\u0275dir=xn({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return t})(),Wz=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275mod=qi({type:t});static#n=this.\u0275inj=Ji({imports:[s2]})}return t})(),Yz=(()=>{class t{static withConfig(i){return{ngModule:t,providers:[{provide:qT,useValue:i.warnOnNgModelWithFormControl??"always"},{provide:B_,useValue:i.callSetDisabledState??tw}]}}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275mod=qi({type:t});static#n=this.\u0275inj=Ji({imports:[Wz]})}return t})();function Jz(t,r){if(1&t&&(al(0,"option",7),at(1,"Id: "),al(2,"b"),at(3),uc()()),2&t){const i=r.$implicit;qu("value",i.id),Wp(3),Dn(i.id)}}function Kz(t,r){if(1&t){const i=Oa();al(0,"div",8),Zu(1,"input",9)(2,"input",10),al(3,"button",11),at(4,"Apply"),uc(),al(5,"button",12),Jo("click",function(){return ar(i),Eo(Cf(2).delete())}),at(6,"Delete"),uc()()}}function Qz(t,r){if(1&t){const i=Oa();al(0,"form",3),Jo("submit",function(){return ar(i),Eo(Cf().editExstruded())}),al(1,"select",4),c_(2,Jz,4,2,"option",5),uc(),c_(3,Kz,7,0,"div",6),uc()}if(2&t){const i=Cf();qu("formGroup",i.exstrutionForm),Wp(2),qu("ngForOf",i.layersExstruded),Wp(1),qu("ngIf",i.exstrutionForm.value.sourceId.length)}}let eB=(()=>{class t{constructor(){this.map=null,this.polygonDrawControls=null,this.lat=37.75,this.lng=-122.41,this.baseColor="#faafee",this.baseHeight=15,this.exstrutionForm=null,this.layersExstruded=[]}ngOnInit(){this.map=new yA.Map({accessToken:"pk.eyJ1IjoibWFyb29uZWRpb25lIiwiYSI6ImNqdmp0MzB1azBpcDAzem1naHZwMjNndGIifQ.65nvvRg9QeFUV2c6b9W4Vw",container:"map-wrap",zoom:13,pitch:50,center:[this.lng,this.lat],logoPosition:"top-left"}),this.polygonDrawControls=new ez({displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:"draw_polygon"});const i=new yA.NavigationControl;this.map.addControl(i,"top-left"),this.map.addControl(this.polygonDrawControls,"top-left")}extrude(){const i=this.polygonDrawControls?.getSelected();i&&i.features.map(s=>{const u=String(s.id);this.map?.getSource(u)||this.map?.addSource(u,{type:"geojson",data:s}),this.map?.addLayer({id:u,type:"fill-extrusion",source:u,paint:{"fill-extrusion-color":this.baseColor,"fill-extrusion-height":this.baseHeight}}),this.polygonDrawControls?.delete(u),this.updateLayersExstruded(),this.exstrutionForm=new ew({sourceId:new I0(""),color:new I0(this.baseColor),height:new I0(this.baseHeight)})})}editExstruded(){this.exstrutionForm&&(this.map?.setPaintProperty(this.exstrutionForm.value.sourceId,"fill-extrusion-color",this.exstrutionForm.value.color),this.map?.setPaintProperty(this.exstrutionForm.value.sourceId,"fill-extrusion-height",this.exstrutionForm.value.height))}delete(){if(this.exstrutionForm){if(this.map?.removeLayer(this.exstrutionForm.value.sourceId),this.map?.removeSource(this.exstrutionForm.value.sourceId),this.updateLayersExstruded(),!this.layersExstruded.length)return void(this.exstrutionForm=null);this.exstrutionForm.value.sourceId=""}}updateLayersExstruded(){console.log(this.map?.getStyle().layers),console.log(this.map?.getStyle().sources),this.layersExstruded=this.map?.getStyle().layers.filter(i=>"fill-extrusion"===i.type)||[]}static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275cmp=as({type:t,selectors:[["app-map"]],decls:3,vars:1,consts:[["id","map-wrap",1,"map-wrap"],["type","button",1,"extrude-btn",3,"click"],["class","map__layer-edit",3,"formGroup","submit",4,"ngIf"],[1,"map__layer-edit",3,"formGroup","submit"],["formControlName","sourceId","name","select","id","select"],[3,"value",4,"ngFor","ngForOf"],["class","map__layer-edit__settings",4,"ngIf"],[3,"value"],[1,"map__layer-edit__settings"],["formControlName","color","type","color","name","color","id","color"],["formControlName","height","type","number","name","number","id","number"],["type","submit",1,"btn"],["type","button",1,"btn",3,"click"]],template:function(s,u){1&s&&(al(0,"div",0)(1,"button",1),Jo("click",function(){return u.extrude()}),uc(),c_(2,Qz,4,3,"form",2),uc()),2&s&&(Wp(2),qu("ngIf",u.exstrutionForm))},dependencies:[LS,FS,o2,d2,p2,Wb,HT,aw,GA,HA,sw,XT],styles:[".map-wrap[_ngcontent-%COMP%]{position:relative;width:100%;max-width:100vw;height:100%;min-height:98vh}.extrude-btn[_ngcontent-%COMP%]{display:block;position:relative;top:200px;left:9px;width:31px;height:31px;padding:0;background:var(--white);z-index:1;border-radius:4px;border:1px solid var(--lite-grey);cursor:pointer;outline:none;overflow:hidden;background-image:url(/poligon-editor/assets/extrude.png);background-repeat:no-repeat;background-position:center;background-size:55%}.extrude-btn[_ngcontent-%COMP%]:hover, .extrude-btn.active[_ngcontent-%COMP%]{background:var(--white-selected);background-image:url(/poligon-editor/assets/extrude.png);background-repeat:no-repeat;background-position:center;background-size:55%}.extrude-btn[_ngcontent-%COMP%]   .img[_ngcontent-%COMP%]{width:100%;height:100%;padding:6px}.map__layer-edit[_ngcontent-%COMP%]{position:absolute;right:10px;display:flex;gap:10px;padding:10px;background:var(--white);border:none;border-radius:6px;z-index:1}.map__layer-edit__settings[_ngcontent-%COMP%]{display:flex;gap:10px}.map__layer-edit__title[_ngcontent-%COMP%]{margin-right:5px}.map__layer-edit__select[_ngcontent-%COMP%]{cursor:pointer}"]})}return t})(),tB=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275cmp=as({type:t,selectors:[["app-main-page"]],decls:1,vars:0,template:function(s,u){1&s&&Zu(0,"app-map")},dependencies:[eB]})}return t})();var lw=function(t){return t.emplty="",t.deploy="poligon-editor",t.main="poligon-editor",t}(lw||{});const nB=[{path:lw.emplty,redirectTo:lw.main,pathMatch:"full"},{path:lw.deploy,component:tB}];let rB=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275mod=qi({type:t});static#n=this.\u0275inj=Ji({imports:[gA.forRoot(nB),gA]})}return t})(),iB=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275cmp=as({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(s,u){1&s&&Zu(0,"router-outlet")},dependencies:[ET]})}return t})(),oB=(()=>{class t{static#e=this.\u0275fac=function(s){return new(s||t)};static#t=this.\u0275mod=qi({type:t,bootstrap:[iB]});static#n=this.\u0275inj=Ji({imports:[mF,rB,Yz]})}return t})();fF().bootstrapModule(oB).catch(t=>console.error(t))},574:function(kf){kf.exports=function(){"use strict";var hl,es,zr;function mc(f,en){if(hl)if(es){var ts="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+hl+")(sharedChunk); ("+es+")(sharedChunk); self.onerror = null;",vn={};hl(vn),zr=en(vn),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(zr.workerUrl=window.URL.createObjectURL(new Blob([ts],{type:"text/javascript"})))}else es=en;else hl=en}return mc(0,function(f){var en="3.2.0";let ts;const vn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ts){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ts=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{ts=n}}return ts},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!vn.API_URL)return null;try{const n=new URL(vn.API_URL);return"api.mapbox.cn"===n.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===n.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},bi={supported:!1,testSupport:function(n){!ti&&Un&&(on?io(n):hn=n)}};let hn,Un,ti=!1,on=!1;const Ln=typeof self<"u"?self:{};function io(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Un),n.isContextLost())return;bi.supported=!0}catch{}n.deleteTexture(e),ti=!0}Ln.document&&(Un=Ln.document.createElement("img"),Un.onload=function(){hn&&io(hn),hn=null,on=!0},Un.onerror=function(){ti=!0,hn=null},Un.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ba="01";function yr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Cr=go;function go(n,e,o,a){this.cx=3*n,this.bx=3*(o-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=o,this.p2y=a}go.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(void 0===e&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var o=n,a=0;a<8;a++){var c=this.sampleCurveX(o)-n;if(Math.abs(c)<e)return o;var d=this.sampleCurveDerivativeX(o);if(Math.abs(d)<1e-6)break;o-=c/d}var p=0,_=1;for(o=n,a=0;a<20&&(c=this.sampleCurveX(o),!(Math.abs(c-n)<e));a++)n>c?p=o:_=o,o=.5*(_-p)+p;return o},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var sa=yr(Cr),aa=ns;function ns(n,e){this.x=n,this.y=e}ns.prototype={clone:function(){return new ns(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,o=n.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),o=Math.sin(n),a=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=a,this},_rotateAround:function(n,e){var o=Math.cos(n),a=Math.sin(n),c=e.y+a*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ns.convert=function(n){return n instanceof ns?n:Array.isArray(n)?new ns(n[0],n[1]):n};var ut=yr(aa);const su=Math.PI/180,Ns=180/Math.PI;function wt(n){return n*su}function Yi(n){return n*Ns}const zs=[[0,0],[1,0],[1,1],[0,1]];function gc(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,o=e*n;return 4*(n<.5?o:3*(n-e)+o-.75)}function la(n,e,o,a){const c=new sa(n,e,o,a);return function(d){return c.solve(d)}}const rs=la(.25,.1,.25,1);function dn(n,e,o){return Math.min(o,Math.max(e,n))}function Bs(n,e,o){return(o=dn((o-n)/(e-n),0,1))*o*(3-2*o)}function fr(n,e,o){const a=o-e,c=((n-e)%a+a)%a+e;return c===e?o:c}function uo(n,e,o){if(!n.length)return o(null,[]);let a=n.length;const c=new Array(n.length);let d=null;n.forEach((p,_)=>{e(p,(v,b)=>{v&&(d=v),c[_]=b,0==--a&&o(d,c)})})}function ca(n){const e=[];for(const o in n)e.push(n[o]);return e}function mr(n,...e){for(const o of e)for(const a in o)n[a]=o[a];return n}let Vs=1;function ci(){return Vs++}function Ui(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Va(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function ni(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function er(n,e){n.forEach(o=>{e[o]&&(e[o]=e[o].bind(e))})}function kn(n,e){return-1!==n.indexOf(e,n.length-e.length)}function _r(n,e,o){const a={};for(const c in n)a[c]=e.call(o||this,n[c],c,n);return a}function $l(n,e,o){const a={};for(const c in n)e.call(o||this,n[c],c,n)&&(a[c]=n[c]);return a}function _s(n){return Array.isArray(n)?n.map(_s):"object"==typeof n&&n?_r(n,_s):n}const js={};function Rr(n){js[n]||(typeof console<"u"&&console.warn(n),js[n]=!0)}function qe(n,e,o){return(o.y-n.y)*(e.x-n.x)>(e.y-n.y)*(o.x-n.x)}function le(n){let e=0;for(let o,a,c=0,d=n.length,p=d-1;c<d;p=c++)o=n[c],a=n[p],e+=(a.x-o.x)*(o.y+a.y);return e}function de([n,e,o]){const a=wt(e+90),c=wt(o);return{x:n*Math.cos(a)*Math.sin(c),y:n*Math.sin(a)*Math.sin(c),z:n*Math.cos(c),azimuthal:e,polar:o}}function Ce(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ye(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,a,c,d)=>{const p=c||d;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e}let Ke=null;function Ct(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ot(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function Qe(n,e,o,a){for(;e<o;){const c=e+o>>1;n[c]<a?e=c+1:o=c}return e}function $t(n,e,o,a){for(;e<o;){const c=e+o>>1;n[c]<=a?e=c+1:o=c}return e}const Kt="mapbox-tiles";let vr,qr,nn=500,tr=50;function gr(){try{return caches}catch{}}function Jn(){const n=gr();n&&!vr&&(vr=n.open(Kt))}function nr(n){const e=n.indexOf("?");if(e<0)return n;const a=function(c){const d=c.indexOf("?");return d>0?c.slice(d+1).split("&"):[]}(n).filter(c=>{const d=c.split("=");return"language"===d[0]||"worldview"===d[0]});return a.length?`${n.slice(0,e)}?${a.join("&")}`:n.slice(0,e)}let $i=1/0;const Gi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Gi);class oo extends Error{constructor(e,o,a){401===o&&ht(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=o,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _o=Ce()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,ys=function(n,e){if(!(/^file:/.test(o=n.url)||/^file:/.test(_o())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){const d=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:_o(),referrerPolicy:a.referrerPolicy,signal:d.signal});let _=!1,v=!1;const b=(C=p.url).indexOf("sku=")>0&&ht(C);var C;"json"===a.type&&p.headers.set("Accept","application/json");const M=(R,L,F)=>{if(v)return;if(R&&"SecurityError"!==R.message&&Rr(R.toString()),L&&F)return I(L);const B=Date.now();fetch(p).then(U=>{if(U.ok){const Y=b?U.clone():null;return I(U,Y,B)}return c(new oo(U.statusText,U.status,a.url))}).catch(U=>{"AbortError"!==U.name&&c(new Error(`${U.message} ${a.url}`))})},I=(R,L,F)=>{("arrayBuffer"===a.type?R.arrayBuffer():"json"===a.type?R.json():R.text()).then(B=>{v||(L&&F&&function(U,Y,J){if(Jn(),!vr)return;const Q={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((me,_e)=>Q.headers.set(_e,me));const oe=Ye(Y.headers.get("Cache-Control")||"");if(oe["no-store"])return;oe["max-age"]&&Q.headers.set("Expires",new Date(J+1e3*oe["max-age"]).toUTCString());const ae=Q.headers.get("Expires");ae&&(new Date(ae).getTime()-J<42e4||function(me,_e){if(void 0===qr)try{new Response(new ReadableStream),qr=!0}catch{qr=!1}qr?_e(me.body):me.blob().then(_e)}(Y,me=>{const _e=new Response(me,Q);Jn(),vr&&vr.then(Ee=>Ee.put(nr(U.url),_e)).catch(Ee=>Rr(Ee.message))}))}(p,L,F),_=!0,c(null,B,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(B=>{v||c(new Error(B.message))})};return b?function(R,L){if(Jn(),!vr)return L(null);const F=nr(R.url);vr.then(B=>{B.match(F).then(U=>{const Y=function(J){if(!J)return!1;const Q=new Date(J.headers.get("Expires")||0),oe=Ye(J.headers.get("Cache-Control")||"");return Q>Date.now()&&!oe["no-cache"]}(U);B.delete(F),Y&&B.put(F,U.clone()),L(null,U,Y)}).catch(L)}).catch(L)}(p,M):M(null,null),{cancel:()=>{v=!0,_||d.abort()}}}(n,e);if(Ce()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var o;return function(a,c){const d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),"arrayBuffer"===a.type&&(d.responseType="arraybuffer");for(const p in a.headers)d.setRequestHeader(p,a.headers[p]);return"json"===a.type&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials="include"===a.credentials,d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||0===d.status)&&null!==d.response){let p=d.response;if("json"===a.type)try{p=JSON.parse(d.response)}catch(_){return c(_)}c(null,p,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new oo(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(n,e)},di=function(n,e){return ys(mr(n,{type:"arrayBuffer"}),e)};function Us(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const vs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Or,Be;Or=[],Be=0;const Ze=function(n,e){if(bi.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Be>=vn.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Or.push(d),d}Be++;let o=!1;const a=()=>{if(!o)for(o=!0,Be--;Or.length&&Be<vn.MAX_PARALLEL_IMAGE_REQUESTS;){const d=Or.shift(),{requestParameters:p,callback:_,cancelled:v}=d;v||(d.cancel=Ze(p,_).cancel)}},c=di(n,(d,p,_,v)=>{a(),d?e(d):p&&(self.createImageBitmap?function(b,C){const M=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(M).then(I=>{C(null,I)}).catch(I=>{C(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(b,C)=>e(b,C,_,v)):function(b,C){const M=new Image;M.onload=()=>{C(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=vs})},M.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(b)],{type:"image/png"});M.src=b.byteLength?URL.createObjectURL(I):vs}(p,(b,C)=>e(b,C,_,v)))});return{cancel:()=>{c.cancel(),a()}}},it="NO_ACCESS_TOKEN";function lt(n){return 0===n.indexOf("mapbox:")}function ht(n){return vn.API_URL_REGEX.test(n)}function yt(n){return vn.API_CDN_URL_REGEX.test(n)}function gt(n){return vn.API_STYLE_REGEX.test(n)&&!pt(n)}function pt(n){return vn.API_SPRITE_REGEX.test(n)}const Tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function dt(n){const e=n.match(Tt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function tn(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}const Wn="mapbox.eventData";function Ut(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Xn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const o=Ut(vn.ACCESS_TOKEN);let a="";return a=o&&o.u?btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(+("0x"+d)))):vn.ACCESS_TOKEN||"",e?`${Wn}.${e}:${a}`:`${Wn}:${a}`}fetchEventData(){const e=Ct("localStorage"),o=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const c=localStorage.getItem(o);c&&(this.eventData=JSON.parse(c));const d=localStorage.getItem(a);d&&(this.anonId=d)}catch{Rr("Unable to read from LocalStorage")}}saveEventData(){const e=Ct("localStorage"),o=this.getStorageKey(),a=this.getStorageKey("uuid"),c=this.anonId;if(e&&c)try{localStorage.setItem(a,c),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{Rr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,o,a,c){if(!vn.EVENTS_URL)return;const d=dt(vn.EVENTS_URL);d.params.push(`access_token=${c||vn.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},_=o?mr(p,o):p,v={url:tn(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};var C;this.pendingRequest=(C=b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(c)},ys(mr(v,{method:"POST"}),C))}queueRequest(e,o){this.queue.push(e),this.processRequests(o)}}const Vn=new class extends Xn{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){vn.EVENTS_URL&&vn.ACCESS_TOKEN&&Array.isArray(n)&&n.some(o=>lt(o)||ht(o))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ut(vn.ACCESS_TOKEN),o=e?e.u:vn.ACCESS_TOKEN;let a=o!==this.eventData.tokenU;ni(this.anonId)||(this.anonId=Ui(),a=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),p=new Date(c),_=(c-this.eventData.lastSuccess)/864e5;a=a||_>=1||_<-1||d.getDate()!==p.getDate()}else a=!0;a?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:en,skuId:Ba,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=o)},n):this.processRequests()}},Zr=Vn.postTurnstileEvent.bind(Vn),Wr=new class extends Xn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,o,a){this.skuToken=e,this.errorCb=a,vn.EVENTS_URL&&(o||vn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},o):this.errorCb(new Error(it)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ni(this.anonId)||(this.anonId=Ui()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:en,skuId:Ba,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n))}},Li=Wr.postMapLoadEvent.bind(Wr),Go=new class extends Xn{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){vn.EVENTS_URL&&(n||vn.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:o}=this.queue.shift(),a=function(c){const d=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),_=function(R){const L={};if(R)for(const F in R)if("other"!==F)for(const B of R[F]){const U=`${F}ResolveRangeMin`,Y=`${F}ResolveRangeMax`,J=`${F}RequestCount`,Q=`${F}RequestCachedCount`;L[U]=Math.min(L[U]||1/0,B.startTime),L[Y]=Math.max(L[Y]||-1/0,B.responseEnd);const oe=ae=>{void 0===L[ae]&&(L[ae]=0),++L[ae]};void 0!==B.transferSize&&0===B.transferSize&&oe(Q),oe(J)}return L}(function(R,L){const F={};if(R)for(const B of R){const U=L(B);void 0===F[U]&&(F[U]=[]),F[U].push(B)}return F}(d,fi)),v=window.devicePixelRatio,b=navigator.connection||navigator.mozConnection||navigator.webkitConnection,C=b?b.effectiveType:void 0,M={counters:[],metadata:[],attributes:[]},I=(R,L,F)=>{null!=F&&R.push({name:L,value:F.toString()})};for(const R in _)I(M.counters,R,_[R]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(I(M.counters,"interactionRangeMin",c.interactionRange[0]),I(M.counters,"interactionRangeMax",c.interactionRange[1])),p)for(const R of Object.keys(ua)){const L=ua[R],F=p.find(B=>B.name===L);F&&I(M.counters,L,F.startTime)}return I(M.counters,"visibilityHidden",c.visibilityHidden),I(M.attributes,"style",function(R){if(R)for(const L of R){const F=L.name.split("?")[0];if(gt(F)){const B=F.split("/").slice(-2);if(2===B.length)return`mapbox://styles/${B[0]}/${B[1]}`}}}(d)),I(M.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),I(M.attributes,"fogEnabled",c.fogEnabled?"true":"false"),I(M.attributes,"projection",c.projection),I(M.attributes,"zoom",c.zoom),I(M.metadata,"devicePixelRatio",v),I(M.metadata,"connectionEffectiveType",C),I(M.metadata,"navigatorUserAgent",navigator.userAgent),I(M.metadata,"screenWidth",window.screen.width),I(M.metadata,"screenHeight",window.screen.height),I(M.metadata,"windowWidth",window.innerWidth),I(M.metadata,"windowHeight",window.innerHeight),I(M.metadata,"mapWidth",c.width/v),I(M.metadata,"mapHeight",c.height/v),I(M.metadata,"webglRenderer",c.renderer),I(M.metadata,"webglVendor",c.vendor),I(M.metadata,"sdkVersion",en),I(M.metadata,"sdkIdentifier","mapbox-gl-js"),M}(o);for(const c of a.metadata);for(const c of a.counters);for(const c of a.attributes);this.postEvent(e,a,()=>{},n)}},Ho=Go.postPerformanceEvent.bind(Go),Br=new class extends Xn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,o,a){if(!vn.API_URL||!vn.SESSION_PATH)return;const c=dt(vn.API_URL+vn.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${a||vn.ACCESS_TOKEN||""}`);const d={url:tn(c),headers:{"Content-Type":"text/plain"}};var _;this.pendingRequest=(_=p=>{this.pendingRequest=null,o(p),this.saveEventData(),this.processRequests(a)},ys(mr(d,{method:"GET"}),_))}getSessionAPI(n,e,o,a){this.skuToken=e,this.errorCb=a,vn.SESSION_PATH&&vn.API_URL&&(o||vn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},o):this.errorCb(new Error(it)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||this.getSession(o,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n)}},so=Br.getSessionAPI.bind(Br),yi=new Set,ua={create:"create",load:"load",fullLoad:"fullLoad"};function fi(n){const e=n.name.split("?")[0];return yt(e)&&e.includes("mapbox-gl.js")?"javascript":yt(e)&&e.includes("mapbox-gl.css")?"css":vn.API_FONTS_REGEX.test(e)?"fontRange":pt(e)?"sprite":gt(e)?"style":vn.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}function ja(n){const e=n?n.url.toString():void 0;return e?performance.getEntriesByName(e):[]}let yo,eh,Gl,dl,xs;function wi(){return null==yo&&(yo=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),yo}const ki={now:()=>void 0!==dl?dl:performance.now(),setNow(n){dl=n},restoreNow(){dl=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:o,height:a}=n;xs||(xs=document.createElement("canvas"));const c=xs.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(o>xs.width||a>xs.height)&&(xs.width=o,xs.height=a),c.clearRect(-e,-e,o+2*e,a+2*e),c.drawImage(n,0,0,o,a),c.getImageData(-e,-e,o+2*e,a+2*e)},resolveURL:n=>(eh||(eh=document.createElement("a")),eh.href=n,eh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Gl&&(Gl=window.matchMedia("(prefers-reduced-motion: reduce)")),Gl.matches)},hasCanvasFingerprintNoise(){if(!wi())return!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let o=0;for(let c=0;c<n.width;++c)e.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,e.fillRect(c,0,1,1);const a=e.getImageData(0,0,n.width,n.height);o=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&o++!==a.data[c])return!0;return!1}};function _c(n,e,o){o[n]&&-1!==o[n].indexOf(e)||(o[n]=o[n]||[],o[n].push(e))}function vo(n,e,o){if(o&&o[n]){const a=o[n].indexOf(e);-1!==a&&o[n].splice(a,1)}}class Ei{constructor(e,o={}){mr(this,o),this.type=e}}class $s extends Ei{constructor(e,o={}){super("error",mr({error:e},o))}}class ho{on(e,o){return this._listeners=this._listeners||{},_c(e,o,this._listeners),this}off(e,o){return vo(e,o,this._listeners),vo(e,o,this._oneTimeListeners),this}once(e,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},_c(e,o,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,o){"string"==typeof e&&(e=new Ei(e,o||{}));const a=e.type;if(this.listens(a)){e.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const _ of c)_.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const _ of d)vo(a,_,this._oneTimeListeners),_.call(this,e);const p=this._eventedParent;p&&(mr(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof $s&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}var De=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Pt{constructor(e,o,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),null!=o&&o.__line__&&(this.line=o.__line__)}}class bs extends Pt{}function ws(n,...e){for(const o of e)for(const a in o)n[a]=o[a];return n}function pi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Vr(n){if(Array.isArray(n))return n.map(Vr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const o in n)e[o]=Vr(n[o]);return e}return pi(n)}class th extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}var mi=th;class Tn{constructor(e,o=[]){this.parent=e,this.bindings={};for(const[a,c]of o)this.bindings[a]=c}concat(e){return new Tn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var cd=Tn;const ha={kind:"null"},He={kind:"number"},Mn={kind:"string"},P={kind:"boolean"},V={kind:"color"},te={kind:"object"},ce={kind:"value"},xe={kind:"collator"},we={kind:"formatted"},Te={kind:"resolvedImage"};function Le(n,e){return{kind:"array",itemType:n,N:e}}function nt(n){if("array"===n.kind){const e=nt(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const jt=[ha,He,Mn,P,V,we,te,Le(ce),Te];function zt(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!zt(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const o of jt)if(!zt(o,e))return null}return`Expected ${nt(n)} but found ${nt(e)} instead.`}function Rt(n,e){return e.some(o=>o.kind===n.kind)}function $e(n,e){return e.some(o=>"null"===o?null===n:"array"===o?Array.isArray(n):"object"===o?n&&!Array.isArray(n)&&"object"==typeof n:o===typeof n)}var Tr,Mt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function _n(n){return(n=Math.round(n))<0?0:n>255?255:n}function ft(n){return _n("%"===n[n.length-1]?parseFloat(n)/100*255:parseInt(n))}function rn(n){return(e="%"===n[n.length-1]?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function xr(n,e,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?n+(e-n)*o*6:2*o<1?e:3*o<2?n+(e-n)*(2/3-o)*6:n}try{Tr={}.parseCSSColor=function(n){var e,o=n.replace(/ /g,"").toLowerCase();if(o in Mt)return Mt[o].slice();if("#"===o[0])return 4===o.length?(e=parseInt(o.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===o.length&&(e=parseInt(o.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=o.indexOf("("),c=o.indexOf(")");if(-1!==a&&c+1===o.length){var d=o.substr(0,a),p=o.substr(a+1,c-(a+1)).split(","),_=1;switch(d){case"rgba":if(4!==p.length)return null;_=rn(p.pop());case"rgb":return 3!==p.length?null:[ft(p[0]),ft(p[1]),ft(p[2]),_];case"hsla":if(4!==p.length)return null;_=rn(p.pop());case"hsl":if(3!==p.length)return null;var v=(parseFloat(p[0])%360+360)%360/360,b=rn(p[1]),C=rn(p[2]),M=C<=.5?C*(b+1):C+b-C*b,I=2*C-M;return[_n(255*xr(I,M,v+1/3)),_n(255*xr(I,M,v)),_n(255*xr(I,M,v-1/3)),_];default:return null}}return null}}catch{}class pr{constructor(e,o,a,c=1){this.r=e,this.g=o,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof pr)return e;if("string"!=typeof e)return;const o=Tr(e);return o?new pr(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[e,o,a,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(o)},${Math.round(a)},${c})`}toArray(){const{r:e,g:o,b:a,a:c}=this;return 0===c?[0,0,0,0]:[255*e/c,255*o/c,255*a/c,c]}toArray01(){const{r:e,g:o,b:a,a:c}=this;return 0===c?[0,0,0,0]:[e/c,o/c,a/c,c]}toArray01Scaled(e){const{r:o,g:a,b:c,a:d}=this;return 0===d?[0,0,0]:[o/d*e,a/d*e,c/d*e]}toArray01PremultipliedAlpha(){const{r:e,g:o,b:a,a:c}=this;return[e,o,a,c]}toArray01Linear(){const{r:e,g:o,b:a,a:c}=this;return 0===c?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(o/c,2.2),Math.pow(a/c,2.2),c]}}pr.black=new pr(0,0,0,1),pr.white=new pr(1,1,1,1),pr.transparent=new pr(0,0,0,0),pr.red=new pr(1,0,0,1),pr.blue=new pr(0,0,1,1);var un=pr;class au{constructor(e,o,a){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fl{constructor(e,o,a,c,d){this.text=e.normalize?e.normalize():e,this.image=o,this.scale=a,this.fontStack=c,this.textColor=d}}class rr{constructor(e){this.sections=e}static fromString(e){return new rr([new fl(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length)}static factory(e){return e instanceof rr?e:rr.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const o of this.sections){if(o.image){e.push(["image",o.image.namePrimary]);continue}e.push(o.text);const a={};o.fontStack&&(a["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(a["font-scale"]=o.scale),o.textColor&&(a["text-color"]=["rgba"].concat(o.textColor.toArray())),e.push(a)}return e}}class Hi{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,o){return e?new Hi({namePrimary:e,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Nf(n,e,o,a){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof o&&o>=0&&o<=255?void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,o,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof a?[n,e,o,a]:[n,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qo(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof un||n instanceof au||n instanceof rr||n instanceof Hi)return!0;if(Array.isArray(n)){for(const e of n)if(!qo(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!qo(n[e]))return!1;return!0}return!1}function Ci(n){if(null===n)return ha;if("string"==typeof n)return Mn;if("boolean"==typeof n)return P;if("number"==typeof n)return He;if(n instanceof un)return V;if(n instanceof au)return xe;if(n instanceof rr)return we;if(n instanceof Hi)return Te;if(Array.isArray(n)){const e=n.length;let o;for(const a of n){const c=Ci(a);if(o){if(o===c)continue;o=ce;break}o=c}return Le(o||ce,e)}return te}function yc(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof un||n instanceof rr||n instanceof Hi?n.toString():JSON.stringify(n)}class lu{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(2!==e.length)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!qo(e[1]))return o.error("invalid value");const a=e[1];let c=Ci(a);const d=o.expectedType;return"array"!==c.kind||0!==c.N||!d||"array"!==d.kind||"number"==typeof d.N&&0!==d.N||(c=d),new lu(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof un?["rgba"].concat(this.value.toArray()):this.value instanceof rr?this.value.serialize():this.value}}var pl=lu,ui=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const nh={string:Mn,number:He,boolean:P,object:te};class Ao{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let a,c=1;const d=e[0];if("array"===d){let _,v;if(e.length>2){const b=e[1];if("string"!=typeof b||!(b in nh)||"object"===b)return o.error('The item type argument of "array" must be one of string, number, boolean',1);_=nh[b],c++}else _=ce;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);v=e[2],c++}a=Le(_,v)}else a=nh[d];const p=[];for(;c<e.length;c++){const _=o.parse(e[c],c,ce);if(!_)return null;p.push(_)}return new Ao(a,p)}evaluate(e){for(let o=0;o<this.args.length;o++){const a=this.args[o].evaluate(e);if(!zt(this.type,Ci(a)))return a;if(o===this.args.length-1)throw new ui(`Expected value to be of type ${nt(this.type)}, but found ${nt(Ci(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,o=[e.kind];if("array"===e.kind){const a=e.itemType;if("string"===a.kind||"number"===a.kind||"boolean"===a.kind){o.push(a.kind);const c=e.N;("number"==typeof c||this.args.length>1)&&o.push(c)}}return o.concat(this.args.map(a=>a.serialize()))}}var fn=Ao;class cu{constructor(e){this.type=we,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&"object"==typeof a)return o.error("First argument must be an image or text section.");const c=[];let d=!1;for(let p=1;p<=e.length-1;++p){const _=e[p];if(d&&"object"==typeof _&&!Array.isArray(_)){d=!1;let v=null;if(_["font-scale"]&&(v=o.parse(_["font-scale"],1,He),!v))return null;let b=null;if(_["text-font"]&&(b=o.parse(_["text-font"],1,Le(Mn)),!b))return null;let C=null;if(_["text-color"]&&(C=o.parse(_["text-color"],1,V),!C))return null;const M=c[c.length-1];M.scale=v,M.font=b,M.textColor=C}else{const v=o.parse(e[p],1,ce);if(!v)return null;const b=v.type.kind;if("string"!==b&&"value"!==b&&"null"!==b&&"resolvedImage"!==b)return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:v,scale:null,font:null,textColor:null})}}return new cu(c)}evaluate(e){return new rr(this.sections.map(o=>{const a=o.content.evaluate(e);return Ci(a)===Te?new fl("",a,null,null,null):new fl(yc(a),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(const o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const o of this.sections){e.push(o.content.serialize());const a={};o.scale&&(a["font-scale"]=o.scale.serialize()),o.font&&(a["text-font"]=o.font.serialize()),o.textColor&&(a["text-color"]=o.textColor.serialize()),e.push(a)}return e}}class vc{constructor(e,o){this.type=Te,this.inputPrimary=e,this.inputSecondary=o}static parse(e,o){if(e.length<2)return o.error("Expected two or more arguments.");const a=o.parse(e[1],1,Mn);if(!a)return o.error("No image name provided.");if(2===e.length)return new vc(a);const c=o.parse(e[2],1,Mn);return c?new vc(a,c):o.error("Secondary image variant is not a string.")}evaluate(e){const o=Hi.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&e.availableImages&&(o.available=e.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Kn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}const Cn={"to-boolean":P,"to-color":V,"to-number":He,"to-string":Mn};class rh{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const a=e[0],c=[];let d=ha;if("to-array"===a){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(o.expectedType){if("array"!==o.expectedType.kind)return o.error(`Expected ${o.expectedType.kind} but found array.`);d=Le(o.expectedType.itemType,p)}else{if(!(p>0&&qo(e[1][0])))return null;d=Le(Ci(e[1][0]),p)}for(let _=0;_<p;_++){const v=e[1][_];let b;if("array"===Kn(v))b=o.parse(v,void 0,d.itemType);else{const C=Kn(v);if(C!==d.itemType.kind)return o.error(`Expected ${d.itemType.kind} but found ${C}.`);b=o.registry.literal.parse(["literal",void 0===v?null:v],o)}if(!b)return null;c.push(b)}}else{if(("to-boolean"===a||"to-string"===a)&&2!==e.length)return o.error("Expected one argument.");d=Cn[a];for(let p=1;p<e.length;p++){const _=o.parse(e[p],p,ce);if(!_)return null;c.push(_)}}return new rh(d,c)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let o,a;for(const c of this.args){if(o=c.evaluate(e),a=null,o instanceof un)return o;if("string"==typeof o){const d=e.parseColor(o);if(d)return d}else if(Array.isArray(o)&&(a=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Nf(o[0],o[1],o[2],o[3]),!a))return new un(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ui(a||`Could not parse color from value '${"string"==typeof o?o:String(JSON.stringify(o))}'`)}if("number"===this.type.kind){let o=null;for(const a of this.args){if(o=a.evaluate(e),null===o)return 0;const c=Number(o);if(!isNaN(c))return c}throw new ui(`Could not convert ${JSON.stringify(o)} to number.`)}return"formatted"===this.type.kind?rr.fromString(yc(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Hi.fromString(yc(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(o=>o.evaluate(e)):yc(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new cu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new vc(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{e.push(o.serialize())}),e}}var Ji=rh;const Ua=["Unknown","Point","LineString","Polygon"];var xc=class{constructor(n,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ua[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:o,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*e-n[0])+this.featureDistanceData.bearing[1]*(a*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=un.parse(n)),e}getConfig(n){return this.options?this.options.get(n):null}};class Gs{constructor(e,o,a,c,d){this.name=e,this.type=o,this._evaluate=a,this.args=c,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const o=Gs.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,o){const a=e[0],c=Gs.definitions[a];if(!c)return o.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=[];let v=null,b=-1;for(const[C,M]of p){if(Array.isArray(C)&&C.length!==e.length-1)continue;_.push(C),b++,v=new Ti(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const I=[];let R=!1;for(let L=1;L<e.length;L++){const F=e[L],B=Array.isArray(C)?C[L-1]:C.type,U=v.parse(F,1+I.length,B);if(!U){R=!0;break}I.push(U)}if(!R)if(Array.isArray(C)&&C.length!==I.length)v.error(`Expected ${C.length} arguments, but found ${I.length} instead.`);else{for(let L=0;L<I.length;L++){const F=Array.isArray(C)?C[L]:C.type,B=I[L];v.concat(L+1).checkSubtype(F,B.type)}if(0===v.errors.length)return new Gs(a,d,M,I,b)}}if(1===_.length)o.errors.push(...v.errors);else{const C=(_.length?_:p.map(([I])=>I)).map(Es).join(" | "),M=[];for(let I=1;I<e.length;I++){const R=o.parse(e[I],1+M.length);if(!R)return null;M.push(nt(R.type))}o.error(`Expected arguments of type ${C}, but found (${M.join(", ")}) instead.`)}return null}static register(e,o){Gs.definitions=o;for(const a in o)e[a]=Gs}}function Es(n){return Array.isArray(n)?`(${n.map(nt).join(", ")})`:`(${nt(n.type)}...)`}var xo=Gs;class da{constructor(e,o,a){this.type=xe,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(2!==e.length)return o.error("Expected one argument.");const a=e[1];if("object"!=typeof a||Array.isArray(a))return o.error("Collator options argument must be an object.");const c=o.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,P);if(!c)return null;const d=o.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,P);if(!d)return null;let p=null;return a.locale&&(p=o.parse(a.locale,1,Mn),!p)?null:new da(c,d,p)}evaluate(e){return new au(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var bc={exports:{}};bc.exports=function(){function n(a,c,d,p,_){for(;p>d;){if(p-d>600){var v=p-d+1,b=c-d+1,C=Math.log(v),M=.5*Math.exp(2*C/3),I=.5*Math.sqrt(C*M*(v-M)/v)*(b-v/2<0?-1:1);n(a,c,Math.max(d,Math.floor(c-b*M/v+I)),Math.min(p,Math.floor(c+(v-b)*M/v+I)),_)}var R=a[c],L=d,F=p;for(e(a,d,c),_(a[p],R)>0&&e(a,d,p);L<F;){for(e(a,L,F),L++,F--;_(a[L],R)<0;)L++;for(;_(a[F],R)>0;)F--}0===_(a[d],R)?e(a,d,F):e(a,++F,p),F<=c&&(d=F+1),c<=F&&(p=F-1)}}function e(a,c,d){var p=a[c];a[c]=a[d],a[d]=p}function o(a,c){return a<c?-1:a>c?1:0}return function(a,c,d,p,_){n(a,c,d||0,p||a.length-1,_||o)}}();var uu=yr(bc.exports);function ml(n){let e=0;for(let o,a,c=0,d=n.length,p=d-1;c<d;p=c++)o=n[c],a=n[p],e+=(a.x-o.x)*(o.y+a.y);return e}function Pn(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Cs(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function ih(n,e,o){const a=n[0]-e[0],c=n[1]-e[1],d=n[0]-o[0],p=n[1]-o[1];return a*p-d*c==0&&a*d<=0&&c*p<=0}function Xr(n,e,o=!1){let a=!1;for(let _=0,v=e.length;_<v;_++){const b=e[_];for(let C=0,M=b.length,I=M-1;C<M;I=C++){const R=b[I],L=b[C];if(ih(n,R,L))return o;(d=R)[1]>(c=n)[1]!=(p=L)[1]>c[1]&&c[0]<(p[0]-d[0])*(c[1]-d[1])/(p[1]-d[1])+d[0]&&(a=!a)}}var c,d,p;return a}function wc(n,e,o,a){const c=a[0]-o[0],d=a[1]-o[1],p=(n[0]-o[0])*d-c*(n[1]-o[1]),_=(e[0]-o[0])*d-c*(e[1]-o[1]);return p>0&&_<0||p<0&&_>0}function $a(n,e,o,a){return(c=[a[0]-o[0],a[1]-o[1]])[0]*(d=[e[0]-n[0],e[1]-n[1]])[1]-c[1]*d[0]!=0&&!(!wc(n,e,o,a)||!wc(o,a,n,e));var c,d}const Wt=8192;function ud(n,e){const o=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(o*c*Wt),Math.round(a*c*Wt)]}function hu(n,e){for(let o=0;o<e.length;o++)if(Xr(n,e[o]))return!0;return!1}function sn(n,e,o){for(const a of o)for(let c=0,d=a.length,p=d-1;c<d;p=c++)if($a(n,e,a[p],a[c]))return!0;return!1}function gl(n,e){for(let o=0;o<n.length;++o)if(!Xr(n[o],e))return!1;for(let o=0;o<n.length-1;++o)if(sn(n[o],n[o+1],e))return!1;return!0}function Ec(n,e){for(let o=0;o<e.length;o++)if(gl(n,e[o]))return!0;return!1}function fa(n,e,o){const a=[];for(let c=0;c<n.length;c++){const d=[];for(let p=0;p<n[c].length;p++){const _=ud(n[c][p],o);Pn(e,_),d.push(_)}a.push(d)}return a}function Cc(n,e,o){const a=[];for(let c=0;c<n.length;c++){const d=fa(n[c],e,o);a.push(d)}return a}function oh(n,e,o,a){if(n[0]<o[0]||n[0]>o[2]){const c=.5*a;let d=n[0]-o[0]>c?-a:o[0]-n[0]>c?a:0;0===d&&(d=n[0]-o[2]>c?-a:o[2]-n[0]>c?a:0),n[0]+=d}Pn(e,n)}function pa(n,e,o,a){const c=Math.pow(2,a.z)*Wt,d=[a.x*Wt,a.y*Wt],p=[];if(!n)return p;for(const _ of n)for(const v of _){const b=[v.x+d[0],v.y+d[1]];oh(b,e,o,c),p.push(b)}return p}function hd(n,e,o,a){const c=Math.pow(2,a.z)*Wt,d=[a.x*Wt,a.y*Wt],p=[];if(!n)return p;for(const v of n){const b=[];for(const C of v){const M=[C.x+d[0],C.y+d[1]];Pn(e,M),b.push(M)}p.push(b)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const v of p)for(const b of v)oh(b,e,o,c)}var _;return p}class ma{constructor(e,o){this.type=P,this.geojson=e,this.geometries=o}static parse(e,o){if(2!==e.length)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(qo(e[1])){const a=e[1];if("FeatureCollection"===a.type)for(let c=0;c<a.features.length;++c){const d=a.features[c].geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new ma(a,a.features[c].geometry)}else if("Feature"===a.type){const c=a.geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new ma(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new ma(a,a)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(o,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=o.canonicalID();if(!p)return!1;if("Polygon"===a.type){const _=fa(a.coordinates,d,p),v=pa(o.geometry(),c,d,p);if(!Cs(c,d))return!1;for(const b of v)if(!Xr(b,_))return!1}if("MultiPolygon"===a.type){const _=Cc(a.coordinates,d,p),v=pa(o.geometry(),c,d,p);if(!Cs(c,d))return!1;for(const b of v)if(!hu(b,_))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(o,a){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=o.canonicalID();if(!p)return!1;if("Polygon"===a.type){const _=fa(a.coordinates,d,p),v=hd(o.geometry(),c,d,p);if(!Cs(c,d))return!1;for(const b of v)if(!gl(b,_))return!1}if("MultiPolygon"===a.type){const _=Cc(a.coordinates,d,p),v=hd(o.geometry(),c,d,p);if(!Cs(c,d))return!1;for(const b of v)if(!Ec(b,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var du=ma,fu={exports:{}};fu.exports=function(){var n={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,o=e*(2-e),a=Math.PI/180,c=function(b,C){if(void 0===b)throw new Error("No latitude given.");if(C&&!n[C])throw new Error("Unknown unit "+C+". Use one of: "+Object.keys(n).join(", "));var M=6378.137*a*(C?n[C]:1),I=Math.cos(b*a),R=1/(1-o*(1-I*I)),L=Math.sqrt(R);this.kx=M*L*I,this.ky=M*L*R*(1-o)},d={units:{configurable:!0}};function p(b,C){return b[0]===C[0]&&b[1]===C[1]}function _(b,C,M){var I=v(C[0]-b[0]);return[b[0]+I*M,b[1]+(C[1]-b[1])*M]}function v(b){for(;b<-180;)b+=360;for(;b>180;)b-=360;return b}return c.fromTile=function(b,C,M){var I=Math.PI*(1-2*(b+.5)/Math.pow(2,C)),R=Math.atan(.5*(Math.exp(I)-Math.exp(-I)))/a;return new c(R,M)},d.units.get=function(){return n},c.prototype.distance=function(b,C){var M=v(b[0]-C[0])*this.kx,I=(b[1]-C[1])*this.ky;return Math.sqrt(M*M+I*I)},c.prototype.bearing=function(b,C){var M=v(C[0]-b[0])*this.kx;return Math.atan2(M,(C[1]-b[1])*this.ky)/a},c.prototype.destination=function(b,C,M){var I=M*a;return this.offset(b,Math.sin(I)*C,Math.cos(I)*C)},c.prototype.offset=function(b,C,M){return[b[0]+C/this.kx,b[1]+M/this.ky]},c.prototype.lineDistance=function(b){for(var C=0,M=0;M<b.length-1;M++)C+=this.distance(b[M],b[M+1]);return C},c.prototype.area=function(b){for(var C=0,M=0;M<b.length;M++)for(var I=b[M],R=0,L=I.length,F=L-1;R<L;F=R++)C+=v(I[R][0]-I[F][0])*(I[R][1]+I[F][1])*(M?-1:1);return Math.abs(C)/2*this.kx*this.ky},c.prototype.along=function(b,C){var M=0;if(C<=0)return b[0];for(var I=0;I<b.length-1;I++){var R=b[I],L=b[I+1],F=this.distance(R,L);if((M+=F)>C)return _(R,L,(C-(M-F))/F)}return b[b.length-1]},c.prototype.pointToSegmentDistance=function(b,C,M){var I=C[0],R=C[1],L=v(M[0]-I)*this.kx,F=(M[1]-R)*this.ky,B=0;return 0===L&&0===F||((B=(v(b[0]-I)*this.kx*L+(b[1]-R)*this.ky*F)/(L*L+F*F))>1?(I=M[0],R=M[1]):B>0&&(I+=L/this.kx*B,R+=F/this.ky*B)),L=v(b[0]-I)*this.kx,F=(b[1]-R)*this.ky,Math.sqrt(L*L+F*F)},c.prototype.pointOnLine=function(b,C){for(var M,I,R,L,F=1/0,B=0;B<b.length-1;B++){var U=b[B][0],Y=b[B][1],J=v(b[B+1][0]-U)*this.kx,Q=(b[B+1][1]-Y)*this.ky,oe=0;0===J&&0===Q||((oe=(v(C[0]-U)*this.kx*J+(C[1]-Y)*this.ky*Q)/(J*J+Q*Q))>1?(U=b[B+1][0],Y=b[B+1][1]):oe>0&&(U+=J/this.kx*oe,Y+=Q/this.ky*oe));var ae=(J=v(C[0]-U)*this.kx)*J+(Q=(C[1]-Y)*this.ky)*Q;ae<F&&(F=ae,M=U,I=Y,R=B,L=oe)}return{point:[M,I],index:R,t:Math.max(0,Math.min(1,L))}},c.prototype.lineSlice=function(b,C,M){var I=this.pointOnLine(M,b),R=this.pointOnLine(M,C);if(I.index>R.index||I.index===R.index&&I.t>R.t){var L=I;I=R,R=L}var F=[I.point],B=I.index+1,U=R.index;!p(M[B],F[0])&&B<=U&&F.push(M[B]);for(var Y=B+1;Y<=U;Y++)F.push(M[Y]);return p(M[U],R.point)||F.push(R.point),F},c.prototype.lineSliceAlong=function(b,C,M){for(var I=0,R=[],L=0;L<M.length-1;L++){var F=M[L],B=M[L+1],U=this.distance(F,B);if((I+=U)>b&&0===R.length&&R.push(_(F,B,(b-(I-U))/U)),I>=C)return R.push(_(F,B,(C-(I-U))/U)),R;I>b&&R.push(B)}return R},c.prototype.bufferPoint=function(b,C){var M=C/this.ky,I=C/this.kx;return[b[0]-I,b[1]-M,b[0]+I,b[1]+M]},c.prototype.bufferBBox=function(b,C){var M=C/this.ky,I=C/this.kx;return[b[0]-I,b[1]-M,b[2]+I,b[3]+M]},c.prototype.insideBBox=function(b,C){return v(b[0]-C[0])>=0&&v(b[0]-C[2])<=0&&b[1]>=C[1]&&b[1]<=C[3]},Object.defineProperties(c,d),c}();var Ga=yr(fu.exports),fo={exports:{}};fo.exports=function(){var n=function(o,a){if(void 0===o&&(o=[]),void 0===a&&(a=e),this.data=o,this.length=this.data.length,this.compare=a,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function e(o,a){return o<a?-1:o>a?1:0}return n.prototype.push=function(o){this.data.push(o),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(0!==this.length){var o=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),o}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(o){for(var a=this.data,c=this.compare,d=a[o];o>0;){var p=o-1>>1,_=a[p];if(c(d,_)>=0)break;a[o]=_,o=p}a[o]=d},n.prototype._down=function(o){for(var a=this.data,c=this.compare,d=this.length>>1,p=a[o];o<d;){var _=1+(o<<1),v=a[_],b=_+1;if(b<this.length&&c(a[b],v)<0&&(_=b,v=a[b]),c(v,p)>=0)break;a[o]=v,o=_}a[o]=p},n}();var is=yr(fo.exports),ct=8192;function ga(n,e){return e.dist-n.dist}const pu=100,Hl=50;function _l(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(e[o]!==n[o])return!1;return!0}function Hs(n){return n[1]-n[0]+1}function qs(n,e){const o=n[1]>=n[0]&&n[1]<e;return o||console.warn("Distance Expression: Index is out of range"),o}function Ts(n,e){if(n[0]>n[1])return[null,null];const o=Hs(n);if(e){if(2===o)return[n,null];const a=Math.floor(o/2);return[[n[0],n[0]+a],[n[0]+a,n[1]]]}{if(1===o)return[n,null];const a=Math.floor(o/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}}function Ha(n,e){const o=[1/0,1/0,-1/0,-1/0];if(!qs(e,n.length))return o;for(let a=e[0];a<=e[1];++a)Pn(o,n[a]);return o}function yn(n){const e=[1/0,1/0,-1/0,-1/0];for(let o=0;o<n.length;++o)for(let a=0;a<n[o].length;++a)Pn(e,n[o][a]);return e}function _a(n,e,o){if(_l(n)||_l(e))return NaN;let a=0,c=0;return n[2]<e[0]&&(a=e[0]-n[2]),n[0]>e[2]&&(a=n[0]-e[2]),n[1]>e[3]&&(c=n[1]-e[3]),n[3]<e[1]&&(c=e[1]-n[3]),o.distance([0,0],[a,c])}function Qt(n,e){const o=Math.pow(2,e.z);return[(c=(n.x/ct+e.x)/o,360*c-180),(a=(n.y/ct+e.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,c}function ya(n,e){const o=[];for(let a=0;a<n.length;++a)o.push(Qt(n[a],e));return o}function Tc(n,e,o){const a=o.pointOnLine(e,n).point;return o.distance(n,a)}function Po(n,e,o,a,c){const d=o.slice(a[0],a[1]+1);let p=1/0;for(let _=e[0];_<=e[1];++_)if(0===(p=Math.min(p,Tc(n[_],d,c))))return 0;return p}function sh(n,e,o,a,c){const d=Math.min(c.pointToSegmentDistance(n,o,a),c.pointToSegmentDistance(e,o,a)),p=Math.min(c.pointToSegmentDistance(o,n,e),c.pointToSegmentDistance(a,n,e));return Math.min(d,p)}function yl(n,e,o,a,c){if(!qs(e,n.length)||!qs(a,o.length))return NaN;let d=1/0;for(let p=e[0];p<e[1];++p)for(let _=a[0];_<a[1];++_){if($a(n[p],n[p+1],o[_],o[_+1]))return 0;d=Math.min(d,sh(n[p],n[p+1],o[_],o[_+1],c))}return d}function dd(n,e,o,a,c){if(!qs(e,n.length)||!qs(a,o.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let _=a[0];_<=a[1];++_)if(0===(d=Math.min(d,c.distance(n[p],o[_]))))return d;return d}function Zs(n,e,o){if(Xr(n,e,!0))return 0;let a=1/0;for(const c of e){const d=c.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[d-1]&&0===(a=Math.min(a,o.pointToSegmentDistance(n,c[d-1],c[0])))||0===(a=Math.min(a,Tc(n,c,o))))return a}return a}function vl(n,e,o,a){if(!qs(e,n.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Xr(n[d],o,!0))return 0;let c=1/0;for(let d=e[0];d<e[1];++d)for(const p of o)for(let _=0,v=p.length,b=v-1;_<v;b=_++){if($a(n[d],n[d+1],p[b],p[_]))return 0;c=Math.min(c,sh(n[d],n[d+1],p[b],p[_],a))}return c}function Ro(n,e){for(const o of n)for(let a=0;a<=o.length-1;++a)if(Xr(o[a],e,!0))return!0;return!1}function os(n,e,o,a=1/0){const c=yn(n),d=yn(e);if(a!==1/0&&_a(c,d,o)>=a)return a;if(Cs(c,d)){if(Ro(n,e))return 0}else if(Ro(e,n))return 0;let p=a;for(const _ of n)for(let v=0,b=_.length,C=b-1;v<b;C=v++)for(const M of e)for(let I=0,R=M.length,L=R-1;I<R;L=I++){if($a(_[C],_[v],M[L],M[I]))return 0;p=Math.min(p,sh(_[C],_[v],M[L],M[I],o))}return p}function or(n,e,o,a,c,d,p){if(null===d||null===p)return;const _=_a(Ha(a,d),Ha(c,p),o);_<e&&n.push({dist:_,range1:d,range2:p})}function Mc(n,e,o,a,c=1/0){let d=Math.min(a.distance(n[0],o[0][0]),c);if(0===d)return d;const p=new is([{dist:0,range1:[0,n.length-1],range2:[0,0]}],ga),_=e?Hl:pu,v=yn(o);for(;p.length;){const b=p.pop();if(b.dist>=d)continue;const C=b.range1;if(Hs(C)<=_){if(!qs(C,n.length))return NaN;if(e){const M=vl(n,C,o,a);if(0===(d=Math.min(d,M)))return d}else for(let M=C[0];M<=C[1];++M){const I=Zs(n[M],o,a);if(0===(d=Math.min(d,I)))return d}}else{const M=Ts(C,e);if(null!==M[0]){const I=_a(Ha(n,M[0]),v,a);I<d&&p.push({dist:I,range1:M[0],range2:[0,0]})}if(null!==M[1]){const I=_a(Ha(n,M[1]),v,a);I<d&&p.push({dist:I,range1:M[1],range2:[0,0]})}}}return d}function qa(n,e,o,a,c,d=1/0){let p=Math.min(d,c.distance(n[0],o[0]));if(0===p)return p;const _=new is([{dist:0,range1:[0,n.length-1],range2:[0,o.length-1]}],ga),v=e?Hl:pu,b=a?Hl:pu;for(;_.length;){const C=_.pop();if(C.dist>=p)continue;const M=C.range1,I=C.range2;if(Hs(M)<=v&&Hs(I)<=b){if(!qs(M,n.length)||!qs(I,o.length))return NaN;if(e&&a?p=Math.min(p,yl(n,M,o,I,c)):e||a?e&&!a?p=Math.min(p,Po(o,I,n,M,c)):!e&&a&&(p=Math.min(p,Po(n,M,o,I,c))):p=Math.min(p,dd(n,M,o,I,c)),0===p)return p}else{const R=Ts(M,e),L=Ts(I,a);or(_,p,c,n,o,R[0],L[0]),or(_,p,c,n,o,R[0],L[1]),or(_,p,c,n,o,R[1],L[0]),or(_,p,c,n,o,R[1],L[1])}}return p}function xl(n,e,o,a,c=1/0){let d=c;const p=Ha(n,[0,n.length-1]);for(const _ of o)if(!(d!==1/0&&_a(p,Ha(_,[0,_.length-1]),a)>=d)&&(d=Math.min(d,qa(n,e,_,!0,a,d)),0===d))return d;return d}function ql(n,e,o,a,c=1/0){let d=c;const p=Ha(n,[0,n.length-1]);for(const _ of o){if(d!==1/0&&_a(p,yn(_),a)>=d)continue;const v=Mc(n,e,_,a,d);if(isNaN(v))return v;if(0===(d=Math.min(d,v)))return d}return d}function Ie(n){return"Point"===n||"MultiPoint"===n||"LineString"===n||"MultiLineString"===n||"Polygon"===n||"MultiPolygon"===n}class We{constructor(e,o){this.type=He,this.geojson=e,this.geometries=o}static parse(e,o){if(2!==e.length)return o.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(qo(e[1])){const a=e[1];if("FeatureCollection"===a.type){for(let c=0;c<a.features.length;++c)if(Ie(a.features[c].geometry.type))return new We(a,a.features[c].geometry)}else if("Feature"===a.type){if(Ie(a.geometry.type))return new We(a,a.geometry)}else if(Ie(a.type))return new We(a,a)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const o=e.geometry(),a=e.canonicalID();if(null!=o&&null!=a){if("Point"===e.geometryType())return function(c,d,p){const _=[];for(const b of c)for(const C of b)_.push(Qt(C,d));const v=new Ga(_[0][1],"meters");return"Point"===p.type||"MultiPoint"===p.type||"LineString"===p.type?qa(_,!1,"Point"===p.type?[p.coordinates]:p.coordinates,"LineString"===p.type,v):"MultiLineString"===p.type?xl(_,!1,p.coordinates,v):"Polygon"===p.type||"MultiPolygon"===p.type?ql(_,!1,"Polygon"===p.type?[p.coordinates]:p.coordinates,v):null}(o,a,this.geometries);if("LineString"===e.geometryType())return function(c,d,p){const _=[];for(const b of c){const C=[];for(const M of b)C.push(Qt(M,d));_.push(C)}const v=new Ga(_[0][0][1],"meters");if("Point"===p.type||"MultiPoint"===p.type||"LineString"===p.type)return xl("Point"===p.type?[p.coordinates]:p.coordinates,"LineString"===p.type,_,v);if("MultiLineString"===p.type){let b=1/0;for(let C=0;C<p.coordinates.length;C++){const M=xl(p.coordinates[C],!0,_,v,b);if(isNaN(M))return M;if(0===(b=Math.min(b,M)))return b}return b}if("Polygon"===p.type||"MultiPolygon"===p.type){let b=1/0;for(let C=0;C<_.length;C++){const M=ql(_[C],!0,"Polygon"===p.type?[p.coordinates]:p.coordinates,v,b);if(isNaN(M))return M;if(0===(b=Math.min(b,M)))return b}return b}return null}(o,a,this.geometries);if("Polygon"===e.geometryType())return function(c,d,p){const _=[];for(const b of function(C,M){const I=C.length;if(I<=1)return[C];const R=[];let L,F;for(let B=0;B<I;B++){const U=ml(C[B]);0!==U&&(C[B].area=Math.abs(U),void 0===F&&(F=U<0),F===U<0?(L&&R.push(L),L=[C[B]]):L.push(C[B]))}return L&&R.push(L),R}(c)){const C=[];for(let M=0;M<b.length;++M)C.push(ya(b[M],d));_.push(C)}const v=new Ga(_[0][0][0][1],"meters");if("Point"===p.type||"MultiPoint"===p.type||"LineString"===p.type)return ql("Point"===p.type?[p.coordinates]:p.coordinates,"LineString"===p.type,_,v);if("MultiLineString"===p.type){let b=1/0;for(let C=0;C<p.coordinates.length;C++){const M=ql(p.coordinates[C],!0,_,v,b);if(isNaN(M))return M;if(0===(b=Math.min(b,M)))return b}return b}return"Polygon"===p.type||"MultiPolygon"===p.type?function(b,C,M){let I=1/0;for(const R of b)for(const L of C){const F=os(R,L,M,I);if(isNaN(F))return F;if(0===(I=Math.min(I,F)))return I}return I}("Polygon"===p.type?[p.coordinates]:p.coordinates,_,v):null}(o,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Bt=We;function an(n){if(n instanceof xo&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof du||n instanceof Bt)return!1;let e=!0;return n.eachChild(o=>{e&&!an(o)&&(e=!1)}),e}function Fn(n){if(n instanceof xo&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(o=>{e&&!Fn(o)&&(e=!1)}),e}function Hn(n){if(n instanceof xo&&"config"===n.name)return!1;let e=!0;return n.eachChild(o=>{e&&!Hn(o)&&(e=!1)}),e}function Mr(n,e){if(n instanceof xo&&e.indexOf(n.name)>=0)return!1;let o=!0;return n.eachChild(a=>{o&&!Mr(a,e)&&(o=!1)}),o}class jr{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(2!==e.length||"string"!=typeof e[1])return o.error("'var' expression requires exactly one string literal argument.");const a=e[1];return o.scope.has(a)?new jr(a,o.scope.get(a)):o.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Zo=jr;class ri{constructor(e,o=[],a,c=new cd,d=[],p,_){this.registry=e,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=c,this.errors=d,this.expectedType=a,this._scope=p,this.options=_}parse(e,o,a,c,d={}){return o||a?this.concat(o,a,c)._parse(e,d):this._parse(e,d)}_parse(e,o){function a(c,d,p){return"assert"===p?new fn(d,[c]):"coerce"===p?new Ji(d,[c]):c}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c="string"==typeof e[0]?this.registry[e[0]]:void 0;if(c){let d=c.parse(e,this);if(!d)return null;if(this.expectedType){const p=this.expectedType,_=d.type;if("string"!==p.kind&&"number"!==p.kind&&"boolean"!==p.kind&&"object"!==p.kind&&"array"!==p.kind||"value"!==_.kind)if("color"!==p.kind&&"formatted"!==p.kind&&"resolvedImage"!==p.kind||"value"!==_.kind&&"string"!==_.kind){if(this.checkSubtype(p,_))return null}else d=a(d,p,o.typeAnnotation||"coerce");else d=a(d,p,o.typeAnnotation||"assert")}if(!(d instanceof pl)&&"resolvedImage"!==d.type.kind&&Oo(d)){const p=new xc(this._scope,this.options);try{d=new pl(d.type,d.evaluate(p))}catch(_){return this.error(_.message),null}}return d}return Ji.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,a){const c="number"==typeof e?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new ri(this.registry,c,o||null,d,this.errors,this._scope,this.options)}error(e,...o){const a=`${this.key}${o.map(c=>`[${c}]`).join("")}`;this.errors.push(new mi(a,e))}checkSubtype(e,o){const a=zt(e,o);return a&&this.error(a),a}}var Ti=ri;function Oo(n){if(n instanceof Zo)return Oo(n.boundExpression);if(n instanceof xo&&"error"===n.name||n instanceof xo&&"config"===n.name||n instanceof da||n instanceof du||n instanceof Bt)return!1;const e=n instanceof Ji||n instanceof fn;let o=!0;return n.eachChild(a=>{o=e?o&&Oo(a):o&&a instanceof pl}),!!o&&an(n)&&Mr(n,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function ss(n,e){const o=n.length-1;let a,c,d=0,p=o,_=0;for(;d<=p;)if(_=Math.floor((d+p)/2),a=n[_],c=n[_+1],a<=e){if(_===o||e<c)return _;d=_+1}else{if(!(a>e))throw new ui("Input is not a number.");p=_-1}return 0}class ao{constructor(e,o,a){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(const[c,d]of a)this.labels.push(c),this.outputs.push(d)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");const a=o.parse(e[1],1,He);if(!a)return null;const c=[];let d=null;o.expectedType&&"value"!==o.expectedType.kind&&(d=o.expectedType);for(let p=1;p<e.length;p+=2){const _=1===p?-1/0:e[p],v=e[p+1],b=p,C=p+1;if("number"!=typeof _)return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(c.length&&c[c.length-1][0]>=_)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const M=o.parse(v,C,d);if(!M)return null;d=d||M.type,c.push([_,M])}return new ao(d,a,c)}evaluate(e){const o=this.labels,a=this.outputs;if(1===o.length)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=o[0])return a[0].evaluate(e);const d=o.length;return c>=o[d-1]?a[d-1].evaluate(e):a[ss(o,c)].evaluate(e)}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&e.push(this.labels[o]),e.push(this.outputs[o].serialize());return e}}var Mi=ao;function mn(n,e,o){return n*(1-o)+e*o}function Za(n,e,o){return n.map((a,c)=>mn(a,e[c],o))}var Ws=Object.freeze({__proto__:null,array:Za,color:function(n,e,o){return new un(mn(n.r,e.r,o),mn(n.g,e.g,o),mn(n.b,e.b,o),mn(n.a,e.a,o))},number:mn});const fd=4/29,bl=6/29,Lr=3*bl*bl,Dr=bl*bl*bl,mu=Math.PI/180,as=180/Math.PI;function Dc(n){return n>Dr?Math.pow(n,1/3):n/Lr+fd}function Lo(n){return n>bl?n*n*n:Lr*(n-fd)}function Ms(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function qi(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Zl(n){const e=qi(n.r),o=qi(n.g),a=qi(n.b),c=Dc((.4124564*e+.3575761*o+.1804375*a)/.95047),d=Dc((.2126729*e+.7151522*o+.072175*a)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-Dc((.0193339*e+.119192*o+.9503041*a)/1.08883)),alpha:n.a}}function Ds(n){let e=(n.l+16)/116,o=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*Lo(e),o=.95047*Lo(o),a=1.08883*Lo(a),new un(Ms(3.2404542*o-1.5371385*e-.4985314*a),Ms(-.969266*o+1.8760108*e+.041556*a),Ms(.0556434*o-.2040259*e+1.0572252*a),n.alpha)}function xn(n,e,o){const a=e-n;return n+o*(a>180||a<-180?a-360*Math.round(a/360):a)}const ii={forward:Zl,reverse:Ds,interpolate:function(n,e,o){return{l:mn(n.l,e.l,o),a:mn(n.a,e.a,o),b:mn(n.b,e.b,o),alpha:mn(n.alpha,e.alpha,o)}}},$n={forward:function(n){const{l:e,a:o,b:a}=Zl(n),c=Math.atan2(a,o)*as;return{h:c<0?c+360:c,c:Math.sqrt(o*o+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*mu,o=n.c;return Ds({l:n.l,a:Math.cos(e)*o,b:Math.sin(e)*o,alpha:n.alpha})},interpolate:function(n,e,o){return{h:xn(n.h,e.h,o),c:mn(n.c,e.c,o),l:mn(n.l,e.l,o),alpha:mn(n.alpha,e.alpha,o)}}};var Di=Object.freeze({__proto__:null,hcl:$n,lab:ii});class Fi{constructor(e,o,a,c,d){this.type=e,this.operator=o,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[p,_]of d)this.labels.push(p),this.outputs.push(_)}static interpolationFactor(e,o,a,c){let d=0;if("exponential"===e.name)d=Ki(o,e.base,a,c);else if("linear"===e.name)d=Ki(o,1,a,c);else if("cubic-bezier"===e.name){const p=e.controlPoints;d=new sa(p[0],p[1],p[2],p[3]).solve(Ki(o,1,a,c))}return d}static parse(e,o){let[a,c,d,...p]=e;if(!Array.isArray(c)||0===c.length)return o.error("Expected an interpolation type expression.",1);if("linear"===c[0])c={name:"linear"};else if("exponential"===c[0]){const b=c[1];if("number"!=typeof b)return o.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:b}}else{if("cubic-bezier"!==c[0])return o.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const b=c.slice(1);if(4!==b.length||b.some(C=>"number"!=typeof C||C<0||C>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(d=o.parse(d,2,He),!d)return null;const _=[];let v=null;"interpolate-hcl"===a||"interpolate-lab"===a?v=V:o.expectedType&&"value"!==o.expectedType.kind&&(v=o.expectedType);for(let b=0;b<p.length;b+=2){const C=p[b],M=p[b+1],I=b+3,R=b+4;if("number"!=typeof C)return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(_.length&&_[_.length-1][0]>=C)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const L=o.parse(M,R,v);if(!L)return null;v=v||L.type,_.push([C,L])}return"number"===v.kind||"color"===v.kind||"array"===v.kind&&"number"===v.itemType.kind&&"number"==typeof v.N?new Fi(v,a,c,d,_):o.error(`Type ${nt(v)} is not interpolatable.`)}evaluate(e){const o=this.labels,a=this.outputs;if(1===o.length)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=o[0])return a[0].evaluate(e);const d=o.length;if(c>=o[d-1])return a[d-1].evaluate(e);const p=ss(o,c),_=Fi.interpolationFactor(this.interpolation,c,o[p],o[p+1]),v=a[p].evaluate(e),b=a[p+1].evaluate(e);return"interpolate"===this.operator?Ws[this.type.kind.toLowerCase()](v,b,_):"interpolate-hcl"===this.operator?$n.reverse($n.interpolate($n.forward(v),$n.forward(b),_)):ii.reverse(ii.interpolate(ii.forward(v),ii.forward(b),_))}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)o.push(this.labels[a],this.outputs[a].serialize());return o}}function Ki(n,e,o,a){const c=a-o,d=n-o;return 0===c?0:1===e?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}var Yr=Fi;class Xs{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let a=null;const c=o.expectedType;c&&"value"!==c.kind&&(a=c);const d=[];for(const _ of e.slice(1)){const v=o.parse(_,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!v)return null;a=a||v.type,d.push(v)}const p=c&&d.some(_=>zt(c,_.type));return new Xs(p?ce:a,d)}evaluate(e){let o,a=null,c=0;for(const d of this.args){if(c++,a=d.evaluate(e),a&&a instanceof Hi&&!a.available&&(o||(o=a),a=null,c===this.args.length))return o;if(null!==a)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(o=>{e.push(o.serialize())}),e}}var Wl=Xs;class xa{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if("string"!=typeof p)return o.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return o.error("Variable names must contain only alphanumeric characters or '_'.",d);const _=o.parse(e[d+1],d+1);if(!_)return null;a.push([p,_])}const c=o.parse(e[e.length-1],e.length-1,o.expectedType,a);return c?new xa(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[o,a]of this.bindings)e.push(o,a.serialize());return e.push(this.result.serialize()),e}}var Am=xa;class zf{constructor(e,o,a){this.type=e,this.index=o,this.input=a}static parse(e,o){if(3!==e.length)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=o.parse(e[1],1,He),c=o.parse(e[2],2,Le(o.expectedType||ce));return a&&c?new zf(c.type.itemType,a,c):null}evaluate(e){const o=this.index.evaluate(e),a=this.input.evaluate(e);if(o<0)throw new ui(`Array index out of bounds: ${o} < 0.`);if(o>=a.length)throw new ui(`Array index out of bounds: ${o} > ${a.length-1}.`);if(o!==Math.floor(o))throw new ui(`Array index must be an integer, but found ${o} instead.`);return a[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ni=zf;class Zt{constructor(e,o){this.type=P,this.needle=e,this.haystack=o}static parse(e,o){if(3!==e.length)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=o.parse(e[1],1,ce),c=o.parse(e[2],2,ce);return a&&c?Rt(a.type,[P,Mn,He,ha,ce])?new Zt(a,c):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${nt(a.type)} instead`):null}evaluate(e){const o=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(null==a)return!1;if(!$e(o,["boolean","string","number","null"]))throw new ui(`Expected first argument to be of type boolean, string, number or null, but found ${nt(Ci(o))} instead.`);if(!$e(a,["string","array"]))throw new ui(`Expected second argument to be of type array or string, but found ${nt(Ci(a))} instead.`);return a.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var jn=Zt;class kr{constructor(e,o,a){this.type=He,this.needle=e,this.haystack=o,this.fromIndex=a}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=o.parse(e[1],1,ce),c=o.parse(e[2],2,ce);if(!a||!c)return null;if(!Rt(a.type,[P,Mn,He,ha,ce]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${nt(a.type)} instead`);if(4===e.length){const d=o.parse(e[3],3,He);return d?new kr(a,c,d):null}return new kr(a,c)}evaluate(e){const o=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!$e(o,["boolean","string","number","null"]))throw new ui(`Expected first argument to be of type boolean, string, number or null, but found ${nt(Ci(o))} instead.`);if(!$e(a,["string","array"]))throw new ui(`Expected second argument to be of type array or string, but found ${nt(Ci(a))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return a.indexOf(o,c)}return a.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ys=kr;class wl{constructor(e,o,a,c,d,p){this.inputType=e,this.type=o,this.input=a,this.cases=c,this.outputs=d,this.otherwise=p}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let a,c;o.expectedType&&"value"!==o.expectedType.kind&&(c=o.expectedType);const d={},p=[];for(let b=2;b<e.length-1;b+=2){let C=e[b];const M=e[b+1];Array.isArray(C)||(C=[C]);const I=o.concat(b);if(0===C.length)return I.error("Expected at least one branch label.");for(const L of C){if("number"!=typeof L&&"string"!=typeof L)return I.error("Branch labels must be numbers or strings.");if("number"==typeof L&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof L&&Math.floor(L)!==L)return I.error("Numeric branch labels must be integer values.");if(a){if(I.checkSubtype(a,Ci(L)))return null}else a=Ci(L);if(void 0!==d[String(L)])return I.error("Branch labels must be unique.");d[String(L)]=p.length}const R=o.parse(M,b,c);if(!R)return null;c=c||R.type,p.push(R)}const _=o.parse(e[1],1,ce);if(!_)return null;const v=o.parse(e[e.length-1],e.length-1,c);return v?"value"!==_.type.kind&&o.concat(1).checkSubtype(a,_.type)?null:new wl(a,c,_,d,p,v):null}evaluate(e){const o=this.input.evaluate(e);return(Ci(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),a=[],c={};for(const p of o){const _=c[this.cases[p]];void 0===_?(c[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[_][1].push(p)}const d=p=>"number"===this.inputType.kind?Number(p):p;for(const[p,_]of a)e.push(1===_.length?d(_[0]):_.map(d)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var ko=wl;class bo{constructor(e,o,a){this.type=e,this.branches=o,this.otherwise=a}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let a;o.expectedType&&"value"!==o.expectedType.kind&&(a=o.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const _=o.parse(e[p],p,P);if(!_)return null;const v=o.parse(e[p+1],p+1,a);if(!v)return null;c.push([_,v]),a=a||v.type}const d=o.parse(e[e.length-1],e.length-1,a);return d?new bo(a,c,d):null}evaluate(e){for(const[o,a]of this.branches)if(o.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[o,a]of this.branches)e(o),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(o=>{e.push(o.serialize())}),e}}var Zi=bo;class Js{constructor(e,o,a,c){this.type=e,this.input=o,this.beginIndex=a,this.endIndex=c}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=o.parse(e[1],1,ce),c=o.parse(e[2],2,He);if(!a||!c)return null;if(!Rt(a.type,[Le(ce),Mn,ce]))return o.error(`Expected first argument to be of type array or string, but found ${nt(a.type)} instead`);if(4===e.length){const d=o.parse(e[3],3,He);return d?new Js(a.type,a,c,d):null}return new Js(a.type,a,c)}evaluate(e){const o=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!$e(o,["string","array"]))throw new ui(`Expected first argument to be of type array or string, but found ${nt(Ci(o))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return o.slice(a,c)}return o.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var gu=Js;function Nn(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function _u(n,e,o,a){return 0===a.compare(e,o)}function Sc(n,e,o){const a="=="!==n&&"!="!==n;return class C2{constructor(d,p,_){this.type=P,this.lhs=d,this.rhs=p,this.collator=_,this.hasUntypedArgument="value"===d.type.kind||"value"===p.type.kind}static parse(d,p){if(3!==d.length&&4!==d.length)return p.error("Expected two or three arguments.");const _=d[0];let v=p.parse(d[1],1,ce);if(!v)return null;if(!Nn(_,v.type))return p.concat(1).error(`"${_}" comparisons are not supported for type '${nt(v.type)}'.`);let b=p.parse(d[2],2,ce);if(!b)return null;if(!Nn(_,b.type))return p.concat(2).error(`"${_}" comparisons are not supported for type '${nt(b.type)}'.`);if(v.type.kind!==b.type.kind&&"value"!==v.type.kind&&"value"!==b.type.kind)return p.error(`Cannot compare types '${nt(v.type)}' and '${nt(b.type)}'.`);a&&("value"===v.type.kind&&"value"!==b.type.kind?v=new fn(b.type,[v]):"value"!==v.type.kind&&"value"===b.type.kind&&(b=new fn(v.type,[b])));let C=null;if(4===d.length){if("string"!==v.type.kind&&"string"!==b.type.kind&&"value"!==v.type.kind&&"value"!==b.type.kind)return p.error("Cannot use collator to compare non-string types.");if(C=p.parse(d[3],3,xe),!C)return null}return new C2(v,b,C)}evaluate(d){const p=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const v=Ci(p),b=Ci(_);if(v.kind!==b.kind||"string"!==v.kind&&"number"!==v.kind)throw new ui(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${v.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const v=Ci(p),b=Ci(_);if("string"!==v.kind||"string"!==b.kind)return e(d,p,_)}return this.collator?o(d,p,_,this.collator.evaluate(d)):e(d,p,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(p=>{d.push(p.serialize())}),d}}}const Ic=Sc("==",function(n,e,o){return e===o},_u),Si=Sc("!=",function(n,e,o){return e!==o},function(n,e,o,a){return!_u(0,e,o,a)}),yu=Sc("<",function(n,e,o){return e<o},function(n,e,o,a){return a.compare(e,o)<0}),vu=Sc(">",function(n,e,o){return e>o},function(n,e,o,a){return a.compare(e,o)>0}),Ii=Sc("<=",function(n,e,o){return e<=o},function(n,e,o,a){return a.compare(e,o)<=0}),ah=Sc(">=",function(n,e,o){return e>=o},function(n,e,o,a){return a.compare(e,o)>=0});class pd{constructor(e,o,a,c,d,p){this.type=Mn,this.number=e,this.locale=o,this.currency=a,this.unit=c,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,o){if(3!==e.length)return o.error("Expected two arguments.");const a=o.parse(e[1],1,He);if(!a)return null;const c=e[2];if("object"!=typeof c||Array.isArray(c))return o.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=o.parse(c.locale,1,Mn),!d))return null;let p=null;if(c.currency&&(p=o.parse(c.currency,1,Mn),!p))return null;let _=null;if(c.unit&&(_=o.parse(c.unit,1,Mn),!_))return null;let v=null;if(c["min-fraction-digits"]&&(v=o.parse(c["min-fraction-digits"],1,He),!v))return null;let b=null;return c["max-fraction-digits"]&&(b=o.parse(c["max-fraction-digits"],1,He),!b)?null:new pd(a,d,p,_,v,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Xa{constructor(e){this.type=He,this.input=e}static parse(e,o){if(2!==e.length)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=o.parse(e[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?o.error(`Expected argument of type string or array, but found ${nt(a.type)} instead.`):new Xa(a):null}evaluate(e){const o=this.input.evaluate(e);if("string"==typeof o||Array.isArray(o))return o.length;throw new ui(`Expected value to be of type string or array, but found ${nt(Ci(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(o=>{e.push(o.serialize())}),e}}function Ss(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Ac={"==":Ic,"!=":Si,">":vu,"<":yu,">=":ah,"<=":Ii,array:fn,at:Ni,boolean:fn,case:Zi,coalesce:Wl,collator:da,format:cu,image:vc,in:jn,"index-of":Ys,interpolate:Yr,"interpolate-hcl":Yr,"interpolate-lab":Yr,length:Xa,let:Am,literal:pl,match:ko,number:fn,"number-format":pd,object:fn,slice:gu,step:Mi,string:fn,"to-boolean":Ji,"to-color":Ji,"to-number":Ji,"to-string":Ji,var:Zo,within:du,distance:Bt};function Xl(n,[e,o,a,c]){e=e.evaluate(n),o=o.evaluate(n),a=a.evaluate(n);const d=c?c.evaluate(n):1,p=Nf(e,o,a,d);if(p)throw new ui(p);return new un(e/255*d,o/255*d,a/255*d,d)}function sr(n,[e,o,a,c]){e=e.evaluate(n),o=o.evaluate(n),a=a.evaluate(n);const d=c?c.evaluate(n):1,p=(C=o,M=a,I=d,"number"==typeof(b=e)&&b>=0&&b<=360?"number"==typeof C&&C>=0&&C<=100&&"number"==typeof M&&M>=0&&M<=100?void 0===I||"number"==typeof I&&I>=0&&I<=1?null:`Invalid hsla value [${[b,C,M,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof I?[b,C,M,I]:[b,C,M]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof I?[b,C,M,I]:[b,C,M]).join(", ")}]: 'h' must be between 0 and 360.`);var b,C,M,I;if(p)throw new ui(p);const _=`hsla(${e}, ${o}%, ${a}%, ${d})`,v=un.parse(_);if(!v)throw new ui(`Failed to parse HSLA color: ${_}`);return v}function j_(n,e){return n in e}function El(n,e){const o=e[n];return void 0===o?null:o}function Bf(n,e){switch(n){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return un.parse(e)}return e}function ba(n,e,o,a){return void 0!==a&&(n=a*Math.round(n/a)),void 0!==e&&n<e&&(n=e),void 0!==o&&n>o&&(n=o),n}function xu(n,e,o){e=[e,o,n.scope].filter(Boolean).join("\x1f");const a=n.getConfig(e);if(!a)return null;const{type:c,value:d,values:p,minValue:_,maxValue:v,stepValue:b}=a,C=a.default.evaluate(n);let M=C;if(d){const I=n.scope;n.scope=(I||"").split("\x1f").slice(1).join("\x1f"),M=d.evaluate(n),n.scope=I}return c&&(M=Bf(c,M)),void 0!==d&&void 0!==M&&p&&!p.includes(M)&&(M=C,c&&(M=Bf(c,M))),void 0===M||void 0===_&&void 0===v&&void 0===b||("number"==typeof M?M=ba(M,_,v,b):Array.isArray(M)&&(M=M.map(I=>"number"==typeof I?ba(I,_,v,b):I))),M}function Is(n){return{type:n}}xo.register(Ac,{error:[{kind:"error"},[Mn],(n,[e])=>{throw new ui(e.evaluate(n))}],typeof:[Mn,[ce],(n,[e])=>nt(Ci(e.evaluate(n)))],"to-rgba":[Le(He,4),[V],(n,[e])=>e.evaluate(n).toArray()],rgb:[V,[He,He,He],Xl],rgba:[V,[He,He,He,He],Xl],hsl:[V,[He,He,He],sr],hsla:[V,[He,He,He,He],sr],has:{type:P,overloads:[[[Mn],(n,[e])=>j_(e.evaluate(n),n.properties())],[[Mn,te],(n,[e,o])=>j_(e.evaluate(n),o.evaluate(n))]]},get:{type:ce,overloads:[[[Mn],(n,[e])=>El(e.evaluate(n),n.properties())],[[Mn,te],(n,[e,o])=>El(e.evaluate(n),o.evaluate(n))]]},config:{type:ce,overloads:[[[Mn],(n,[e])=>xu(n,e.evaluate(n))],[[Mn,Mn],(n,[e,o])=>xu(n,e.evaluate(n),o.evaluate(n))]]},"feature-state":[ce,[Mn],(n,[e])=>El(e.evaluate(n),n.featureState||{})],properties:[te,[],n=>n.properties()],"geometry-type":[Mn,[],n=>n.geometryType()],id:[ce,[],n=>n.id()],zoom:[He,[],n=>n.globals.zoom],pitch:[He,[],n=>n.globals.pitch||0],"distance-from-center":[He,[],n=>n.distanceFromCenter()],"measure-light":[He,[Mn],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[He,[],n=>n.globals.heatmapDensity||0],"line-progress":[He,[],n=>n.globals.lineProgress||0],"raster-value":[He,[],n=>n.globals.rasterValue||0],"sky-radial-progress":[He,[],n=>n.globals.skyRadialProgress||0],accumulated:[ce,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[He,Is(He),(n,e)=>{let o=0;for(const a of e)o+=a.evaluate(n);return o}],"*":[He,Is(He),(n,e)=>{let o=1;for(const a of e)o*=a.evaluate(n);return o}],"-":{type:He,overloads:[[[He,He],(n,[e,o])=>e.evaluate(n)-o.evaluate(n)],[[He],(n,[e])=>-e.evaluate(n)]]},"/":[He,[He,He],(n,[e,o])=>e.evaluate(n)/o.evaluate(n)],"%":[He,[He,He],(n,[e,o])=>e.evaluate(n)%o.evaluate(n)],ln2:[He,[],()=>Math.LN2],pi:[He,[],()=>Math.PI],e:[He,[],()=>Math.E],"^":[He,[He,He],(n,[e,o])=>Math.pow(e.evaluate(n),o.evaluate(n))],sqrt:[He,[He],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[He,[He],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[He,[He],(n,[e])=>Math.log(e.evaluate(n))],log2:[He,[He],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[He,[He],(n,[e])=>Math.sin(e.evaluate(n))],cos:[He,[He],(n,[e])=>Math.cos(e.evaluate(n))],tan:[He,[He],(n,[e])=>Math.tan(e.evaluate(n))],asin:[He,[He],(n,[e])=>Math.asin(e.evaluate(n))],acos:[He,[He],(n,[e])=>Math.acos(e.evaluate(n))],atan:[He,[He],(n,[e])=>Math.atan(e.evaluate(n))],min:[He,Is(He),(n,e)=>Math.min(...e.map(o=>o.evaluate(n)))],max:[He,Is(He),(n,e)=>Math.max(...e.map(o=>o.evaluate(n)))],abs:[He,[He],(n,[e])=>Math.abs(e.evaluate(n))],round:[He,[He],(n,[e])=>{const o=e.evaluate(n);return o<0?-Math.round(-o):Math.round(o)}],floor:[He,[He],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[He,[He],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[P,[Mn,ce],(n,[e,o])=>n.properties()[e.value]===o.value],"filter-id-==":[P,[ce],(n,[e])=>n.id()===e.value],"filter-type-==":[P,[Mn],(n,[e])=>n.geometryType()===e.value],"filter-<":[P,[Mn,ce],(n,[e,o])=>{const a=n.properties()[e.value],c=o.value;return typeof a==typeof c&&a<c}],"filter-id-<":[P,[ce],(n,[e])=>{const o=n.id(),a=e.value;return typeof o==typeof a&&o<a}],"filter->":[P,[Mn,ce],(n,[e,o])=>{const a=n.properties()[e.value],c=o.value;return typeof a==typeof c&&a>c}],"filter-id->":[P,[ce],(n,[e])=>{const o=n.id(),a=e.value;return typeof o==typeof a&&o>a}],"filter-<=":[P,[Mn,ce],(n,[e,o])=>{const a=n.properties()[e.value],c=o.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[P,[ce],(n,[e])=>{const o=n.id(),a=e.value;return typeof o==typeof a&&o<=a}],"filter->=":[P,[Mn,ce],(n,[e,o])=>{const a=n.properties()[e.value],c=o.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[P,[ce],(n,[e])=>{const o=n.id(),a=e.value;return typeof o==typeof a&&o>=a}],"filter-has":[P,[ce],(n,[e])=>e.value in n.properties()],"filter-has-id":[P,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[P,[Le(Mn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[P,[Le(ce)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[P,[Mn,Le(ce)],(n,[e,o])=>o.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[P,[Mn,Le(ce)],(n,[e,o])=>function(a,c,d,p){for(;d<=p;){const _=d+p>>1;if(c[_]===a)return!0;c[_]>a?p=_-1:d=_+1}return!1}(n.properties()[e.value],o.value,0,o.value.length-1)],all:{type:P,overloads:[[[P,P],(n,[e,o])=>e.evaluate(n)&&o.evaluate(n)],[Is(P),(n,e)=>{for(const o of e)if(!o.evaluate(n))return!1;return!0}]]},any:{type:P,overloads:[[[P,P],(n,[e,o])=>e.evaluate(n)||o.evaluate(n)],[Is(P),(n,e)=>{for(const o of e)if(o.evaluate(n))return!0;return!1}]]},"!":[P,[P],(n,[e])=>!e.evaluate(n)],"is-supported-script":[P,[Mn],(n,[e])=>{const o=n.globals&&n.globals.isSupportedScript;return!o||o(e.evaluate(n))}],upcase:[Mn,[Mn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Mn,[Mn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Mn,Is(ce),(n,e)=>e.map(o=>yc(o.evaluate(n))).join("")],"resolved-locale":[Mn,[xe],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[He,[He,He,ce],(n,e)=>{const[o,a,c]=e.map(p=>p.evaluate(n));if(o>a||o===a)return o;let d;if("string"==typeof c)d=function(p){let _=0;if(0===p.length)return _;for(let v=0;v<p.length;v++)_=(_<<5)-_+p.charCodeAt(v),_&=_;return _}(c);else{if("number"!=typeof c)throw new ui(`Invalid seed input: ${c}`);d=c}return o+Ss(d)()*(a-o)}]});var Cl=Ac;function Jr(n){return{result:"success",value:n}}function Pc(n){return{result:"error",value:n}}function Wo(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function zi(n){return"data-driven"===n["property-type"]}function Rc(n){return Wo(n.expression,"measure-light")}function Tl(n){return Wo(n.expression,"zoom")}function bu(n){return!!n.expression&&n.expression.interpolated}function ls(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function Vf(n){return n}function Pm(n,e){const o="color"===e.type,a=n.stops&&"object"==typeof n.stops[0][0],c=a||!(a||void 0!==n.property),d=n.type||(bu(e)?"exponential":"interval");if(o&&((n=ws({},n)).stops&&(n.stops=n.stops.map(b=>[b[0],un.parse(b[1])])),n.default=un.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!Di[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let p,_,v;if("exponential"===d)p=lh;else if("interval"===d)p=As;else if("categorical"===d){p=jf,_=Object.create(null);for(const b of n.stops)_[b[0]]=b[1];v=typeof n.stops[0][0]}else{if("identity"!==d)throw new Error(`Unknown function type "${d}"`);p=A0}if(a){const b={},C=[];for(let R=0;R<n.stops.length;R++){const L=n.stops[R],F=L[0].zoom;void 0===b[F]&&(b[F]={zoom:F,type:n.type,property:n.property,default:n.default,stops:[]},C.push(F)),b[F].stops.push([L[0].value,L[1]])}const M=[];for(const R of C)M.push([b[R].zoom,Pm(b[R],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Yr.interpolationFactor.bind(void 0,I),zoomStops:M.map(R=>R[0]),evaluate:({zoom:R},L)=>lh({stops:M,base:n.base},e,R).evaluate(R,L)}}if(c){const b="exponential"===d?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Yr.interpolationFactor.bind(void 0,b),zoomStops:n.stops.map(C=>C[0]),evaluate:({zoom:C})=>p(n,e,C,_,v)}}return{kind:"source",evaluate(b,C){const M=C&&C.properties?C.properties[n.property]:void 0;return void 0===M?Yl(n.default,e.default):p(n,e,M,_,v)}}}function Yl(n,e,o){return void 0!==n?n:void 0!==e?e:void 0!==o?o:void 0}function jf(n,e,o,a,c){return Yl(typeof o===c?a[o]:void 0,n.default,e.default)}function As(n,e,o){if("number"!==Kn(o))return Yl(n.default,e.default);const a=n.stops.length;if(1===a||o<=n.stops[0][0])return n.stops[0][1];if(o>=n.stops[a-1][0])return n.stops[a-1][1];const c=ss(n.stops.map(d=>d[0]),o);return n.stops[c][1]}function lh(n,e,o){const a=void 0!==n.base?n.base:1;if("number"!==Kn(o))return Yl(n.default,e.default);const c=n.stops.length;if(1===c||o<=n.stops[0][0])return n.stops[0][1];if(o>=n.stops[c-1][0])return n.stops[c-1][1];const d=ss(n.stops.map(C=>C[0]),o),p=function(C,M,I,R){const L=R-I,F=C-I;return 0===L?0:1===M?F/L:(Math.pow(M,F)-1)/(Math.pow(M,L)-1)}(o,a,n.stops[d][0],n.stops[d+1][0]),_=n.stops[d][1],v=n.stops[d+1][1];let b=Ws[e.type]||Vf;if(n.colorSpace&&"rgb"!==n.colorSpace){const C=Di[n.colorSpace];b=(M,I)=>C.reverse(C.interpolate(C.forward(M),C.forward(I),p))}return"function"==typeof _.evaluate?{evaluate(...C){const M=_.evaluate.apply(void 0,C),I=v.evaluate.apply(void 0,C);if(void 0!==M&&void 0!==I)return b(M,I,p)}}:b(_,v,p)}function A0(n,e,o){return"color"===e.type?o=un.parse(o):"formatted"===e.type?o=rr.fromString(o.toString()):"resolvedImage"===e.type?o=Hi.fromString(o.toString()):Kn(o)===e.type||"enum"===e.type&&e.values[o]||(o=void 0),Yl(o,n.default,e.default)}class Rm{constructor(e,o,a,c){var d;this.expression=e,this._warningHistory={},this._evaluator=new xc(a,c),this._defaultValue=o?"color"===(d=o).type&&(ls(d.default)||Array.isArray(d.default))?new un(0,0,0,0):"color"===d.type?un.parse(d.default)||null:void 0===d.default?null:d.default:null,this._enumValues=o&&"enum"===o.type?o.values:null}evaluateWithoutErrorHandling(e,o,a,c,d,p,_,v){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,o,a,c,d,p,_,v){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=v||null;try{const b=this.expression.evaluate(this._evaluator);if(null==b||"number"==typeof b&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new ui(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Uf(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in Cl}function md(n,e,o,a){const c=new Ti(Cl,[],e?function(p){const _={color:V,string:Mn,number:He,enum:Mn,boolean:P,formatted:we,resolvedImage:Te};return"array"===p.type?Le(_[p.value]||ce,p.length):_[p.type]}(e):void 0,void 0,void 0,o,a),d=c.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return d?Jr(new Rm(d,e,o,a)):Pc(c.errors)}class gd{constructor(e,o,a){this.kind=e,this._styleExpression=o,this.isLightConstant=a,this.isStateDependent="constant"!==e&&!Fn(o.expression),this.isConfigDependent=!Hn(o.expression)}evaluateWithoutErrorHandling(e,o,a,c,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,o,a,c,d,p)}evaluate(e,o,a,c,d,p){return this._styleExpression.evaluate(e,o,a,c,d,p)}}class _d{constructor(e,o,a,c,d){this.kind=e,this.zoomStops=a,this._styleExpression=o,this.isStateDependent="camera"!==e&&!Fn(o.expression),this.isLightConstant=d,this.isConfigDependent=!Hn(o.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,o,a,c,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,o,a,c,d,p)}evaluate(e,o,a,c,d,p){return this._styleExpression.evaluate(e,o,a,c,d,p)}interpolationFactor(e,o,a){return this.interpolationType?Yr.interpolationFactor(this.interpolationType,e,o,a):0}}function yd(n,e,o,a){if("error"===(n=md(n,e,o,a)).result)return n;const c=n.value.expression,d=an(c);if(!d&&!zi(e))return Pc([new mi("","data expressions not supported")]);const p=Mr(c,["zoom","pitch","distance-from-center"]);if(!p&&!Tl(e))return Pc([new mi("","zoom expressions not supported")]);const _=Mr(c,["measure-light"]);if(!_&&!Rc(e))return Pc([new mi("","measure-light expression not supported")]);const v=e.expression&&e.expression.relaxZoomRestriction,b=Gf(c);return b||p||v?b instanceof mi?Pc([b]):b instanceof Yr&&!bu(e)?Pc([new mi("",'"interpolate" expressions cannot be used with this property')]):Jr(b?new _d(d?"camera":"composite",n.value,b.labels,b instanceof Yr?b.interpolation:void 0,_):new gd(d?"constant":"source",n.value,_)):Pc([new mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class $f{constructor(e,o){this._parameters=e,this._specification=o,ws(this,Pm(this._parameters,this._specification))}static deserialize(e){return new $f(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Gf(n){let e=null;if(n instanceof Am)e=Gf(n.result);else if(n instanceof Wl){for(const o of n.args)if(e=Gf(o),e)break}else(n instanceof Mi||n instanceof Yr)&&n.input instanceof xo&&"zoom"===n.input.name&&(e=n);return e instanceof mi||n.eachChild(o=>{const a=Gf(o);a instanceof mi?e=a:e&&a&&e!==a&&(e=new mi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ps(n){const e=n.key,o=n.value,a=n.valueSpec||{},c=n.objectElementValidators||{},d=n.style,p=n.styleSpec;let _=[];const v=Kn(o);if("object"!==v)return[new Pt(e,o,`object expected, ${v} found`)];for(const b in o){const C=b.split(".")[0];let M;c[C]?M=c[C]:a[C]?M=Bi:c["*"]?M=c["*"]:a["*"]&&(M=Bi),M?_=_.concat(M({key:(e&&`${e}.`)+b,value:o[b],valueSpec:a[C]||a["*"],style:d,styleSpec:p,object:o,objectKey:b},o)):_.push(new bs(e,o[b],`unknown property "${b}"`))}for(const b in a)c[b]||a[b].required&&void 0===a[b].default&&void 0===o[b]&&_.push(new Pt(e,o,`missing required property "${b}"`));return _}function U_(n){const e=n.value,o=n.valueSpec,a=n.style,c=n.styleSpec,d=n.key,p=n.arrayElementValidator||Bi;if("array"!==Kn(e))return[new Pt(d,e,`array expected, ${Kn(e)} found`)];if(o.length&&e.length!==o.length)return[new Pt(d,e,`array length ${o.length} expected, length ${e.length} found`)];if(o["min-length"]&&e.length<o["min-length"])return[new Pt(d,e,`array length at least ${o["min-length"]} expected, length ${e.length} found`)];let _={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};c.$version<7&&(_.function=o.function),"object"===Kn(o.value)&&(_=o.value);let v=[];for(let b=0;b<e.length;b++)v=v.concat(p({array:e,arrayIndex:b,value:e[b],valueSpec:_,style:a,styleSpec:c,key:`${d}[${b}]`},!0));return v}function Om(n){const e=n.key,o=n.value,a=n.valueSpec;let c=Kn(o);if("number"===c&&o!=o&&(c="NaN"),"number"!==c)return[new Pt(e,o,`number expected, ${c} found`)];if("minimum"in a){let d=a.minimum;if("array"===Kn(a.minimum)&&(d=a.minimum[n.arrayIndex]),o<d)return[new Pt(e,o,`${o} is less than the minimum value ${d}`)]}if("maximum"in a){let d=a.maximum;if("array"===Kn(a.maximum)&&(d=a.maximum[n.arrayIndex]),o>d)return[new Pt(e,o,`${o} is greater than the maximum value ${d}`)]}return[]}function vd(n){const e=n.valueSpec,o=pi(n.value.type);let a,c,d,p={};const _="categorical"!==o&&void 0===n.value.property,v=!_,b="array"===Kn(n.value.stops)&&"array"===Kn(n.value.stops[0])&&"object"===Kn(n.value.stops[0][0]),C=Ps({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(R){if("identity"===o)return[new Pt(R.key,R.value,'identity function may not have a "stops" property')];let L=[];const F=R.value;return L=L.concat(U_({key:R.key,value:F,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:M})),"array"===Kn(F)&&0===F.length&&L.push(new Pt(R.key,F,"array must have at least one stop")),L},default:function(R){return Bi({key:R.key,value:R.value,valueSpec:e,style:R.style,styleSpec:R.styleSpec})}}});return"identity"===o&&_&&C.push(new Pt(n.key,n.value,'missing required property "property"')),"identity"===o||n.value.stops||C.push(new Pt(n.key,n.value,'missing required property "stops"')),"exponential"===o&&n.valueSpec.expression&&!bu(n.valueSpec)&&C.push(new Pt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(v&&!zi(n.valueSpec)?C.push(new Pt(n.key,n.value,"property functions not supported")):_&&!Tl(n.valueSpec)&&C.push(new Pt(n.key,n.value,"zoom functions not supported"))),"categorical"!==o&&!b||void 0!==n.value.property||C.push(new Pt(n.key,n.value,'"property" property is required')),C;function M(R){let L=[];const F=R.value,B=R.key;if("array"!==Kn(F))return[new Pt(B,F,`array expected, ${Kn(F)} found`)];if(2!==F.length)return[new Pt(B,F,`array length 2 expected, length ${F.length} found`)];if(b){if("object"!==Kn(F[0]))return[new Pt(B,F,`object expected, ${Kn(F[0])} found`)];if(void 0===F[0].zoom)return[new Pt(B,F,"object stop key must have zoom")];if(void 0===F[0].value)return[new Pt(B,F,"object stop key must have value")];const U=pi(F[0].zoom);if("number"!=typeof U)return[new Pt(B,F[0].zoom,"stop zoom values must be numbers")];if(d&&d>U)return[new Pt(B,F[0].zoom,"stop zoom values must appear in ascending order")];U!==d&&(d=U,c=void 0,p={}),L=L.concat(Ps({key:`${B}[0]`,value:F[0],valueSpec:{zoom:{}},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Om,value:I}}))}else L=L.concat(I({key:`${B}[0]`,value:F[0],valueSpec:{},style:R.style,styleSpec:R.styleSpec},F));return Uf(Vr(F[1]))?L.concat([new Pt(`${B}[1]`,F[1],"expressions are not allowed in function stops.")]):L.concat(Bi({key:`${B}[1]`,value:F[1],valueSpec:e,style:R.style,styleSpec:R.styleSpec}))}function I(R,L){const F=Kn(R.value),B=pi(R.value),U=null!==R.value?R.value:L;if(a){if(F!==a)return[new Pt(R.key,U,`${F} stop domain type must match previous stop domain type ${a}`)]}else a=F;if("number"!==F&&"string"!==F&&"boolean"!==F&&"number"!=typeof B&&"string"!=typeof B&&"boolean"!=typeof B)return[new Pt(R.key,U,"stop domain value must be a number, string, or boolean")];if("number"!==F&&"categorical"!==o){let Y=`number expected, ${F} found`;return zi(e)&&void 0===o&&(Y+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(R.key,U,Y)]}return"categorical"!==o||"number"!==F||"number"==typeof B&&isFinite(B)&&Math.floor(B)===B?"categorical"!==o&&"number"===F&&"number"==typeof B&&"number"==typeof c&&void 0!==c&&B<c?[new Pt(R.key,U,"stop domain values must appear in ascending order")]:(c=B,"categorical"===o&&B in p?[new Pt(R.key,U,"stop domain values must be unique")]:(p[B]=!0,[])):[new Pt(R.key,U,`integer expected, found ${String(B)}`)]}}function Jl(n){const e=("property"===n.expressionContext?yd:md)(Vr(n.value),n.valueSpec);if("error"===e.result)return e.value.map(a=>new Pt(`${n.key}${a.key}`,n.value,a.message));const o=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!o.outputDefined())return[new Pt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!Fn(o))return[new Pt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return Hf(o,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Mr(o,["zoom","feature-state"]))return[new Pt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!an(o))return[new Pt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hf(n,e){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)o.delete(c);if(0===o.size)return[];const a=[];return n instanceof xo&&o.has(n.name)?[new Pt(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(c=>{a.push(...Hf(c,e))}),a)}function wu(n){const e=n.key,o=n.value,a=n.valueSpec,c=[];return Array.isArray(a.values)?-1===a.values.indexOf(pi(o))&&c.push(new Pt(e,o,`expected one of [${a.values.join(", ")}], ${JSON.stringify(o)} found`)):-1===Object.keys(a.values).indexOf(pi(o))&&c.push(new Pt(e,o,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(o)} found`)),c}function qf(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!qf(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ya(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};qf(n)||(n=ch(n));const o=n;let a=!0;try{a=function(b){if(!Oc(b))return b;let C=Vr(b);return $_(C),C=Ja(C),C}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(o,null,2)}\n        `)}const c=De[`filter_${e}`],d=md(a,c);let p=null;if("error"===d.result)throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));p=(b,C,M)=>d.value.evaluate(b,C,{},M);let _=null,v=null;if(a!==o){const b=md(o,c);if("error"===b.result)throw new Error(b.value.map(C=>`${C.key}: ${C.message}`).join(", "));_=(C,M,I,R,L)=>b.value.evaluate(C,M,{},I,void 0,void 0,R,L),v=!an(b.value.expression)}return{filter:p,dynamicFilter:_||void 0,needGeometry:Rs(a),needFeature:!!v}}function Ja(n){if(!Array.isArray(n))return n;const e=function(o){if(wo.has(o[0]))for(let a=1;a<o.length;a++)if(Oc(o[a]))return!0;return o}(n);return!0===e?e:e.map(o=>Ja(o))}function $_(n){let e=!1;const o=[];if("case"===n[0]){for(let a=1;a<n.length-1;a+=2)e=e||Oc(n[a]),o.push(n[a+1]);o.push(n[n.length-1])}else if("match"===n[0]){e=e||Oc(n[1]);for(let a=2;a<n.length-1;a+=2)o.push(n[a+1]);o.push(n[n.length-1])}else if("step"===n[0]){e=e||Oc(n[1]);for(let a=1;a<n.length-1;a+=2)o.push(n[a+1])}e&&(n.length=0,n.push("any",...o));for(let a=1;a<n.length;a++)$_(n[a])}function Oc(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let o=1;o<n.length;o++)if(Oc(n[o]))return!0;return!1}const wo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function xd(n,e){return n<e?-1:n>e?1:0}function Rs(n){if(!Array.isArray(n))return!1;if("within"===n[0]||"distance"===n[0])return!0;for(let e=1;e<n.length;e++)if(Rs(n[e]))return!0;return!1}function ch(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?uh(n[1],n[2],"=="):"!="===e?Eu(uh(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?uh(n[1],n[2],e):"any"===e?(o=n.slice(1),["any"].concat(o.map(ch))):"all"===e?["all"].concat(n.slice(1).map(ch)):"none"===e?["all"].concat(n.slice(1).map(ch).map(Eu)):"in"===e?Zf(n[1],n.slice(2)):"!in"===e?Eu(Zf(n[1],n.slice(2))):"has"===e?Wf(n[1]):"!has"!==e||Eu(Wf(n[1]));var o}function uh(n,e,o){switch(n){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,n,e]}}function Zf(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",n,["literal",e.sort(xd)]]:["filter-in-small",n,["literal",e]]}}function Wf(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Eu(n){return["!",n]}function bd(n){return qf(Vr(n.value))?Jl(ws({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):wd(n)}function wd(n){const e=n.value,o=n.key;if("array"!==Kn(e))return[new Pt(o,e,`array expected, ${Kn(e)} found`)];const a=n.styleSpec;let c,d=[];if(e.length<1)return[new Pt(o,e,"filter array must have at least 1 element")];switch(d=d.concat(wu({key:`${o}[0]`,value:e[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),pi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===pi(e[1])&&d.push(new Pt(o,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&d.push(new Pt(o,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Kn(e[1]),"string"!==c&&d.push(new Pt(`${o}[1]`,e[1],`string expected, ${c} found`)));for(let p=2;p<e.length;p++)c=Kn(e[p]),"$type"===pi(e[1])?d=d.concat(wu({key:`${o}[${p}]`,value:e[p],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==c&&"number"!==c&&"boolean"!==c&&d.push(new Pt(`${o}[${p}]`,e[p],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)d=d.concat(wd({key:`${o}[${p}]`,value:e[p],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=Kn(e[1]),2!==e.length?d.push(new Pt(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==c&&d.push(new Pt(`${o}[1]`,e[1],`string expected, ${c} found`))}return d}function Ed(n,e){const o=n.key,a=n.style,c=n.layer,d=n.styleSpec,p=n.value,_=n.objectKey,v=d[`${e}_${n.layerType}`];if(!v)return[];const b=_.match(/^(.*)-transition$/);if("paint"===e&&b&&v[b[1]]&&v[b[1]].transition)return Bi({key:o,value:p,valueSpec:d.transition,style:a,styleSpec:d});const C=n.valueSpec||v[_];if(!C)return[new bs(o,p,`unknown property "${_}"`)];let M;if("string"===Kn(p)&&zi(C)&&!C.tokens&&(M=/^{([^}]+)}$/.exec(p))){const R=`\`{ "type": "identity", "property": ${M?JSON.stringify(M[1]):'"_"'} }\``;return[new Pt(o,p,`"${_}" does not support interpolation syntax\nUse an identity property function instead: ${R}.`)]}const I=[];if("symbol"===n.layerType)"text-field"!==_||!a||a.glyphs||a.imports||I.push(new Pt(o,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&ls(Vr(p))&&"identity"===pi(p.type)&&I.push(new Pt(o,p,'"text-font" does not support identity functions'));else if("model"===n.layerType&&"paint"===e&&c&&c.layout&&c.layout.hasOwnProperty("model-id")&&zi(C)&&(Rc(C)||Tl(C))){const R=yd(Vr(p),C),L=R.value.expression||R.value._styleExpression.expression;L&&!Mr(L,["measure-light"])&&("model-emissive-strength"===_&&an(L)&&Fn(L)||I.push(new Pt(o,p,`${_} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return I.concat(Bi({key:n.key,value:p,valueSpec:C,style:a,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:_}))}function Xf(n){return Ed(n,"paint")}function Cu(n){return Ed(n,"layout")}function Yf(n){let e=[];const o=n.value,a=n.key,c=n.style,d=n.styleSpec;o.type||o.ref||e.push(new Pt(a,o,'either "type" or "ref" is required'));let p=pi(o.type);const _=pi(o.ref);if(o.id){const v=pi(o.id);for(let b=0;b<n.arrayIndex;b++){const C=c.layers[b];pi(C.id)===v&&e.push(new Pt(a,o.id,`duplicate layer id "${o.id}", previously used at line ${C.id.__line__}`))}}if("ref"in o){let v;["type","source","source-layer","filter","layout"].forEach(b=>{b in o&&e.push(new Pt(a,o[b],`"${b}" is prohibited for ref layers`))}),c.layers.forEach(b=>{pi(b.id)===_&&(v=b)}),v?v.ref?e.push(new Pt(a,o.ref,"ref cannot reference another ref layer")):p=pi(v.type):"string"==typeof _&&e.push(new Pt(a,o.ref,`ref layer "${_}" not found`))}else if("background"!==p&&"sky"!==p&&"slot"!==p)if(o.source){const v=c.sources&&c.sources[o.source],b=v&&pi(v.type);v?"vector"===b&&"raster"===p?e.push(new Pt(a,o.source,`layer "${o.id}" requires a raster source`)):"raster"===b&&"raster"!==p?e.push(new Pt(a,o.source,`layer "${o.id}" requires a vector source`)):"vector"!==b||o["source-layer"]?"raster-dem"===b&&"hillshade"!==p?e.push(new Pt(a,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==p||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||"geojson"===b&&v.lineMetrics||e.push(new Pt(a,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Pt(a,o,`layer "${o.id}" must specify a "source-layer"`)):e.push(new Pt(a,o.source,`source "${o.source}" not found`))}else e.push(new Pt(a,o,'missing required property "source"'));return e=e.concat(Ps({key:a,value:o,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Bi({key:`${a}.type`,value:o.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,object:o,objectKey:"type"}),filter:v=>bd(ws({layerType:p},v)),layout:v=>Ps({layer:o,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>Cu(ws({layerType:p},b))}}),paint:v=>Ps({layer:o,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>Xf(ws({layerType:p,layer:o},b))}})}})),e}function Ml(n){const e=n.value,o=n.key,a=Kn(e);return"string"!==a?[new Pt(o,e,`string expected, ${a} found`)]:[]}const Dl={promoteId:function({key:n,value:e}){if("string"===Kn(e))return Ml({key:n,value:e});{const o=[];for(const a in e)o.push(...Ml({key:`${n}.${a}`,value:e[a]}));return o}}};function Lc(n){const e=n.value,o=n.key,a=n.styleSpec,c=n.style;if(!e.type)return[new Pt(o,e,'"type" is required')];const d=pi(e.type);let p=[];switch(["vector","raster","raster-dem"].includes(d)&&(e.url||e.tiles||p.push(new bs(o,e,'Either "url" or "tiles" is required.'))),d){case"vector":case"raster":case"raster-dem":return p=p.concat(Ps({key:o,value:e,valueSpec:a[`source_${d.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:Dl})),p;case"geojson":if(p=Ps({key:o,value:e,valueSpec:a.source_geojson,style:c,styleSpec:a,objectElementValidators:Dl}),e.cluster)for(const _ in e.clusterProperties){const[v,b]=e.clusterProperties[_],C="string"==typeof v?[v,["accumulated"],["get",_]]:v;p.push(...Jl({key:`${o}.${_}.map`,value:b,expressionContext:"cluster-map"})),p.push(...Jl({key:`${o}.${_}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return p;case"video":return Ps({key:o,value:e,valueSpec:a.source_video,style:c,styleSpec:a});case"image":return Ps({key:o,value:e,valueSpec:a.source_image,style:c,styleSpec:a});case"canvas":return[new Pt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wu({key:`${o}.type`,value:e.type,valueSpec:{values:Jf(a)},style:c,styleSpec:a})}}function Jf(n){return n.source.reduce((e,o)=>{const a=n[o];return"enum"===a.type.type&&(e=e.concat(Object.keys(a.type.values))),e},[])}function G_(n){const e=n.value;let o=[];if(!e)return o;const a=Kn(e);return"string"!==a?(o=o.concat([new Pt(n.key,e,`string expected, "${a}" found`)]),o):(function(c){const d=-1===c.indexOf("://");try{return new URL(c,d?"http://example.com":void 0),!0}catch{return!1}}(e)||(o=o.concat([new Pt(n.key,e,`invalid url "${e}"`)])),o)}function Lm(n){const e=n.value,o=n.styleSpec,a=o.light,c=n.style;let d=[];const p=Kn(e);if(void 0===e)return d;if("object"!==p)return d=d.concat([new Pt("light",e,`object expected, ${p} found`)]),d;for(const _ in e){const v=_.match(/^(.*)-transition$/);d=d.concat(v&&a[v[1]]&&a[v[1]].transition?Bi({key:_,value:e[_],valueSpec:o.transition,style:c,styleSpec:o}):a[_]?Bi({key:_,value:e[_],valueSpec:a[_],style:c,styleSpec:o}):[new Pt(_,e[_],`unknown property "${_}"`)])}return d}function km(n){const e=n.value;let o=[];if(!e)return o;const a=Kn(e);if("object"!==a)return o=o.concat([new Pt("light-3d",e,`object expected, ${a} found`)]),o;const c=n.styleSpec,d=c["light-3d"],p=n.key,_=n.style,v=n.style.lights;for(const M of["type","id"])if(!(M in e))return o=o.concat([new Pt("light-3d",e,`missing property ${M} on light`)]),o;if(e.type&&v)for(let M=0;M<n.arrayIndex;M++){const I=pi(e.type),R=v[M];pi(R.type)===I&&o.push(new Pt(p,e.id,`duplicate light type "${e.type}", previously defined at line ${R.id.__line__}`))}const b=`properties_light_${e.type}`;if(!(b in c))return o=o.concat([new Pt("light-3d",e,`Invalid light type ${e.type}`)]),o;const C=c[b];for(const M in e)if("properties"===M){const I=e[M],R=Kn(I);if("object"!==R)return o=o.concat([new Pt("properties",I,`object expected, ${R} found`)]),o;for(const L in I)o=o.concat(C[L]?Bi({key:L,value:I[L],valueSpec:C[L],style:_,styleSpec:c}):[new bs(n.key,I[L],`unknown property "${L}"`)])}else{const I=M.match(/^(.*)-transition$/);o=o.concat(I&&d[I[1]]&&d[I[1]].transition?Bi({key:M,value:e[M],valueSpec:c.transition,style:_,styleSpec:c}):d[M]?Bi({key:M,value:e[M],valueSpec:d[M],style:_,styleSpec:c}):[new bs(M,e[M],`unknown property "${M}"`)])}return o}function Kf(n){const e=n.value,o=n.key,a=n.style,c=n.styleSpec,d=c.terrain;let p=[];const _=Kn(e);if(void 0===e||"null"===_)return p;if("object"!==_)return p=p.concat([new Pt("terrain",e,`object expected, ${_} found`)]),p;for(const v in e){const b=v.match(/^(.*)-transition$/);p=p.concat(b&&d[b[1]]&&d[b[1]].transition?Bi({key:v,value:e[v],valueSpec:c.transition,style:a,styleSpec:c}):d[v]?Bi({key:v,value:e[v],valueSpec:d[v],style:a,styleSpec:c}):[new bs(v,e[v],`unknown property "${v}"`)])}if(e.source){const v=a.sources&&a.sources[e.source],b=v&&pi(v.type);v?"raster-dem"!==b&&p.push(new Pt(o,e.source,`terrain cannot be used with a source of type ${String(b)}, it only be used with a "raster-dem" source type`)):p.push(new Pt(o,e.source,`source "${e.source}" not found`))}else p.push(new Pt(o,e,'terrain is missing required property "source"'));return p}function Qf(n){const e=n.value,o=n.style,a=n.styleSpec,c=a.fog;let d=[];const p=Kn(e);if(void 0===e)return d;if("object"!==p)return d=d.concat([new Pt("fog",e,`object expected, ${p} found`)]),d;for(const _ in e){const v=_.match(/^(.*)-transition$/);d=d.concat(v&&c[v[1]]&&c[v[1]].transition?Bi({key:_,value:e[_],valueSpec:a.transition,style:o,styleSpec:a}):c[_]?Bi({key:_,value:e[_],valueSpec:c[_],style:o,styleSpec:a}):[new bs(_,e[_],`unknown property "${_}"`)])}return d}const ep={"*":()=>[],array:U_,boolean:function(n){const e=n.value,o=n.key,a=Kn(e);return"boolean"!==a?[new Pt(o,e,`boolean expected, ${a} found`)]:[]},number:Om,color:function(n){const e=n.key,o=n.value,a=Kn(o);return"string"!==a?[new Pt(e,o,`color expected, ${a} found`)]:null===Tr(o)?[new Pt(e,o,`color expected, "${o}" found`)]:[]},enum:wu,filter:bd,function:vd,layer:Yf,object:Ps,source:Lc,model:G_,light:Lm,"light-3d":km,terrain:Kf,fog:Qf,string:Ml,formatted:function(n){return 0===Ml(n).length?[]:Jl(n)},resolvedImage:function(n){return 0===Ml(n).length?[]:Jl(n)},projection:function(n){const e=n.value,o=n.styleSpec,a=o.projection,c=n.style;let d=[];const p=Kn(e);if("object"===p)for(const _ in e)d=d.concat(Bi({key:_,value:e[_],valueSpec:a[_],style:c,styleSpec:o}));else"string"!==p&&(d=d.concat([new Pt("projection",e,`object or string expected, ${p} found`)]));return d},import:function(n){const{value:e,styleSpec:o}=n,{data:a,...c}=e;Object.defineProperty(c,"__line__",{value:e.__line__,enumerable:!1});let d=Ps(ws({},n,{value:c,valueSpec:o.import}));return""===pi(c.id)&&d.push(new Pt(`${n.key}.id`,c,"import id can't be an empty string")),a&&(d=d.concat(Fm(a,o,{key:`${n.key}.data`}))),d}};function Bi(n,e=!1){const o=n.value,a=n.valueSpec,c=n.styleSpec;if(a.expression&&ls(pi(o)))return vd(n);if(a.expression&&Uf(Vr(o)))return Jl(n);if(a.type&&ep[a.type]){const d=ep[a.type](n);return!0===e&&d.length>0&&"array"===Kn(n.value)?Jl(n):d}return Ps(ws({},n,{valueSpec:a.type?c[a.type]:a}))}function tp(n){const e=n.value,o=n.key,a=Ml(n);return a.length||(-1===e.indexOf("{fontstack}")&&a.push(new Pt(o,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&a.push(new Pt(o,e,'"glyphs" url must include a "{range}" token'))),a}function Fm(n,e=De,o={}){return Bi({key:o.key||"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:tp,"*":()=>[]}})}function hh(n,e=De){return wa(Fm(n,e))}const P0=n=>wa(Xf(n)),R0=n=>wa(Cu(n));function wa(n){return n.slice().sort((e,o)=>e.line&&o.line?e.line-o.line:0)}function np(n,e){let o=!1;if(e&&e.length)for(const a of e)a instanceof bs?Rr(a.message):(n.fire(new $s(new Error(a.message))),o=!0);return o}var Nm=Ka,Kl=3;function Ka(n,e,o){var a=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var c=new Int32Array(this.arrayBuffer);n=c[0],this.d=(e=c[1])+2*(o=c[2]);for(var d=0;d<this.d*this.d;d++){var p=c[Kl+d],_=c[Kl+d+1];a.push(p===_?null:c.subarray(p,_))}var v=c[Kl+a.length+1];this.keys=c.subarray(c[Kl+a.length],v),this.bboxes=c.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*o;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=o,this.scale=e/n,this.uid=0;var C=o/e*n;this.min=-C,this.max=n+C}Ka.prototype.insert=function(n,e,o,a,c){this._forEachCell(e,o,a,c,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(o),this.bboxes.push(a),this.bboxes.push(c)},Ka.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ka.prototype._insertCell=function(n,e,o,a,c,d){this.cells[c].push(d)},Ka.prototype.query=function(n,e,o,a,c){var d=this.min,p=this.max;if(n<=d&&e<=d&&p<=o&&p<=a&&!c)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(n,e,o,a,this._queryCell,_,{},c),_},Ka.prototype._queryCell=function(n,e,o,a,c,d,p,_){var v=this.cells[c];if(null!==v)for(var b=this.keys,C=this.bboxes,M=0;M<v.length;M++){var I=v[M];if(void 0===p[I]){var R=4*I;(_?_(C[R+0],C[R+1],C[R+2],C[R+3]):n<=C[R+2]&&e<=C[R+3]&&o>=C[R+0]&&a>=C[R+1])?(p[I]=!0,d.push(b[I])):p[I]=!1}}},Ka.prototype._forEachCell=function(n,e,o,a,c,d,p,_){for(var v=this._convertToCellCoord(n),b=this._convertToCellCoord(e),C=this._convertToCellCoord(o),M=this._convertToCellCoord(a),I=v;I<=C;I++)for(var R=b;R<=M;R++){var L=this.d*R+I;if((!_||_(this._convertFromCellCoord(I),this._convertFromCellCoord(R),this._convertFromCellCoord(I+1),this._convertFromCellCoord(R+1)))&&c.call(this,n,e,o,a,L,d,p,_))return}},Ka.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Ka.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Ka.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=Kl+this.cells.length+1+1,o=0,a=0;a<this.cells.length;a++)o+=this.cells[a].length;var c=new Int32Array(e+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,p=0;p<n.length;p++){var _=n[p];c[Kl+p]=d,c.set(_,d),d+=_.length}return c[Kl+n.length]=d,c.set(this.keys,d),c[Kl+n.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};var Tu=yr(Nm);const dh={};function It(n,e,o={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),dh[e]={klass:n,omit:o.omit||[]}}It(Object,"Object"),Tu.serialize=function(n,e){const o=n.toArrayBuffer();return e&&e.add(o),{buffer:o}},Tu.deserialize=function(n){return new Tu(n.buffer)},Object.defineProperty(Tu,"name",{value:"Grid"}),It(Tu,"Grid"),It(un,"Color"),It(Error,"Error"),It(rr,"Formatted"),It(fl,"FormattedSection"),It(oo,"AJAXError"),It(Hi,"ResolvedImage"),It($f,"StylePropertyFunction"),It(Rm,"StyleExpression",{omit:["_evaluator"]}),It(_d,"ZoomDependentExpression"),It(gd,"ZoomConstantExpression"),It(xo,"CompoundExpression",{omit:["_evaluate"]});for(const n in Cl)dh[Cl[n]._classRegistryKey]||It(Cl[n],`Expression${n}`);function m(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function l(n){return self.ImageBitmap&&n instanceof ImageBitmap}function h(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(m(n)||l(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n)){const o=n;return e&&e.add(o.buffer),o}if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const o=[];for(const a of n)o.push(h(a,e));return o}if(n instanceof Map){const o={$name:"Map"};for(const[a,c]of n.entries())o[a]=h(c);return o}if("object"==typeof n){const o=n.constructor,a=o._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const c=o.serialize?o.serialize(n,e):{};if(!o.serialize){for(const d in n)n.hasOwnProperty(d)&&(dh[a].omit.indexOf(d)>=0||(c[d]=h(n[d],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof n)}function y(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||m(n)||l(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(y);if("object"==typeof n){const e=n.$name||"Object";if("Map"===e){const c=new Map;for(const d of Object.keys(n))"$name"!==d&&c.set(d,y(n[d]));return c}const{klass:o}=dh[e];if(!o)throw new Error(`can't deserialize unregistered class ${e}`);if(o.deserialize)return o.deserialize(n);const a=Object.create(o.prototype);for(const c of Object.keys(n))"$name"!==c&&(a[c]=y(n[c]));return a}throw new Error("can't deserialize object of type "+typeof n)}const x={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function w(n){for(const e of n)if(O(e.charCodeAt(0)))return!0;return!1}function T(n){for(const e of n)if(!S(e.charCodeAt(0)))return!1;return!0}function S(n){return!(x.Arabic(n)||x["Arabic Supplement"](n)||x["Arabic Extended-A"](n)||x["Arabic Presentation Forms-A"](n)||x["Arabic Presentation Forms-B"](n))}function O(n){return!(746!==n&&747!==n&&(n<4352||!(x["Bopomofo Extended"](n)||x.Bopomofo(n)||x["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||x["CJK Compatibility Ideographs"](n)||x["CJK Compatibility"](n)||x["CJK Radicals Supplement"](n)||x["CJK Strokes"](n)||!(!x["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||x["CJK Unified Ideographs Extension A"](n)||x["CJK Unified Ideographs"](n)||x["Enclosed CJK Letters and Months"](n)||x["Hangul Compatibility Jamo"](n)||x["Hangul Jamo Extended-A"](n)||x["Hangul Jamo Extended-B"](n)||x["Hangul Jamo"](n)||x["Hangul Syllables"](n)||x.Hiragana(n)||x["Ideographic Description Characters"](n)||x.Kanbun(n)||x["Kangxi Radicals"](n)||x["Katakana Phonetic Extensions"](n)||x.Katakana(n)&&12540!==n||!(!x["Halfwidth and Fullwidth Forms"](n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!x["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||x["Unified Canadian Aboriginal Syllabics"](n)||x["Unified Canadian Aboriginal Syllabics Extended"](n)||x["Vertical Forms"](n)||x["Yijing Hexagram Symbols"](n)||x["Yi Syllables"](n)||x["Yi Radicals"](n))))}function k(n){return!(O(n)||(e=n,x["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||x["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||x["Letterlike Symbols"](e)||x["Number Forms"](e)||x["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||x["Control Pictures"](e)&&9251!==e||x["Optical Character Recognition"](e)||x["Enclosed Alphanumerics"](e)||x["Geometric Shapes"](e)||x["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||x["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||x["CJK Symbols and Punctuation"](e)||x.Katakana(e)||x["Private Use Area"](e)||x["CJK Compatibility Forms"](e)||x["Small Form Variants"](e)||x["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function z(n){return n>=1424&&n<=2303||x["Arabic Presentation Forms-A"](n)||x["Arabic Presentation Forms-B"](n)}function j(n,e){return!(!e&&z(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||x.Khmer(n))}function $(n){for(const e of n)if(z(e.charCodeAt(0)))return!0;return!1}const G="deferred",W="loading",X="loaded";let q=null,Z="unavailable",ee=null;const se=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(Z="error"),q&&q(n)};function ue(){K.fire(new Ei("pluginStateChange",{pluginStatus:Z,pluginURL:ee}))}const K=new ho,ie=function(){return Z},he=function(){if(Z!==G||!ee)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Z=W,ue(),ee&&di({url:ee},n=>{n?se(n):(Z=X,ue())})},ge={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Z===X||null!=ge.applyArabicShaping,isLoading:()=>Z===W,setState(n){Z=n.pluginStatus,ee=n.pluginURL},isParsed:()=>null!=ge.applyArabicShaping&&null!=ge.processBidirectionalText&&null!=ge.processStyledBidirectionalText,getPluginURL:()=>ee};class pe{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(o,a){for(const c of o)if(!j(c.charCodeAt(0),a))return!1;return!0}(e,ge.isLoaded())}}class ye{constructor(e,o,a,c){this.property=e,this.value=o,this.expression=function(d,p,_,v){if(ls(d))return new $f(d,p);if(Uf(d)||Array.isArray(d)&&d.length>0){const b=yd(d,p,_,v);if("error"===b.result)throw new Error(b.value.map(C=>`${C.key}: ${C.message}`).join(", "));return b.value}{let b=d;return"string"==typeof d&&"color"===p.type&&(b=un.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>b}}}(void 0===o?e.specification.default:o,e.specification,a,c)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,o,a){return this.property.possiblyEvaluate(this,e,o,a)}}class Ne{constructor(e,o,a){this.property=e,this.value=new ye(e,void 0,o,a)}transitioned(e,o){return new Oe(this.property,this.value,o,mr({},e.transition,this.transition),e.now)}untransitioned(){return new Oe(this.property,this.value,null,{},0)}}class Ae{constructor(e,o,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=o,this._options=a,this.isConfigDependent=!1}getValue(e){return _s(this._values[e].value.value)}setValue(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new Ne(this._values[e].property,this._scope,this._options)),this._values[e].value=new ye(this._values[e].property,null===o?void 0:_s(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,o){o&&(this._options=o);const a=this._properties.properties;if(e)for(const c in e){const d=e[c];if(kn(c,"-transition")){const p=c.slice(0,-11);a[p]&&this.setTransition(p,d)}else a[c]&&this.setValue(c,d)}}getTransition(e){return _s(this._values[e].transition)}setTransition(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new Ne(this._values[e].property)),this._values[e].transition=_s(o)||void 0}serialize(){const e={};for(const o of Object.keys(this._values)){const a=this.getValue(o);void 0!==a&&(e[o]=a);const c=this.getTransition(o);void 0!==c&&(e[`${o}-transition`]=c)}return e}transitioned(e,o){const a=new be(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,o._values[c]);return a}untransitioned(){const e=new be(this._properties);for(const o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class Oe{constructor(e,o,a,c,d){const p=c.delay||0,_=c.duration||0;d=d||0,this.property=e,this.value=o,this.begin=d+p,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,o,a){const c=e.now||0,d=this.value.possiblyEvaluate(e,o,a),p=this.prior;if(p){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return p.possiblyEvaluate(e,o,a);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,o,a),d,gc(_))}}return d}}class be{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,a){const c=new Ge(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,o,a);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ve{constructor(e,o,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=o,this._options=a,this.isConfigDependent=!1}getValue(e){return _s(this._values[e].value)}setValue(e,o){this._values[e]=new ye(this._values[e].property,null===o?void 0:_s(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const o of Object.keys(this._values)){const a=this.getValue(o);void 0!==a&&(e[o]=a)}return e}possiblyEvaluate(e,o,a){const c=new Ge(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,o,a);return c}}class Re{constructor(e,o,a){this.property=e,this.value=o,this.parameters=a}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,o,a,c){return this.property.evaluate(this.value,this.parameters,e,o,a,c)}}class Ge{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class re{constructor(e){this.specification=e}possiblyEvaluate(e,o){return e.expression.evaluate(o)}interpolate(e,o,a){const c=Ws[this.specification.type];return c?c(e,o,a):e}}class Me{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,a,c){return new Re(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(o,null,{},a,c)}:e.expression,o)}interpolate(e,o,a){if("constant"!==e.value.kind||"constant"!==o.value.kind)return e;if(void 0===e.value.value||void 0===o.value.value)return new Re(this,{kind:"constant",value:void 0},e.parameters);const c=Ws[this.specification.type];return c?new Re(this,{kind:"constant",value:c(e.value.value,o.value.value,a)},e.parameters):e}evaluate(e,o,a,c,d,p){return"constant"===e.kind?e.value:e.evaluate(o,a,c,d,p)}}class tt{constructor(e){this.specification=e}possiblyEvaluate(e,o,a,c){return!!e.expression.evaluate(o,null,{},a,c)}interpolate(){return!1}}class Xe{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new pe(0,{});for(const a in e){const c=e[a];c.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new ye(c,void 0),p=this.defaultTransitionablePropertyValues[a]=new Ne(c);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(o)}}}It(Me,"DataDrivenProperty"),It(re,"DataConstantProperty"),It(tt,"ColorRampProperty");function vt(n,e){return e?`${n}\x1f${e}`:n}const Vt="-transition";class xt extends ho{constructor(e,o,a,c){if(super(),this.id=e.id,this.fqid=vt(this.id,a),this.type=e.type,this.scope=a,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),o.layout&&(this._unevaluatedLayout=new Ve(o.layout,this.scope,c),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),o.paint)){this._transitionablePaint=new Ae(o.paint,this.scope,c);for(const d in e.paint)this.setPaintProperty(d,e.paint[d],{validate:!1});for(const d in e.layout)this.setLayoutProperty(d,e.layout[d],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ge(o.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o,a={}){if(null!=o&&this._validate(R0,`layers.${this.id}.layout.${e}`,e,o,a))return;if("custom"===this.type&&"visibility"===e)return void(this.visibility=o);const c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,o),this.isConfigDependent=this.isConfigDependent||c.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return kn(e,Vt)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o,a={}){if(null!=o&&this._validate(P0,`layers.${this.id}.paint.${e}`,e,o,a))return!1;const c=this._transitionablePaint,d=c._properties.properties;if(kn(e,Vt)){const I=e.slice(0,-11);return d[I]&&c.setTransition(I,o||void 0),!1}if(!d[e])return!1;const p=c._values[e],_=p.value.isDataDriven(),v=p.value;c.setValue(e,o),this.isConfigDependent=this.isConfigDependent||c.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const b=c._values[e].value,C=b.isDataDriven(),M=kn(e,"pattern")||"line-dasharray"===e;return C||_||M||this._handleOverridablePaintPropertyUpdate(e,v,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,o){return null}_handleOverridablePaintPropertyUpdate(e,o,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){return $l({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,o)=>!(void 0===e||"layout"===o&&!Object.keys(e).length||"paint"===o&&!Object.keys(e).length))}_validate(e,o,a,c,d={}){return(!d||!1!==d.validate)&&np(this,e.call(hh,{key:o,layerType:this.type,objectKey:a,value:c,styleSpec:De,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const o=this.paint.get(e);if(o instanceof Re&&zi(o.property.specification)&&("source"===o.value.kind||"composite"===o.value.kind)&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ya(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}const Xt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Yt{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Lt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&(e.isTransferred=!0,o.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ft(n,e=1){let o=0,a=0;return{members:n.map(c=>{const d=Xt[c.type].BYTES_PER_ELEMENT,p=o=zn(o,Math.max(e,d)),_=c.components||1;return a=Math.max(a,d),o+=d*_,{name:c.name,type:c.type,components:_,offset:p}}),size:zn(o,Math.max(a,e)),alignment:e}}function zn(n,e){return Math.ceil(n/e)*e}class ke extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,o)}emplace(e,o,a){const c=2*e;return this.int16[c+0]=o,this.int16[c+1]=a,e}}ke.prototype.bytesPerElement=4,It(ke,"StructArrayLayout2i4");class ln extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,o,a)}emplace(e,o,a,c){const d=3*e;return this.int16[d+0]=o,this.int16[d+1]=a,this.int16[d+2]=c,e}}ln.prototype.bytesPerElement=6,It(ln,"StructArrayLayout3i6");class ar extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,a,c)}emplace(e,o,a,c,d){const p=4*e;return this.int16[p+0]=o,this.int16[p+1]=a,this.int16[p+2]=c,this.int16[p+3]=d,e}}ar.prototype.bytesPerElement=8,It(ar,"StructArrayLayout4i8");class Eo extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,o,a,c,d)}emplace(e,o,a,c,d,p){const _=5*e;return this.int16[_+0]=o,this.int16[_+1]=a,this.int16[_+2]=c,this.int16[_+3]=d,this.int16[_+4]=p,e}}Eo.prototype.bytesPerElement=10,It(Eo,"StructArrayLayout5i10");class Kr extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,o,a,c,d,p,_)}emplace(e,o,a,c,d,p,_,v){const b=6*e,C=12*e,M=3*e;return this.int16[b+0]=o,this.int16[b+1]=a,this.uint8[C+4]=c,this.uint8[C+5]=d,this.uint8[C+6]=p,this.uint8[C+7]=_,this.float32[M+2]=v,e}}Kr.prototype.bytesPerElement=12,It(Kr,"StructArrayLayout2i4ub1f12");class lr extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,a,c)}emplace(e,o,a,c,d){const p=4*e;return this.float32[p+0]=o,this.float32[p+1]=a,this.float32[p+2]=c,this.float32[p+3]=d,e}}lr.prototype.bytesPerElement=16,It(lr,"StructArrayLayout4f16");class Rn extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,o,a,c,d)}emplace(e,o,a,c,d,p){const _=6*e,v=3*e;return this.uint16[_+0]=o,this.uint16[_+1]=a,this.uint16[_+2]=c,this.uint16[_+3]=d,this.float32[v+2]=p,e}}Rn.prototype.bytesPerElement=12,It(Rn,"StructArrayLayout4ui1f12");class In extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,a,c)}emplace(e,o,a,c,d){const p=4*e;return this.uint16[p+0]=o,this.uint16[p+1]=a,this.uint16[p+2]=c,this.uint16[p+3]=d,e}}In.prototype.bytesPerElement=8,It(In,"StructArrayLayout4ui8");class Sr extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,a,c,d,p)}emplace(e,o,a,c,d,p,_){const v=6*e;return this.int16[v+0]=o,this.int16[v+1]=a,this.int16[v+2]=c,this.int16[v+3]=d,this.int16[v+4]=p,this.int16[v+5]=_,e}}Sr.prototype.bytesPerElement=12,It(Sr,"StructArrayLayout6i12");class Wi extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p,_,v,b,C,M,I){const R=this.length;return this.resize(R+1),this.emplace(R,e,o,a,c,d,p,_,v,b,C,M,I)}emplace(e,o,a,c,d,p,_,v,b,C,M,I,R){const L=12*e;return this.int16[L+0]=o,this.int16[L+1]=a,this.int16[L+2]=c,this.int16[L+3]=d,this.uint16[L+4]=p,this.uint16[L+5]=_,this.uint16[L+6]=v,this.uint16[L+7]=b,this.int16[L+8]=C,this.int16[L+9]=M,this.int16[L+10]=I,this.int16[L+11]=R,e}}Wi.prototype.bytesPerElement=24,It(Wi,"StructArrayLayout4i4ui4i24");class Ir extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,a,c,d,p)}emplace(e,o,a,c,d,p,_){const v=10*e,b=5*e;return this.int16[v+0]=o,this.int16[v+1]=a,this.int16[v+2]=c,this.float32[b+2]=d,this.float32[b+3]=p,this.float32[b+4]=_,e}}Ir.prototype.bytesPerElement=20,It(Ir,"StructArrayLayout3i3f20");class Fo extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}Fo.prototype.bytesPerElement=4,It(Fo,"StructArrayLayout1ul4");class No extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,o)}emplace(e,o,a){const c=2*e;return this.uint16[c+0]=o,this.uint16[c+1]=a,e}}No.prototype.bytesPerElement=4,It(No,"StructArrayLayout2ui4");class Ar extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p,_,v,b,C,M,I,R){const L=this.length;return this.resize(L+1),this.emplace(L,e,o,a,c,d,p,_,v,b,C,M,I,R)}emplace(e,o,a,c,d,p,_,v,b,C,M,I,R,L){const F=20*e,B=10*e;return this.int16[F+0]=o,this.int16[F+1]=a,this.int16[F+2]=c,this.int16[F+3]=d,this.int16[F+4]=p,this.float32[B+3]=_,this.float32[B+4]=v,this.float32[B+5]=b,this.float32[B+6]=C,this.int16[F+14]=M,this.uint32[B+8]=I,this.uint16[F+18]=R,this.uint16[F+19]=L,e}}Ar.prototype.bytesPerElement=40,It(Ar,"StructArrayLayout5i4f1i1ul2ui40");class Qi extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,o,a,c,d,p,_)}emplace(e,o,a,c,d,p,_,v){const b=8*e;return this.int16[b+0]=o,this.int16[b+1]=a,this.int16[b+2]=c,this.int16[b+4]=d,this.int16[b+5]=p,this.int16[b+6]=_,this.int16[b+7]=v,e}}Qi.prototype.bytesPerElement=16,It(Qi,"StructArrayLayout3i2i2i16");class Qa extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,o,a,c,d)}emplace(e,o,a,c,d,p){const _=4*e,v=8*e;return this.float32[_+0]=o,this.float32[_+1]=a,this.float32[_+2]=c,this.int16[v+6]=d,this.int16[v+7]=p,e}}Qa.prototype.bytesPerElement=16,It(Qa,"StructArrayLayout2f1f2i16");class zo extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,a,c)}emplace(e,o,a,c,d){const p=12*e,_=3*e;return this.uint8[p+0]=o,this.uint8[p+1]=a,this.float32[_+1]=c,this.float32[_+2]=d,e}}zo.prototype.bytesPerElement=12,It(zo,"StructArrayLayout2ub2f12");class qn extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,o,a)}emplace(e,o,a,c){const d=3*e;return this.uint16[d+0]=o,this.uint16[d+1]=a,this.uint16[d+2]=c,e}}qn.prototype.bytesPerElement=6,It(qn,"StructArrayLayout3ui6");class Ea extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B,U,Y,J,Q,oe){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B,U,Y,J,Q,oe)}emplace(e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B,U,Y,J,Q,oe,ae){const me=30*e,_e=15*e,Ee=60*e;return this.int16[me+0]=o,this.int16[me+1]=a,this.int16[me+2]=c,this.float32[_e+2]=d,this.float32[_e+3]=p,this.uint16[me+8]=_,this.uint16[me+9]=v,this.uint32[_e+5]=b,this.uint32[_e+6]=C,this.uint32[_e+7]=M,this.uint16[me+16]=I,this.uint16[me+17]=R,this.uint16[me+18]=L,this.float32[_e+10]=F,this.float32[_e+11]=B,this.uint8[Ee+48]=U,this.uint8[Ee+49]=Y,this.uint8[Ee+50]=J,this.uint32[_e+13]=Q,this.int16[me+28]=oe,this.uint8[Ee+58]=ae,e}}Ea.prototype.bytesPerElement=60,It(Ea,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ca extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B,U,Y,J,Q,oe,ae,me,_e,Ee,Pe,Se,Ue,ot,je,Je,Fe){const _t=this.length;return this.resize(_t+1),this.emplace(_t,e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B,U,Y,J,Q,oe,ae,me,_e,Ee,Pe,Se,Ue,ot,je,Je,Fe)}emplace(e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B,U,Y,J,Q,oe,ae,me,_e,Ee,Pe,Se,Ue,ot,je,Je,Fe,_t){const Et=20*e,rt=40*e,Jt=80*e;return this.float32[Et+0]=o,this.float32[Et+1]=a,this.int16[rt+4]=c,this.int16[rt+5]=d,this.int16[rt+6]=p,this.int16[rt+7]=_,this.int16[rt+8]=v,this.int16[rt+9]=b,this.int16[rt+10]=C,this.int16[rt+11]=M,this.int16[rt+12]=I,this.uint16[rt+13]=R,this.uint16[rt+14]=L,this.uint16[rt+15]=F,this.uint16[rt+16]=B,this.uint16[rt+17]=U,this.uint16[rt+18]=Y,this.uint16[rt+19]=J,this.uint16[rt+20]=Q,this.uint16[rt+21]=oe,this.uint16[rt+22]=ae,this.uint16[rt+23]=me,this.uint16[rt+24]=_e,this.uint16[rt+25]=Ee,this.uint16[rt+26]=Pe,this.uint16[rt+27]=Se,this.uint32[Et+14]=Ue,this.float32[Et+15]=ot,this.float32[Et+16]=je,this.float32[Et+17]=Je,this.float32[Et+18]=Fe,this.uint8[Jt+76]=_t,e}}Ca.prototype.bytesPerElement=80,It(Ca,"StructArrayLayout2f9i15ui1ul4f1ub80");class Sl extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}Sl.prototype.bytesPerElement=4,It(Sl,"StructArrayLayout1f4");class fh extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,o,a,c,d)}emplace(e,o,a,c,d,p){const _=5*e;return this.float32[_+0]=o,this.float32[_+1]=a,this.float32[_+2]=c,this.float32[_+3]=d,this.float32[_+4]=p,e}}fh.prototype.bytesPerElement=20,It(fh,"StructArrayLayout5f20");class rp extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,o,a,c,d,p,_)}emplace(e,o,a,c,d,p,_,v){const b=7*e;return this.float32[b+0]=o,this.float32[b+1]=a,this.float32[b+2]=c,this.float32[b+3]=d,this.float32[b+4]=p,this.float32[b+5]=_,this.float32[b+6]=v,e}}rp.prototype.bytesPerElement=28,It(rp,"StructArrayLayout7f28");class ip extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,a,c)}emplace(e,o,a,c,d){const p=6*e;return this.uint32[3*e+0]=o,this.uint16[p+2]=a,this.uint16[p+3]=c,this.uint16[p+4]=d,e}}ip.prototype.bytesPerElement=12,It(ip,"StructArrayLayout1ul3ui12");class Cd extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}Cd.prototype.bytesPerElement=2,It(Cd,"StructArrayLayout1ui2");class kc extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,o,a)}emplace(e,o,a,c){const d=3*e;return this.float32[d+0]=o,this.float32[d+1]=a,this.float32[d+2]=c,e}}kc.prototype.bytesPerElement=12,It(kc,"StructArrayLayout3f12");class op extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,o)}emplace(e,o,a){const c=2*e;return this.float32[c+0]=o,this.float32[c+1]=a,e}}op.prototype.bytesPerElement=8,It(op,"StructArrayLayout2f8");class zm extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B){const U=this.length;return this.resize(U+1),this.emplace(U,e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B)}emplace(e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B,U){const Y=16*e;return this.float32[Y+0]=o,this.float32[Y+1]=a,this.float32[Y+2]=c,this.float32[Y+3]=d,this.float32[Y+4]=p,this.float32[Y+5]=_,this.float32[Y+6]=v,this.float32[Y+7]=b,this.float32[Y+8]=C,this.float32[Y+9]=M,this.float32[Y+10]=I,this.float32[Y+11]=R,this.float32[Y+12]=L,this.float32[Y+13]=F,this.float32[Y+14]=B,this.float32[Y+15]=U,e}}zm.prototype.bytesPerElement=64,It(zm,"StructArrayLayout16f64");class Td extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,a,c,d,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,o,a,c,d,p,_)}emplace(e,o,a,c,d,p,_,v){const b=10*e,C=5*e;return this.uint16[b+0]=o,this.uint16[b+1]=a,this.uint16[b+2]=c,this.uint16[b+3]=d,this.float32[C+2]=p,this.float32[C+3]=_,this.float32[C+4]=v,e}}Td.prototype.bytesPerElement=20,It(Td,"StructArrayLayout4ui3f20");class Bm extends Lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint8[1*e+0]=o,e}}Bm.prototype.bytesPerElement=1,It(Bm,"StructArrayLayout1ub1");class H_ extends Yt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}H_.prototype.size=40;class Vm extends Ar{get(e){return new H_(this,e)}}It(Vm,"CollisionBoxArray");class q_ extends Yt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}q_.prototype.size=60;class jm extends Ea{get(e){return new q_(this,e)}}It(jm,"PlacedSymbolArray");class O0 extends Yt{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}O0.prototype.size=80;class L0 extends Ca{get(e){return new O0(this,e)}}It(L0,"SymbolInstanceArray");class cs extends Sl{getoffsetX(e){return this.float32[1*e+0]}}It(cs,"GlyphOffsetArray");class Mu extends ke{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}It(Mu,"SymbolLineVertexArray");class Vi extends Yt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Vi.prototype.size=12;class k0 extends ip{get(e){return new Vi(this,e)}}It(k0,"FeatureIndexArray");class F0 extends No{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}It(F0,"FillExtrusionCentroidArray");const cw=Ft([{name:"a_pos",components:2,type:"Int16"}],4),uw=Ft([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ur{constructor(e=[]){this.segments=e}_prepareSegment(e,o,a,c){let d=this.segments[this.segments.length-1];return e>Ur.MAX_VERTEX_ARRAY_LENGTH&&Rr(`Max vertices per segment is ${Ur.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Ur.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:o,primitiveOffset:a,vertexLength:0,primitiveLength:0},void 0!==c&&(d.sortKey=c),this.segments.push(d)),d}prepareSegment(e,o,a,c){return this._prepareSegment(e,o.length,a.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,a,c){return new Ur([{vertexOffset:e,primitiveOffset:o,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function Z_(n,e){return 256*(n=dn(Math.floor(n),0,255))+dn(Math.floor(e),0,255)}Ur.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,It(Ur,"SegmentVector");const Um=Ft([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Du=Ft([{name:"a_dash",components:4,type:"Uint16"}]);var $m={exports:{}},Gm={exports:function(e,o){var a,c,d,p,_,v,b,C;for(c=e.length-(a=3&e.length),d=o,_=3432918353,v=461845907,C=0;C<c;)b=255&e.charCodeAt(C)|(255&e.charCodeAt(++C))<<8|(255&e.charCodeAt(++C))<<16|(255&e.charCodeAt(++C))<<24,++C,d=27492+(65535&(p=5*(65535&(d=(d^=b=(65535&(b=(b=(65535&b)*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(b=0,a){case 3:b^=(255&e.charCodeAt(C+2))<<16;case 2:b^=(255&e.charCodeAt(C+1))<<8;case 1:d^=b=(65535&(b=(b=(65535&(b^=255&e.charCodeAt(C)))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}}.exports,ap={exports:{}};ap.exports=function(e,o){for(var a,c=e.length,d=o^c,p=0;c>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:d^=(255&e.charCodeAt(p+2))<<16;case 2:d^=(255&e.charCodeAt(p+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(p)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var Hm=Gm,N0=ap.exports;$m.exports=Hm,$m.exports.murmur3=Hm,$m.exports.murmur2=N0;var qm=yr($m.exports);class lp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,o,a,c){this.ids.push(ph(e)),this.positions.push(o,a,c)}eachPosition(e,o){const a=ph(e);let c=0,d=this.ids.length-1;for(;c<d;){const p=c+d>>1;this.ids[p]>=a?d=p:c=p+1}for(;this.ids[c]===a;)o(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,o){const a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return mh(a,c,0,a.length-1),o&&(o.add(a.buffer),o.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){const o=new lp;let a;o.ids=e.ids,o.positions=e.positions;for(const c of o.ids)c!==a&&o.uniqueIds.push(c),a=c;return o.indexed=!0,o}}function ph(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:qm(String(n))}function mh(n,e,o,a){for(;o<a;){const c=n[o+a>>1];let d=o-1,p=a+1;for(;;){do{d++}while(n[d]<c);do{p--}while(n[p]>c);if(d>=p)break;Zm(n,d,p),Zm(e,3*d,3*p),Zm(e,3*d+1,3*p+1),Zm(e,3*d+2,3*p+2)}p-o<a-p?(mh(n,e,o,p),o=p+1):(mh(n,e,p+1,a),a=p)}}function Zm(n,e,o){const a=n[e];n[e]=n[o],n[o]=a}It(lp,"FeaturePositionMap");class Su{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,o),this.initialized=!0),!!this.location}}class Md extends Su{constructor(e){super(e),this.current=0}set(e,o,a){this.fetchUniformLocation(e,o)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Os extends Su{constructor(e){super(e),this.current=0}set(e,o,a){this.fetchUniformLocation(e,o)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class gh extends Su{constructor(e){super(e),this.current=[0,0]}set(e,o,a){this.fetchUniformLocation(e,o)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class W_ extends Su{constructor(e){super(e),this.current=[0,0,0]}set(e,o,a){this.fetchUniformLocation(e,o)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class hw extends Su{constructor(e){super(e),this.current=[0,0,0,0]}set(e,o,a){this.fetchUniformLocation(e,o)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class dw extends Su{constructor(e){super(e),this.current=un.transparent}set(e,o,a){this.fetchUniformLocation(e,o)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const X_=new Float32Array(16);class Fc extends Su{constructor(e){super(e),this.current=X_}set(e,o,a){if(this.fetchUniformLocation(e,o)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const fw=new Float32Array(9),cp=new Float32Array(4);class up extends Su{constructor(e){super(e),this.current=cp}set(e,o,a){if(this.fetchUniformLocation(e,o))for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}function Dd(n){return[Z_(255*n.r,255*n.g),Z_(255*n.b,255*n.a)]}class Wm{constructor(e,o,a){this.value=e,this.uniformNames=o.map(c=>`u_${c}`),this.type=a}setUniform(e,o,a,c,d){o.set(e,d,c.constantOr(this.value))}getBinding(e,o){return"color"===this.type?new dw(e):new Os(e)}}class _h{constructor(e,o){this.uniformNames=o.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,o,a,c,d){const p="u_pattern"===d||"u_dash"===d?this.pattern:"u_pixel_ratio"===d?this.pixelRatio:null;p&&o.set(e,d,p)}getBinding(e,o){return"u_pattern"===o||"u_dash"===o?new hw(e):new Os(e)}}class Ql{constructor(e,o,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=o.map(d=>({name:`a_${d}`,type:"Float32",components:"color"===a?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,o,a,c,d,p,_){const v=this.paintVertexArray.length,b=this.expression.evaluate(new pe(0,{brightness:p}),o,{},d,c,_);this.paintVertexArray.resize(e),this._setPaintValue(v,e,b)}updatePaintArray(e,o,a,c,d,p,_){const v=this.expression.evaluate({zoom:0,brightness:_},a,c,void 0,d);this._setPaintValue(e,o,v)}_setPaintValue(e,o,a){if("color"===this.type){const c=Dd(a);for(let d=e;d<o;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<o;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Il{constructor(e,o,a,c,d,p){this.expression=e,this.uniformNames=o.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=o.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===a?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,o,a,c,d,p,_){const v=this.expression.evaluate(new pe(this.zoom,{brightness:p}),o,{},d,c,_),b=this.expression.evaluate(new pe(this.zoom+1,{brightness:p}),o,{},d,c,_),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,v,b)}updatePaintArray(e,o,a,c,d,p,_){const v=this.expression.evaluate({zoom:this.zoom,brightness:_},a,c,void 0,d),b=this.expression.evaluate({zoom:this.zoom+1,brightness:_},a,c,void 0,d);this._setPaintValue(e,o,v,b)}_setPaintValue(e,o,a,c){if("color"===this.type){const d=Dd(a),p=Dd(c);for(let _=e;_<o;_++)this.paintVertexArray.emplace(_,d[0],d[1],p[0],p[1])}else{for(let d=e;d<o;d++)this.paintVertexArray.emplace(d,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o,a,c,d){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=dn(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);o.set(e,d,_)}getBinding(e,o){return new Os(e)}}class Xo{constructor(e,o,a,c,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=("array"===a?Du:Um).members;for(let p=0;p<o.length;++p);this.paintVertexArray=new c}populatePaintArray(e,o,a){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,o.patterns&&o.patterns[this.layerId],a)}updatePaintArray(e,o,a,c,d,p,_){this._setPaintValues(e,o,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,o,a,c){if(!c||!a)return;const d=c[a];if(!d)return;const{tl:p,br:_,pixelRatio:v}=d;for(let b=e;b<o;b++)this.paintVertexArray.emplace(b,p[0],p[1],_[0],_[1],v)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yh{constructor(e,o,a=(()=>!0)){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){const p=e.paint.get(d);if(!a(d)||!(p instanceof Re&&zi(p.property.specification)))continue;const _=z0(d,e.type),v=p.value,b=p.property.specification.type,C=!!p.property.useIntegerZoom,M="line-dasharray"===d||d.endsWith("pattern"),I="line-dasharray"===d&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==v.kind||I)if("source"===v.kind||I||M){const R=B0(d,b,"source");this.binders[d]=M?new Xo(v,_,b,R,e.id):new Ql(v,_,b,R),c.push(`/a_${d}`)}else{const R=B0(d,b,"composite");this.binders[d]=new Il(v,_,b,C,o,R),c.push(`/z_${d}`)}else this.binders[d]=M?new _h(v.value,_):new Wm(v.value,_,b),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const o=this.binders[e];return o instanceof Ql||o instanceof Il?o.maxValue:0}populatePaintArrays(e,o,a,c,d,p,_){for(const v in this.binders){const b=this.binders[v];(b instanceof Ql||b instanceof Il||b instanceof Xo)&&b.populatePaintArray(e,o,a,c,d,p,_)}}setConstantPatternPositions(e){for(const o in this.binders){const a=this.binders[o];a instanceof _h&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,o,a,c,d,p,_,v){let b=!1;const C=Object.keys(e),M=0!==C.length,I=M?C:o.uniqueIds;for(const R in this.binders){const L=this.binders[R];if((L instanceof Ql||L instanceof Il||L instanceof Xo)&&(!0===L.expression.isStateDependent||!1===L.expression.isLightConstant)){const F=d.paint.get(R);L.expression=F.value;for(const B of I){const U=e[B.toString()];o.eachPosition(B,(Y,J,Q)=>{const oe=c.feature(Y);L.updatePaintArray(J,Q,oe,U,p,_,v)})}if(!M)for(const B of a.uniqueIds){const U=e[B.toString()];a.eachPosition(B,(Y,J,Q)=>{const oe=c.feature(Y);L.updatePaintArray(J,Q,oe,U,p,_,v)})}b=!0}}return b}defines(){const e=[];for(const o in this.binders){const a=this.binders[o];(a instanceof Wm||a instanceof _h)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const o in this.binders){const a=this.binders[o];if(a instanceof Ql||a instanceof Il||a instanceof Xo)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const o in this.binders){const a=this.binders[o];if(a instanceof Wm||a instanceof _h||a instanceof Il)for(const c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const o=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof Wm||c instanceof _h||c instanceof Il)for(const d of c.uniformNames)o.push({name:d,property:a,binding:c.getBinding(e,d)})}return o}setUniforms(e,o,a,c,d){for(const{name:p,property:_,binding:v}of a)this.binders[_].setUniform(e,v,d,c.get(_),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const o=this.binders[e];(o instanceof Ql||o instanceof Il||o instanceof Xo)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const o in this.binders){const a=this.binders[o];(a instanceof Ql||a instanceof Il||a instanceof Xo)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const o=this.binders[e];(o instanceof Ql||o instanceof Il||o instanceof Xo)&&o.destroy()}}}class Al{constructor(e,o,a=(()=>!0)){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new yh(c,o,a);this.needsUpload=!1,this._featureMap=new lp,this._featureMapWithoutIds=new lp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,o,a,c,d,p,_,v){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,o,c,d,p,_,v);void 0!==o.id?this._featureMap.add(o.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,a,c,d,p){for(const _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,o,_,c,d,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Y_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function z0(n,e){return Y_[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const Xm={"line-pattern":{source:Rn,composite:Rn},"fill-pattern":{source:Rn,composite:Rn},"fill-extrusion-pattern":{source:Rn,composite:Rn},"line-dasharray":{source:In,composite:In}},J_={color:{source:op,composite:lr},number:{source:Sl,composite:op}};function B0(n,e,o){const a=Xm[n];return a&&a[o]||J_[e][o]}It(Wm,"ConstantBinder"),It(_h,"PatternConstantBinder"),It(Ql,"SourceExpressionBinder"),It(Xo,"PatternCompositeBinder"),It(Il,"CompositeExpressionBinder"),It(yh,"ProgramConfiguration",{omit:["_buffers"]}),It(Al,"ProgramConfigurationSet");class Nc{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof hr?new hr(e.lng,e.lat):hr.convert(e),this}setSouthWest(e){return this._sw=e instanceof hr?new hr(e.lng,e.lat):hr.convert(e),this}extend(e){const o=this._sw,a=this._ne;let c,d;if(e instanceof hr)c=e,d=e;else{if(!(e instanceof Nc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Nc.convert(e)):this.extend(hr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(hr.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return o||a?(o.lng=Math.min(c.lng,o.lng),o.lat=Math.min(c.lat,o.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new hr(c.lng,c.lat),this._ne=new hr(d.lng,d.lat)),this}getCenter(){return new hr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new hr(this.getWest(),this.getNorth())}getSouthEast(){return new hr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:a}=hr.convert(e);let c=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return!e||e instanceof Nc?e:new Nc(e)}}var eo={},to={};Object.defineProperty(to,"__esModule",{value:!0}),to.setMatrixArrayType=function(n){to.ARRAY_TYPE=V0=n},to.toRadian=function(n){return n*vh},to.equals=function(n,e){return Math.abs(n-e)<=K_*Math.max(1,Math.abs(n),Math.abs(e))},to.RANDOM=to.ARRAY_TYPE=to.EPSILON=void 0;var K_=1e-6;to.EPSILON=K_;var V0=typeof Float32Array<"u"?Float32Array:Array;to.ARRAY_TYPE=V0;var Ym=Math.random;to.RANDOM=Ym;var vh=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Qr={};function Jm(n){return(Jm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.create=function(){var n=new zc.ARRAY_TYPE(4);return zc.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},Qr.clone=function(n){var e=new zc.ARRAY_TYPE(4);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e},Qr.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},Qr.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},Qr.fromValues=function(n,e,o,a){var c=new zc.ARRAY_TYPE(4);return c[0]=n,c[1]=e,c[2]=o,c[3]=a,c},Qr.set=function(n,e,o,a,c){return n[0]=e,n[1]=o,n[2]=a,n[3]=c,n},Qr.transpose=function(n,e){if(n===e){var o=e[1];n[1]=e[2],n[2]=o}else n[0]=e[0],n[1]=e[2],n[2]=e[1],n[3]=e[3];return n},Qr.invert=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=o*d-c*a;return p?(n[0]=d*(p=1/p),n[1]=-a*p,n[2]=-c*p,n[3]=o*p,n):null},Qr.adjoint=function(n,e){var o=e[0];return n[0]=e[3],n[1]=-e[1],n[2]=-e[2],n[3]=o,n},Qr.determinant=function(n){return n[0]*n[3]-n[2]*n[1]},Qr.multiply=j0,Qr.rotate=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=Math.sin(o),v=Math.cos(o);return n[0]=a*v+d*_,n[1]=c*v+p*_,n[2]=a*-_+d*v,n[3]=c*-_+p*v,n},Qr.scale=function(n,e,o){var a=e[1],c=e[2],d=e[3],p=o[0],_=o[1];return n[0]=e[0]*p,n[1]=a*p,n[2]=c*_,n[3]=d*_,n},Qr.fromRotation=function(n,e){var o=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=o,n[2]=-o,n[3]=a,n},Qr.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=e[1],n},Qr.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},Qr.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},Qr.LDU=function(n,e,o,a){return n[2]=a[2]/a[0],o[0]=a[0],o[1]=a[1],o[3]=a[3]-n[2]*o[1],[n,e,o]},Qr.add=function(n,e,o){return n[0]=e[0]+o[0],n[1]=e[1]+o[1],n[2]=e[2]+o[2],n[3]=e[3]+o[3],n},Qr.subtract=us,Qr.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},Qr.equals=function(n,e){var o=n[0],a=n[1],c=n[2],d=n[3],p=e[0],_=e[1],v=e[2],b=e[3];return Math.abs(o-p)<=zc.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-_)<=zc.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(c-v)<=zc.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(d-b)<=zc.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},Qr.multiplyScalar=function(n,e,o){return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n},Qr.multiplyScalarAndAdd=function(n,e,o,a){return n[0]=e[0]+o[0]*a,n[1]=e[1]+o[1]*a,n[2]=e[2]+o[2]*a,n[3]=e[3]+o[3]*a,n},Qr.sub=Qr.mul=void 0;var zc=function(n,e){if(n&&n.__esModule)return n;if(null===n||"object"!==Jm(n)&&"function"!=typeof n)return{default:n};var o=Sd(void 0);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}(to);function Sd(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(Sd=function(a){return a?o:e})(n)}function j0(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=o[0],v=o[1],b=o[2],C=o[3];return n[0]=a*_+d*v,n[1]=c*_+p*v,n[2]=a*b+d*C,n[3]=c*b+p*C,n}function us(n,e,o){return n[0]=e[0]-o[0],n[1]=e[1]-o[1],n[2]=e[2]-o[2],n[3]=e[3]-o[3],n}Qr.mul=j0,Qr.sub=us;var oi={};function Co(n){return(Co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}Object.defineProperty(oi,"__esModule",{value:!0}),oi.create=function(){var n=new el.ARRAY_TYPE(6);return el.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[4]=0,n[5]=0),n[0]=1,n[3]=1,n},oi.clone=function(n){var e=new el.ARRAY_TYPE(6);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e},oi.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n},oi.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},oi.fromValues=function(n,e,o,a,c,d){var p=new el.ARRAY_TYPE(6);return p[0]=n,p[1]=e,p[2]=o,p[3]=a,p[4]=c,p[5]=d,p},oi.set=function(n,e,o,a,c,d,p){return n[0]=e,n[1]=o,n[2]=a,n[3]=c,n[4]=d,n[5]=p,n},oi.invert=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=e[4],_=e[5],v=o*d-a*c;return v?(n[0]=d*(v=1/v),n[1]=-a*v,n[2]=-c*v,n[3]=o*v,n[4]=(c*_-d*p)*v,n[5]=(a*p-o*_)*v,n):null},oi.determinant=function(n){return n[0]*n[3]-n[1]*n[2]},oi.multiply=Q_,oi.rotate=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=e[4],v=e[5],b=Math.sin(o),C=Math.cos(o);return n[0]=a*C+d*b,n[1]=c*C+p*b,n[2]=a*-b+d*C,n[3]=c*-b+p*C,n[4]=_,n[5]=v,n},oi.scale=function(n,e,o){var a=e[1],c=e[2],d=e[3],p=e[4],_=e[5],v=o[0],b=o[1];return n[0]=e[0]*v,n[1]=a*v,n[2]=c*b,n[3]=d*b,n[4]=p,n[5]=_,n},oi.translate=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=e[4],v=e[5],b=o[0],C=o[1];return n[0]=a,n[1]=c,n[2]=d,n[3]=p,n[4]=a*b+d*C+_,n[5]=c*b+p*C+v,n},oi.fromRotation=function(n,e){var o=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=o,n[2]=-o,n[3]=a,n[4]=0,n[5]=0,n},oi.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=e[1],n[4]=0,n[5]=0,n},oi.fromTranslation=function(n,e){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=e[0],n[5]=e[1],n},oi.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"},oi.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],1)},oi.add=function(n,e,o){return n[0]=e[0]+o[0],n[1]=e[1]+o[1],n[2]=e[2]+o[2],n[3]=e[3]+o[3],n[4]=e[4]+o[4],n[5]=e[5]+o[5],n},oi.subtract=hp,oi.multiplyScalar=function(n,e,o){return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*o,n[5]=e[5]*o,n},oi.multiplyScalarAndAdd=function(n,e,o,a){return n[0]=e[0]+o[0]*a,n[1]=e[1]+o[1]*a,n[2]=e[2]+o[2]*a,n[3]=e[3]+o[3]*a,n[4]=e[4]+o[4]*a,n[5]=e[5]+o[5]*a,n},oi.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]},oi.equals=function(n,e){var o=n[0],a=n[1],c=n[2],d=n[3],p=n[4],_=n[5],v=e[0],b=e[1],C=e[2],M=e[3],I=e[4],R=e[5];return Math.abs(o-v)<=el.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-b)<=el.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(c-C)<=el.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(d-M)<=el.EPSILON*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(p-I)<=el.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(_-R)<=el.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},oi.sub=oi.mul=void 0;var el=function(n,e){if(n&&n.__esModule)return n;if(null===n||"object"!==Co(n)&&"function"!=typeof n)return{default:n};var o=U0(void 0);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}(to);function U0(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(U0=function(a){return a?o:e})(n)}function Q_(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=e[4],v=e[5],b=o[0],C=o[1],M=o[2],I=o[3],R=o[4],L=o[5];return n[0]=a*b+d*C,n[1]=c*b+p*C,n[2]=a*M+d*I,n[3]=c*M+p*I,n[4]=a*R+d*L+_,n[5]=c*R+p*L+v,n}function hp(n,e,o){return n[0]=e[0]-o[0],n[1]=e[1]-o[1],n[2]=e[2]-o[2],n[3]=e[3]-o[3],n[4]=e[4]-o[4],n[5]=e[5]-o[5],n}oi.mul=Q_,oi.sub=hp;var ir={};function Iu(n){return(Iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}Object.defineProperty(ir,"__esModule",{value:!0}),ir.create=function(){var n=new Bo.ARRAY_TYPE(9);return Bo.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},ir.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},ir.clone=function(n){var e=new Bo.ARRAY_TYPE(9);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e},ir.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n},ir.fromValues=function(n,e,o,a,c,d,p,_,v){var b=new Bo.ARRAY_TYPE(9);return b[0]=n,b[1]=e,b[2]=o,b[3]=a,b[4]=c,b[5]=d,b[6]=p,b[7]=_,b[8]=v,b},ir.set=function(n,e,o,a,c,d,p,_,v,b){return n[0]=e,n[1]=o,n[2]=a,n[3]=c,n[4]=d,n[5]=p,n[6]=_,n[7]=v,n[8]=b,n},ir.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},ir.transpose=function(n,e){if(n===e){var o=e[1],a=e[2],c=e[5];n[1]=e[3],n[2]=e[6],n[3]=o,n[5]=e[7],n[6]=a,n[7]=c}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},ir.invert=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=e[4],_=e[5],v=e[6],b=e[7],C=e[8],M=C*p-_*b,I=-C*d+_*v,R=b*d-p*v,L=o*M+a*I+c*R;return L?(n[0]=M*(L=1/L),n[1]=(-C*a+c*b)*L,n[2]=(_*a-c*p)*L,n[3]=I*L,n[4]=(C*o-c*v)*L,n[5]=(-_*o+c*d)*L,n[6]=R*L,n[7]=(-b*o+a*v)*L,n[8]=(p*o-a*d)*L,n):null},ir.adjoint=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=e[4],_=e[5],v=e[6],b=e[7],C=e[8];return n[0]=p*C-_*b,n[1]=c*b-a*C,n[2]=a*_-c*p,n[3]=_*v-d*C,n[4]=o*C-c*v,n[5]=c*d-o*_,n[6]=d*b-p*v,n[7]=a*v-o*b,n[8]=o*p-a*d,n},ir.determinant=function(n){var e=n[3],o=n[4],a=n[5],c=n[6],d=n[7],p=n[8];return n[0]*(p*o-a*d)+n[1]*(-p*e+a*c)+n[2]*(d*e-o*c)},ir.multiply=Km,ir.translate=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=e[4],v=e[5],b=e[6],C=e[7],M=e[8],I=o[0],R=o[1];return n[0]=a,n[1]=c,n[2]=d,n[3]=p,n[4]=_,n[5]=v,n[6]=I*a+R*p+b,n[7]=I*c+R*_+C,n[8]=I*d+R*v+M,n},ir.rotate=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=e[4],v=e[5],b=e[6],C=e[7],M=e[8],I=Math.sin(o),R=Math.cos(o);return n[0]=R*a+I*p,n[1]=R*c+I*_,n[2]=R*d+I*v,n[3]=R*p-I*a,n[4]=R*_-I*c,n[5]=R*v-I*d,n[6]=b,n[7]=C,n[8]=M,n},ir.scale=function(n,e,o){var a=o[0],c=o[1];return n[0]=a*e[0],n[1]=a*e[1],n[2]=a*e[2],n[3]=c*e[3],n[4]=c*e[4],n[5]=c*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n},ir.fromTranslation=function(n,e){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=e[0],n[7]=e[1],n[8]=1,n},ir.fromRotation=function(n,e){var o=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=o,n[2]=0,n[3]=-o,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},ir.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=e[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},ir.fromMat2d=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=0,n[3]=e[2],n[4]=e[3],n[5]=0,n[6]=e[4],n[7]=e[5],n[8]=1,n},ir.fromQuat=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=o+o,_=a+a,v=c+c,b=o*p,C=a*p,M=a*_,I=c*p,R=c*_,L=c*v,F=d*p,B=d*_,U=d*v;return n[0]=1-M-L,n[3]=C-U,n[6]=I+B,n[1]=C+U,n[4]=1-b-L,n[7]=R-F,n[2]=I-B,n[5]=R+F,n[8]=1-b-M,n},ir.normalFromMat4=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=e[4],_=e[5],v=e[6],b=e[7],C=e[8],M=e[9],I=e[10],R=e[11],L=e[12],F=e[13],B=e[14],U=e[15],Y=o*_-a*p,J=o*v-c*p,Q=o*b-d*p,oe=a*v-c*_,ae=a*b-d*_,me=c*b-d*v,_e=C*F-M*L,Ee=C*B-I*L,Pe=C*U-R*L,Se=M*B-I*F,Ue=M*U-R*F,ot=I*U-R*B,je=Y*ot-J*Ue+Q*Se+oe*Pe-ae*Ee+me*_e;return je?(n[0]=(_*ot-v*Ue+b*Se)*(je=1/je),n[1]=(v*Pe-p*ot-b*Ee)*je,n[2]=(p*Ue-_*Pe+b*_e)*je,n[3]=(c*Ue-a*ot-d*Se)*je,n[4]=(o*ot-c*Pe+d*Ee)*je,n[5]=(a*Pe-o*Ue-d*_e)*je,n[6]=(F*me-B*ae+U*oe)*je,n[7]=(B*Q-L*me-U*J)*je,n[8]=(L*ae-F*Q+U*Y)*je,n):null},ir.projection=function(n,e,o){return n[0]=2/e,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/o,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,n},ir.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"},ir.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},ir.add=function(n,e,o){return n[0]=e[0]+o[0],n[1]=e[1]+o[1],n[2]=e[2]+o[2],n[3]=e[3]+o[3],n[4]=e[4]+o[4],n[5]=e[5]+o[5],n[6]=e[6]+o[6],n[7]=e[7]+o[7],n[8]=e[8]+o[8],n},ir.subtract=xh,ir.multiplyScalar=function(n,e,o){return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*o,n[5]=e[5]*o,n[6]=e[6]*o,n[7]=e[7]*o,n[8]=e[8]*o,n},ir.multiplyScalarAndAdd=function(n,e,o,a){return n[0]=e[0]+o[0]*a,n[1]=e[1]+o[1]*a,n[2]=e[2]+o[2]*a,n[3]=e[3]+o[3]*a,n[4]=e[4]+o[4]*a,n[5]=e[5]+o[5]*a,n[6]=e[6]+o[6]*a,n[7]=e[7]+o[7]*a,n[8]=e[8]+o[8]*a,n},ir.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]},ir.equals=function(n,e){var o=n[0],a=n[1],c=n[2],d=n[3],p=n[4],_=n[5],v=n[6],b=n[7],C=n[8],M=e[0],I=e[1],R=e[2],L=e[3],F=e[4],B=e[5],U=e[6],Y=e[7],J=e[8];return Math.abs(o-M)<=Bo.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-I)<=Bo.EPSILON*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(c-R)<=Bo.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(d-L)<=Bo.EPSILON*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(p-F)<=Bo.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(_-B)<=Bo.EPSILON*Math.max(1,Math.abs(_),Math.abs(B))&&Math.abs(v-U)<=Bo.EPSILON*Math.max(1,Math.abs(v),Math.abs(U))&&Math.abs(b-Y)<=Bo.EPSILON*Math.max(1,Math.abs(b),Math.abs(Y))&&Math.abs(C-J)<=Bo.EPSILON*Math.max(1,Math.abs(C),Math.abs(J))},ir.sub=ir.mul=void 0;var Bo=function(n,e){if(n&&n.__esModule)return n;if(null===n||"object"!==Iu(n)&&"function"!=typeof n)return{default:n};var o=ey(void 0);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}(to);function ey(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(ey=function(a){return a?o:e})(n)}function Km(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=e[4],v=e[5],b=e[6],C=e[7],M=e[8],I=o[0],R=o[1],L=o[2],F=o[3],B=o[4],U=o[5],Y=o[6],J=o[7],Q=o[8];return n[0]=I*a+R*p+L*b,n[1]=I*c+R*_+L*C,n[2]=I*d+R*v+L*M,n[3]=F*a+B*p+U*b,n[4]=F*c+B*_+U*C,n[5]=F*d+B*v+U*M,n[6]=Y*a+J*p+Q*b,n[7]=Y*c+J*_+Q*C,n[8]=Y*d+J*v+Q*M,n}function xh(n,e,o){return n[0]=e[0]-o[0],n[1]=e[1]-o[1],n[2]=e[2]-o[2],n[3]=e[3]-o[3],n[4]=e[4]-o[4],n[5]=e[5]-o[5],n[6]=e[6]-o[6],n[7]=e[7]-o[7],n[8]=e[8]-o[8],n}ir.mul=Km,ir.sub=xh;var bn={};function ty(n){return(ty="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}Object.defineProperty(bn,"__esModule",{value:!0}),bn.create=function(){var n=new vi.ARRAY_TYPE(16);return vi.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},bn.clone=function(n){var e=new vi.ARRAY_TYPE(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},bn.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},bn.fromValues=function(n,e,o,a,c,d,p,_,v,b,C,M,I,R,L,F){var B=new vi.ARRAY_TYPE(16);return B[0]=n,B[1]=e,B[2]=o,B[3]=a,B[4]=c,B[5]=d,B[6]=p,B[7]=_,B[8]=v,B[9]=b,B[10]=C,B[11]=M,B[12]=I,B[13]=R,B[14]=L,B[15]=F,B},bn.set=function(n,e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B){return n[0]=e,n[1]=o,n[2]=a,n[3]=c,n[4]=d,n[5]=p,n[6]=_,n[7]=v,n[8]=b,n[9]=C,n[10]=M,n[11]=I,n[12]=R,n[13]=L,n[14]=F,n[15]=B,n},bn.identity=mw,bn.transpose=function(n,e){if(n===e){var o=e[1],a=e[2],c=e[3],d=e[6],p=e[7],_=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=o,n[6]=e[9],n[7]=e[13],n[8]=a,n[9]=d,n[11]=e[14],n[12]=c,n[13]=p,n[14]=_}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},bn.invert=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=e[4],_=e[5],v=e[6],b=e[7],C=e[8],M=e[9],I=e[10],R=e[11],L=e[12],F=e[13],B=e[14],U=e[15],Y=o*_-a*p,J=o*v-c*p,Q=o*b-d*p,oe=a*v-c*_,ae=a*b-d*_,me=c*b-d*v,_e=C*F-M*L,Ee=C*B-I*L,Pe=C*U-R*L,Se=M*B-I*F,Ue=M*U-R*F,ot=I*U-R*B,je=Y*ot-J*Ue+Q*Se+oe*Pe-ae*Ee+me*_e;return je?(n[0]=(_*ot-v*Ue+b*Se)*(je=1/je),n[1]=(c*Ue-a*ot-d*Se)*je,n[2]=(F*me-B*ae+U*oe)*je,n[3]=(I*ae-M*me-R*oe)*je,n[4]=(v*Pe-p*ot-b*Ee)*je,n[5]=(o*ot-c*Pe+d*Ee)*je,n[6]=(B*Q-L*me-U*J)*je,n[7]=(C*me-I*Q+R*J)*je,n[8]=(p*Ue-_*Pe+b*_e)*je,n[9]=(a*Pe-o*Ue-d*_e)*je,n[10]=(L*ae-F*Q+U*Y)*je,n[11]=(M*Q-C*ae-R*Y)*je,n[12]=(_*Ee-p*Se-v*_e)*je,n[13]=(o*Se-a*Ee+c*_e)*je,n[14]=(F*J-L*oe-B*Y)*je,n[15]=(C*oe-M*J+I*Y)*je,n):null},bn.adjoint=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=e[4],_=e[5],v=e[6],b=e[7],C=e[8],M=e[9],I=e[10],R=e[11],L=e[12],F=e[13],B=e[14],U=e[15];return n[0]=_*(I*U-R*B)-M*(v*U-b*B)+F*(v*R-b*I),n[1]=-(a*(I*U-R*B)-M*(c*U-d*B)+F*(c*R-d*I)),n[2]=a*(v*U-b*B)-_*(c*U-d*B)+F*(c*b-d*v),n[3]=-(a*(v*R-b*I)-_*(c*R-d*I)+M*(c*b-d*v)),n[4]=-(p*(I*U-R*B)-C*(v*U-b*B)+L*(v*R-b*I)),n[5]=o*(I*U-R*B)-C*(c*U-d*B)+L*(c*R-d*I),n[6]=-(o*(v*U-b*B)-p*(c*U-d*B)+L*(c*b-d*v)),n[7]=o*(v*R-b*I)-p*(c*R-d*I)+C*(c*b-d*v),n[8]=p*(M*U-R*F)-C*(_*U-b*F)+L*(_*R-b*M),n[9]=-(o*(M*U-R*F)-C*(a*U-d*F)+L*(a*R-d*M)),n[10]=o*(_*U-b*F)-p*(a*U-d*F)+L*(a*b-d*_),n[11]=-(o*(_*R-b*M)-p*(a*R-d*M)+C*(a*b-d*_)),n[12]=-(p*(M*B-I*F)-C*(_*B-v*F)+L*(_*I-v*M)),n[13]=o*(M*B-I*F)-C*(a*B-c*F)+L*(a*I-c*M),n[14]=-(o*(_*B-v*F)-p*(a*B-c*F)+L*(a*v-c*_)),n[15]=o*(_*I-v*M)-p*(a*I-c*M)+C*(a*v-c*_),n},bn.determinant=function(n){var e=n[0],o=n[1],a=n[2],c=n[3],d=n[4],p=n[5],_=n[6],v=n[7],b=n[8],C=n[9],M=n[10],I=n[11],R=n[12],L=n[13],F=n[14],B=n[15];return(e*p-o*d)*(M*B-I*F)-(e*_-a*d)*(C*B-I*L)+(e*v-c*d)*(C*F-M*L)+(o*_-a*p)*(b*B-I*R)-(o*v-c*p)*(b*F-M*R)+(a*v-c*_)*(b*L-C*R)},bn.multiply=gw,bn.translate=function(n,e,o){var a,c,d,p,_,v,b,C,M,I,R,L,F=o[0],B=o[1],U=o[2];return e===n?(n[12]=e[0]*F+e[4]*B+e[8]*U+e[12],n[13]=e[1]*F+e[5]*B+e[9]*U+e[13],n[14]=e[2]*F+e[6]*B+e[10]*U+e[14],n[15]=e[3]*F+e[7]*B+e[11]*U+e[15]):(c=e[1],d=e[2],p=e[3],_=e[4],v=e[5],b=e[6],C=e[7],M=e[8],I=e[9],R=e[10],L=e[11],n[0]=a=e[0],n[1]=c,n[2]=d,n[3]=p,n[4]=_,n[5]=v,n[6]=b,n[7]=C,n[8]=M,n[9]=I,n[10]=R,n[11]=L,n[12]=a*F+_*B+M*U+e[12],n[13]=c*F+v*B+I*U+e[13],n[14]=d*F+b*B+R*U+e[14],n[15]=p*F+C*B+L*U+e[15]),n},bn.scale=function(n,e,o){var a=o[0],c=o[1],d=o[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},bn.rotate=function(n,e,o,a){var c,d,p,_,v,b,C,M,I,R,L,F,B,U,Y,J,Q,oe,ae,me,_e,Ee,Pe,Se,Ue=a[0],ot=a[1],je=a[2],Je=Math.hypot(Ue,ot,je);return Je<vi.EPSILON?null:(Ue*=Je=1/Je,ot*=Je,je*=Je,c=Math.sin(o),d=Math.cos(o),v=e[1],b=e[2],C=e[3],I=e[5],R=e[6],L=e[7],B=e[9],U=e[10],Y=e[11],ae=Ue*ot*(p=1-d)-je*c,me=ot*ot*p+d,_e=je*ot*p+Ue*c,Ee=Ue*je*p+ot*c,Pe=ot*je*p-Ue*c,Se=je*je*p+d,n[0]=(_=e[0])*(J=Ue*Ue*p+d)+(M=e[4])*(Q=ot*Ue*p+je*c)+(F=e[8])*(oe=je*Ue*p-ot*c),n[1]=v*J+I*Q+B*oe,n[2]=b*J+R*Q+U*oe,n[3]=C*J+L*Q+Y*oe,n[4]=_*ae+M*me+F*_e,n[5]=v*ae+I*me+B*_e,n[6]=b*ae+R*me+U*_e,n[7]=C*ae+L*me+Y*_e,n[8]=_*Ee+M*Pe+F*Se,n[9]=v*Ee+I*Pe+B*Se,n[10]=b*Ee+R*Pe+U*Se,n[11]=C*Ee+L*Pe+Y*Se,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)},bn.rotateX=function(n,e,o){var a=Math.sin(o),c=Math.cos(o),d=e[4],p=e[5],_=e[6],v=e[7],b=e[8],C=e[9],M=e[10],I=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*c+b*a,n[5]=p*c+C*a,n[6]=_*c+M*a,n[7]=v*c+I*a,n[8]=b*c-d*a,n[9]=C*c-p*a,n[10]=M*c-_*a,n[11]=I*c-v*a,n},bn.rotateY=function(n,e,o){var a=Math.sin(o),c=Math.cos(o),d=e[0],p=e[1],_=e[2],v=e[3],b=e[8],C=e[9],M=e[10],I=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c-b*a,n[1]=p*c-C*a,n[2]=_*c-M*a,n[3]=v*c-I*a,n[8]=d*a+b*c,n[9]=p*a+C*c,n[10]=_*a+M*c,n[11]=v*a+I*c,n},bn.rotateZ=function(n,e,o){var a=Math.sin(o),c=Math.cos(o),d=e[0],p=e[1],_=e[2],v=e[3],b=e[4],C=e[5],M=e[6],I=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c+b*a,n[1]=p*c+C*a,n[2]=_*c+M*a,n[3]=v*c+I*a,n[4]=b*c-d*a,n[5]=C*c-p*a,n[6]=M*c-_*a,n[7]=I*c-v*a,n},bn.fromTranslation=function(n,e){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},bn.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},bn.fromRotation=function(n,e,o){var a,c,d,p=o[0],_=o[1],v=o[2],b=Math.hypot(p,_,v);return b<vi.EPSILON?null:(p*=b=1/b,_*=b,v*=b,a=Math.sin(e),c=Math.cos(e),n[0]=p*p*(d=1-c)+c,n[1]=_*p*d+v*a,n[2]=v*p*d-_*a,n[3]=0,n[4]=p*_*d-v*a,n[5]=_*_*d+c,n[6]=v*_*d+p*a,n[7]=0,n[8]=p*v*d+_*a,n[9]=_*v*d-p*a,n[10]=v*v*d+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)},bn.fromXRotation=function(n,e){var o=Math.sin(e),a=Math.cos(e);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=o,n[7]=0,n[8]=0,n[9]=-o,n[10]=a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},bn.fromYRotation=function(n,e){var o=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=0,n[2]=-o,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=o,n[9]=0,n[10]=a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},bn.fromZRotation=function(n,e){var o=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=o,n[2]=0,n[3]=0,n[4]=-o,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},bn.fromRotationTranslation=_w,bn.fromQuat2=function(n,e){var o=new vi.ARRAY_TYPE(3),a=-e[0],c=-e[1],d=-e[2],p=e[3],_=e[4],v=e[5],b=e[6],C=e[7],M=a*a+c*c+d*d+p*p;return M>0?(o[0]=2*(_*p+C*a+v*d-b*c)/M,o[1]=2*(v*p+C*c+b*a-_*d)/M,o[2]=2*(b*p+C*d+_*c-v*a)/M):(o[0]=2*(_*p+C*a+v*d-b*c),o[1]=2*(v*p+C*c+b*a-_*d),o[2]=2*(b*p+C*d+_*c-v*a)),_w(n,e,o),n},bn.getTranslation=function(n,e){return n[0]=e[12],n[1]=e[13],n[2]=e[14],n},bn.getScaling=yw,bn.getRotation=function(n,e){var o=new vi.ARRAY_TYPE(3);yw(o,e);var a=1/o[0],c=1/o[1],d=1/o[2],p=e[0]*a,_=e[1]*c,v=e[2]*d,b=e[4]*a,C=e[5]*c,M=e[6]*d,I=e[8]*a,R=e[9]*c,L=e[10]*d,F=p+C+L,B=0;return F>0?(B=2*Math.sqrt(F+1),n[3]=.25*B,n[0]=(M-R)/B,n[1]=(I-v)/B,n[2]=(_-b)/B):p>C&&p>L?(B=2*Math.sqrt(1+p-C-L),n[3]=(M-R)/B,n[0]=.25*B,n[1]=(_+b)/B,n[2]=(I+v)/B):C>L?(B=2*Math.sqrt(1+C-p-L),n[3]=(I-v)/B,n[0]=(_+b)/B,n[1]=.25*B,n[2]=(M+R)/B):(B=2*Math.sqrt(1+L-p-C),n[3]=(_-b)/B,n[0]=(I+v)/B,n[1]=(M+R)/B,n[2]=.25*B),n},bn.fromRotationTranslationScale=function(n,e,o,a){var c=e[0],d=e[1],p=e[2],_=e[3],v=c+c,b=d+d,C=p+p,M=c*v,I=c*b,R=c*C,L=d*b,F=d*C,B=p*C,U=_*v,Y=_*b,J=_*C,Q=a[0],oe=a[1],ae=a[2];return n[0]=(1-(L+B))*Q,n[1]=(I+J)*Q,n[2]=(R-Y)*Q,n[3]=0,n[4]=(I-J)*oe,n[5]=(1-(M+B))*oe,n[6]=(F+U)*oe,n[7]=0,n[8]=(R+Y)*ae,n[9]=(F-U)*ae,n[10]=(1-(M+L))*ae,n[11]=0,n[12]=o[0],n[13]=o[1],n[14]=o[2],n[15]=1,n},bn.fromRotationTranslationScaleOrigin=function(n,e,o,a,c){var d=e[0],p=e[1],_=e[2],v=e[3],b=d+d,C=p+p,M=_+_,I=d*b,R=d*C,L=d*M,F=p*C,B=p*M,U=_*M,Y=v*b,J=v*C,Q=v*M,oe=a[0],ae=a[1],me=a[2],_e=c[0],Ee=c[1],Pe=c[2],Se=(1-(F+U))*oe,Ue=(R+Q)*oe,ot=(L-J)*oe,je=(R-Q)*ae,Je=(1-(I+U))*ae,Fe=(B+Y)*ae,_t=(L+J)*me,Et=(B-Y)*me,rt=(1-(I+F))*me;return n[0]=Se,n[1]=Ue,n[2]=ot,n[3]=0,n[4]=je,n[5]=Je,n[6]=Fe,n[7]=0,n[8]=_t,n[9]=Et,n[10]=rt,n[11]=0,n[12]=o[0]+_e-(Se*_e+je*Ee+_t*Pe),n[13]=o[1]+Ee-(Ue*_e+Je*Ee+Et*Pe),n[14]=o[2]+Pe-(ot*_e+Fe*Ee+rt*Pe),n[15]=1,n},bn.fromQuat=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=o+o,_=a+a,v=c+c,b=o*p,C=a*p,M=a*_,I=c*p,R=c*_,L=c*v,F=d*p,B=d*_,U=d*v;return n[0]=1-M-L,n[1]=C+U,n[2]=I-B,n[3]=0,n[4]=C-U,n[5]=1-b-L,n[6]=R+F,n[7]=0,n[8]=I+B,n[9]=R-F,n[10]=1-b-M,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},bn.frustum=function(n,e,o,a,c,d,p){var _=1/(o-e),v=1/(c-a),b=1/(d-p);return n[0]=2*d*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*d*v,n[6]=0,n[7]=0,n[8]=(o+e)*_,n[9]=(c+a)*v,n[10]=(p+d)*b,n[11]=-1,n[12]=0,n[13]=0,n[14]=p*d*2*b,n[15]=0,n},bn.perspectiveNO=bh,bn.perspectiveZO=function(n,e,o,a,c){var d,p=1/Math.tan(e/2);return n[0]=p/o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=c&&c!==1/0?(n[10]=c*(d=1/(a-c)),n[14]=c*a*d):(n[10]=-1,n[14]=-a),n},bn.perspectiveFromFieldOfView=function(n,e,o,a){var c=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),v=2/(p+_),b=2/(c+d);return n[0]=v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=b,n[6]=0,n[7]=0,n[8]=-(p-_)*v*.5,n[9]=(c-d)*b*.5,n[10]=a/(o-a),n[11]=-1,n[12]=0,n[13]=0,n[14]=a*o/(o-a),n[15]=0,n},bn.orthoNO=$0,bn.orthoZO=function(n,e,o,a,c,d,p){var _=1/(e-o),v=1/(a-c),b=1/(d-p);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=b,n[11]=0,n[12]=(e+o)*_,n[13]=(c+a)*v,n[14]=d*b,n[15]=1,n},bn.lookAt=function(n,e,o,a){var c,d,p,_,v,b,C,M,I,R,L=e[0],F=e[1],B=e[2],U=a[0],Y=a[1],J=a[2],Q=o[0],oe=o[1],ae=o[2];return Math.abs(L-Q)<vi.EPSILON&&Math.abs(F-oe)<vi.EPSILON&&Math.abs(B-ae)<vi.EPSILON?mw(n):(C=L-Q,M=F-oe,I=B-ae,c=Y*(I*=R=1/Math.hypot(C,M,I))-J*(M*=R),d=J*(C*=R)-U*I,p=U*M-Y*C,(R=Math.hypot(c,d,p))?(c*=R=1/R,d*=R,p*=R):(c=0,d=0,p=0),_=M*p-I*d,v=I*c-C*p,b=C*d-M*c,(R=Math.hypot(_,v,b))?(_*=R=1/R,v*=R,b*=R):(_=0,v=0,b=0),n[0]=c,n[1]=_,n[2]=C,n[3]=0,n[4]=d,n[5]=v,n[6]=M,n[7]=0,n[8]=p,n[9]=b,n[10]=I,n[11]=0,n[12]=-(c*L+d*F+p*B),n[13]=-(_*L+v*F+b*B),n[14]=-(C*L+M*F+I*B),n[15]=1,n)},bn.targetTo=function(n,e,o,a){var c=e[0],d=e[1],p=e[2],_=a[0],v=a[1],b=a[2],C=c-o[0],M=d-o[1],I=p-o[2],R=C*C+M*M+I*I;R>0&&(C*=R=1/Math.sqrt(R),M*=R,I*=R);var L=v*I-b*M,F=b*C-_*I,B=_*M-v*C;return(R=L*L+F*F+B*B)>0&&(L*=R=1/Math.sqrt(R),F*=R,B*=R),n[0]=L,n[1]=F,n[2]=B,n[3]=0,n[4]=M*B-I*F,n[5]=I*L-C*B,n[6]=C*F-M*L,n[7]=0,n[8]=C,n[9]=M,n[10]=I,n[11]=0,n[12]=c,n[13]=d,n[14]=p,n[15]=1,n},bn.str=function(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"},bn.frob=function(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])},bn.add=function(n,e,o){return n[0]=e[0]+o[0],n[1]=e[1]+o[1],n[2]=e[2]+o[2],n[3]=e[3]+o[3],n[4]=e[4]+o[4],n[5]=e[5]+o[5],n[6]=e[6]+o[6],n[7]=e[7]+o[7],n[8]=e[8]+o[8],n[9]=e[9]+o[9],n[10]=e[10]+o[10],n[11]=e[11]+o[11],n[12]=e[12]+o[12],n[13]=e[13]+o[13],n[14]=e[14]+o[14],n[15]=e[15]+o[15],n},bn.subtract=G0,bn.multiplyScalar=function(n,e,o){return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*o,n[5]=e[5]*o,n[6]=e[6]*o,n[7]=e[7]*o,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12]*o,n[13]=e[13]*o,n[14]=e[14]*o,n[15]=e[15]*o,n},bn.multiplyScalarAndAdd=function(n,e,o,a){return n[0]=e[0]+o[0]*a,n[1]=e[1]+o[1]*a,n[2]=e[2]+o[2]*a,n[3]=e[3]+o[3]*a,n[4]=e[4]+o[4]*a,n[5]=e[5]+o[5]*a,n[6]=e[6]+o[6]*a,n[7]=e[7]+o[7]*a,n[8]=e[8]+o[8]*a,n[9]=e[9]+o[9]*a,n[10]=e[10]+o[10]*a,n[11]=e[11]+o[11]*a,n[12]=e[12]+o[12]*a,n[13]=e[13]+o[13]*a,n[14]=e[14]+o[14]*a,n[15]=e[15]+o[15]*a,n},bn.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},bn.equals=function(n,e){var o=n[0],a=n[1],c=n[2],d=n[3],p=n[4],_=n[5],v=n[6],b=n[7],C=n[8],M=n[9],I=n[10],R=n[11],L=n[12],F=n[13],B=n[14],U=n[15],Y=e[0],J=e[1],Q=e[2],oe=e[3],ae=e[4],me=e[5],_e=e[6],Ee=e[7],Pe=e[8],Se=e[9],Ue=e[10],ot=e[11],je=e[12],Je=e[13],Fe=e[14],_t=e[15];return Math.abs(o-Y)<=vi.EPSILON*Math.max(1,Math.abs(o),Math.abs(Y))&&Math.abs(a-J)<=vi.EPSILON*Math.max(1,Math.abs(a),Math.abs(J))&&Math.abs(c-Q)<=vi.EPSILON*Math.max(1,Math.abs(c),Math.abs(Q))&&Math.abs(d-oe)<=vi.EPSILON*Math.max(1,Math.abs(d),Math.abs(oe))&&Math.abs(p-ae)<=vi.EPSILON*Math.max(1,Math.abs(p),Math.abs(ae))&&Math.abs(_-me)<=vi.EPSILON*Math.max(1,Math.abs(_),Math.abs(me))&&Math.abs(v-_e)<=vi.EPSILON*Math.max(1,Math.abs(v),Math.abs(_e))&&Math.abs(b-Ee)<=vi.EPSILON*Math.max(1,Math.abs(b),Math.abs(Ee))&&Math.abs(C-Pe)<=vi.EPSILON*Math.max(1,Math.abs(C),Math.abs(Pe))&&Math.abs(M-Se)<=vi.EPSILON*Math.max(1,Math.abs(M),Math.abs(Se))&&Math.abs(I-Ue)<=vi.EPSILON*Math.max(1,Math.abs(I),Math.abs(Ue))&&Math.abs(R-ot)<=vi.EPSILON*Math.max(1,Math.abs(R),Math.abs(ot))&&Math.abs(L-je)<=vi.EPSILON*Math.max(1,Math.abs(L),Math.abs(je))&&Math.abs(F-Je)<=vi.EPSILON*Math.max(1,Math.abs(F),Math.abs(Je))&&Math.abs(B-Fe)<=vi.EPSILON*Math.max(1,Math.abs(B),Math.abs(Fe))&&Math.abs(U-_t)<=vi.EPSILON*Math.max(1,Math.abs(U),Math.abs(_t))},bn.sub=bn.mul=bn.ortho=bn.perspective=void 0;var vi=function(n,e){if(n&&n.__esModule)return n;if(null===n||"object"!==ty(n)&&"function"!=typeof n)return{default:n};var o=pw(void 0);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}(to);function pw(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(pw=function(a){return a?o:e})(n)}function mw(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function gw(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=e[4],v=e[5],b=e[6],C=e[7],M=e[8],I=e[9],R=e[10],L=e[11],F=e[12],B=e[13],U=e[14],Y=e[15],J=o[0],Q=o[1],oe=o[2],ae=o[3];return n[0]=J*a+Q*_+oe*M+ae*F,n[1]=J*c+Q*v+oe*I+ae*B,n[2]=J*d+Q*b+oe*R+ae*U,n[3]=J*p+Q*C+oe*L+ae*Y,n[4]=(J=o[4])*a+(Q=o[5])*_+(oe=o[6])*M+(ae=o[7])*F,n[5]=J*c+Q*v+oe*I+ae*B,n[6]=J*d+Q*b+oe*R+ae*U,n[7]=J*p+Q*C+oe*L+ae*Y,n[8]=(J=o[8])*a+(Q=o[9])*_+(oe=o[10])*M+(ae=o[11])*F,n[9]=J*c+Q*v+oe*I+ae*B,n[10]=J*d+Q*b+oe*R+ae*U,n[11]=J*p+Q*C+oe*L+ae*Y,n[12]=(J=o[12])*a+(Q=o[13])*_+(oe=o[14])*M+(ae=o[15])*F,n[13]=J*c+Q*v+oe*I+ae*B,n[14]=J*d+Q*b+oe*R+ae*U,n[15]=J*p+Q*C+oe*L+ae*Y,n}function _w(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=a+a,v=c+c,b=d+d,C=a*_,M=a*v,I=a*b,R=c*v,L=c*b,F=d*b,B=p*_,U=p*v,Y=p*b;return n[0]=1-(R+F),n[1]=M+Y,n[2]=I-U,n[3]=0,n[4]=M-Y,n[5]=1-(C+F),n[6]=L+B,n[7]=0,n[8]=I+U,n[9]=L-B,n[10]=1-(C+R),n[11]=0,n[12]=o[0],n[13]=o[1],n[14]=o[2],n[15]=1,n}function yw(n,e){var o=e[4],a=e[5],c=e[6],d=e[8],p=e[9],_=e[10];return n[0]=Math.hypot(e[0],e[1],e[2]),n[1]=Math.hypot(o,a,c),n[2]=Math.hypot(d,p,_),n}function bh(n,e,o,a,c){var d,p=1/Math.tan(e/2);return n[0]=p/o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=p,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=c&&c!==1/0?(n[10]=(c+a)*(d=1/(a-c)),n[14]=2*c*a*d):(n[10]=-1,n[14]=-2*a),n}function $0(n,e,o,a,c,d,p){var _=1/(e-o),v=1/(a-c),b=1/(d-p);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*b,n[11]=0,n[12]=(e+o)*_,n[13]=(c+a)*v,n[14]=(p+d)*b,n[15]=1,n}function G0(n,e,o){return n[0]=e[0]-o[0],n[1]=e[1]-o[1],n[2]=e[2]-o[2],n[3]=e[3]-o[3],n[4]=e[4]-o[4],n[5]=e[5]-o[5],n[6]=e[6]-o[6],n[7]=e[7]-o[7],n[8]=e[8]-o[8],n[9]=e[9]-o[9],n[10]=e[10]-o[10],n[11]=e[11]-o[11],n[12]=e[12]-o[12],n[13]=e[13]-o[13],n[14]=e[14]-o[14],n[15]=e[15]-o[15],n}bn.perspective=bh,bn.ortho=$0,bn.mul=gw,bn.sub=G0;var qt={},gn={};function wh(n){return(wh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}Object.defineProperty(gn,"__esModule",{value:!0}),gn.create=Eh,gn.clone=function(n){var e=new Bc.ARRAY_TYPE(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},gn.length=ny,gn.fromValues=function(n,e,o){var a=new Bc.ARRAY_TYPE(3);return a[0]=n,a[1]=e,a[2]=o,a},gn.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},gn.set=function(n,e,o,a){return n[0]=e,n[1]=o,n[2]=a,n},gn.add=function(n,e,o){return n[0]=e[0]+o[0],n[1]=e[1]+o[1],n[2]=e[2]+o[2],n},gn.subtract=dp,gn.multiply=Id,gn.divide=H0,gn.ceil=function(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n},gn.floor=function(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n},gn.min=function(n,e,o){return n[0]=Math.min(e[0],o[0]),n[1]=Math.min(e[1],o[1]),n[2]=Math.min(e[2],o[2]),n},gn.max=function(n,e,o){return n[0]=Math.max(e[0],o[0]),n[1]=Math.max(e[1],o[1]),n[2]=Math.max(e[2],o[2]),n},gn.round=function(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n},gn.scale=function(n,e,o){return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n},gn.scaleAndAdd=function(n,e,o,a){return n[0]=e[0]+o[0]*a,n[1]=e[1]+o[1]*a,n[2]=e[2]+o[2]*a,n},gn.distance=vw,gn.squaredDistance=q0,gn.squaredLength=xw,gn.negate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n},gn.inverse=function(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n},gn.normalize=function(n,e){var o=e[0],a=e[1],c=e[2],d=o*o+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n},gn.dot=Ks,gn.cross=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=o[0],_=o[1],v=o[2];return n[0]=c*v-d*_,n[1]=d*p-a*v,n[2]=a*_-c*p,n},gn.lerp=function(n,e,o,a){var c=e[0],d=e[1],p=e[2];return n[0]=c+a*(o[0]-c),n[1]=d+a*(o[1]-d),n[2]=p+a*(o[2]-p),n},gn.hermite=function(n,e,o,a,c,d){var p=d*d,_=p*(2*d-3)+1,v=p*(d-2)+d,b=p*(d-1),C=p*(3-2*d);return n[0]=e[0]*_+o[0]*v+a[0]*b+c[0]*C,n[1]=e[1]*_+o[1]*v+a[1]*b+c[1]*C,n[2]=e[2]*_+o[2]*v+a[2]*b+c[2]*C,n},gn.bezier=function(n,e,o,a,c,d){var p=1-d,_=p*p,v=d*d,b=_*p,C=3*d*_,M=3*v*p,I=v*d;return n[0]=e[0]*b+o[0]*C+a[0]*M+c[0]*I,n[1]=e[1]*b+o[1]*C+a[1]*M+c[1]*I,n[2]=e[2]*b+o[2]*C+a[2]*M+c[2]*I,n},gn.random=function(n,e){e=e||1;var o=2*Bc.RANDOM()*Math.PI,a=2*Bc.RANDOM()-1,c=Math.sqrt(1-a*a)*e;return n[0]=Math.cos(o)*c,n[1]=Math.sin(o)*c,n[2]=a*e,n},gn.transformMat4=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=o[3]*a+o[7]*c+o[11]*d+o[15];return n[0]=(o[0]*a+o[4]*c+o[8]*d+o[12])/(p=p||1),n[1]=(o[1]*a+o[5]*c+o[9]*d+o[13])/p,n[2]=(o[2]*a+o[6]*c+o[10]*d+o[14])/p,n},gn.transformMat3=function(n,e,o){var a=e[0],c=e[1],d=e[2];return n[0]=a*o[0]+c*o[3]+d*o[6],n[1]=a*o[1]+c*o[4]+d*o[7],n[2]=a*o[2]+c*o[5]+d*o[8],n},gn.transformQuat=function(n,e,o){var a=o[0],c=o[1],d=o[2],p=e[0],_=e[1],v=e[2],b=c*v-d*_,C=d*p-a*v,M=a*_-c*p,I=c*M-d*C,R=d*b-a*M,L=a*C-c*b,F=2*o[3];return C*=F,M*=F,R*=2,L*=2,n[0]=p+(b*=F)+(I*=2),n[1]=_+C+R,n[2]=v+M+L,n},gn.rotateX=function(n,e,o,a){var c=[],d=[];return c[0]=e[0]-o[0],c[1]=e[1]-o[1],c[2]=e[2]-o[2],d[0]=c[0],d[1]=c[1]*Math.cos(a)-c[2]*Math.sin(a),d[2]=c[1]*Math.sin(a)+c[2]*Math.cos(a),n[0]=d[0]+o[0],n[1]=d[1]+o[1],n[2]=d[2]+o[2],n},gn.rotateY=function(n,e,o,a){var c=[],d=[];return c[0]=e[0]-o[0],c[1]=e[1]-o[1],c[2]=e[2]-o[2],d[0]=c[2]*Math.sin(a)+c[0]*Math.cos(a),d[1]=c[1],d[2]=c[2]*Math.cos(a)-c[0]*Math.sin(a),n[0]=d[0]+o[0],n[1]=d[1]+o[1],n[2]=d[2]+o[2],n},gn.rotateZ=function(n,e,o,a){var c=[],d=[];return c[0]=e[0]-o[0],c[1]=e[1]-o[1],c[2]=e[2]-o[2],d[0]=c[0]*Math.cos(a)-c[1]*Math.sin(a),d[1]=c[0]*Math.sin(a)+c[1]*Math.cos(a),d[2]=c[2],n[0]=d[0]+o[0],n[1]=d[1]+o[1],n[2]=d[2]+o[2],n},gn.angle=function(n,e){var o=n[0],a=n[1],c=n[2],d=e[0],p=e[1],_=e[2],v=Math.sqrt(o*o+a*a+c*c)*Math.sqrt(d*d+p*p+_*_),b=v&&Ks(n,e)/v;return Math.acos(Math.min(Math.max(b,-1),1))},gn.zero=function(n){return n[0]=0,n[1]=0,n[2]=0,n},gn.str=function(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"},gn.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},gn.equals=function(n,e){var o=n[0],a=n[1],c=n[2],d=e[0],p=e[1],_=e[2];return Math.abs(o-d)<=Bc.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=Bc.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(c-_)<=Bc.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},gn.forEach=gn.sqrLen=gn.len=gn.sqrDist=gn.dist=gn.div=gn.mul=gn.sub=void 0;var Bc=function(n,e){if(n&&n.__esModule)return n;if(null===n||"object"!==wh(n)&&"function"!=typeof n)return{default:n};var o=Ta(void 0);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}(to);function Ta(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(Ta=function(a){return a?o:e})(n)}function Eh(){var n=new Bc.ARRAY_TYPE(3);return Bc.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ny(n){return Math.hypot(n[0],n[1],n[2])}function dp(n,e,o){return n[0]=e[0]-o[0],n[1]=e[1]-o[1],n[2]=e[2]-o[2],n}function Id(n,e,o){return n[0]=e[0]*o[0],n[1]=e[1]*o[1],n[2]=e[2]*o[2],n}function H0(n,e,o){return n[0]=e[0]/o[0],n[1]=e[1]/o[1],n[2]=e[2]/o[2],n}function vw(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])}function q0(n,e){var o=e[0]-n[0],a=e[1]-n[1],c=e[2]-n[2];return o*o+a*a+c*c}function xw(n){var e=n[0],o=n[1],a=n[2];return e*e+o*o+a*a}function Ks(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}gn.sub=dp,gn.mul=Id,gn.div=H0,gn.dist=vw,gn.sqrDist=q0,gn.len=ny,gn.sqrLen=xw;var Pl,Ad=(Pl=Eh(),function(n,e,o,a,c,d){var p,_;for(e||(e=3),o||(o=0),_=a?Math.min(a*e+o,n.length):n.length,p=o;p<_;p+=e)Pl[0]=n[p],Pl[1]=n[p+1],Pl[2]=n[p+2],c(Pl,Pl,d),n[p]=Pl[0],n[p+1]=Pl[1],n[p+2]=Pl[2];return n});gn.forEach=Ad;var An={};function Qm(n){return(Qm="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}Object.defineProperty(An,"__esModule",{value:!0}),An.create=W0,An.clone=function(n){var e=new tl.ARRAY_TYPE(4);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e},An.fromValues=function(n,e,o,a){var c=new tl.ARRAY_TYPE(4);return c[0]=n,c[1]=e,c[2]=o,c[3]=a,c},An.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},An.set=function(n,e,o,a,c){return n[0]=e,n[1]=o,n[2]=a,n[3]=c,n},An.add=function(n,e,o){return n[0]=e[0]+o[0],n[1]=e[1]+o[1],n[2]=e[2]+o[2],n[3]=e[3]+o[3],n},An.subtract=X0,An.multiply=Y0,An.divide=J0,An.ceil=function(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n[3]=Math.ceil(e[3]),n},An.floor=function(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n[3]=Math.floor(e[3]),n},An.min=function(n,e,o){return n[0]=Math.min(e[0],o[0]),n[1]=Math.min(e[1],o[1]),n[2]=Math.min(e[2],o[2]),n[3]=Math.min(e[3],o[3]),n},An.max=function(n,e,o){return n[0]=Math.max(e[0],o[0]),n[1]=Math.max(e[1],o[1]),n[2]=Math.max(e[2],o[2]),n[3]=Math.max(e[3],o[3]),n},An.round=function(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n[3]=Math.round(e[3]),n},An.scale=function(n,e,o){return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n},An.scaleAndAdd=function(n,e,o,a){return n[0]=e[0]+o[0]*a,n[1]=e[1]+o[1]*a,n[2]=e[2]+o[2]*a,n[3]=e[3]+o[3]*a,n},An.distance=eg,An.squaredDistance=fp,An.length=K0,An.squaredLength=pp,An.negate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=-e[3],n},An.inverse=function(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n[3]=1/e[3],n},An.normalize=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=o*o+a*a+c*c+d*d;return p>0&&(p=1/Math.sqrt(p)),n[0]=o*p,n[1]=a*p,n[2]=c*p,n[3]=d*p,n},An.dot=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]},An.cross=function(n,e,o,a){var c=o[0]*a[1]-o[1]*a[0],d=o[0]*a[2]-o[2]*a[0],p=o[0]*a[3]-o[3]*a[0],_=o[1]*a[2]-o[2]*a[1],v=o[1]*a[3]-o[3]*a[1],b=o[2]*a[3]-o[3]*a[2],C=e[0],M=e[1],I=e[2],R=e[3];return n[0]=M*b-I*v+R*_,n[1]=-C*b+I*p-R*d,n[2]=C*v-M*p+R*c,n[3]=-C*_+M*d-I*c,n},An.lerp=function(n,e,o,a){var c=e[0],d=e[1],p=e[2],_=e[3];return n[0]=c+a*(o[0]-c),n[1]=d+a*(o[1]-d),n[2]=p+a*(o[2]-p),n[3]=_+a*(o[3]-_),n},An.random=function(n,e){var o,a,c,d,p,_;e=e||1;do{p=(o=2*tl.RANDOM()-1)*o+(a=2*tl.RANDOM()-1)*a}while(p>=1);do{_=(c=2*tl.RANDOM()-1)*c+(d=2*tl.RANDOM()-1)*d}while(_>=1);var v=Math.sqrt((1-p)/_);return n[0]=e*o,n[1]=e*a,n[2]=e*c*v,n[3]=e*d*v,n},An.transformMat4=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3];return n[0]=o[0]*a+o[4]*c+o[8]*d+o[12]*p,n[1]=o[1]*a+o[5]*c+o[9]*d+o[13]*p,n[2]=o[2]*a+o[6]*c+o[10]*d+o[14]*p,n[3]=o[3]*a+o[7]*c+o[11]*d+o[15]*p,n},An.transformQuat=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=o[0],_=o[1],v=o[2],b=o[3],C=b*a+_*d-v*c,M=b*c+v*a-p*d,I=b*d+p*c-_*a,R=-p*a-_*c-v*d;return n[0]=C*b+R*-p+M*-v-I*-_,n[1]=M*b+R*-_+I*-p-C*-v,n[2]=I*b+R*-v+C*-_-M*-p,n[3]=e[3],n},An.zero=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},An.str=function(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},An.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},An.equals=function(n,e){var o=n[0],a=n[1],c=n[2],d=n[3],p=e[0],_=e[1],v=e[2],b=e[3];return Math.abs(o-p)<=tl.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-_)<=tl.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(c-v)<=tl.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(d-b)<=tl.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))},An.forEach=An.sqrLen=An.len=An.sqrDist=An.dist=An.div=An.mul=An.sub=void 0;var tl=function(n,e){if(n&&n.__esModule)return n;if(null===n||"object"!==Qm(n)&&"function"!=typeof n)return{default:n};var o=Z0(void 0);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}(to);function Z0(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(Z0=function(a){return a?o:e})(n)}function W0(){var n=new tl.ARRAY_TYPE(4);return tl.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function X0(n,e,o){return n[0]=e[0]-o[0],n[1]=e[1]-o[1],n[2]=e[2]-o[2],n[3]=e[3]-o[3],n}function Y0(n,e,o){return n[0]=e[0]*o[0],n[1]=e[1]*o[1],n[2]=e[2]*o[2],n[3]=e[3]*o[3],n}function J0(n,e,o){return n[0]=e[0]/o[0],n[1]=e[1]/o[1],n[2]=e[2]/o[2],n[3]=e[3]/o[3],n}function eg(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2],e[3]-n[3])}function fp(n,e){var o=e[0]-n[0],a=e[1]-n[1],c=e[2]-n[2],d=e[3]-n[3];return o*o+a*a+c*c+d*d}function K0(n){return Math.hypot(n[0],n[1],n[2],n[3])}function pp(n){var e=n[0],o=n[1],a=n[2],c=n[3];return e*e+o*o+a*a+c*c}An.sub=X0,An.mul=Y0,An.div=J0,An.dist=eg,An.sqrDist=fp,An.len=K0,An.sqrLen=pp;var bw=function(){var n=W0();return function(e,o,a,c,d,p){var _,v;for(o||(o=4),a||(a=0),v=c?Math.min(c*o+a,e.length):e.length,_=a;_<v;_+=o)n[0]=e[_],n[1]=e[_+1],n[2]=e[_+2],n[3]=e[_+3],d(n,n,p),e[_]=n[0],e[_+1]=n[1],e[_+2]=n[2],e[_+3]=n[3];return e}}();function Pd(n){return(Pd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}An.forEach=bw,Object.defineProperty(qt,"__esModule",{value:!0}),qt.create=iy,qt.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n},qt.setAxisAngle=Th,qt.getAxisAngle=function(n,e){var o=2*Math.acos(e[3]),a=Math.sin(o/2);return a>Ch.EPSILON?(n[0]=e[0]/a,n[1]=e[1]/a,n[2]=e[2]/a):(n[0]=1,n[1]=0,n[2]=0),o},qt.getAngle=function(n,e){var o=nx(n,e);return Math.acos(2*o*o-1)},qt.multiply=Rd,qt.rotateX=function(n,e,o){o*=.5;var a=e[0],c=e[1],d=e[2],p=e[3],_=Math.sin(o),v=Math.cos(o);return n[0]=a*v+p*_,n[1]=c*v+d*_,n[2]=d*v-c*_,n[3]=p*v-a*_,n},qt.rotateY=function(n,e,o){o*=.5;var a=e[0],c=e[1],d=e[2],p=e[3],_=Math.sin(o),v=Math.cos(o);return n[0]=a*v-d*_,n[1]=c*v+p*_,n[2]=d*v+a*_,n[3]=p*v-c*_,n},qt.rotateZ=function(n,e,o){o*=.5;var a=e[0],c=e[1],d=e[2],p=e[3],_=Math.sin(o),v=Math.cos(o);return n[0]=a*v+c*_,n[1]=c*v-a*_,n[2]=d*v+p*_,n[3]=p*v-d*_,n},qt.calculateW=function(n,e){var o=e[0],a=e[1],c=e[2];return n[0]=o,n[1]=a,n[2]=c,n[3]=Math.sqrt(Math.abs(1-o*o-a*a-c*c)),n},qt.exp=ex,qt.ln=ww,qt.pow=function(n,e,o){return ww(n,e),Ew(n,n,o),ex(n,n),n},qt.slerp=mp,qt.random=function(n){var e=Ch.RANDOM(),o=Ch.RANDOM(),a=Ch.RANDOM(),c=Math.sqrt(1-e),d=Math.sqrt(e);return n[0]=c*Math.sin(2*Math.PI*o),n[1]=c*Math.cos(2*Math.PI*o),n[2]=d*Math.sin(2*Math.PI*a),n[3]=d*Math.cos(2*Math.PI*a),n},qt.invert=function(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=o*o+a*a+c*c+d*d,_=p?1/p:0;return n[0]=-o*_,n[1]=-a*_,n[2]=-c*_,n[3]=d*_,n},qt.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},qt.fromMat3=tx,qt.fromEuler=function(n,e,o,a){var c=.5*Math.PI/180;e*=c,o*=c,a*=c;var d=Math.sin(e),p=Math.cos(e),_=Math.sin(o),v=Math.cos(o),b=Math.sin(a),C=Math.cos(a);return n[0]=d*v*C-p*_*b,n[1]=p*_*C+d*v*b,n[2]=p*v*b-d*_*C,n[3]=p*v*C+d*_*b,n},qt.str=function(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"},qt.setAxes=qt.sqlerp=qt.rotationTo=qt.equals=qt.exactEquals=qt.normalize=qt.sqrLen=qt.squaredLength=qt.len=qt.length=qt.lerp=qt.dot=qt.scale=qt.mul=qt.add=qt.set=qt.copy=qt.fromValues=qt.clone=void 0;var Ch=tg(to),Q0=tg(ir),Rl=tg(gn),hs=tg(An);function ry(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(ry=function(a){return a?o:e})(n)}function tg(n,e){if(!e&&n&&n.__esModule)return n;if(null===n||"object"!==Pd(n)&&"function"!=typeof n)return{default:n};var o=ry(e);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}function iy(){var n=new Ch.ARRAY_TYPE(4);return Ch.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Th(n,e,o){o*=.5;var a=Math.sin(o);return n[0]=a*e[0],n[1]=a*e[1],n[2]=a*e[2],n[3]=Math.cos(o),n}function Rd(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=o[0],v=o[1],b=o[2],C=o[3];return n[0]=a*C+p*_+c*b-d*v,n[1]=c*C+p*v+d*_-a*b,n[2]=d*C+p*b+a*v-c*_,n[3]=p*C-a*_-c*v-d*b,n}function ex(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=Math.sqrt(o*o+a*a+c*c),_=Math.exp(d),v=p>0?_*Math.sin(p)/p:0;return n[0]=o*v,n[1]=a*v,n[2]=c*v,n[3]=_*Math.cos(p),n}function ww(n,e){var o=e[0],a=e[1],c=e[2],d=e[3],p=Math.sqrt(o*o+a*a+c*c),_=p>0?Math.atan2(p,d)/p:0;return n[0]=o*_,n[1]=a*_,n[2]=c*_,n[3]=.5*Math.log(o*o+a*a+c*c+d*d),n}function mp(n,e,o,a){var c,d,p,_,v,b=e[0],C=e[1],M=e[2],I=e[3],R=o[0],L=o[1],F=o[2],B=o[3];return(d=b*R+C*L+M*F+I*B)<0&&(d=-d,R=-R,L=-L,F=-F,B=-B),1-d>Ch.EPSILON?(c=Math.acos(d),p=Math.sin(c),_=Math.sin((1-a)*c)/p,v=Math.sin(a*c)/p):(_=1-a,v=a),n[0]=_*b+v*R,n[1]=_*C+v*L,n[2]=_*M+v*F,n[3]=_*I+v*B,n}function tx(n,e){var o,a=e[0]+e[4]+e[8];if(a>0)o=Math.sqrt(a+1),n[3]=.5*o,n[0]=(e[5]-e[7])*(o=.5/o),n[1]=(e[6]-e[2])*o,n[2]=(e[1]-e[3])*o;else{var c=0;e[4]>e[0]&&(c=1),e[8]>e[3*c+c]&&(c=2);var d=(c+1)%3,p=(c+2)%3;o=Math.sqrt(e[3*c+c]-e[3*d+d]-e[3*p+p]+1),n[c]=.5*o,n[3]=(e[3*d+p]-e[3*p+d])*(o=.5/o),n[d]=(e[3*d+c]+e[3*c+d])*o,n[p]=(e[3*p+c]+e[3*c+p])*o}return n}qt.clone=hs.clone,qt.fromValues=hs.fromValues,qt.copy=hs.copy,qt.set=hs.set,qt.add=hs.add,qt.mul=Rd;var Ew=hs.scale;qt.scale=Ew;var nx=hs.dot;qt.dot=nx,qt.lerp=hs.lerp;var rx=hs.length;qt.length=rx,qt.len=rx;var ix=hs.squaredLength;qt.squaredLength=ix,qt.sqrLen=ix;var Od=hs.normalize;qt.normalize=Od,qt.exactEquals=hs.exactEquals,qt.equals=hs.equals;var nl,ox,oy,QT=(nl=Rl.create(),ox=Rl.fromValues(1,0,0),oy=Rl.fromValues(0,1,0),function(n,e,o){var a=Rl.dot(e,o);return a<-.999999?(Rl.cross(nl,ox,e),Rl.len(nl)<1e-6&&Rl.cross(nl,oy,e),Rl.normalize(nl,nl),Th(n,nl,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Rl.cross(nl,e,o),n[0]=nl[0],n[1]=nl[1],n[2]=nl[2],n[3]=1+a,Od(n,n))});qt.rotationTo=QT;var ng,sx,Cw=(ng=iy(),sx=iy(),function(n,e,o,a,c,d){return mp(ng,e,c,d),mp(sx,o,a,d),mp(n,ng,sx,2*d*(1-d)),n});qt.sqlerp=Cw;var Ol,sy=(Ol=Q0.create(),function(n,e,o,a){return Ol[0]=o[0],Ol[3]=o[1],Ol[6]=o[2],Ol[1]=a[0],Ol[4]=a[1],Ol[7]=a[2],Ol[2]=-e[0],Ol[5]=-e[1],Ol[8]=-e[2],Od(n,tx(n,Ol))});qt.setAxes=sy;var Bn={};function ax(n){return(ax="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.create=function(){var n=new Yo.ARRAY_TYPE(8);return Yo.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0),n[3]=1,n},Bn.clone=function(n){var e=new Yo.ARRAY_TYPE(8);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e},Bn.fromValues=function(n,e,o,a,c,d,p,_){var v=new Yo.ARRAY_TYPE(8);return v[0]=n,v[1]=e,v[2]=o,v[3]=a,v[4]=c,v[5]=d,v[6]=p,v[7]=_,v},Bn.fromRotationTranslationValues=function(n,e,o,a,c,d,p){var _=new Yo.ARRAY_TYPE(8);_[0]=n,_[1]=e,_[2]=o,_[3]=a;var v=.5*c,b=.5*d,C=.5*p;return _[4]=v*a+b*o-C*e,_[5]=b*a+C*n-v*o,_[6]=C*a+v*e-b*n,_[7]=-v*n-b*e-C*o,_},Bn.fromRotationTranslation=Dw,Bn.fromTranslation=function(n,e){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=.5*e[0],n[5]=.5*e[1],n[6]=.5*e[2],n[7]=0,n},Bn.fromRotation=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=0,n[5]=0,n[6]=0,n[7]=0,n},Bn.fromMat4=function(n,e){var o=Au.create();Tw.getRotation(o,e);var a=new Yo.ARRAY_TYPE(3);return Tw.getTranslation(a,e),Dw(n,o,a),n},Bn.copy=cx,Bn.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n},Bn.set=function(n,e,o,a,c,d,p,_,v){return n[0]=e,n[1]=o,n[2]=a,n[3]=c,n[4]=d,n[5]=p,n[6]=_,n[7]=v,n},Bn.getDual=function(n,e){return n[0]=e[4],n[1]=e[5],n[2]=e[6],n[3]=e[7],n},Bn.setDual=function(n,e){return n[4]=e[0],n[5]=e[1],n[6]=e[2],n[7]=e[3],n},Bn.getTranslation=function(n,e){var o=e[4],a=e[5],c=e[6],d=e[7],p=-e[0],_=-e[1],v=-e[2],b=e[3];return n[0]=2*(o*b+d*p+a*v-c*_),n[1]=2*(a*b+d*_+c*p-o*v),n[2]=2*(c*b+d*v+o*_-a*p),n},Bn.translate=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=.5*o[0],v=.5*o[1],b=.5*o[2],C=e[4],M=e[5],I=e[6],R=e[7];return n[0]=a,n[1]=c,n[2]=d,n[3]=p,n[4]=p*_+c*b-d*v+C,n[5]=p*v+d*_-a*b+M,n[6]=p*b+a*v-c*_+I,n[7]=-a*_-c*v-d*b+R,n},Bn.rotateX=function(n,e,o){var a=-e[0],c=-e[1],d=-e[2],p=e[3],_=e[4],v=e[5],b=e[6],C=e[7],M=_*p+C*a+v*d-b*c,I=v*p+C*c+b*a-_*d,R=b*p+C*d+_*c-v*a,L=C*p-_*a-v*c-b*d;return Au.rotateX(n,e,o),n[4]=M*(p=n[3])+L*(a=n[0])+I*(d=n[2])-R*(c=n[1]),n[5]=I*p+L*c+R*a-M*d,n[6]=R*p+L*d+M*c-I*a,n[7]=L*p-M*a-I*c-R*d,n},Bn.rotateY=function(n,e,o){var a=-e[0],c=-e[1],d=-e[2],p=e[3],_=e[4],v=e[5],b=e[6],C=e[7],M=_*p+C*a+v*d-b*c,I=v*p+C*c+b*a-_*d,R=b*p+C*d+_*c-v*a,L=C*p-_*a-v*c-b*d;return Au.rotateY(n,e,o),n[4]=M*(p=n[3])+L*(a=n[0])+I*(d=n[2])-R*(c=n[1]),n[5]=I*p+L*c+R*a-M*d,n[6]=R*p+L*d+M*c-I*a,n[7]=L*p-M*a-I*c-R*d,n},Bn.rotateZ=function(n,e,o){var a=-e[0],c=-e[1],d=-e[2],p=e[3],_=e[4],v=e[5],b=e[6],C=e[7],M=_*p+C*a+v*d-b*c,I=v*p+C*c+b*a-_*d,R=b*p+C*d+_*c-v*a,L=C*p-_*a-v*c-b*d;return Au.rotateZ(n,e,o),n[4]=M*(p=n[3])+L*(a=n[0])+I*(d=n[2])-R*(c=n[1]),n[5]=I*p+L*c+R*a-M*d,n[6]=R*p+L*d+M*c-I*a,n[7]=L*p-M*a-I*c-R*d,n},Bn.rotateByQuatAppend=function(n,e,o){var a=o[0],c=o[1],d=o[2],p=o[3],_=e[0],v=e[1],b=e[2],C=e[3];return n[0]=_*p+C*a+v*d-b*c,n[1]=v*p+C*c+b*a-_*d,n[2]=b*p+C*d+_*c-v*a,n[3]=C*p-_*a-v*c-b*d,n[4]=(_=e[4])*p+(C=e[7])*a+(v=e[5])*d-(b=e[6])*c,n[5]=v*p+C*c+b*a-_*d,n[6]=b*p+C*d+_*c-v*a,n[7]=C*p-_*a-v*c-b*d,n},Bn.rotateByQuatPrepend=function(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=o[0],v=o[1],b=o[2],C=o[3];return n[0]=a*C+p*_+c*b-d*v,n[1]=c*C+p*v+d*_-a*b,n[2]=d*C+p*b+a*v-c*_,n[3]=p*C-a*_-c*v-d*b,n[4]=a*(C=o[7])+p*(_=o[4])+c*(b=o[6])-d*(v=o[5]),n[5]=c*C+p*v+d*_-a*b,n[6]=d*C+p*b+a*v-c*_,n[7]=p*C-a*_-c*v-d*b,n},Bn.rotateAroundAxis=function(n,e,o,a){if(Math.abs(a)<Yo.EPSILON)return cx(n,e);var c=Math.hypot(o[0],o[1],o[2]);a*=.5;var d=Math.sin(a),p=d*o[0]/c,_=d*o[1]/c,v=d*o[2]/c,b=Math.cos(a),C=e[0],M=e[1],I=e[2],R=e[3];n[0]=C*b+R*p+M*v-I*_,n[1]=M*b+R*_+I*p-C*v,n[2]=I*b+R*v+C*_-M*p,n[3]=R*b-C*p-M*_-I*v;var L=e[4],F=e[5],B=e[6],U=e[7];return n[4]=L*b+U*p+F*v-B*_,n[5]=F*b+U*_+B*p-L*v,n[6]=B*b+U*v+L*_-F*p,n[7]=U*b-L*p-F*_-B*v,n},Bn.add=function(n,e,o){return n[0]=e[0]+o[0],n[1]=e[1]+o[1],n[2]=e[2]+o[2],n[3]=e[3]+o[3],n[4]=e[4]+o[4],n[5]=e[5]+o[5],n[6]=e[6]+o[6],n[7]=e[7]+o[7],n},Bn.multiply=gp,Bn.scale=function(n,e,o){return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*o,n[5]=e[5]*o,n[6]=e[6]*o,n[7]=e[7]*o,n},Bn.lerp=function(n,e,o,a){var c=1-a;return _p(e,o)<0&&(a=-a),n[0]=e[0]*c+o[0]*a,n[1]=e[1]*c+o[1]*a,n[2]=e[2]*c+o[2]*a,n[3]=e[3]*c+o[3]*a,n[4]=e[4]*c+o[4]*a,n[5]=e[5]*c+o[5]*a,n[6]=e[6]*c+o[6]*a,n[7]=e[7]*c+o[7]*a,n},Bn.invert=function(n,e){var o=yp(e);return n[0]=-e[0]/o,n[1]=-e[1]/o,n[2]=-e[2]/o,n[3]=e[3]/o,n[4]=-e[4]/o,n[5]=-e[5]/o,n[6]=-e[6]/o,n[7]=e[7]/o,n},Bn.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n[4]=-e[4],n[5]=-e[5],n[6]=-e[6],n[7]=e[7],n},Bn.normalize=function(n,e){var o=yp(e);if(o>0){o=Math.sqrt(o);var a=e[0]/o,c=e[1]/o,d=e[2]/o,p=e[3]/o,_=e[4],v=e[5],b=e[6],C=e[7],M=a*_+c*v+d*b+p*C;n[0]=a,n[1]=c,n[2]=d,n[3]=p,n[4]=(_-a*M)/o,n[5]=(v-c*M)/o,n[6]=(b-d*M)/o,n[7]=(C-p*M)/o}return n},Bn.str=function(n){return"quat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+")"},Bn.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]},Bn.equals=function(n,e){var o=n[0],a=n[1],c=n[2],d=n[3],p=n[4],_=n[5],v=n[6],b=n[7],C=e[0],M=e[1],I=e[2],R=e[3],L=e[4],F=e[5],B=e[6],U=e[7];return Math.abs(o-C)<=Yo.EPSILON*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(a-M)<=Yo.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(c-I)<=Yo.EPSILON*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(d-R)<=Yo.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-L)<=Yo.EPSILON*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(_-F)<=Yo.EPSILON*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(v-B)<=Yo.EPSILON*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(b-U)<=Yo.EPSILON*Math.max(1,Math.abs(b),Math.abs(U))},Bn.sqrLen=Bn.squaredLength=Bn.len=Bn.length=Bn.dot=Bn.mul=Bn.setReal=Bn.getReal=void 0;var Yo=lx(to),Au=lx(qt),Tw=lx(bn);function Mw(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(Mw=function(a){return a?o:e})(n)}function lx(n,e){if(!e&&n&&n.__esModule)return n;if(null===n||"object"!==ax(n)&&"function"!=typeof n)return{default:n};var o=Mw(e);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}function Dw(n,e,o){var a=.5*o[0],c=.5*o[1],d=.5*o[2],p=e[0],_=e[1],v=e[2],b=e[3];return n[0]=p,n[1]=_,n[2]=v,n[3]=b,n[4]=a*b+c*v-d*_,n[5]=c*b+d*p-a*v,n[6]=d*b+a*_-c*p,n[7]=-a*p-c*_-d*v,n}function cx(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n}function gp(n,e,o){var a=e[0],c=e[1],d=e[2],p=e[3],_=o[4],v=o[5],b=o[6],C=o[7],M=e[4],I=e[5],R=e[6],L=e[7],F=o[0],B=o[1],U=o[2],Y=o[3];return n[0]=a*Y+p*F+c*U-d*B,n[1]=c*Y+p*B+d*F-a*U,n[2]=d*Y+p*U+a*B-c*F,n[3]=p*Y-a*F-c*B-d*U,n[4]=a*C+p*_+c*b-d*v+M*Y+L*F+I*U-R*B,n[5]=c*C+p*v+d*_-a*b+I*Y+L*B+R*F-M*U,n[6]=d*C+p*b+a*v-c*_+R*Y+L*U+M*B-I*F,n[7]=p*C-a*_-c*v-d*b+L*Y-M*F-I*B-R*U,n}Bn.getReal=Au.copy,Bn.setReal=Au.copy,Bn.mul=gp;var _p=Au.dot;Bn.dot=_p;var ay=Au.length;Bn.length=ay,Bn.len=ay;var yp=Au.squaredLength;Bn.squaredLength=yp,Bn.sqrLen=yp;var En={};function Pu(n){return(Pu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}Object.defineProperty(En,"__esModule",{value:!0}),En.create=vp,En.clone=function(n){var e=new Ru.ARRAY_TYPE(2);return e[0]=n[0],e[1]=n[1],e},En.fromValues=function(n,e){var o=new Ru.ARRAY_TYPE(2);return o[0]=n,o[1]=e,o},En.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n},En.set=function(n,e,o){return n[0]=e,n[1]=o,n},En.add=function(n,e,o){return n[0]=e[0]+o[0],n[1]=e[1]+o[1],n},En.subtract=xp,En.multiply=Vc,En.divide=ux,En.ceil=function(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n},En.floor=function(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n},En.min=function(n,e,o){return n[0]=Math.min(e[0],o[0]),n[1]=Math.min(e[1],o[1]),n},En.max=function(n,e,o){return n[0]=Math.max(e[0],o[0]),n[1]=Math.max(e[1],o[1]),n},En.round=function(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n},En.scale=function(n,e,o){return n[0]=e[0]*o,n[1]=e[1]*o,n},En.scaleAndAdd=function(n,e,o,a){return n[0]=e[0]+o[0]*a,n[1]=e[1]+o[1]*a,n},En.distance=hx,En.squaredDistance=dx,En.length=cy,En.squaredLength=rg,En.negate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n},En.inverse=function(n,e){return n[0]=1/e[0],n[1]=1/e[1],n},En.normalize=function(n,e){var o=e[0],a=e[1],c=o*o+a*a;return c>0&&(c=1/Math.sqrt(c)),n[0]=e[0]*c,n[1]=e[1]*c,n},En.dot=function(n,e){return n[0]*e[0]+n[1]*e[1]},En.cross=function(n,e,o){var a=e[0]*o[1]-e[1]*o[0];return n[0]=n[1]=0,n[2]=a,n},En.lerp=function(n,e,o,a){var c=e[0],d=e[1];return n[0]=c+a*(o[0]-c),n[1]=d+a*(o[1]-d),n},En.random=function(n,e){e=e||1;var o=2*Ru.RANDOM()*Math.PI;return n[0]=Math.cos(o)*e,n[1]=Math.sin(o)*e,n},En.transformMat2=function(n,e,o){var a=e[0],c=e[1];return n[0]=o[0]*a+o[2]*c,n[1]=o[1]*a+o[3]*c,n},En.transformMat2d=function(n,e,o){var a=e[0],c=e[1];return n[0]=o[0]*a+o[2]*c+o[4],n[1]=o[1]*a+o[3]*c+o[5],n},En.transformMat3=function(n,e,o){var a=e[0],c=e[1];return n[0]=o[0]*a+o[3]*c+o[6],n[1]=o[1]*a+o[4]*c+o[7],n},En.transformMat4=function(n,e,o){var a=e[0],c=e[1];return n[0]=o[0]*a+o[4]*c+o[12],n[1]=o[1]*a+o[5]*c+o[13],n},En.rotate=function(n,e,o,a){var c=e[0]-o[0],d=e[1]-o[1],p=Math.sin(a),_=Math.cos(a);return n[0]=c*_-d*p+o[0],n[1]=c*p+d*_+o[1],n},En.angle=function(n,e){var o=n[0],a=n[1],c=e[0],d=e[1],p=Math.sqrt(o*o+a*a)*Math.sqrt(c*c+d*d);return Math.acos(Math.min(Math.max(p&&(o*c+a*d)/p,-1),1))},En.zero=function(n){return n[0]=0,n[1]=0,n},En.str=function(n){return"vec2("+n[0]+", "+n[1]+")"},En.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]},En.equals=function(n,e){var o=n[0],a=n[1],c=e[0],d=e[1];return Math.abs(o-c)<=Ru.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-d)<=Ru.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},En.forEach=En.sqrLen=En.sqrDist=En.dist=En.div=En.mul=En.sub=En.len=void 0;var Ru=function(n,e){if(n&&n.__esModule)return n;if(null===n||"object"!==Pu(n)&&"function"!=typeof n)return{default:n};var o=ly(void 0);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}(to);function ly(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(ly=function(a){return a?o:e})(n)}function vp(){var n=new Ru.ARRAY_TYPE(2);return Ru.ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0),n}function xp(n,e,o){return n[0]=e[0]-o[0],n[1]=e[1]-o[1],n}function Vc(n,e,o){return n[0]=e[0]*o[0],n[1]=e[1]*o[1],n}function ux(n,e,o){return n[0]=e[0]/o[0],n[1]=e[1]/o[1],n}function hx(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1])}function dx(n,e){var o=e[0]-n[0],a=e[1]-n[1];return o*o+a*a}function cy(n){return Math.hypot(n[0],n[1])}function rg(n){var e=n[0],o=n[1];return e*e+o*o}En.len=cy,En.sub=xp,En.mul=Vc,En.div=ux,En.dist=hx,En.sqrDist=dx,En.sqrLen=rg;var Sw=function(){var n=vp();return function(e,o,a,c,d,p){var _,v;for(o||(o=2),a||(a=0),v=c?Math.min(c*o+a,e.length):e.length,_=a;_<v;_+=o)n[0]=e[_],n[1]=e[_+1],d(n,n,p),e[_]=n[0],e[_+1]=n[1];return e}}();function uy(n){return(uy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}En.forEach=Sw,Object.defineProperty(eo,"__esModule",{value:!0}),f.e=eo.vec4=f.v=eo.vec3=eo.vec2=eo.quat2=f.q=eo.quat=f.m=eo.mat4=f.bx=eo.mat3=eo.mat2d=f.h=eo.mat2=eo.glMatrix=void 0;var Iw=Ll(to);eo.glMatrix=Iw;var fx=Ll(Qr);f.h=eo.mat2=fx;var Aw=Ll(oi);eo.mat2d=Aw;var Pw=Ll(ir);f.bx=eo.mat3=Pw;var Qs=Ll(bn);f.m=eo.mat4=Qs;var hy=Ll(qt);f.q=eo.quat=hy;var px=Ll(Bn);eo.quat2=px;var dy=Ll(En);eo.vec2=dy;var ds=Ll(gn);f.v=eo.vec3=ds;var bp=Ll(An);function fy(n){if("function"!=typeof WeakMap)return null;var e=new WeakMap,o=new WeakMap;return(fy=function(a){return a?o:e})(n)}function Ll(n,e){if(!e&&n&&n.__esModule)return n;if(null===n||"object"!==uy(n)&&"function"!=typeof n)return{default:n};var o=fy(e);if(o&&o.has(n))return o.get(n);var a={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in n)if("default"!==d&&Object.prototype.hasOwnProperty.call(n,d)){var p=c?Object.getOwnPropertyDescriptor(n,d):null;p&&(p.get||p.set)?Object.defineProperty(a,d,p):a[d]=n[d]}return a.default=n,o&&o.set(n,a),a}f.e=eo.vec4=bp;const Rw=Ft([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:wp}=Rw,mx=Ft([{name:"a_pos_3",components:3,type:"Int16"}]);var Ld=Ft([{name:"a_pos",type:"Int16",components:2}]),gx={};!function(o){function a(d,p,_){var v=c(256*d,256*(p=Math.pow(2,_)-p-1),_),b=c(256*(d+1),256*(p+1),_);return v[0]+","+v[1]+","+b[0]+","+b[1]}function c(d,p,_){var v=2*Math.PI*6378137/256/Math.pow(2,_);return[d*v-2*Math.PI*6378137/2,p*v-2*Math.PI*6378137/2]}o.getURL=function(d,p,_,v,b,C){return C=C||{},d+"?"+["bbox="+a(_,v,b),"format="+(C.format||"image/png"),"service="+(C.service||"WMS"),"version="+(C.version||"1.1.1"),"request="+(C.request||"GetMap"),"srs="+(C.srs||"EPSG:3857"),"width="+(C.width||256),"height="+(C.height||256),"layers="+p].join("&")},o.getTileBBox=a,o.getMercCoords=c,Object.defineProperty(o,"__esModule",{value:!0})}(gx);var _x=gx;class Mh{constructor(e,o,a){this.z=e,this.x=o,this.y=a,this.key=Dh(0,e,e,o,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o){const a=_x.getTileBBox(this.x,this.y,this.z),c=function(d,p,_){let v,b="";for(let C=d;C>0;C--)v=1<<C-1,b+=(p&v?1:0)+(_&v?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===o?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yx{constructor(e,o){this.wrap=e,this.canonical=o,this.key=Dh(e,o.z,o.z,o.x,o.y)}}class no{constructor(e,o,a,c,d){this.overscaledZ=e,this.wrap=o,this.canonical=new Mh(a,+c,+d),this.key=0===o&&e===a?this.canonical.key:Dh(o,e,a,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const o=this.canonical.z-e;return e>this.canonical.z?new no(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new no(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o=!0){if(this.overscaledZ===e&&o)return this.key;if(e>this.canonical.z)return Dh(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Dh(this.wrap*+o,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const o=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new no(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new no(o,this.wrap,o,a,c),new no(o,this.wrap,o,a+1,c),new no(o,this.wrap,o,a,c+1),new no(o,this.wrap,o,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new no(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new no(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Dh(n,e,o,a,c){const d=1<<Math.min(o,22);let p=d*(c%d)+a%d;return n&&o<22&&(p+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-o)))),16*(32*p+o)+(e-o)}const Ow=[n=>{let e=n.canonical.x-1,o=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,o--),new no(n.overscaledZ,o,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,o=n.wrap;return e===1<<n.canonical.z&&(e=0,o++),new no(n.overscaledZ,o,n.canonical.z,e,n.canonical.y)},n=>new no(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(0===n.canonical.y?1<<n.canonical.z:n.canonical.y)-1),n=>new no(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];It(Mh,"CanonicalTileID"),It(no,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class Sh{constructor(e,o){this.pos=e,this.dir=o}intersectsPlane(e,o,a){const c=f.v.dot(o,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((e[0]-this.pos[0])*o[0]+(e[1]-this.pos[1])*o[1]+(e[2]-this.pos[2])*o[2])/c;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,o,a){if(f.v.equals(this.pos,e)||0===o)return a[0]=a[1]=a[2]=0,!1;const[c,d,p]=this.dir,_=this.pos[0]-e[0],v=this.pos[1]-e[1],b=this.pos[2]-e[2],C=c*c+d*d+p*p,M=2*(_*c+v*d+b*p),I=M*M-4*C*(_*_+v*v+b*b-o*o);if(I<0){const R=Math.max(-M/2,0),L=_+c*R,F=v+d*R,B=b+p*R,U=Math.hypot(L,F,B);return a[0]=L*o/U,a[1]=F*o/U,a[2]=B*o/U,!1}{const R=(-M-Math.sqrt(I))/(2*C);if(R<0){const L=Math.hypot(_,v,b);return a[0]=_*o/L,a[1]=v*o/L,a[2]=b*o/L,!1}return a[0]=_+c*R,a[1]=v+d*R,a[2]=b+p*R,!0}}}class py{constructor(e,o,a,c,d){this.TL=e,this.TR=o,this.BR=a,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(e,o,a){const c=[-1,1,1],d=[1,1,1],p=[1,-1,1],_=[-1,-1,1],v=f.v.transformMat4(c,c,e),b=f.v.transformMat4(d,d,e),C=f.v.transformMat4(p,p,e),M=f.v.transformMat4(_,_,e);return new py(v,b,C,M,o/a)}}function Ep(n,e,o){let a=1/0,c=-1/0;const d=[];for(const p of n){f.v.sub(d,p,e);const _=f.v.dot(d,o);a=Math.min(a,_),c=Math.max(c,_)}return[a,c]}function my(n,e){let o=!0;for(let a=0;a<n.planes.length;a++){const c=n.planes[a];let d=0;for(let p=0;p<e.length;p++)d+=f.v.dot(c,e[p])+c[3]>=0;if(0===d)return 0;d!==e.length&&(o=!1)}return o?2:1}function gy(n,e){for(const o of n.projections){const a=Ep(e,n.points[0],o.axis);if(o.projection[1]<a[0]||o.projection[0]>a[1])return 0}return 1}function _y(n,e){let o=0;const a=[0,0,0,0];for(let c=0;c<n.length;c++)a[0]=n[c][0],a[1]=n[c][1],a[2]=n[c][2],a[3]=1,f.e.dot(a,e)>=0&&o++;return o}class Ou{constructor(e,o){this.points=e||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=hi.fromPoints(this.points),this.projections=[],this.frustumEdges=[f.v.sub([],this.points[2],this.points[3]),f.v.sub([],this.points[0],this.points[3]),f.v.sub([],this.points[4],this.points[0]),f.v.sub([],this.points[5],this.points[1]),f.v.sub([],this.points[6],this.points[2]),f.v.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const c=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:c,projection:Ep(this.points,this.points[0],c)}),this.projections.push({axis:d,projection:Ep(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,o,a,c){const d=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const C=f.e.transformMat4([],b,e),M=1/C[3]/o*d;return f.e.mul(C,C,[M,M,c?1/C[3]:M,M])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const C=f.v.sub([],p[b[0]],p[b[1]]),M=f.v.sub([],p[b[2]],p[b[1]]),I=f.v.normalize([],f.v.cross([],C,M)),R=-f.v.dot(I,p[b[1]]);return I.concat(R)}),v=[];for(let b=0;b<p.length;b++)v.push([p[b][0],p[b][1],p[b][2]]);return new Ou(v,_)}intersectsPrecise(e,o,a){for(let c=0;c<o.length;c++)if(!_y(e,o[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!_y(e,this.planes[c]))return 0;for(const c of a)for(const d of this.frustumEdges){const p=f.v.cross([],c,d),_=f.v.length(p);if(0===_)continue;f.v.scale(p,p,1/_);const v=Ep(this.points,this.points[0],p),b=Ep(e,this.points[0],p);if(v[0]>b[1]||b[0]>v[1])return 0}return 1}}class hi{static fromPoints(e){const o=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const c of e)f.v.min(o,o,c),f.v.max(a,a,c);return new hi(o,a)}static fromTileIdAndHeight(e,o,a){const c=1<<e.canonical.z,d=e.canonical.x,p=e.canonical.y;return new hi([d/c,p/c,o],[(d+1)/c,(p+1)/c,a])}static applyTransform(e,o){const a=e.getCorners();for(let c=0;c<a.length;++c)f.v.transformMat4(a[c],a[c],o);return hi.fromPoints(a)}static projectAabbCorners(e,o){const a=e.getCorners();for(let c=0;c<a.length;++c)f.v.transformMat4(a[c],a[c],o);return a}constructor(e,o){this.min=e,this.max=o,this.center=f.v.scale([],f.v.add([],this.min,this.max),.5)}quadrant(e){const o=[e%2==0,e<2],a=f.v.clone(this.min),c=f.v.clone(this.max);for(let d=0;d<o.length;d++)a[d]=o[d]?this.min[d]:this.center[d],c[d]=o[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new hi(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,o=this.max;return[[e[0],e[1],e[2]],[o[0],e[1],e[2]],[o[0],o[1],e[2]],[e[0],o[1],e[2]],[e[0],e[1],o[2]],[o[0],e[1],o[2]],[o[0],o[1],o[2]],[e[0],o[1],o[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?my(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?my(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,o){return o||this.intersects(e)?gy(e,this.getCorners()):0}intersectsPreciseFlat(e,o){return o||this.intersectsFlat(e)?gy(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let o=0;o<3;++o)if(this.min[o]>e.max[o]||e.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],e.min[o]),this.max[o]=Math.max(this.max[o],e.max[o])}encapsulatePoint(e){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],e[o]),this.max[o]=Math.max(this.max[o],e[o])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}It(hi,"Aabb");const ig=5,og=6,fs=ct/Math.PI/2,Lw=16383,yy=[64,32,16],rl=-fs,il=fs,kw=[new hi([rl,rl,rl],[il,il,il]),new hi([rl,rl,rl],[0,0,il]),new hi([0,rl,rl],[il,0,il]),new hi([rl,0,rl],[0,il,il]),new hi([0,0,rl],[il,il,il])];function Cp(n){return n*fs/Uc}function Tp(n,e,o,a=!0){const c=f.v.scale([],n._camera.position,n.worldSize),d=[e,o,1,1];f.e.transformMat4(d,d,n.pixelMatrixInverse),f.e.scale(d,d,1/d[3]);const p=f.v.sub([],d,c),_=f.v.normalize([],p),v=n.globeMatrix,b=[v[12],v[13],v[14]],C=f.v.sub([],b,c),M=f.v.length(C),I=f.v.normalize([],C),R=n.worldSize/(2*Math.PI),L=f.v.dot(I,_),F=Math.asin(R/M);if(F<Math.acos(L)){if(!a)return null;const Se=[],Ue=[];f.v.scale(Se,_,M/L),f.v.normalize(Ue,f.v.sub(Ue,Se,C)),f.v.normalize(_,f.v.add(_,C,f.v.scale(_,Ue,Math.tan(F)*M)))}const B=[];new Sh(c,_).closestPointOnSphere(b,R,B);const U=f.v.normalize([],Ot(v,0)),Y=f.v.normalize([],Ot(v,1)),J=f.v.normalize([],Ot(v,2)),Q=f.v.dot(U,B),oe=f.v.dot(Y,B),ae=f.v.dot(J,B),me=Yi(Math.asin(-oe/R));let _e=Yi(Math.atan2(Q,ae));_e=n.center.lng+function(Se,Ue){const ot=(Ue-Se+180)%360-180;return ot<-180?ot+360:ot}(n.center.lng,_e);const Ee=kl(_e),Pe=dn(Da(me),0,1);return new lo(Ee,Pe)}class vy{constructor(e,o,a){this.a=f.v.sub([],e,a),this.b=f.v.sub([],o,a),this.center=a;const c=f.v.normalize([],this.a),d=f.v.normalize([],this.b);this.angle=Math.acos(f.v.dot(c,d))}}function Mp(n,e){if(0===n.angle)return null;let o;return o=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),o<0||o>1?null:function(a,c,d,p){const _=Math.sin(d);return a*(Math.sin((1-p)*d)/_)+c*(Math.sin(p*d)/_)}(n.a[e],n.b[e],n.angle,dn(o,0,1))+n.center[e]}function ec(n){if(n.z<=1)return kw[n.z+2*n.y+n.x];const e=ag(Dp(n));return hi.fromPoints(e)}function jc(n,e,o){return f.v.scale(n,n,1-o),f.v.scaleAndAdd(n,n,e,o)}function sg(n,e){const o=Ma(e.zoom);if(0===o)return ec(n);const a=Dp(n),c=ag(a),d=kl(a.getWest())*e.worldSize,p=kl(a.getEast())*e.worldSize,_=Da(a.getNorth())*e.worldSize,v=Da(a.getSouth())*e.worldSize,b=[d,_,0],C=[p,_,0],M=[d,v,0],I=[p,v,0],R=f.m.invert([],e.globeMatrix);return f.v.transformMat4(b,b,R),f.v.transformMat4(C,C,R),f.v.transformMat4(M,M,R),f.v.transformMat4(I,I,R),c[0]=jc(c[0],M,o),c[1]=jc(c[1],I,o),c[2]=jc(c[2],C,o),c[3]=jc(c[3],b,o),hi.fromPoints(c)}function xy(n,e,o){for(const a of n)f.v.transformMat4(a,a,e),f.v.scale(a,a,o)}function Lu(n,e,o,a){const c=e/n.worldSize,d=n.globeMatrix;if(o.z<=1){const Ee=ec(o).getCorners();return xy(Ee,d,c),hi.fromPoints(Ee)}const p=Dp(o,a),_=ag(p);xy(_,d,c);const v=Number.MAX_VALUE,b=[-v,-v,-v],C=[v,v,v];if(p.contains(n.center)){for(const Se of _)f.v.min(C,C,Se),f.v.max(b,b,Se);b[2]=0;const Ee=n.point,Pe=[Ee.x*c,Ee.y*c,0];return f.v.min(C,C,Pe),f.v.max(b,b,Pe),new hi(C,b)}const M=[d[12]*c,d[13]*c,d[14]*c],I=p.getCenter(),R=dn(n.center.lat,-Ai,Ai),L=dn(I.lat,-Ai,Ai),F=kl(n.center.lng),B=Da(R);let U=F-kl(I.lng);const Y=B-Da(L);U>.5?U-=1:U<-.5&&(U+=1);let J=0;if(Math.abs(U)>Math.abs(Y))J=U>=0?1:3;else{J=Y>=0?0:2;const Ee=[d[4]*c,d[5]*c,d[6]*c],Pe=-Math.sin(wt(Y>=0?p.getSouth():p.getNorth()))*fs;f.v.scaleAndAdd(M,M,Ee,Pe)}const Q=_[J],oe=_[(J+1)%4],ae=new vy(Q,oe,M),me=[Mp(ae,0)||Q[0],Mp(ae,1)||Q[1],Mp(ae,2)||Q[2]],_e=Ma(n.zoom);if(_e>0){const Ee=function({x:Se,y:Ue,z:ot},je,Je,Fe,_t){const Et=1/(1<<ot);let rt=Se*Et,Jt=rt+Et,St=Ue*Et,mt=St+Et,Ht=0;const Nt=(rt+Jt)/2-Fe;return Nt>.5?Ht=-1:Nt<-.5&&(Ht=1),rt=((rt+Ht)*je-(Fe*=je))*Je+Fe,Jt=((Jt+Ht)*je-Fe)*Je+Fe,St=(St*je-(_t*=je))*Je+_t,mt=(mt*je-_t)*Je+_t,[[rt,mt,0],[Jt,mt,0],[Jt,St,0],[rt,St,0]]}(o,e,n._pixelsPerMercatorPixel,F,B);for(let Se=0;Se<_.length;Se++)jc(_[Se],Ee[Se],_e);const Pe=f.v.add([],Ee[J],Ee[(J+1)%4]);f.v.scale(Pe,Pe,.5),jc(me,Pe,_e)}for(const Ee of _)f.v.min(C,C,Ee),f.v.max(b,b,Ee);return C[2]=Math.min(Q[2],oe[2]),f.v.min(C,C,me),f.v.max(b,b,me),new hi(C,b)}function Dp({x:n,y:e,z:o},a=!1){const c=1/(1<<o),d=new hr(To(n*c),e===(1<<o)-1&&a?-90:Mo((e+1)*c)),p=new hr(To((n+1)*c),0===e&&a?90:Mo(e*c));return new Nc(d,p)}function ag(n){const e=wt(n.getNorth()),o=wt(n.getSouth()),a=Math.cos(e),c=Math.cos(o),d=Math.sin(e),p=Math.sin(o),_=n.getWest(),v=n.getEast();return[Fd(c,p,_),Fd(c,p,v),Fd(a,d,v),Fd(a,d,_)]}function Fd(n,e,o,a=fs){return o=wt(o),[n*Math.sin(o)*a,-e*a,n*Math.cos(o)*a]}function Nd(n,e,o){return Fd(Math.cos(wt(n)),Math.sin(wt(n)),e,o)}function ku(n,e,o,a){const c=1<<o.z,d=(n/ct+o.x)/c;return Nd(Mo((e/ct+o.y)/c),To(d),a)}function lg({min:n,max:e}){return Lw/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const by=new Float64Array(16);function zd(n){const e=lg(n),o=f.m.fromScaling(by,[e,e,e]);return f.m.translate(o,o,f.v.negate([],n.min))}function cg(n){const e=f.m.fromTranslation(by,n.min),o=1/lg(n);return f.m.scale(e,e,[o,o,o])}function Sp(n){const e=ct/(2*Math.PI);return n/(2*Math.PI)/e}function wy(n,e){return ct/(512*Math.pow(2,n))*lg(ec(e))}function Ip(n,e,o,a,c){const d=Sp(o),p=[n,e,-o/(2*Math.PI)],_=f.m.identity(new Float64Array(16));return f.m.translate(_,_,p),f.m.scale(_,_,[d,d,d]),f.m.rotateX(_,_,wt(-c)),f.m.rotateY(_,_,wt(-a)),_}function Ma(n){return Bs(ig,og,n)}function Ey(n,e){const o=Nd(e.lat,e.lng),a=function(d){const p=Nd(d._center.lat,d._center.lng),_=f.v.fromValues(0,1,0);let v=f.v.cross([],_,p);const b=f.m.fromRotation([],-d.angle,p);v=f.v.transformMat4(v,v,b),f.m.fromRotation(b,-d._pitch,v);const C=f.v.normalize([],p);return f.v.scale(C,C,Cp(d.cameraToCenterDistance/d.pixelsPerMeter)),f.v.transformMat4(C,C,b),f.v.add([],p,C)}(n),c=f.v.subtract([],a,o);return f.v.angle(c,o)}function Ap(n,e){return Ey(n,e)>Math.PI/2*1.01}const Pp=wt(85),vx=Math.cos(Pp),Cy=Math.sin(Pp),Uc=6371008.8,Ty=2*Math.PI*Uc;class $c{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $c(fr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const o=Math.PI/180,a=this.lat*o,c=e.lat*o,d=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*o);return Uc*Math.acos(Math.min(d,1))}toBounds(e=0){const o=360*e/40075017,a=o/Math.cos(Math.PI/180*this.lat);return new Nc(new $c(this.lng-a,this.lat-o),new $c(this.lng+a,this.lat+o))}toEcef(e){const o=Cp(e);return Nd(this.lat,this.lng,fs+o)}static convert(e){if(e instanceof $c)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new $c(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new $c(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var hr=$c;const Fw=0,Nw=25.5;function ug(n){return Ty*Math.cos(n*Math.PI/180)}function kl(n){return(180+n)/360}function Da(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Vo(n,e){return n/ug(e)}function To(n){return 360*n-180}function Mo(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function xx(n,e){return n*ug(Mo(e))}const Ai=85.051129;function bx(n){return Math.cos(wt(dn(n,-Ai,Ai)))}function Gc(n,e){const o=dn(e,Fw,Nw),a=Math.pow(2,o);return bx(n)*Ty/(512*a)}function wx(n){return 1/Math.cos(n*Math.PI/180)}function Hc(n,e=0){const o=Math.exp(Math.PI*(1-(n.y+e/ct)/(1<<n.z)*2));return 80150034*o/(o*o+1)/ct/(1<<n.z)}class lo{constructor(e,o,a=0){this.x=+e,this.y=+o,this.z=+a}static fromLngLat(e,o=0){const a=hr.convert(e);return new lo(kl(a.lng),Da(a.lat),Vo(o,a.lat))}toLngLat(){return new hr(To(this.x),Mo(this.y))}toAltitude(){return xx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ty*wx(Mo(this.y))}}function Rp(n,e,o,a,c,d,p,_,v){const b=(e+a)/2,C=(o+c)/2,M=new ut(b,C);_(M),function(I,R,L,F,B,U){const Y=L-B,J=F-U;return Math.abs((F-R)*Y-(L-I)*J)/Math.hypot(Y,J)}(M.x,M.y,d.x,d.y,p.x,p.y)>=v?(Rp(n,e,o,b,C,d,M,_,v),Rp(n,b,C,a,c,M,p,_,v)):n.push(p)}function My(n,e,o){let a=n[0],c=a.x,d=a.y;e(a);const p=[a];for(let _=1;_<n.length;_++){const v=n[_],{x:b,y:C}=v;e(v),Rp(p,c,d,b,C,a,v,e,o),c=b,d=C,a=v}return p}function hg(n,e,o,a){if(a(e,o)){const c=e.add(o)._mult(.5);hg(n,e,c,a),hg(n,c,o,a)}else n.push(o)}function Ex(n,e){let o=n[0];const a=[o];for(let c=1;c<n.length;c++){const d=n[c];hg(a,o,d,e),o=d}return a}const dg=Math.pow(2,14)-1,Cx=-dg-1;function zw(n,e){const o=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=dn(o,Cx,dg),n.y=dn(a,Cx,dg),(o<n.x||o>n.x+1||a<n.y||a>n.y+1)&&Rr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function tc(n,e,o){const a=n.loadGeometry(),c=n.extent,d=ct/c;if(e&&o&&o.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:_,x:v,y:b,projection:C}=o,M=I=>{const R=To((e.x+I.x/c)/p),L=Mo((e.y+I.y/c)/p),F=C.project(R,L);I.x=(F.x*_-v)*c,I.y=(F.y*_-b)*c};for(let I=0;I<a.length;I++)if(1!==n.type)a[I]=My(a[I],M,1);else{const R=[];for(const L of a[I])L.x<0||L.x>=c||L.y<0||L.y>=c||(M(L),R.push(L));a[I]=R}}for(const p of a)for(const _ of p)zw(_,d);return a}function Fu(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?tc(n):[]}}function fg(n,e,o,a,c){n.emplaceBack(2*e+(a+1)/2,2*o+(c+1)/2)}function Fl(n,e,o){n.emplaceBack(e.x,e.y,e.z,16384*o[0],16384*o[1],16384*o[2])}class Ih{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ke,this.indexArray=new qn,this.segments=new Ur,this.programConfigurations=new Al(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,a,c){const d=this.layers[0],p=[];let _=null;"circle"===d.type&&(_=d.layout.get("circle-sort-key"));for(const{feature:b,id:C,index:M,sourceLayerIndex:I}of e){const R=this.layers[0]._featureFilter.needGeometry,L=Fu(b,R);if(!this.layers[0]._featureFilter.filter(new pe(this.zoom),L,a))continue;const F=_?_.evaluate(L,{},a):void 0,B={id:C,properties:b.properties,type:b.type,sourceLayerIndex:I,index:M,geometry:R?L.geometry:tc(b,a,c),patterns:{},sortKey:F};p.push(B)}_&&p.sort((b,C)=>b.sortKey-C.sortKey);let v=null;"globe"===c.projection.name&&(this.globeExtVertexArray=new Sr,v=c.projection);for(const b of p){const{geometry:C,index:M,sourceLayerIndex:I}=b,R=e[M].feature;this.addFeature(b,C,M,o.availableImages,a,v,o.brightness),o.featureIndex.insert(R,C,M,I,this.index)}}update(e,o,a,c,d){const p=0!==Object.keys(e).length;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,o,p?this.stateDependentLayers:this.layers,a,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,uw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,o,a,c,d,p,_){for(const v of o)for(const b of v){const C=b.x,M=b.y;if(C<0||C>=ct||M<0||M>=ct)continue;if(p){const L=p.projectTilePoint(C,M,d),F=p.upVector(d,C,M),B=this.globeExtVertexArray;Fl(B,L,F),Fl(B,L,F),Fl(B,L,F),Fl(B,L,F)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=I.vertexLength;fg(this.layoutVertexArray,C,M,-1,-1),fg(this.layoutVertexArray,C,M,1,-1),fg(this.layoutVertexArray,C,M,1,1),fg(this.layoutVertexArray,C,M,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,d,_)}}function Tx(n,e){for(let o=0;o<n.length;o++)if(Ah(e,n[o]))return!0;for(let o=0;o<e.length;o++)if(Ah(n,e[o]))return!0;return!!Mx(n,e)}function eM(n,e,o){return!!Ah(n,e)||!!pg(e,n,o)}function Bw(n,e){if(1===n.length)return Sx(e,n[0]);for(let o=0;o<e.length;o++){const a=e[o];for(let c=0;c<a.length;c++)if(Ah(n,a[c]))return!0}for(let o=0;o<n.length;o++)if(Sx(e,n[o]))return!0;for(let o=0;o<e.length;o++)if(Mx(n,e[o]))return!0;return!1}function tM(n,e,o){if(n.length>1){if(Mx(n,e))return!0;for(let a=0;a<e.length;a++)if(pg(e[a],n,o))return!0}for(let a=0;a<n.length;a++)if(pg(n[a],e,o))return!0;return!1}function Mx(n,e){if(0===n.length||0===e.length)return!1;for(let o=0;o<n.length-1;o++){const a=n[o],c=n[o+1];for(let d=0;d<e.length-1;d++)if(nM(a,c,e[d],e[d+1]))return!0}return!1}function nM(n,e,o,a){return qe(n,o,a)!==qe(e,o,a)&&qe(n,e,o)!==qe(n,e,a)}function pg(n,e,o){const a=o*o;if(1===e.length)return n.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(Dx(n,e[c-1],e[c])<a)return!0;return!1}function Dx(n,e,o){const a=e.distSqr(o);if(0===a)return n.distSqr(e);const c=((n.x-e.x)*(o.x-e.x)+(n.y-e.y)*(o.y-e.y))/a;return n.distSqr(c<0?e:c>1?o:o.sub(e)._mult(c)._add(e))}function Sx(n,e){let o,a,c,d=!1;for(let p=0;p<n.length;p++){o=n[p];for(let _=0,v=o.length-1;_<o.length;v=_++)a=o[_],c=o[v],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(d=!d)}return d}function Ah(n,e){let o=!1;for(let a=0,c=n.length-1;a<n.length;c=a++){const d=n[a],p=n[c];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(o=!o)}return o}function Ix(n,e,o,a,c){for(const p of n)if(e<=p.x&&o<=p.y&&a>=p.x&&c>=p.y)return!0;const d=[new ut(e,o),new ut(e,c),new ut(a,c),new ut(a,o)];if(n.length>2)for(const p of d)if(Ah(n,p))return!0;for(let p=0;p<n.length-1;p++)if(Dy(n[p],n[p+1],d))return!0;return!1}function Dy(n,e,o){const a=o[0],c=o[2];if(n.x<a.x&&e.x<a.x||n.x>c.x&&e.x>c.x||n.y<a.y&&e.y<a.y||n.y>c.y&&e.y>c.y)return!1;const d=qe(n,e,o[0]);return d!==qe(n,e,o[1])||d!==qe(n,e,o[2])||d!==qe(n,e,o[3])}function ea(n,e,o,a,c,d){let p=e.y-n.y,_=n.x-e.x;if(d=d||0){const v=p*p+_*_;if(0===v)return!0;const b=Math.sqrt(v);p/=b,_/=b}return!((o.x-n.x)*p+(o.y-n.y)*_-d<0||(a.x-n.x)*p+(a.y-n.y)*_-d<0||(c.x-n.x)*p+(c.y-n.y)*_-d<0)}function Ph(n,e,o,a,c,d,p){return!(ea(n,e,a,c,d,p)||ea(e,o,a,c,d,p)||ea(o,n,a,c,d,p)||ea(a,c,n,e,o,p)||ea(c,d,n,e,o,p)||ea(d,a,n,e,o,p))}function Rh(n,e,o){const a=e.paint.get(n).value;return"constant"===a.kind?a.value:o.programConfigurations.get(e.id).getMaxValue(n)}function Op(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Sy(n,e,o,a,c){if(!e[0]&&!e[1])return n;const d=ut.convert(e)._mult(c);"viewport"===o&&d._rotate(-a);const p=[];for(let _=0;_<n.length;_++)p.push(n[_].sub(d));return p}function Vw(n,e,o,a){const c=ut.convert(n)._mult(a);return"viewport"===e&&c._rotate(-o),c}It(Ih,"CircleBucket",{omit:["layers"]});const rM=new Xe({"circle-sort-key":new Me(De.layout_circle["circle-sort-key"]),visibility:new re(De.layout_circle.visibility)});var iM={paint:new Xe({"circle-radius":new Me(De.paint_circle["circle-radius"]),"circle-color":new Me(De.paint_circle["circle-color"]),"circle-blur":new Me(De.paint_circle["circle-blur"]),"circle-opacity":new Me(De.paint_circle["circle-opacity"]),"circle-translate":new re(De.paint_circle["circle-translate"]),"circle-translate-anchor":new re(De.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new re(De.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new re(De.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Me(De.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Me(De.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Me(De.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new re(De.paint_circle["circle-emissive-strength"])}),layout:rM};const Iy=f.m.create(),mg=n=>{const e=[];return"map"===n.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===n.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function jw(n,e,o,a,c,d,p,_,v){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(v*=n.pixelToTileUnitsFactor);const b=n.tileID.canonical,C=o.projection.upVectorScale(b,o.center.lat,o.worldSize).metersToTile;for(const M of e)for(const I of M){const R=I.add(_),L=c&&o.elevation?o.elevation.exaggeration()*c.getElevationAt(R.x,R.y,!0):0,F=o.projection.projectTilePoint(R.x,R.y,b);if(L>0){const J=o.projection.upVector(b,R.x,R.y);F.x+=J[0]*C*L,F.y+=J[1]*C*L,F.z+=J[2]*C*L}const B=d?R:oM(F.x,F.y,F.z,a),U=d?n.tilespaceRays.map(J=>$w(J,L)):n.queryGeometry.screenGeometry,Y=f.e.transformMat4([],[F.x,F.y,F.z,1],a);if(!p&&d?v*=Y[3]/o.cameraToCenterDistance:p&&!d&&(v*=o.cameraToCenterDistance/Y[3]),d){const J=Mo((I.y/ct+b.y)/(1<<b.z));v/=o.projection.pixelsPerMeter(J,1)/Vo(1,J)}if(eM(U,B,v))return!0}return!1}function oM(n,e,o,a){const c=f.e.transformMat4([],[n,e,o,1],a);return new ut(c[0]/c[3],c[1]/c[3])}const Ay=f.v.fromValues(0,0,0),Uw=f.v.fromValues(0,0,1);function $w(n,e){const o=f.v.create();return Ay[2]=e,n.intersectsPlane(Ay,Uw,o),new ut(o[0],o[1])}class Ax extends Ih{}function Px(n,{width:e,height:o},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*o*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*o*a);return n.width=e,n.height=o,n.data=c,n}function Py(n,e,o){const{width:a,height:c}=e;a===n.width&&c===n.height||(Bd(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,c)},o),n.width=a,n.height=c,n.data=e.data)}function Bd(n,e,o,a,c,d,p){if(0===c.width||0===c.height)return e;if(c.width>n.width||c.height>n.height||o.x>n.width-c.width||o.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const _=n.data,v=e.data,b=4===d&&p;for(let C=0;C<c.height;C++){const M=((o.y+C)*n.width+o.x)*d,I=((a.y+C)*e.width+a.x)*d;if(b)for(let R=0;R<c.width;R++){const L=M+R*d+3,F=I+R*d;v[F+0]=255,v[F+1]=255,v[F+2]=255,v[F+3]=_[L]}else for(let R=0;R<c.width*d;R++)v[I+R]=_[M+R]}return e}It(Ax,"HeatmapBucket",{omit:["layers"]});class qc{constructor(e,o){Px(this,e,1,o)}resize(e){Py(this,new qc(e),1)}clone(){return new qc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,a,c,d){Bd(e,o,a,c,d,1)}}class Ls{constructor(e,o){Px(this,e,4,o)}resize(e){Py(this,new Ls(e),4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ls({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,a,c,d,p){Bd(e,o,a,c,d,4,p)}}class Rx{constructor(e,o){this.width=e.width,this.height=e.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}It(qc,"AlphaImage"),It(Ls,"RGBAImage");const Vd=new Xe({visibility:new re(De.layout_heatmap.visibility)});var Gw={paint:new Xe({"heatmap-radius":new Me(De.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Me(De.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new re(De.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tt(De.paint_heatmap["heatmap-color"]),"heatmap-opacity":new re(De.paint_heatmap["heatmap-opacity"])}),layout:Vd};function gg(n){const e={},o=n.resolution||256,a=n.clips?n.clips.length:1,c=n.image||new Ls({width:o,height:a}),d=(p,_,v)=>{e[n.evaluationKey]=v;const b=n.expression.evaluate(e);b&&(c.data[p+_+0]=Math.floor(255*b.r/b.a),c.data[p+_+1]=Math.floor(255*b.g/b.a),c.data[p+_+2]=Math.floor(255*b.b/b.a),c.data[p+_+3]=Math.floor(255*b.a))};if(n.clips)for(let p=0,_=0;p<a;++p,_+=4*o)for(let v=0,b=0;v<o;v++,b+=4){const C=v/(o-1),{start:M,end:I}=n.clips[p];d(_,b,M*(1-C)+I*C)}else for(let p=0,_=0;p<o;p++,_+=4)d(0,_,p/(o-1));return c}const Ox=new Xe({visibility:new re(De.layout_hillshade.visibility)});var Lx={paint:new Xe({"hillshade-illumination-direction":new re(De.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new re(De.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new re(De.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new re(De.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new re(De.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new re(De.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new re(De.paint_hillshade["hillshade-emissive-strength"])}),layout:Ox};const Hw=Ft([{name:"a_pos",components:2,type:"Int16"}],4),{members:qw}=Hw;var Ry={exports:{}};function _g(n,e,o){o=o||2;var a,c,d,p,_,v,b,C=e&&e.length,M=C?e[0]*o:n.length,I=Oy(n,0,M,o,!0),R=[];if(!I||I.next===I.prev)return R;if(C&&(I=function(F,B,U,Y){var J,Q,oe,ae=[];for(J=0,Q=B.length;J<Q;J++)(oe=Oy(F,B[J]*Y,J<Q-1?B[J+1]*Y:F.length,Y,!1))===oe.next&&(oe.steiner=!0),ae.push(zx(oe));for(ae.sort(Ly),J=0;J<ae.length;J++)U=Nx(ae[J],U);return U}(n,e,I,o)),n.length>80*o){a=d=n[0],c=p=n[1];for(var L=o;L<M;L+=o)(_=n[L])<a&&(a=_),(v=n[L+1])<c&&(c=v),_>d&&(d=_),v>p&&(p=v);b=0!==(b=Math.max(d-a,p-c))?32767/b:0}return yg(I,R,o,a,c,b,0),R}function Oy(n,e,o,a,c){var d,p;if(c===zp(n,e,o,a)>0)for(d=e;d<o;d+=a)p=wg(d,n[d],n[d+1],p);else for(d=o-a;d>=e;d-=a)p=wg(d,n[d],n[d+1],p);return p&&xg(p,p.next)&&(Nu(p),p=p.next),p}function jd(n,e){if(!n)return n;e||(e=n);var o,a=n;do{if(o=!1,a.steiner||!xg(a,a.next)&&0!==Pi(a.prev,a,a.next))a=a.next;else{if(Nu(a),(a=e=a.prev)===a.next)break;o=!0}}while(o||a!==e);return e}function yg(n,e,o,a,c,d,p){if(n){!p&&d&&function(C,M,I,R){var L=C;do{0===L.z&&(L.z=vg(L.x,L.y,M,I,R)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next}while(L!==C);L.prevZ.nextZ=null,L.prevZ=null,function(F){var B,U,Y,J,Q,oe,ae,me,_e=1;do{for(U=F,F=null,Q=null,oe=0;U;){for(oe++,Y=U,ae=0,B=0;B<_e&&(ae++,Y=Y.nextZ);B++);for(me=_e;ae>0||me>0&&Y;)0!==ae&&(0===me||!Y||U.z<=Y.z)?(J=U,U=U.nextZ,ae--):(J=Y,Y=Y.nextZ,me--),Q?Q.nextZ=J:F=J,J.prevZ=Q,Q=J;U=Y}Q.nextZ=null,_e*=2}while(oe>1)}(L)}(n,a,c,d);for(var _,v,b=n;n.prev!==n.next;)if(_=n.prev,v=n.next,d?kp(n,a,c,d):Lp(n))e.push(_.i/o|0),e.push(n.i/o|0),e.push(v.i/o|0),Nu(n),n=v.next,b=v.next;else if((n=v)===b){p?1===p?yg(n=kx(jd(n),e,o),e,o,a,c,d,2):2===p&&Fx(n,e,o,a,c,d):yg(jd(n),e,o,a,c,d,1);break}}}function Lp(n){var e=n.prev,o=n,a=n.next;if(Pi(e,o,a)>=0)return!1;for(var c=e.x,d=o.x,p=a.x,_=e.y,v=o.y,b=a.y,C=c<d?c<p?c:p:d<p?d:p,M=_<v?_<b?_:b:v<b?v:b,I=c>d?c>p?c:p:d>p?d:p,R=_>v?_>b?_:b:v>b?v:b,L=a.next;L!==e;){if(L.x>=C&&L.x<=I&&L.y>=M&&L.y<=R&&Zc(c,_,d,v,p,b,L.x,L.y)&&Pi(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function kp(n,e,o,a){var c=n.prev,d=n,p=n.next;if(Pi(c,d,p)>=0)return!1;for(var _=c.x,v=d.x,b=p.x,C=c.y,M=d.y,I=p.y,R=_<v?_<b?_:b:v<b?v:b,L=C<M?C<I?C:I:M<I?M:I,F=_>v?_>b?_:b:v>b?v:b,B=C>M?C>I?C:I:M>I?M:I,U=vg(R,L,e,o,a),Y=vg(F,B,e,o,a),J=n.prevZ,Q=n.nextZ;J&&J.z>=U&&Q&&Q.z<=Y;){if(J.x>=R&&J.x<=F&&J.y>=L&&J.y<=B&&J!==c&&J!==p&&Zc(_,C,v,M,b,I,J.x,J.y)&&Pi(J.prev,J,J.next)>=0||(J=J.prevZ,Q.x>=R&&Q.x<=F&&Q.y>=L&&Q.y<=B&&Q!==c&&Q!==p&&Zc(_,C,v,M,b,I,Q.x,Q.y)&&Pi(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;J&&J.z>=U;){if(J.x>=R&&J.x<=F&&J.y>=L&&J.y<=B&&J!==c&&J!==p&&Zc(_,C,v,M,b,I,J.x,J.y)&&Pi(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;Q&&Q.z<=Y;){if(Q.x>=R&&Q.x<=F&&Q.y>=L&&Q.y<=B&&Q!==c&&Q!==p&&Zc(_,C,v,M,b,I,Q.x,Q.y)&&Pi(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function kx(n,e,o){var a=n;do{var c=a.prev,d=a.next.next;!xg(c,d)&&bg(c,a,a.next,d)&&Nl(c,d)&&Nl(d,c)&&(e.push(c.i/o|0),e.push(a.i/o|0),e.push(d.i/o|0),Nu(a),Nu(a.next),a=n=d),a=a.next}while(a!==n);return jd(a)}function Fx(n,e,o,a,c,d){var p=n;do{for(var _=p.next.next;_!==p.prev;){if(p.i!==_.i&&sM(p,_)){var v=Bx(p,_);return p=jd(p,p.next),v=jd(v,v.next),yg(p,e,o,a,c,d,0),void yg(v,e,o,a,c,d,0)}_=_.next}p=p.next}while(p!==n)}function Ly(n,e){return n.x-e.x}function Nx(n,e){var o=function(c,d){var p,_=d,v=c.x,b=c.y,C=-1/0;do{if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){var M=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(M<=v&&M>C&&(C=M,p=_.x<_.next.x?_:_.next,M===v))return p}_=_.next}while(_!==d);if(!p)return null;var I,R=p,L=p.x,F=p.y,B=1/0;_=p;do{v>=_.x&&_.x>=L&&v!==_.x&&Zc(b<F?v:C,b,L,F,b<F?C:v,b,_.x,_.y)&&(I=Math.abs(b-_.y)/(v-_.x),Nl(_,c)&&(I<B||I===B&&(_.x>p.x||_.x===p.x&&Zw(p,_)))&&(p=_,B=I)),_=_.next}while(_!==R);return p}(n,e);if(!o)return e;var a=Bx(o,n);return jd(a,a.next),jd(o,o.next)}function Zw(n,e){return Pi(n.prev,n,e.prev)<0&&Pi(e.next,n,n.next)<0}function vg(n,e,o,a,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-o)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function zx(n){var e=n,o=n;do{(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next}while(e!==n);return o}function Zc(n,e,o,a,c,d,p,_){return(c-p)*(e-_)>=(n-p)*(d-_)&&(n-p)*(a-_)>=(o-p)*(e-_)&&(o-p)*(d-_)>=(c-p)*(a-_)}function sM(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(o,a){var c=o;do{if(c.i!==o.i&&c.next.i!==o.i&&c.i!==a.i&&c.next.i!==a.i&&bg(c,c.next,o,a))return!0;c=c.next}while(c!==o);return!1}(n,e)&&(Nl(n,e)&&Nl(e,n)&&function(o,a){var c=o,d=!1,p=(o.x+a.x)/2,_=(o.y+a.y)/2;do{c.y>_!=c.next.y>_&&c.next.y!==c.y&&p<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next}while(c!==o);return d}(n,e)&&(Pi(n.prev,n,e.prev)||Pi(n,e.prev,e))||xg(n,e)&&Pi(n.prev,n,n.next)>0&&Pi(e.prev,e,e.next)>0)}function Pi(n,e,o){return(e.y-n.y)*(o.x-e.x)-(e.x-n.x)*(o.y-e.y)}function xg(n,e){return n.x===e.x&&n.y===e.y}function bg(n,e,o,a){var c=Np(Pi(n,e,o)),d=Np(Pi(n,e,a)),p=Np(Pi(o,a,n)),_=Np(Pi(o,a,e));return c!==d&&p!==_||!(0!==c||!Fp(n,o,e))||!(0!==d||!Fp(n,a,e))||!(0!==p||!Fp(o,n,a))||!(0!==_||!Fp(o,e,a))}function Fp(n,e,o){return e.x<=Math.max(n.x,o.x)&&e.x>=Math.min(n.x,o.x)&&e.y<=Math.max(n.y,o.y)&&e.y>=Math.min(n.y,o.y)}function Np(n){return n>0?1:n<0?-1:0}function Nl(n,e){return Pi(n.prev,n,n.next)<0?Pi(n,e,n.next)>=0&&Pi(n,n.prev,e)>=0:Pi(n,e,n.prev)<0||Pi(n,n.next,e)<0}function Bx(n,e){var o=new ky(n.i,n.x,n.y),a=new ky(e.i,e.x,e.y),c=n.next,d=e.prev;return n.next=e,e.prev=n,o.next=c,c.prev=o,a.next=o,o.prev=a,d.next=a,a.prev=d,a}function wg(n,e,o,a){var c=new ky(n,e,o);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Nu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function ky(n,e,o){this.i=n,this.x=e,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zp(n,e,o,a){for(var c=0,d=e,p=o-a;d<o;d+=a)c+=(n[p]-n[d])*(n[d+1]+n[p+1]),p=d;return c}Ry.exports=_g,Ry.exports.default=_g,_g.deviation=function(n,e,o,a){var c=e&&e.length,d=Math.abs(zp(n,0,c?e[0]*o:n.length,o));if(c)for(var p=0,_=e.length;p<_;p++)d-=Math.abs(zp(n,e[p]*o,p<_-1?e[p+1]*o:n.length,o));var v=0;for(p=0;p<a.length;p+=3){var b=a[p]*o,C=a[p+1]*o,M=a[p+2]*o;v+=Math.abs((n[b]-n[M])*(n[C+1]-n[b+1])-(n[b]-n[C])*(n[M+1]-n[b+1]))}return 0===d&&0===v?0:Math.abs((v-d)/d)},_g.flatten=function(n){for(var e=n[0][0].length,o={vertices:[],holes:[],dimensions:e},a=0,c=0;c<n.length;c++){for(var d=0;d<n[c].length;d++)for(var p=0;p<e;p++)o.vertices.push(n[c][d][p]);c>0&&o.holes.push(a+=n[c-1].length)}return o};var Oh=yr(Ry.exports);function ta(n,e){const o=n.length;if(o<=1)return[n];const a=[];let c,d;for(let p=0;p<o;p++){const _=le(n[p]);0!==_&&(n[p].area=Math.abs(_),void 0===d&&(d=_<0),d===_<0?(c&&a.push(c),c=[n[p]]):c.push(n[p]))}if(c&&a.push(c),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(uu(a[p],e,1,a[p].length-1,Ud),a[p]=a[p].slice(0,e));return a}function Ud(n,e){return e.area-n.area}function Bp(n,e,o){const a=o.patternDependencies;let c=!1;for(const d of e){const p=d.paint.get(`${n}-pattern`);p.isConstant()||(c=!0);const _=p.constantOr(null);_&&(c=!0,a[_]=!0)}return c}function Fy(n,e,o,a,c){const d=c.patternDependencies;for(const p of e){const _=p.paint.get(`${n}-pattern`).value;if("constant"!==_.kind){let v=_.evaluate({zoom:a},o,{},c.availableImages);v=v&&v.name?v.name:v,d[v]=!0,o.patterns[p.id]=v}}return o}class Eg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ke,this.indexArray=new qn,this.indexArray2=new No,this.programConfigurations=new Al(e.layers,e.zoom),this.segments=new Ur,this.segments2=new Ur,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=e.projection}populate(e,o,a,c){this.hasPattern=Bp("fill",this.layers,o);const d=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:_,id:v,index:b,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,I=Fu(_,M);if(!this.layers[0]._featureFilter.filter(new pe(this.zoom),I,a))continue;const R=d?d.evaluate(I,{},a,o.availableImages):void 0,L={id:v,properties:_.properties,type:_.type,sourceLayerIndex:C,index:b,geometry:M?I.geometry:tc(_,a,c),patterns:{},sortKey:R};p.push(L)}d&&p.sort((_,v)=>_.sortKey-v.sortKey);for(const _ of p){const{geometry:v,index:b,sourceLayerIndex:C}=_;if(this.hasPattern){const M=Fy("fill",this.layers,_,this.zoom,o);this.patternFeatures.push(M)}else this.addFeature(_,v,b,a,{},o.availableImages,o.brightness);o.featureIndex.insert(e[b].feature,v,b,C,this.index)}}update(e,o,a,c,d){const p=0!==Object.keys(e).length;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,o,p?this.stateDependentLayers:this.layers,a,c,d)}addFeatures(e,o,a,c,d,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,a,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,o,a,c,d,p=[],_){for(const v of ta(o,500)){let b=0;for(const F of v)b+=F.length;const C=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),M=C.vertexLength,I=[],R=[];for(const F of v){if(0===F.length)continue;F!==v[0]&&R.push(I.length/2);const B=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),U=B.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(U+F.length-1,U),I.push(F[0].x),I.push(F[0].y);for(let Y=1;Y<F.length;Y++)this.layoutVertexArray.emplaceBack(F[Y].x,F[Y].y),this.indexArray2.emplaceBack(U+Y-1,U+Y),I.push(F[Y].x),I.push(F[Y].y);B.vertexLength+=F.length,B.primitiveLength+=F.length}const L=Oh(I,R);for(let F=0;F<L.length;F+=3)this.indexArray.emplaceBack(M+L[F],M+L[F+1],M+L[F+2]);C.vertexLength+=b,C.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,c,_)}}It(Eg,"FillBucket",{omit:["layers","patternFeatures"]});const Vx=new Xe({"fill-sort-key":new Me(De.layout_fill["fill-sort-key"]),visibility:new re(De.layout_fill.visibility)});var $d={paint:new Xe({"fill-antialias":new re(De.paint_fill["fill-antialias"]),"fill-opacity":new Me(De.paint_fill["fill-opacity"]),"fill-color":new Me(De.paint_fill["fill-color"]),"fill-outline-color":new Me(De.paint_fill["fill-outline-color"]),"fill-translate":new re(De.paint_fill["fill-translate"]),"fill-translate-anchor":new re(De.paint_fill["fill-translate-anchor"]),"fill-pattern":new Me(De.paint_fill["fill-pattern"]),"fill-emissive-strength":new re(De.paint_fill["fill-emissive-strength"])}),layout:Vx};const Ww=Ft([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Xw=Ft([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Yw=Ft([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ny=Ft([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Cg=Ft([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Jw}=Ww;var Vp={},Gd=aa,Kw=jp;function jp(n,e,o,a,c){this.properties={},this.extent=o,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=c,n.readFields(jx,this,e)}function jx(n,e,o){1==n?e.id=o.readVarint():2==n?function(a,c){for(var d=a.readVarint()+a.pos;a.pos<d;){var p=c._keys[a.readVarint()],_=c._values[a.readVarint()];c.properties[p]=_}}(o,e):3==n?e.type=o.readVarint():4==n&&(e._geometry=o.pos)}function Qw(n){for(var e,o,a=0,c=0,d=n.length,p=d-1;c<d;p=c++)a+=((o=n[p]).x-(e=n[c]).x)*(e.y+o.y);return a}jp.types=["Unknown","Point","LineString","Polygon"],jp.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,o=n.readVarint()+n.pos,a=1,c=0,d=0,p=0,_=[];n.pos<o;){if(c<=0){var v=n.readVarint();a=7&v,c=v>>3}if(c--,1===a||2===a)d+=n.readSVarint(),p+=n.readSVarint(),1===a&&(e&&_.push(e),e=[]),e.push(new Gd(d,p));else{if(7!==a)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&_.push(e),_},jp.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,o=1,a=0,c=0,d=0,p=1/0,_=-1/0,v=1/0,b=-1/0;n.pos<e;){if(a<=0){var C=n.readVarint();o=7&C,a=C>>3}if(a--,1===o||2===o)(c+=n.readSVarint())<p&&(p=c),c>_&&(_=c),(d+=n.readSVarint())<v&&(v=d),d>b&&(b=d);else if(7!==o)throw new Error("unknown command "+o)}return[p,v,_,b]},jp.prototype.toGeoJSON=function(n,e,o){var a,c,d=this.extent*Math.pow(2,o),p=this.extent*n,_=this.extent*e,v=this.loadGeometry(),b=jp.types[this.type];function C(R){for(var L=0;L<R.length;L++){var F=R[L];R[L]=[360*(F.x+p)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(a=0;a<v.length;a++)M[a]=v[a][0];C(v=M);break;case 2:for(a=0;a<v.length;a++)C(v[a]);break;case 3:for(v=function(R){var L=R.length;if(L<=1)return[R];for(var F,B,U=[],Y=0;Y<L;Y++){var J=Qw(R[Y]);0!==J&&(void 0===B&&(B=J<0),B===J<0?(F&&U.push(F),F=[R[Y]]):F.push(R[Y]))}return F&&U.push(F),U}(v),a=0;a<v.length;a++)for(c=0;c<v[a].length;c++)C(v[a][c])}1===v.length?v=v[0]:b="Multi"+b;var I={type:"Feature",geometry:{type:b,coordinates:v},properties:this.properties};return"id"in this&&(I.id=this.id),I};var aM=Kw,eE=Up;function Up(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(tE,this,e),this.length=this._features.length}function tE(n,e,o){15===n?e.version=o.readVarint():1===n?e.name=o.readString():5===n?e.extent=o.readVarint():2===n?e._features.push(o.pos):3===n?e._keys.push(o.readString()):4===n&&e._values.push(function(a){for(var c=null,d=a.readVarint()+a.pos;a.pos<d;){var p=a.readVarint()>>3;c=1===p?a.readString():2===p?a.readFloat():3===p?a.readDouble():4===p?a.readVarint64():5===p?a.readVarint():6===p?a.readSVarint():7===p?a.readBoolean():null}return c}(o))}Up.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new aM(this._pbf,e,this.extent,this._keys,this._values)};var zy=eE;function By(n,e,o){if(3===n){var a=new zy(o,o.readVarint()+o.pos);a.length&&(e[a.name]=a)}}var zu=Vp.VectorTile=function(n,e){this.layers=n.readFields(By,{},e)},Hd=Vp.VectorTileFeature=Kw;function qd(n,e,o,a){const c=[],d=0===a?(p,_,v,b,C,M)=>{p.push(new ut(M,v+(M-_)/(b-_)*(C-v)))}:(p,_,v,b,C,M)=>{p.push(new ut(_+(M-v)/(C-v)*(b-_),M))};for(const p of n){const _=[];for(const v of p){if(v.length<=2)continue;const b=[];for(let I=0;I<v.length-1;I++){const R=v[I].x,L=v[I].y,F=v[I+1].x,B=v[I+1].y,U=0===a?R:L,Y=0===a?F:B;U<e?Y>e&&d(b,R,L,F,B,e):U>o?Y<o&&d(b,R,L,F,B,o):b.push(v[I]),Y<e&&U>=e&&d(b,R,L,F,B,e),Y>o&&U<=o&&d(b,R,L,F,B,o)}let C=v[v.length-1];const M=0===a?C.x:C.y;M>=e&&M<=o&&b.push(C),b.length&&(C=b[b.length-1],b[0].x===C.x&&b[0].y===C.y||b.push(b[0]),_.push(b))}_.length&&c.push(_)}return c}Vp.VectorTileLayer=eE;class Zd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){const a=e[o];this._stringToNumber[a]=o,this._numberToString[o]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var Tg={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(n,e,o,a,c){var d,p,_=8*c-a-1,v=(1<<_)-1,b=v>>1,C=-7,M=o?c-1:0,I=o?-1:1,R=n[e+M];for(M+=I,d=R&(1<<-C)-1,R>>=-C,C+=_;C>0;d=256*d+n[e+M],M+=I,C-=8);for(p=d&(1<<-C)-1,d>>=-C,C+=a;C>0;p=256*p+n[e+M],M+=I,C-=8);if(0===d)d=1-b;else{if(d===v)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,a),d-=b}return(R?-1:1)*p*Math.pow(2,d-a)},write:function(n,e,o,a,c,d){var p,_,v,b=8*d-c-1,C=(1<<b)-1,M=C>>1,I=23===c?Math.pow(2,-24)-Math.pow(2,-77):0,R=a?0:d-1,L=a?1:-1,F=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,p=C):(p=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-p))<1&&(p--,v*=2),(e+=p+M>=1?I/v:I*Math.pow(2,1-M))*v>=2&&(p++,v/=2),p+M>=C?(_=0,p=C):p+M>=1?(_=(e*v-1)*Math.pow(2,c),p+=M):(_=e*Math.pow(2,M-1)*Math.pow(2,c),p=0));c>=8;n[o+R]=255&_,R+=L,_/=256,c-=8);for(p=p<<c|_,b+=c;b>0;n[o+R]=255&p,R+=L,p/=256,b-=8);n[o+R-L]|=128*F}},Lh=Pr,Wd=Tg;function Pr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Pr.Varint=0,Pr.Fixed64=1,Pr.Bytes=2,Pr.Fixed32=5;var Xd=4294967296,nE=1/Xd,Mg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Sa(n){return n.type===Pr.Bytes?n.readVarint()+n.pos:n.pos+1}function Vy(n,e,o){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));o.realloc(a);for(var c=o.pos-1;c>=n;c--)o.buf[c+a]=o.buf[c]}function rE(n,e){for(var o=0;o<n.length;o++)e.writeVarint(n[o])}function iE(n,e){for(var o=0;o<n.length;o++)e.writeSVarint(n[o])}function jy(n,e){for(var o=0;o<n.length;o++)e.writeFloat(n[o])}function Ux(n,e){for(var o=0;o<n.length;o++)e.writeDouble(n[o])}function oE(n,e){for(var o=0;o<n.length;o++)e.writeBoolean(n[o])}function sE(n,e){for(var o=0;o<n.length;o++)e.writeFixed32(n[o])}function lM(n,e){for(var o=0;o<n.length;o++)e.writeSFixed32(n[o])}function aE(n,e){for(var o=0;o<n.length;o++)e.writeFixed64(n[o])}function Dg(n,e){for(var o=0;o<n.length;o++)e.writeSFixed64(n[o])}function Jd(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Kd(n,e,o){n[o]=e,n[o+1]=e>>>8,n[o+2]=e>>>16,n[o+3]=e>>>24}function Uy(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}Pr.prototype={destroy:function(){this.buf=null},readFields:function(n,e,o){for(o=o||this.length;this.pos<o;){var a=this.readVarint(),c=a>>3,d=this.pos;this.type=7&a,n(c,e,this),this.pos===d&&this.skip(a)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Jd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Uy(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Jd(this.buf,this.pos)+Jd(this.buf,this.pos+4)*Xd;return this.pos+=8,n},readSFixed64:function(){var n=Jd(this.buf,this.pos)+Uy(this.buf,this.pos+4)*Xd;return this.pos+=8,n},readFloat:function(){var n=Wd.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Wd.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,o,a=this.buf;return e=127&(o=a[this.pos++]),o<128?e:(e|=(127&(o=a[this.pos++]))<<7,o<128?e:(e|=(127&(o=a[this.pos++]))<<14,o<128?e:(e|=(127&(o=a[this.pos++]))<<21,o<128?e:function(c,d,p){var _,v,b=p.buf;if(_=(112&(v=b[p.pos++]))>>4,v<128||(_|=(127&(v=b[p.pos++]))<<3,v<128)||(_|=(127&(v=b[p.pos++]))<<10,v<128)||(_|=(127&(v=b[p.pos++]))<<17,v<128)||(_|=(127&(v=b[p.pos++]))<<24,v<128)||(_|=(1&(v=b[p.pos++]))<<31,v<128))return function Yd(n,e,o){return o?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(c,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(o=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Mg?Mg.decode(this.buf.subarray(e,n)):function(o,a,c){for(var d="",p=a;p<c;){var _,v,b,C=o[p],M=null,I=C>239?4:C>223?3:C>191?2:1;if(p+I>c)break;1===I?C<128&&(M=C):2===I?128==(192&(_=o[p+1]))&&(M=(31&C)<<6|63&_)<=127&&(M=null):3===I?(v=o[p+2],128==(192&(_=o[p+1]))&&128==(192&v)&&((M=(15&C)<<12|(63&_)<<6|63&v)<=2047||M>=55296&&M<=57343)&&(M=null)):4===I&&(v=o[p+2],b=o[p+3],128==(192&(_=o[p+1]))&&128==(192&v)&&128==(192&b)&&((M=(15&C)<<18|(63&_)<<12|(63&v)<<6|63&b)<=65535||M>=1114112)&&(M=null)),null===M?(M=65533,I=1):M>65535&&(M-=65536,d+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),d+=String.fromCharCode(M),p+=I}return d}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Pr.Bytes)return n.push(this.readVarint(e));var o=Sa(this);for(n=n||[];this.pos<o;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Pr.Bytes)return n.push(this.readSVarint());var e=Sa(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Pr.Bytes)return n.push(this.readBoolean());var e=Sa(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Pr.Bytes)return n.push(this.readFloat());var e=Sa(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Pr.Bytes)return n.push(this.readDouble());var e=Sa(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Pr.Bytes)return n.push(this.readFixed32());var e=Sa(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Pr.Bytes)return n.push(this.readSFixed32());var e=Sa(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Pr.Bytes)return n.push(this.readFixed64());var e=Sa(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Pr.Bytes)return n.push(this.readSFixed64());var e=Sa(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===Pr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Pr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Pr.Fixed32)this.pos+=4;else{if(e!==Pr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var o=new Uint8Array(e);o.set(this.buf),this.buf=o,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Kd(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Kd(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Kd(this.buf,-1&n,this.pos),Kd(this.buf,Math.floor(n*nE),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Kd(this.buf,-1&n,this.pos),Kd(this.buf,Math.floor(n*nE),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,o){var a,c,d,_;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,c=c+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),d=a,(_=o).buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7),function(d,p){var _=(7&d)<<4;p.buf[p.pos++]|=_|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(c,o)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(a,c,d){for(var p,_,v=0;v<c.length;v++){if((p=c.charCodeAt(v))>55295&&p<57344){if(!_){p>56319||v+1===c.length?(a[d++]=239,a[d++]=191,a[d++]=189):_=p;continue}if(p<56320){a[d++]=239,a[d++]=191,a[d++]=189,_=p;continue}p=_-55296<<10|p-56320|65536,_=null}else _&&(a[d++]=239,a[d++]=191,a[d++]=189,_=null);p<128?a[d++]=p:(p<2048?a[d++]=p>>6|192:(p<65536?a[d++]=p>>12|224:(a[d++]=p>>18|240,a[d++]=p>>12&63|128),a[d++]=p>>6&63|128),a[d++]=63&p|128)}return d}(this.buf,n,this.pos);var o=this.pos-e;o>=128&&Vy(e,o,this),this.pos=e-1,this.writeVarint(o),this.pos+=o},writeFloat:function(n){this.realloc(4),Wd.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Wd.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var o=0;o<e;o++)this.buf[this.pos++]=n[o]},writeRawMessage:function(n,e){this.pos++;var o=this.pos;n(e,this);var a=this.pos-o;a>=128&&Vy(o,a,this),this.pos=o-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,e,o){this.writeTag(n,Pr.Bytes),this.writeRawMessage(e,o)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,rE,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,iE,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,oE,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,jy,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Ux,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,sE,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,lM,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,aE,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,Dg,e)},writeBytesField:function(n,e){this.writeTag(n,Pr.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Pr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Pr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Pr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Pr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Pr.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Pr.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Pr.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Pr.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Pr.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var Qd=yr(Lh);const Sg=["tile","layer","source","sourceLayer","state"];class $x{constructor(e,o,a,c,d){this.type="Feature",this._vectorTileFeature=e,this._z=o,this._x=a,this._y=c,this.properties=e.properties,this.id=d}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const o of Sg)void 0!==this[o]&&(e[o]=this[o]);return e}}class Gx{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,a){const c=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},mr(this.stateChanges[e][c],a),null===this.deletedStates[e]){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][c]){this.deletedStates[e][c]={};for(const d in this.state[e][c])a[d]||(this.deletedStates[e][c][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][c]&&null===this.deletedStates[e][c][d]&&delete this.deletedStates[e][c][d]}removeFeatureState(e,o,a){if(null===this.deletedStates[e])return;const c=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&void 0!==o)null!==this.deletedStates[e][c]&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(void 0!==o)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,o){const a=String(o),c=mr({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const d=this.deletedStates[e][o];if(null===d)return{};for(const p in d)delete c[p]}return c}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const a={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const p in this.stateChanges[c])this.state[c][p]||(this.state[c][p]={}),mr(this.state[c][p],this.stateChanges[c][p]),d[p]=this.state[c][p];a[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(null===this.deletedStates[c])for(const p in this.state[c])d[p]={},this.state[c][p]={};else for(const p in this.deletedStates[c]){if(null===this.deletedStates[c][p])this.state[c][p]={};else if(this.state[c][p])for(const _ of Object.keys(this.deletedStates[c][p]))delete this.state[c][p][_];d[p]=this.state[c][p]}a[c]=a[c]||{},mr(a[c],d)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(a).length)for(const c in e)e[c].setFeatureState(a,o)}}class Hx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,o){const a=this.toIdx(e,o);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,o){return this.leaves[this.toIdx(e,o)]}toIdx(e,o){return o*this.size+e}}function $y(n,e,o,a){let c=0,d=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(o[p]<n[p]||o[p]>e[p])return null}else{const _=1/a[p];let v=(n[p]-o[p])*_,b=(e[p]-o[p])*_;if(v>b){const C=v;v=b,b=C}if(v>c&&(c=v),b<d&&(d=b),c>d)return null}return c}function lE(n,e,o,a,c,d,p,_,v,b,C){const M=a-n,I=c-e,R=d-o,L=p-n,F=_-e,B=v-o,U=C[1]*B-C[2]*F,Y=C[2]*L-C[0]*B,J=C[0]*F-C[1]*L,Q=M*U+I*Y+R*J;if(Math.abs(Q)<1e-15)return null;const oe=1/Q,ae=b[0]-n,me=b[1]-e,_e=b[2]-o,Ee=(ae*U+me*Y+_e*J)*oe;if(Ee<0||Ee>1)return null;const Pe=me*R-_e*I,Se=_e*M-ae*R,Ue=ae*I-me*M,ot=(C[0]*Pe+C[1]*Se+C[2]*Ue)*oe;return ot<0||Ee+ot>1?null:(L*Pe+F*Se+B*Ue)*oe}function qx(n,e,o){return(n-e)/(o-e)}function $p(n,e,o,a,c,d,p,_,v){const b=1<<o,C=d-a,M=p-c,I=(n+1)/b*C+a,R=(e+0)/b*M+c,L=(e+1)/b*M+c;_[0]=(n+0)/b*C+a,_[1]=R,v[0]=I,v[1]=L}class Zx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(d){const p=Math.ceil(Math.log2(d.dim/8)),_=[];let v=Math.ceil(Math.pow(2,p));const b=1/v,C=(R,L,F,B,U)=>{const Y=B?1:0,J=(R+1)*F-Y,Q=L*F,oe=(L+1)*F-Y;U[0]=R*F,U[1]=Q,U[2]=J,U[3]=oe};let M=new Hx(v);const I=[];for(let R=0;R<v*v;R++){C(R%v,Math.floor(R/v),b,!1,I);const L=po(I[0],I[1],d),F=po(I[2],I[1],d),B=po(I[2],I[3],d),U=po(I[0],I[3],d);M.minimums.push(Math.min(L,F,B,U)),M.maximums.push(Math.max(L,F,B,U)),M.leaves.push(1)}for(_.push(M),v/=2;v>=1;v/=2){const R=_[_.length-1];M=new Hx(v);for(let L=0;L<v*v;L++){C(L%v,Math.floor(L/v),2,!0,I);const F=R.getElevation(I[0],I[1]),B=R.getElevation(I[2],I[1]),U=R.getElevation(I[2],I[3]),Y=R.getElevation(I[0],I[3]),J=R.isLeaf(I[0],I[1]),Q=R.isLeaf(I[2],I[1]),oe=R.isLeaf(I[2],I[3]),ae=R.isLeaf(I[0],I[3]),me=Math.min(F.min,B.min,U.min,Y.min),_e=Math.max(F.max,B.max,U.max,Y.max),Ee=J&&Q&&oe&&ae;M.maximums.push(_e),M.minimums.push(me),M.leaves.push(_e-me<=5&&Ee?1:0)}_.push(M)}return _}(this.dem),a=o.length-1,c=o[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(o,0,0,a,0)}raycastRoot(e,o,a,c,d,p,_=1){return $y([e,o,-100],[a,c,this.maximums[0]*_],d,p)}raycast(e,o,a,c,d,p,_=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,o,a,c,d,p,_);if(null==v)return null;const b=[],C=[],M=[],I=[],R=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:L,t:F,nodex:B,nodey:U,depth:Y}=R.pop();if(this.leaves[L]){$p(B,U,Y,e,o,a,c,M,I);const Q=1<<Y,oe=(B+0)/Q,ae=(B+1)/Q,me=(U+0)/Q,_e=(U+1)/Q,Ee=po(oe,me,this.dem)*_,Pe=po(ae,me,this.dem)*_,Se=po(ae,_e,this.dem)*_,Ue=po(oe,_e,this.dem)*_,ot=lE(M[0],M[1],Ee,I[0],M[1],Pe,I[0],I[1],Se,d,p),je=lE(I[0],I[1],Se,M[0],I[1],Ue,M[0],M[1],Ee,d,p),Je=Math.min(null!==ot?ot:Number.MAX_VALUE,null!==je?je:Number.MAX_VALUE);if(Je!==Number.MAX_VALUE)return Je;{const Fe=f.v.scaleAndAdd([],d,p,F);if(kh(Ee,Pe,Ue,Se,qx(Fe[0],M[0],I[0]),qx(Fe[1],M[1],I[1]))>=Fe[2])return F}continue}let J=0;for(let Q=0;Q<this._siblingOffset.length;Q++){$p((B<<1)+this._siblingOffset[Q][0],(U<<1)+this._siblingOffset[Q][1],Y+1,e,o,a,c,M,I),M[2]=-100,I[2]=this.maximums[this.childOffsets[L]+Q]*_;const oe=$y(M,I,d,p);if(null!=oe){const ae=oe;b[Q]=ae;let me=!1;for(let _e=0;_e<J&&!me;_e++)ae>=b[C[_e]]&&(C.splice(_e,0,Q),me=!0);me||(C[J]=Q),J++}}for(let Q=0;Q<J;Q++){const oe=C[Q];R.push({idx:this.childOffsets[L]+oe,t:b[oe],nodex:(B<<1)+this._siblingOffset[oe][0],nodey:(U<<1)+this._siblingOffset[oe][1],depth:Y+1})}}return null}_addNode(e,o,a){return this.minimums.push(e),this.maximums.push(o),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,o,a,c,d){if(1===e[c].isLeaf(o,a))return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const p=c-1,_=e[p];let v=0,b=0;for(let C=0;C<this._siblingOffset.length;C++){const M=2*o+this._siblingOffset[C][0],I=2*a+this._siblingOffset[C][1],R=_.getElevation(M,I),L=_.isLeaf(M,I),F=this._addNode(R.min,R.max,L);L&&(v|=1<<C),b||(b=F)}for(let C=0;C<this._siblingOffset.length;C++)v&1<<C||this._construct(e,2*o+this._siblingOffset[C][0],2*a+this._siblingOffset[C][1],p,b+C)}}function kh(n,e,o,a,c,d){return mn(mn(n,o,d),mn(e,a,d),c)}function po(n,e,o){const a=o.dim,c=dn(n*a-.5,0,a-1),d=dn(e*a-.5,0,a-1),p=Math.floor(c),_=Math.floor(d),v=Math.min(p+1,a-1),b=Math.min(_+1,a-1);return kh(o.get(p,_),o.get(v,_),o.get(p,b),o.get(v,b),c-p,d-_)}const cE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Wx(n,e,o){return(256*n*256+256*e+o)/10-1e4}function Wc(n,e,o){return 256*n+e+o/256-32768}class Ig{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,o,a,c=!1){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(a&&"mapbox"!==a&&"terrarium"!==a)return Rr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const d=this.dim=o.height-2,p=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let v=0;v<d;v++)p[this._idx(-1,v)]=p[this._idx(0,v)],p[this._idx(d,v)]=p[this._idx(d-1,v)],p[this._idx(v,-1)]=p[this._idx(v,0)],p[this._idx(v,d)]=p[this._idx(v,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)]}const _="terrarium"===a?Wc:Wx;for(let v=0;v<p.length;++v){const b=4*v;this.floatView[v]=_(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=ki.now()}_buildQuadTree(){this._tree=new Zx(this)}get(e,o,a=!1){a&&(e=dn(e,-1,this.dim),o=dn(o,-1,this.dim));const c=this._idx(e,o);return this.floatView[c]}set(e,o,a){const c=this._idx(e,o),d=this.floatView[c];return this.floatView[c]=a,a-d}static getUnpackVector(e){return cE[e]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}static pack(e,o){const a=[0,0,0,0],c=Ig.getUnpackVector(o);let d=Math.floor((e+c[3])/c[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new Rx({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,o,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=o*this.dim,d=o*this.dim+this.dim,p=a*this.dim,_=a*this.dim+this.dim;switch(o){case-1:c=d-1;break;case 1:d=c+1}switch(a){case-1:p=_-1;break;case 1:_=p+1}const v=-o*this.dim,b=-a*this.dim;for(let C=p;C<_;C++)for(let M=c;M<d;M++){const I=4*this._idx(M,C),R=4*this._idx(M+v,C+b);this.pixels[I+0]=e.pixels[R+0],this.pixels[I+1]=e.pixels[R+1],this.pixels[I+2]=e.pixels[R+2],this.pixels[I+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}It(Ig,"DEMData"),It(Zx,"DemMinMaxQuadTree",{omit:["dem"]});class ef{constructor(e,o,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=o,this._offset=a}static create(e,o,a){const c=a||e.findDEMTileFor(o);if(!c||!c.dem)return;const d=c.dem,p=c.tileID,_=1<<o.canonical.z-p.canonical.z;return new ef(c,d.dim/ct/_,[(o.canonical.x/_-p.canonical.x)*d.dim,(o.canonical.y/_-p.canonical.y)*d.dim])}tileCoordToPixel(e,o){const a=o*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(a);return new ut(c,d)}getElevationAt(e,o,a,c){const d=e*this._scale+this._offset[0],p=o*this._scale+this._offset[1],_=Math.floor(d),v=Math.floor(p),b=this._dem;return c=!!c,a?mn(mn(b.get(_,v,c),b.get(_,v+1,c),p-v),mn(b.get(_+1,v,c),b.get(_+1,v+1,c),p-v),d-_):b.get(_,v,c)}getElevationAtPixel(e,o,a){return this._dem.get(e,o,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Vo(1,e)*this._dem.stride}}class Fh{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Tu(ct,16,0),this.featureIndexArray=new k0,this.promoteId=o}insert(e,o,a,c,d,p=0){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,d,p);const v=this.grid;for(let b=0;b<o.length;b++){const C=o[b],M=[1/0,1/0,-1/0,-1/0];for(let I=0;I<C.length;I++){const R=C[I];M[0]=Math.min(M[0],R.x),M[1]=Math.min(M[1],R.y),M[2]=Math.max(M[2],R.x),M[3]=Math.max(M[3],R.y)}M[0]<ct&&M[1]<ct&&M[2]>=0&&M[3]>=0&&v.insert(_,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new zu(new Qd(this.rawTileData)).layers,this.sourceLayerCoder=new Zd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,o,a,c){this.loadVTLayers();const d=e.params||{},p=Ya(d.filter),_=e.tileResult,v=e.transform,b=_.bufferedTilespaceBounds,C=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(L,F,B,U)=>Ix(_.bufferedTilespaceGeometry,L,F,B,U));C.sort(Gy);let M=null;v.elevation&&C.length>0&&(M=ef.create(v.elevation,this.tileID));const I={};let R;for(let L=0;L<C.length;L++){const F=C[L];if(F===R)continue;R=F;const B=this.featureIndexArray.get(F);let U=null;this.loadMatchingFeature(I,B,p,d.layers,d.availableImages,o,a,c,(Y,J,Q,oe=0)=>(U||(U=tc(Y,this.tileID.canonical,e.tileTransform)),J.queryIntersectsFeature(_,Y,Q,U,this.z,e.transform,e.pixelPosMatrix,M,oe)))}return I}loadMatchingFeature(e,o,a,c,d,p,_,v,b){const{featureIndex:C,bucketIndex:M,sourceLayerIndex:I,layoutVertexArrayOffset:R}=o,L=this.bucketLayerIDs[M];if(c&&!function(Y,J){for(let Q=0;Q<Y.length;Q++)if(J.indexOf(Y[Q])>=0)return!0;return!1}(c,L))return;const F=this.sourceLayerCoder.decode(I),B=this.vtLayers[F].feature(C);if(a.needGeometry){const Y=Fu(B,!0);if(!a.filter(new pe(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!a.filter(new pe(this.tileID.overscaledZ),B))return;const U=this.getId(B,F);for(let Y=0;Y<L.length;Y++){const J=L[Y];if(c&&c.indexOf(J)<0)continue;const Q=p[J];if(!Q)continue;let oe={};void 0!==U&&v&&(oe=v.getState(Q.sourceLayer||"_geojsonTileLayer",U));const ae=mr({},_[J]);ae.paint=Xx(ae.paint,Q.paint,B,oe,d),ae.layout=Xx(ae.layout,Q.layout,B,oe,d);const me=!b||b(B,Q,oe,R);if(!me)continue;const _e=new $x(B,this.z,this.x,this.y,U);_e.layer=ae;let Ee=e[J];void 0===Ee&&(Ee=e[J]=[]),Ee.push({featureIndex:C,feature:_e,intersectionZ:me})}}lookupSymbolFeatures(e,o,a,c,d,p,_,v){const b={};this.loadVTLayers();const C=Ya(d);for(const M of e)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:c,featureIndex:M,layoutVertexArrayOffset:0},C,p,_,v,o);return b}loadFeature(e){const{featureIndex:o,sourceLayerIndex:a}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(a),d=this.vtFeatures[c];if(d[o])return d[o];const p=this.vtLayers[c].feature(o);return d[o]=p,p}hasLayer(e){for(const o of this.bucketLayerIDs)for(const a of o)if(e===a)return!0;return!1}getId(e,o){let a=e.id;if(this.promoteId){const c="string"==typeof this.promoteId?this.promoteId:this.promoteId[o];null!=c&&(a=e.properties[c]),"boolean"==typeof a&&(a=Number(a))}return a}}function Xx(n,e,o,a,c){return _r(n,(d,p)=>{const _=e instanceof Ge?e.get(p):null;return _&&_.evaluate?_.evaluate(o,a,c):_})}function Gy(n,e){return e-n}It(Fh,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const cM=Ft([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hy=Ft([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Yx=Ft([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ft([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const uE=Ft([{name:"a_z_offset",components:1,type:"Float32"}],4),hE=Ft([{name:"a_texb",components:2,type:"Uint16"}]),Jx=Ft([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),dE=Ft([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const qy=Ft([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),fE=Ft([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ft([{name:"triangle",components:3,type:"Uint16"}]),Ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ft([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ft([{type:"Float32",name:"offsetX"}]),Ft([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Do=24;const nc=128;function Ag(n,e){const{expression:o}=e;if("constant"===o.kind)return{kind:"constant",layoutSize:o.evaluate(new pe(n+1))};if("source"===o.kind)return{kind:"source"};{const{zoomStops:a,interpolationType:c}=o;let d=0;for(;d<a.length&&a[d]<=n;)d++;d=Math.max(0,d-1);let p=d;for(;p<a.length&&a[p]<n+1;)p++;p=Math.min(a.length-1,p);const _=a[d],v=a[p];return"composite"===o.kind?{kind:"composite",minZoom:_,maxZoom:v,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:v,minSize:o.evaluate(new pe(_)),maxSize:o.evaluate(new pe(v)),interpolationType:c}}}function Gp(n,{uSize:e,uSizeT:o},{lowerSize:a,upperSize:c}){return"source"===n.kind?a/nc:"composite"===n.kind?mn(a/nc,c/nc,o):e}function jo(n,e){let o=0,a=0;if("constant"===n.kind)a=n.layoutSize;else if("source"!==n.kind){const{interpolationType:c,minZoom:d,maxZoom:p}=n,_=c?dn(Yr.interpolationFactor(c,e,d,p),0,1):0;"camera"===n.kind?a=mn(n.minSize,n.maxSize,_):o=_}return{uSizeT:o,uSize:a}}var Kx=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:nc,evaluateSizeForFeature:Gp,evaluateSizeForZoom:jo,getSizeData:Ag});function uM(n,e,o){return n.sections.forEach(a=>{a.text=function(c,d,p){const _=d.layout.get("text-transform").evaluate(p,{});return"uppercase"===_?c=c.toLocaleUpperCase():"lowercase"===_&&(c=c.toLocaleLowerCase()),ge.applyArabicShaping&&(c=ge.applyArabicShaping(c)),c}(a.text,e,o)}),n}const Nh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Xc(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function Zy(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}const Wy=3;function hM(n,e,o){e.glyphs=[],1===n&&o.readMessage(pE,e)}function pE(n,e,o){if(3===n){const{id:a,bitmap:c,width:d,height:p,left:_,top:v,advance:b}=o.readMessage(Xy,{});e.glyphs.push({id:a,bitmap:new qc({width:d+2*Wy,height:p+2*Wy},c),metrics:{width:d,height:p,left:_,top:v,advance:b}})}else 4===n?e.ascender=o.readSVarint():5===n&&(e.descender=o.readSVarint())}function Xy(n,e,o){1===n?e.id=o.readVarint():2===n?e.bitmap=o.readBytes():3===n?e.width=o.readVarint():4===n?e.height=o.readVarint():5===n?e.left=o.readSVarint():6===n?e.top=o.readSVarint():7===n&&(e.advance=o.readVarint())}const Xi=Wy,na={horizontal:1,vertical:2,horizontalOnly:3},Qx=-17;class Pg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,o){const a=new Pg;return a.scale=e||1,a.fontStack=o,a}static forImage(e){const o=new Pg;return o.imageName=e,o}}class $r{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o){const a=new $r;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?a.addImageSection(d):a.addTextSection(d,o)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(o,a){let c="";for(let d=0;d<o.length;d++){const p=o.charCodeAt(d+1)||null,_=o.charCodeAt(d-1)||null;c+=!a&&(p&&k(p)&&!Nh[o[d+1]]||_&&k(_)&&!Nh[o[d-1]])||!Nh[o[d]]?o[d]:Nh[o[d]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&tf[this.text.charCodeAt(a)];a++)e++;let o=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&tf[this.text.charCodeAt(a)];a--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){const a=new $r;return a.text=this.text.substring(e,o),a.sectionIndex=this.sectionIndex.slice(e,o),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(Pg.forText(e.scale,e.fontStack||o));const a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e){const o=e.image?e.image.namePrimary:"";if(0===o.length)return void Rr("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Pg.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Rr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yy(n,e,o,a,c,d,p,_,v,b,C,M,I,R,L){const F=$r.fromFeature(n,c);M===na.vertical&&F.verticalizePunctuation(I);let B=[];const U=function(ae,me,_e,Ee,Pe,Se){if(!ae)return[];const Ue=[],ot=function(_t,Et,rt,Jt,St,mt){let Ht=0;for(let Nt=0;Nt<_t.length();Nt++){const Gt=_t.getSection(Nt);Ht+=e1(_t.getCodePoint(Nt),Gt,Jt,St,Et,mt)}return Ht/Math.max(1,Math.ceil(Ht/rt))}(ae,me,_e,Ee,Pe,Se),je=ae.text.indexOf("\u200b")>=0;let Je=0;for(let _t=0;_t<ae.length();_t++){const Et=ae.getSection(_t),rt=ae.getCodePoint(_t);if(tf[rt]||(Je+=e1(rt,Et,Ee,Pe,me,Se)),_t<ae.length()-1){const Jt=!((Fe=rt)<11904||!(x["Bopomofo Extended"](Fe)||x.Bopomofo(Fe)||x["CJK Compatibility Forms"](Fe)||x["CJK Compatibility Ideographs"](Fe)||x["CJK Compatibility"](Fe)||x["CJK Radicals Supplement"](Fe)||x["CJK Strokes"](Fe)||x["CJK Symbols and Punctuation"](Fe)||x["CJK Unified Ideographs Extension A"](Fe)||x["CJK Unified Ideographs"](Fe)||x["Enclosed CJK Letters and Months"](Fe)||x["Halfwidth and Fullwidth Forms"](Fe)||x.Hiragana(Fe)||x["Ideographic Description Characters"](Fe)||x["Kangxi Radicals"](Fe)||x["Katakana Phonetic Extensions"](Fe)||x.Katakana(Fe)||x["Vertical Forms"](Fe)||x["Yi Radicals"](Fe)||x["Yi Syllables"](Fe)));(mE[rt]||Jt||Et.imageName)&&Ue.push(Jy(_t+1,Je,ot,Ue,t1(rt,ae.getCodePoint(_t+1),Jt&&je),!1))}}var Fe;return n1(Jy(ae.length(),Je,ot,Ue,0,!0))}(F,b,d,e,a,R),{processBidirectionalText:Y,processStyledBidirectionalText:J}=ge;if(Y&&1===F.sections.length){const ae=Y(F.toString(),U);for(const me of ae){const _e=new $r;_e.text=me,_e.sections=F.sections;for(let Ee=0;Ee<me.length;Ee++)_e.sectionIndex.push(0);B.push(_e)}}else if(J){const ae=J(F.text,F.sectionIndex,U);for(const me of ae){const _e=new $r;_e.text=me[0],_e.sectionIndex=me[1],_e.sections=F.sections,B.push(_e)}}else B=function(ae,me){const _e=[],Ee=ae.text;let Pe=0;for(const Se of me)_e.push(ae.substring(Pe,Se)),Pe=Se;return Pe<Ee.length&&_e.push(ae.substring(Pe,Ee.length)),_e}(F,U);const Q=[],oe={positionedLines:Q,text:F.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ae,me,_e,Ee,Pe,Se,Ue,ot,je,Je,Fe,_t){let Et=0,rt=0,Jt=0;const St="right"===ot?1:"left"===ot?0:.5;let mt=!1;for(const On of Pe){const pn=On.getSections();for(const Dn of pn){if(Dn.imageName)continue;const Yn=me[Dn.fontStack];if(Yn&&(mt=void 0!==Yn.ascender&&void 0!==Yn.descender,!mt))break}if(!mt)break}let Ht=0;for(const On of Pe){On.trim();const pn=On.getMaxScale(),Dn=(pn-1)*Do,Yn={positionedGlyphs:[],lineOffset:0};ae.positionedLines[Ht]=Yn;const br=Yn.positionedGlyphs;let wn=0;if(!On.length()){rt+=Se,++Ht;continue}let Fr=0,wr=0;for(let dr=0;dr<On.length();dr++){const Qn=On.getSection(dr),si=On.getSectionIndex(dr),Gr=On.getCodePoint(dr);let xi=Qn.scale,co=null,ms=null,Ri=null,gi=Do,Ko=0;const Qo=!(je===na.horizontal||!Fe&&!O(Gr)||Fe&&(tf[Gr]||(Nt=Gr,x.Arabic(Nt)||x["Arabic Supplement"](Nt)||x["Arabic Extended-A"](Nt)||x["Arabic Presentation Forms-A"](Nt)||x["Arabic Presentation Forms-B"](Nt))));if(Qn.imageName){const gs=Ee[Qn.imageName];if(!gs)continue;Ri=Qn.imageName,ae.iconsInText=ae.iconsInText||!0,ms=gs.paddedRect;const Hr=gs.displaySize;xi=xi*Do/_t,co={width:Hr[0],height:Hr[1],left:0,top:-Xi,advance:Qo?Hr[1]:Hr[0],localGlyph:!1},Ko=mt?-co.height*xi:Qx+pn*Do-Hr[1]*xi,gi=co.advance;const Vl=(Qo?Hr[0]:Hr[1])*xi-Do*pn;Vl>0&&Vl>wn&&(wn=Vl)}else{const gs=_e[Qn.fontStack];if(!gs)continue;gs[Gr]&&(ms=gs[Gr]);const Hr=me[Qn.fontStack];if(!Hr)continue;const Vl=Hr.glyphs[Gr];if(!Vl)continue;if(co=Vl.metrics,gi=8203!==Gr?Do:0,mt){const Tf=void 0!==Hr.ascender?Math.abs(Hr.ascender):0,Qc=void 0!==Hr.descender?Math.abs(Hr.descender):0,eu=(Tf+Qc)*xi;Fr<eu&&(Fr=eu,wr=(Tf-Qc)/2*xi),Ko=-Tf*xi}else Ko=Qx+(pn-xi)*Do}Qo?(ae.verticalizable=!0,br.push({glyph:Gr,imageName:Ri,x:Et,y:rt+Ko,vertical:Qo,scale:xi,localGlyph:co.localGlyph,fontStack:Qn.fontStack,sectionIndex:si,metrics:co,rect:ms}),Et+=gi*xi+Je):(br.push({glyph:Gr,imageName:Ri,x:Et,y:rt+Ko,vertical:Qo,scale:xi,localGlyph:co.localGlyph,fontStack:Qn.fontStack,sectionIndex:si,metrics:co,rect:ms}),Et+=co.advance*xi+Je)}0!==br.length&&(Jt=Math.max(Et-Je,Jt),mt?Ky(br,St,wn,wr,Se*pn/2):Ky(br,St,wn,0,Se/2)),Et=0;const cr=Se*pn+wn;Yn.lineOffset=Math.max(wn,Dn),rt+=cr,++Ht}var Nt;const Gt=rt,{horizontalAlign:at,verticalAlign:cn}=Og(Ue);(function(On,pn,Dn,Yn,br,wn){const Fr=(pn-Dn)*br,wr=-wn*Yn;for(const cr of On)for(const dr of cr.positionedGlyphs)dr.x+=Fr,dr.y+=wr})(ae.positionedLines,St,at,cn,Jt,Gt),ae.top+=-cn*Gt,ae.bottom=ae.top+Gt,ae.left+=-at*Jt,ae.right=ae.left+Jt,ae.hasBaseline=mt}(oe,e,o,a,B,p,_,v,M,b,I,L),!function(ae){for(const me of ae)if(0!==me.positionedGlyphs.length)return!1;return!0}(Q)&&oe}const tf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function e1(n,e,o,a,c,d){if(e.imageName){const p=a[e.imageName];return p?p.displaySize[0]*e.scale*Do/d+c:0}{const p=o[e.fontStack],_=p&&p.glyphs[n];return _?_.metrics.advance*e.scale+c:0}}function Rg(n,e,o,a){const c=Math.pow(n-e,2);return a?n<e?c/2:2*c:c+Math.abs(o)*o}function t1(n,e,o){let a=0;return 10===n&&(a-=1e4),o&&(a+=150),40!==n&&65288!==n||(a+=50),41!==e&&65289!==e||(a+=50),a}function Jy(n,e,o,a,c,d){let p=null,_=Rg(e,o,c,d);for(const v of a){const b=Rg(e-v.x,o,c,d)+v.badness;b<=_&&(p=v,_=b)}return{index:n,x:e,priorBreak:p,badness:_}}function n1(n){return n?n1(n.priorBreak).concat(n.index):[]}function Og(n){let e=.5,o=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function Ky(n,e,o,a,c){if(!(e||o||a||c))return;const d=n.length-1,p=n[d],_=(p.x+p.metrics.advance*p.scale)*e;for(let v=0;v<=d;v++)n[v].x-=_,n[v].y+=o+a+c}function gE(n,e,o,a){const{horizontalAlign:c,verticalAlign:d}=Og(a),p=o[0]-n.displaySize[0]*c,_=o[1]-n.displaySize[1]*d;return{imagePrimary:n,imageSecondary:e,top:_,bottom:_+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function r1(n,e,o,a,c,d){const p=n.imagePrimary;let _;if(p.content){const B=p.content,U=p.pixelRatio||1;_=[B[0]/U,B[1]/U,p.displaySize[0]-B[2]/U,p.displaySize[1]-B[3]/U]}const v=e.left*d,b=e.right*d;let C,M,I,R;"width"===o||"both"===o?(R=c[0]+v-a[3],M=c[0]+b+a[1]):(R=c[0]+(v+b-p.displaySize[0])/2,M=R+p.displaySize[0]);const L=e.top*d,F=e.bottom*d;return"height"===o||"both"===o?(C=c[1]+L-a[0],I=c[1]+F+a[2]):(C=c[1]+(L+F-p.displaySize[1])/2,I=C+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:C,right:M,bottom:I,left:R,collisionPadding:_}}class Yc extends ut{constructor(e,o,a,c,d){super(e,o),this.angle=c,this.z=a,void 0!==d&&(this.segment=d)}clone(){return new Yc(this.x,this.y,this.z,this.angle,this.segment)}}function Qy(n,e,o,a,c){if(void 0===e.segment)return!0;let d=e,p=e.segment+1,_=0;for(;_>-o/2;){if(p--,p<0)return!1;_-=n[p].dist(d),d=n[p]}_+=n[p].dist(n[p+1]),p++;const v=[];let b=0;for(;_<o/2;){const C=n[p],M=n[p+1];if(!M)return!1;let I=n[p-1].angleTo(C)-C.angleTo(M);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:_,angleDelta:I}),b+=I;_-v[0].distance>a;)b-=v.shift().angleDelta;if(b>c)return!1;p++,_+=C.dist(M)}return!0}function zh(n){let e=0;for(let o=0;o<n.length-1;o++)e+=n[o].dist(n[o+1]);return e}function rc(n,e,o){return n?.6*e*o:0}function Bh(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function _E(n,e,o,a,c,d){const p=rc(o,c,d),_=Bh(o,a)*d;let v=0;const b=zh(n)/2;for(let C=0;C<n.length-1;C++){const M=n[C],I=n[C+1],R=M.dist(I);if(v+R>b){const L=(b-v)/R,F=mn(M.x,I.x,L),B=mn(M.y,I.y,L),U=new Yc(F,B,0,I.angleTo(M),C);return!p||Qy(n,U,_,p,e)?U:void 0}v+=R}}function yE(n,e,o,a,c,d,p,_,v){const b=rc(a,d,p),C=Bh(a,c),M=C*p,I=0===n[0].x||n[0].x===v||0===n[0].y||n[0].y===v;return e-M<e/4&&(e=M+e/4),ev(n,I?e/2*_%e:(C/2+2*d)*p*_%e,e,b,o,M,I,!1,v)}function ev(n,e,o,a,c,d,p,_,v){const b=d/2,C=zh(n);let M=0,I=e-o,R=[];for(let L=0;L<n.length-1;L++){const F=n[L],B=n[L+1],U=F.dist(B),Y=B.angleTo(F);for(;I+o<M+U;){I+=o;const J=(I-M)/U,Q=mn(F.x,B.x,J),oe=mn(F.y,B.y,J);if(Q>=0&&Q<v&&oe>=0&&oe<v&&I-b>=0&&I+b<=C){const ae=new Yc(Q,oe,0,Y,L);a&&!Qy(n,ae,d,a,c)||R.push(ae)}}M+=U}return _||R.length||p||(R=ev(n,M/2,o,a,c,d,p,!0,v)),R}function tv(n,e,o,a,c){const d=[];for(let p=0;p<n.length;p++){const _=n[p];let v;for(let b=0;b<_.length-1;b++){let C=_[b],M=_[b+1];C.x<e&&M.x<e||(C.x<e?C=new ut(e,C.y+(e-C.x)/(M.x-C.x)*(M.y-C.y))._round():M.x<e&&(M=new ut(e,C.y+(e-C.x)/(M.x-C.x)*(M.y-C.y))._round()),C.y<o&&M.y<o||(C.y<o?C=new ut(C.x+(o-C.y)/(M.y-C.y)*(M.x-C.x),o)._round():M.y<o&&(M=new ut(C.x+(o-C.y)/(M.y-C.y)*(M.x-C.x),o)._round()),C.x>=a&&M.x>=a||(C.x>=a?C=new ut(a,C.y+(a-C.x)/(M.x-C.x)*(M.y-C.y))._round():M.x>=a&&(M=new ut(a,C.y+(a-C.x)/(M.x-C.x)*(M.y-C.y))._round()),C.y>=c&&M.y>=c||(C.y>=c?C=new ut(C.x+(c-C.y)/(M.y-C.y)*(M.x-C.x),c)._round():M.y>=c&&(M=new ut(C.x+(c-C.y)/(M.y-C.y)*(M.x-C.x),c)._round()),v&&C.equals(v[v.length-1])||(v=[C],d.push(v)),v.push(M)))))}}return d}function Hp(n){let e=0,o=0;for(const p of n)e+=p.w*p.h,o=Math.max(o,p.w);n.sort((p,_)=>_.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}];let c=0,d=0;for(const p of n)for(let _=a.length-1;_>=0;_--){const v=a[_];if(!(p.w>v.w||p.h>v.h)){if(p.x=v.x,p.y=v.y,d=Math.max(d,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===v.w&&p.h===v.h){const b=a.pop();_<a.length&&(a[_]=b)}else p.h===v.h?(v.x+=p.w,v.w-=p.w):p.w===v.w?(v.y+=p.h,v.h-=p.h):(a.push({x:v.x+p.w,y:v.y,w:v.w-p.w,h:p.h}),v.y+=p.h,v.h-=p.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}It(Yc,"Anchor");const Uo=1;class nf{constructor(e,{pixelRatio:o,version:a,stretchX:c,stretchY:d,content:p}){this.paddedRect=e,this.pixelRatio=o,this.stretchX=c,this.stretchY=d,this.content=p,this.version=a}get tl(){return[this.paddedRect.x+Uo,this.paddedRect.y+Uo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Uo,this.paddedRect.y+this.paddedRect.h-Uo]}get displaySize(){return[(this.paddedRect.w-2*Uo)/this.pixelRatio,(this.paddedRect.h-2*Uo)/this.pixelRatio]}}class nv{constructor(e,o){const a={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,d),this.addImages(o,c,d);const{w:p,h:_}=Hp(d),v=new Ls({width:p||1,height:_||1});for(const b in e){const C=e[b],M=a[b].paddedRect;Ls.copy(C.data,v,{x:0,y:0},{x:M.x+Uo,y:M.y+Uo},C.data,C.sdf)}for(const b in o){const C=o[b],M=c[b].paddedRect,I=M.x+Uo,R=M.y+Uo,L=C.data.width,F=C.data.height;Ls.copy(C.data,v,{x:0,y:0},{x:I,y:R},C.data),Ls.copy(C.data,v,{x:0,y:F-1},{x:I,y:R-1},{width:L,height:1}),Ls.copy(C.data,v,{x:0,y:0},{x:I,y:R+F},{width:L,height:1}),Ls.copy(C.data,v,{x:L-1,y:0},{x:I-1,y:R},{width:1,height:F}),Ls.copy(C.data,v,{x:0,y:0},{x:I+L,y:R},{width:1,height:F})}this.image=v,this.iconPositions=a,this.patternPositions=c}addImages(e,o,a){for(const c in e){const d=e[c],p={x:0,y:0,w:d.data.width+2*Uo,h:d.data.height+2*Uo};a.push(p),o[c]=new nf(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,o,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const c in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[c],e.getImage(c,a),o),this.patchUpdatedImage(this.patternPositions[c],e.getImage(c,a),o)}patchUpdatedImage(e,o,a){if(!e||!o||e.version===o.version)return;e.version=o.version;const[c,d]=e.tl,p=!!Object.keys(this.patternPositions).length;a.update(o.data,{useMipmap:p},{x:c,y:d})}}It(nf,"ImagePosition"),It(nv,"ImageAtlas");const rf=1e20;function i1(n,e,o,a,c,d,p,_,v){for(let b=e;b<e+a;b++)o1(n,o*d+b,d,c,p,_,v);for(let b=o;b<o+c;b++)o1(n,b*d+e,1,a,p,_,v)}function o1(n,e,o,a,c,d,p){d[0]=0,p[0]=-rf,p[1]=rf,c[0]=n[e];for(let _=1,v=0,b=0;_<a;_++){c[_]=n[e+_*o];const C=_*_;do{const M=d[v];b=(c[_]-c[M]+C-M*M)/(_-M)/2}while(b<=p[v]&&--v>-1);v++,d[v]=_,p[v]=b,p[v+1]=rf}for(let _=0,v=0;_<a;_++){for(;p[v+1]<_;)v++;const b=d[v],C=_-b;n[e+_*o]=c[b]+C*C}}const zl=2,rv={none:0,ideographs:1,all:2};class Vh{constructor(e,o,a){this.requestManager=e,this.localGlyphMode=o,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,o){this.urls[o]=e}getGlyphs(e,o,a){const c=[],d=this.urls[o]||vn.GLYPHS_URL;for(const p in e)for(const _ of e[p])c.push({stack:p,id:_});uo(c,({stack:p,id:_},v)=>{let b=this.entries[p];b||(b=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=b.glyphs[_];if(void 0!==C)return void v(null,{stack:p,id:_,glyph:C});if(C=this._tinySDF(b,p,_),C)return b.glyphs[_]=C,void v(null,{stack:p,id:_,glyph:C});const M=Math.floor(_/256);if(256*M>65535)return void v(new Error("glyphs > 65535 not supported"));if(b.ranges[M])return void v(null,{stack:p,id:_,glyph:C});let I=b.requests[M];I||(I=b.requests[M]=[],Vh.loadGlyphRange(p,M,d,this.requestManager,(R,L)=>{if(L){b.ascender=L.ascender,b.descender=L.descender;for(const F in L.glyphs)this._doesCharSupportLocalGlyph(+F)||(b.glyphs[+F]=L.glyphs[+F]);b.ranges[M]=!0}for(const F of I)F(R,L);delete b.requests[M]})),I.push((R,L)=>{R?v(R):L&&v(null,{stack:p,id:_,glyph:L.glyphs[_]||null})})},(p,_)=>{if(p)a(p);else if(_){const v={};for(const{stack:b,id:C,glyph:M}of _)void 0===v[b]&&(v[b]={}),void 0===v[b].glyphs&&(v[b].glyphs={}),v[b].glyphs[C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},v[b].ascender=this.entries[b].ascender,v[b].descender=this.entries[b].descender;a(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==rv.none&&(this.localGlyphMode===rv.all?!!this.localFontFamily:!!this.localFontFamily&&(x["CJK Unified Ideographs"](e)||x["Hangul Syllables"](e)||x.Hiragana(e)||x.Katakana(e)||x["CJK Symbols and Punctuation"](e)||x["CJK Unified Ideographs Extension A"](e)||x["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,o,a){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let F="400";/bold/i.test(o)?F="900":/medium/i.test(o)?F="500":/light/i.test(o)&&(F="200"),d=e.tinySDF=new Vh.TinySDF({fontFamily:c,fontWeight:F,fontSize:24*zl,buffer:3*zl,radius:8*zl}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const p=String.fromCodePoint(a),{data:_,width:v,height:b,glyphWidth:C,glyphHeight:M,glyphLeft:I,glyphTop:R,glyphAdvance:L}=d.draw(p);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new qc({width:v,height:b},_),metrics:{width:C/zl,height:M/zl,left:I/zl,top:R/zl-27,advance:L/zl,localGlyph:!0}}}}Vh.loadGlyphRange=function(n,e,o,a,c){const d=256*e,p=d+255,_=a.transformRequest(a.normalizeGlyphsURL(o).replace("{fontstack}",n).replace("{range}",`${d}-${p}`),Gi.Glyphs);di(_,(v,b)=>{if(v)c(v);else if(b){const C={},M=new Qd(b).readFields(hM,{});for(const I of M.glyphs)C[I.id]=I;c(null,{glyphs:C,ascender:M.ascender,descender:M.descender})}})},Vh.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:o=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=o;const _=this.size=n+4*e,v=this._createCanvas(_),b=this.ctx=v.getContext("2d",{willReadFrequently:!0});b.font=`${p} ${d} ${n}px ${c}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(n),p=Math.ceil(o),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),v=Math.min(this.size-this.buffer,p+Math.ceil(a)),b=_+2*this.buffer,C=v+2*this.buffer,M=Math.max(b*C,0),I=new Uint8ClampedArray(M),R={data:I,width:b,height:C,glyphWidth:_,glyphHeight:v,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(0===_||0===v)return R;const{ctx:L,buffer:F,gridInner:B,gridOuter:U}=this;L.clearRect(F,F,_,v),L.fillText(n,F,F+p);const Y=L.getImageData(F,F,_,v);U.fill(rf,0,M),B.fill(0,0,M);for(let J=0;J<v;J++)for(let Q=0;Q<_;Q++){const oe=Y.data[4*(J*_+Q)+3]/255;if(0===oe)continue;const ae=(J+F)*b+Q+F;if(1===oe)U[ae]=0,B[ae]=rf;else{const me=.5-oe;U[ae]=me>0?me*me:0,B[ae]=me<0?me*me:0}}i1(U,0,0,b,C,b,this.f,this.v,this.z),i1(B,F,F,_,v,b,this.f,this.v,this.z);for(let J=0;J<M;J++){const Q=Math.sqrt(U[J])-Math.sqrt(B[J]);I[J]=Math.round(255-255*(Q/this.radius+this.cutoff))}return R}};const jh=Uo;function s1(n,e,o,a){const c=[],d=n.imagePrimary,p=d.pixelRatio,_=d.paddedRect.w-2*jh,v=d.paddedRect.h-2*jh,b=n.right-n.left,C=n.bottom-n.top,M=d.stretchX||[[0,_]],I=d.stretchY||[[0,v]],R=(Se,Ue)=>Se+Ue[1]-Ue[0],L=M.reduce(R,0),F=I.reduce(R,0),B=_-L,U=v-F;let Y=0,J=L,Q=0,oe=F,ae=0,me=B,_e=0,Ee=U;if(d.content&&a){const Se=d.content;Y=iv(M,0,Se[0]),Q=iv(I,0,Se[1]),J=iv(M,Se[0],Se[2]),oe=iv(I,Se[1],Se[3]),ae=Se[0]-Y,_e=Se[1]-Q,me=Se[2]-Se[0]-J,Ee=Se[3]-Se[1]-oe}const Pe=(Se,Ue,ot,je)=>{const Je=qp(Se.stretch-Y,J,b,n.left),Fe=Zp(Se.fixed-ae,me,Se.stretch,L),_t=qp(Ue.stretch-Q,oe,C,n.top),Et=Zp(Ue.fixed-_e,Ee,Ue.stretch,F),rt=qp(ot.stretch-Y,J,b,n.left),Jt=Zp(ot.fixed-ae,me,ot.stretch,L),St=qp(je.stretch-Q,oe,C,n.top),mt=Zp(je.fixed-_e,Ee,je.stretch,F),Ht=new ut(Je,_t),Nt=new ut(rt,_t),Gt=new ut(rt,St),at=new ut(Je,St),cn=new ut(Fe/p,Et/p),On=new ut(Jt/p,mt/p),pn=e*Math.PI/180;if(pn){const wr=Math.sin(pn),cr=Math.cos(pn),dr=[cr,-wr,wr,cr];Ht._matMult(dr),Nt._matMult(dr),at._matMult(dr),Gt._matMult(dr)}const Dn=Se.stretch+Se.fixed,Yn=ot.stretch+ot.fixed,br=Ue.stretch+Ue.fixed,wn=je.stretch+je.fixed,Fr=n.imageSecondary;return{tl:Ht,tr:Nt,bl:at,br:Gt,texPrimary:{x:d.paddedRect.x+jh+Dn,y:d.paddedRect.y+jh+br,w:Yn-Dn,h:wn-br},texSecondary:Fr?{x:Fr.paddedRect.x+jh+Dn,y:Fr.paddedRect.y+jh+br,w:Yn-Dn,h:wn-br}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cn,pixelOffsetBR:On,minFontScaleX:me/p/b,minFontScaleY:Ee/p/C,isSDF:o}};if(a&&(d.stretchX||d.stretchY)){const Se=vE(M,B,L),Ue=vE(I,U,F);for(let ot=0;ot<Se.length-1;ot++){const je=Se[ot],Je=Se[ot+1];for(let Fe=0;Fe<Ue.length-1;Fe++)c.push(Pe(je,Ue[Fe],Je,Ue[Fe+1]))}}else c.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:v+1}));return c}function iv(n,e,o){let a=0;for(const c of n)a+=Math.max(e,Math.min(o,c[1]))-Math.max(e,Math.min(o,c[0]));return a}function vE(n,e,o){const a=[{fixed:-jh,stretch:0}];for(const[c,d]of n){const p=a[a.length-1];a.push({fixed:c-p.stretch,stretch:p.stretch}),a.push({fixed:c-p.stretch,stretch:p.stretch+(d-c)})}return a.push({fixed:e+jh,stretch:o}),a}function qp(n,e,o,a){return n/e*o+a}function Zp(n,e,o,a){return n-e*o/a}function dM(n,e,o,a){const c=e+n.positionedLines[a].lineOffset;return 0===a?o+c/2:o+(c+(e+n.positionedLines[a-1].lineOffset))/2}function Lg(n,e=1,o=!1){let a=1/0,c=1/0,d=-1/0,p=-1/0;const _=n[0];for(let R=0;R<_.length;R++){const L=_[R];(!R||L.x<a)&&(a=L.x),(!R||L.y<c)&&(c=L.y),(!R||L.x>d)&&(d=L.x),(!R||L.y>p)&&(p=L.y)}const v=Math.min(d-a,p-c);let b=v/2;const C=new is([],a1);if(0===v)return new ut(a,c);for(let R=a;R<d;R+=v)for(let L=c;L<p;L+=v)C.push(new Uh(R+b,L+b,b,n));let M=function(R){let L=0,F=0,B=0;const U=R[0];for(let Y=0,J=U.length,Q=J-1;Y<J;Q=Y++){const oe=U[Y],ae=U[Q],me=oe.x*ae.y-ae.x*oe.y;F+=(oe.x+ae.x)*me,B+=(oe.y+ae.y)*me,L+=3*me}return new Uh(F/L,B/L,0,R)}(n),I=C.length;for(;C.length;){const R=C.pop();(R.d>M.d||!M.d)&&(M=R,o&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,I)),R.max-M.d<=e||(b=R.h/2,C.push(new Uh(R.p.x-b,R.p.y-b,b,n)),C.push(new Uh(R.p.x+b,R.p.y-b,b,n)),C.push(new Uh(R.p.x-b,R.p.y+b,b,n)),C.push(new Uh(R.p.x+b,R.p.y+b,b,n)),I+=4)}return o&&(console.log(`num probes: ${I}`),console.log(`best distance: ${M.d}`)),M.p}function a1(n,e){return e.max-n.max}class Uh{constructor(e,o,a,c){this.p=new ut(e,o),this.h=a,this.d=function(d,p){let _=!1,v=1/0;for(let b=0;b<p.length;b++){const C=p[b];for(let M=0,I=C.length,R=I-1;M<I;R=M++){const L=C[M],F=C[R];L.y>d.y!=F.y>d.y&&d.x<(F.x-L.x)*(d.y-L.y)/(F.y-L.y)+L.x&&(_=!_),v=Math.min(v,Dx(d,L,F))}}return(_?1:-1)*Math.sqrt(v)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const sf=7,kg=Number.POSITIVE_INFINITY,l1=Math.sqrt(2);function Zn(n,[e,o]){let a=0,c=0;if(o===kg){e<0&&(e=0);const d=e/l1;switch(n){case"top-right":case"top-left":c=d-sf;break;case"bottom-right":case"bottom-left":c=-d+sf;break;case"bottom":c=-e+sf;break;case"top":c=e-sf}switch(n){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),o=Math.abs(o),n){case"top-right":case"top-left":case"top":c=o-sf;break;case"bottom-right":case"bottom-left":case"bottom":c=-o+sf}switch(n){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function Wp(n,e,o,a,c,d,p,_,v,b,C){n.createArrays(),n.tilePixelRatio=ct/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const M=n.layers[0].layout,I=n.layers[0]._unevaluatedLayout._values,R={};if("composite"===n.textSizeData.kind){const{minZoom:U,maxZoom:Y}=n.textSizeData;R.compositeTextSizes=[I["text-size"].possiblyEvaluate(new pe(U),_),I["text-size"].possiblyEvaluate(new pe(Y),_)]}if("composite"===n.iconSizeData.kind){const{minZoom:U,maxZoom:Y}=n.iconSizeData;R.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new pe(U),_),I["icon-size"].possiblyEvaluate(new pe(Y),_)]}R.layoutTextSize=I["text-size"].possiblyEvaluate(new pe(v+1),_),R.layoutIconSize=I["icon-size"].possiblyEvaluate(new pe(v+1),_),R.textMaxSize=I["text-size"].possiblyEvaluate(new pe(18),_);const L="map"===M.get("text-rotation-alignment")&&"point"!==M.get("symbol-placement"),F=M.get("text-size");let B=!1;for(const U of n.features)if(U.icon&&U.icon.nameSecondary){B=!0;break}for(const U of n.features){const Y=M.get("text-font").evaluate(U,{},_).join(","),J=F.evaluate(U,{},_),Q=R.layoutTextSize.evaluate(U,{},_),oe=(R.layoutIconSize.evaluate(U,{},_),{horizontal:{},vertical:void 0}),ae=U.text;let me,_e=[0,0];if(ae){const Se=ae.toString(),Ue=M.get("text-letter-spacing").evaluate(U,{},_)*Do,ot=M.get("text-line-height").evaluate(U,{},_)*Do,je=T(Se)?Ue:0,Je=M.get("text-anchor").evaluate(U,{},_),Fe=M.get("text-variable-anchor");if(!Fe){const St=M.get("text-radial-offset").evaluate(U,{},_);_e=St?Zn(Je,[St*Do,kg]):M.get("text-offset").evaluate(U,{},_).map(mt=>mt*Do)}let _t=L?"center":M.get("text-justify").evaluate(U,{},_);const Et="point"===M.get("symbol-placement"),rt=Et?M.get("text-max-width").evaluate(U,{},_)*Do:1/0,Jt=St=>{n.allowVerticalPlacement&&w(Se)&&(oe.vertical=Yy(ae,e,o,c,Y,rt,ot,Je,St,je,_e,na.vertical,!0,Q,J))};if(!L&&Fe){const St="auto"===_t?Fe.map(Ht=>Fg(Ht)):[_t];let mt=!1;for(let Ht=0;Ht<St.length;Ht++){const Nt=St[Ht];if(!oe.horizontal[Nt])if(mt)oe.horizontal[Nt]=oe.horizontal[0];else{const Gt=Yy(ae,e,o,c,Y,rt,ot,"center",Nt,je,_e,na.horizontal,!1,Q,J);Gt&&(oe.horizontal[Nt]=Gt,mt=1===Gt.positionedLines.length)}}Jt("left")}else{if("auto"===_t&&(_t=Fg(Je)),Et||M.get("text-writing-mode").indexOf("horizontal")>=0||!w(Se)){const St=Yy(ae,e,o,c,Y,rt,ot,Je,_t,je,_e,na.horizontal,!1,Q,J);St&&(oe.horizontal[_t]=St)}Jt(Et?"left":_t)}}let Ee=!1;if(U.icon&&U.icon.namePrimary){const Se=a[U.icon.namePrimary];Se&&(me=gE(c[U.icon.namePrimary],U.icon.nameSecondary?c[U.icon.nameSecondary]:void 0,M.get("icon-offset").evaluate(U,{},_),M.get("icon-anchor").evaluate(U,{},_)),Ee=Se.sdf,void 0===n.sdfIcons?n.sdfIcons=Se.sdf:n.sdfIcons!==Se.sdf&&Rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Se.pixelRatio!==n.pixelRatio||0!==M.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const Pe=$h(oe.horizontal)||oe.vertical;n.iconsInText||(n.iconsInText=!!Pe&&Pe.iconsInText),(Pe||me)&&Dt(n,U,oe,me,a,R,Q,0,_e,Ee,p,_,b,C,B)}d&&n.generateCollisionDebugBuffers(v,n.collisionBoxArray)}function Fg(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dt(n,e,o,a,c,d,p,_,v,b,C,M,I,R,L){let F=d.textMaxSize.evaluate(e,{},M);void 0===F&&(F=p);const B=n.layers[0].layout,U=B.get("icon-offset").evaluate(e,{},M),Y=$h(o.horizontal)||o.vertical,J="globe"===I.name,Q=Do,oe=p/Q,ae=n.tilePixelRatio*F/Q,me=(Je=n.overscaling,n.zoom>18&&Je>2&&(Je>>=1),Math.max(ct/(512*Je),1)*B.get("symbol-spacing")),_e=B.get("text-padding")*n.tilePixelRatio,Ee=B.get("icon-padding")*n.tilePixelRatio,Pe=wt(B.get("text-max-angle")),Se="map"===B.get("text-rotation-alignment")&&"point"!==B.get("symbol-placement"),Ue="map"===B.get("icon-rotation-alignment")&&"point"!==B.get("symbol-placement"),ot=B.get("symbol-placement"),je=me/2;var Je;const Fe=B.get("icon-text-fit").evaluate(e,{},M),_t=B.get("icon-text-fit-padding").evaluate(e,{},M),Et="none"!==Fe;let rt;!1===n.hasAnyIconTextFit&&Et&&(n.hasAnyIconTextFit=!0),a&&Et&&(n.allowVerticalPlacement&&o.vertical&&(rt=r1(a,o.vertical,Fe,_t,U,oe)),Y&&(a=r1(a,Y,Fe,_t,U,oe)));const Jt=(St,mt,Ht)=>{if(mt.x<0||mt.x>=ct||mt.y<0||mt.y>=ct)return;let Nt=null;if(J){const{x:Gt,y:at,z:cn}=I.projectTilePoint(mt.x,mt.y,Ht);Nt={anchor:new Yc(Gt,at,cn,0,void 0),up:I.upVector(Ht,mt.x,mt.y)}}!function(Gt,at,cn,On,pn,Dn,Yn,br,wn,Fr,wr,cr,dr,Qn,si,Gr,xi,co,ms,Ri,gi,Ko,Qo,gs,Hr,Vl,Tf){const Qc=Gt.addToLineVertexArray(at,On);let eu,vm,xm,v_,eb,zv,Bv,Vv=0,jv=0,Uv=0,$v=0,x_=-1,b_=-1;const jl={};let Gv=qm("");const Yu=cn?cn.anchor:at,tu="none"!==wn.layout.get("icon-text-fit").evaluate(gi,{},Hr);let Hv=0,qv=0;if(void 0===wn._unevaluatedLayout.getValue("text-radial-offset")?[Hv,qv]=wn.layout.get("text-offset").evaluate(gi,{},Hr).map(ka=>ka*Do):(Hv=wn.layout.get("text-radial-offset").evaluate(gi,{},Hr)*Do,qv=kg),Gt.allowVerticalPlacement&&pn.vertical){const ka=pn.vertical;if(si)zv=Gh(ka),br&&(Bv=Gh(br));else{const Fs=wn.layout.get("text-rotate").evaluate(gi,{},Hr)+90;xm=lf(Fr,Yu,at,wr,cr,dr,ka,Qn,Fs,Gr),br&&(v_=lf(Fr,Yu,at,wr,cr,dr,br,co,Fs))}}if(Dn){const ka=wn.layout.get("icon-rotate").evaluate(gi,{},Hr),Fs=s1(Dn,ka,Qo,tu),ed=br?s1(br,ka,Qo,tu):void 0;vm=lf(Fr,Yu,at,wr,cr,dr,Dn,co,ka),Vv=4*Fs.length;const WE=Gt.iconSizeData;let Nr=null;"source"===WE.kind?(Nr=[nc*wn.layout.get("icon-size").evaluate(gi,{},Hr)],Nr[0]>Bu&&Rr(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${af}. Reduce your "icon-size".`)):"composite"===WE.kind&&(Nr=[nc*Ko.compositeIconSizes[0].evaluate(gi,{},Hr),nc*Ko.compositeIconSizes[1].evaluate(gi,{},Hr)],(Nr[0]>Bu||Nr[1]>Bu)&&Rr(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${af}. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,Fs,Nr,Ri,ms,gi,!1,cn,at,Qc.lineStartIndex,Qc.lineLength,-1,gs,Hr,Vl,Tf),x_=Gt.icon.placedSymbolArray.length-1,ed&&(jv=4*ed.length,Gt.addSymbols(Gt.icon,ed,Nr,Ri,ms,gi,na.vertical,cn,at,Qc.lineStartIndex,Qc.lineLength,-1,gs,Hr,Vl,Tf),b_=Gt.icon.placedSymbolArray.length-1)}for(const ka in pn.horizontal){const Fs=pn.horizontal[ka];eu||(Gv=qm(Fs.text),si?eb=Gh(Fs):eu=lf(Fr,Yu,at,wr,cr,dr,Fs,Qn,wn.layout.get("text-rotate").evaluate(gi,{},Hr),Gr));const ed=1===Fs.positionedLines.length;if(Uv+=Xp(Gt,cn,at,Fs,Yn,wn,si,gi,Gr,Qc,pn.vertical?na.horizontal:na.horizontalOnly,ed?Object.keys(pn.horizontal):[ka],jl,x_,Ko,gs,Hr,Vl),ed)break}pn.vertical&&($v+=Xp(Gt,cn,at,pn.vertical,Yn,wn,si,gi,Gr,Qc,na.vertical,["vertical"],jl,b_,Ko,gs,Hr,Vl));let La=-1;const tb=(ka,Fs)=>ka?Math.max(ka,Fs):Fs;La=tb(eb,La),La=tb(zv,La),La=tb(Bv,La);const ks=La>-1?1:0;Gt.glyphOffsetArray.length>=uf.MAX_GLYPHS&&Rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==gi.sortKey&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,gi.sortKey),Gt.symbolInstances.emplaceBack(at.x,at.y,Yu.x,Yu.y,Yu.z,jl.right>=0?jl.right:-1,jl.center>=0?jl.center:-1,jl.left>=0?jl.left:-1,jl.vertical>=0?jl.vertical:-1,x_,b_,Gv,void 0!==eu?eu:Gt.collisionBoxArray.length,void 0!==eu?eu+1:Gt.collisionBoxArray.length,void 0!==xm?xm:Gt.collisionBoxArray.length,void 0!==xm?xm+1:Gt.collisionBoxArray.length,void 0!==vm?vm:Gt.collisionBoxArray.length,void 0!==vm?vm+1:Gt.collisionBoxArray.length,v_||Gt.collisionBoxArray.length,v_?v_+1:Gt.collisionBoxArray.length,wr,Uv,$v,Vv,jv,ks,0,Hv,qv,La,0,tu?1:0)}(n,mt,Nt,St,o,a,c,rt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,_e,Se,v,0,Ee,Ue,U,e,d,b,C,M,R,L)};if("line"===ot)for(const St of tv(e.geometry,0,0,ct,ct)){const mt=yE(St,me,Pe,o.vertical||Y,a,Q,ae,n.overscaling,ct);for(const Ht of mt)Y&&c1(n,Y.text,je,Ht)||Jt(St,Ht,M)}else if("line-center"===ot){for(const St of e.geometry)if(St.length>1){const mt=_E(St,Pe,o.vertical||Y,a,Q,ae);mt&&Jt(St,mt,M)}}else if("Polygon"===e.type)for(const St of ta(e.geometry,0)){const mt=Lg(St,16);Jt(St[0],new Yc(mt.x,mt.y,0,0,void 0),M)}else if("LineString"===e.type)for(const St of e.geometry)Jt(St,new Yc(St[0].x,St[0].y,0,0,void 0),M);else if("Point"===e.type)for(const St of e.geometry)for(const mt of St)Jt([mt],new Yc(mt.x,mt.y,0,0,void 0),M)}const af=255,Bu=af*nc;function Xp(n,e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B,U){const Y=function(oe,ae,me,_e,Ee,Pe,Se,Ue){const ot=[];if(0===ae.positionedLines.length)return ot;const je=_e.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,Je=function(Jt){const St=Jt[0],mt=Jt[1],Ht=St*mt;return Ht>0?[St,-mt]:Ht<0?[-St,mt]:0===St?[mt,St]:[mt,-St]}(me);let Fe=Math.abs(ae.top-ae.bottom);for(const Jt of ae.positionedLines)Fe-=Jt.lineOffset;const _t=ae.positionedLines.length,Et=Fe/_t;let rt=ae.top-me[1];for(let Jt=0;Jt<_t;++Jt){const St=ae.positionedLines[Jt];rt=dM(ae,Et,rt,Jt);for(const mt of St.positionedGlyphs){if(!mt.rect)continue;const Ht=mt.rect||{};let Nt=Xi+1,Gt=!0,at=1,cn=0;if(mt.imageName){const Ri=Se[mt.imageName];if(!Ri)continue;if(Ri.sdf){Rr("SDF images are not supported in formatted text and will be ignored.");continue}Gt=!1,at=Ri.pixelRatio,Nt=Uo/at}const On=(Ee||Ue)&&mt.vertical,pn=mt.metrics.advance*mt.scale/2,Dn=mt.metrics,Yn=mt.rect;if(null===Yn)continue;Ue&&ae.verticalizable&&(cn=mt.imageName?pn-mt.metrics.width*mt.scale/2:0);const br=Ee?[mt.x+pn,mt.y]:[0,0];let wn=[0,0],Fr=[0,0],wr=!1;Ee||(On?(Fr=[mt.x+pn+Je[0],mt.y+Je[1]-cn],wr=!0):wn=[mt.x+pn+me[0],mt.y+me[1]-cn]);const cr=Yn.w*mt.scale/(at*(mt.localGlyph?zl:1)),dr=Yn.h*mt.scale/(at*(mt.localGlyph?zl:1));let Qn,si,Gr,xi;if(On){const Ri=mt.y-rt,gi=new ut(-pn,pn-Ri),Ko=-Math.PI/2,Qo=new ut(...Fr);Qn=new ut(-pn+wn[0],wn[1]),Qn._rotateAround(Ko,gi)._add(Qo),Qn.x+=-Ri+pn,Qn.y-=(Dn.left-Nt)*mt.scale;const gs=mt.imageName?Dn.advance*mt.scale:Do*mt.scale,Hr=String.fromCodePoint(mt.glyph);Xc(Hr)?Qn.x+=(1-Nt)*mt.scale:Zy(Hr)?Qn.x+=gs-Dn.height*mt.scale+(-Nt-1)*mt.scale:Qn.x+=mt.imageName||Dn.width+2*Nt===Yn.w&&Dn.height+2*Nt===Yn.h?(gs-dr)/2:(gs-(Dn.height+2*Nt)*mt.scale)/2,si=new ut(Qn.x,Qn.y-cr),Gr=new ut(Qn.x+dr,Qn.y),xi=new ut(Qn.x+dr,Qn.y-cr)}else{const Ri=(Dn.left-Nt)*mt.scale-pn+wn[0],gi=(-Dn.top-Nt)*mt.scale+wn[1],Ko=Ri+cr,Qo=gi+dr;Qn=new ut(Ri,gi),si=new ut(Ko,gi),Gr=new ut(Ri,Qo),xi=new ut(Ko,Qo)}if(je){let Ri;Ri=Ee?new ut(0,0):wr?new ut(Je[0],Je[1]):new ut(me[0],me[1]),Qn._rotateAround(je,Ri),si._rotateAround(je,Ri),Gr._rotateAround(je,Ri),xi._rotateAround(je,Ri)}const co=new ut(0,0),ms=new ut(0,0);ot.push({tl:Qn,tr:si,bl:Gr,br:xi,texPrimary:Ht,texSecondary:void 0,writingMode:ae.writingMode,glyphOffset:br,sectionIndex:mt.sectionIndex,isSDF:Gt,pixelOffsetTL:co,pixelOffsetBR:ms,minFontScaleX:0,minFontScaleY:0})}}return ot}(0,a,v,d,p,_,c,n.allowVerticalPlacement),J=n.textSizeData;let Q=null;"source"===J.kind?(Q=[nc*d.layout.get("text-size").evaluate(_,{},B)],Q[0]>Bu&&Rr(`${n.layerIds[0]}: Value for "text-size" is >= ${af}. Reduce your "text-size".`)):"composite"===J.kind&&(Q=[nc*L.compositeTextSizes[0].evaluate(_,{},B),nc*L.compositeTextSizes[1].evaluate(_,{},B)],(Q[0]>Bu||Q[1]>Bu)&&Rr(`${n.layerIds[0]}: Value for "text-size" is >= ${af}. Reduce your "text-size".`)),n.addSymbols(n.text,Y,Q,v,p,_,C,e,o,b.lineStartIndex,b.lineLength,R,F,B,U,!1);for(const oe of M)I[oe]=n.text.placedSymbolArray.length-1;return 4*Y.length}function $h(n){for(const e in n)return n[e];return null}function lf(n,e,o,a,c,d,p,_,v,b){let C=p.top,M=p.bottom,I=p.left,R=p.right;const L=p.collisionPadding;if(L&&(I-=L[0],C-=L[1],R+=L[2],M+=L[3]),v){const F=new ut(I,C),B=new ut(R,C),U=new ut(I,M),Y=new ut(R,M),J=wt(v);let Q=new ut(0,0);b&&(Q=new ut(b[0],b[1])),F._rotateAround(J,Q),B._rotateAround(J,Q),U._rotateAround(J,Q),Y._rotateAround(J,Q),I=Math.min(F.x,B.x,U.x,Y.x),R=Math.max(F.x,B.x,U.x,Y.x),C=Math.min(F.y,B.y,U.y,Y.y),M=Math.max(F.y,B.y,U.y,Y.y)}return n.emplaceBack(e.x,e.y,e.z,o.x,o.y,I,C,R,M,_,a,c,d),n.length-1}function Gh(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function c1(n,e,o,a){const c=n.compareText;if(e in c){const d=c[e];for(let p=d.length-1;p>=0;p--)if(a.dist(d[p])<o)return!0}else c[e]=[];return c[e].push(a),!1}function Ng(n,e){const o=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),d=Math.sin(o)*c/Math.sin(Math.max(Math.PI/2-n._pitch-o,.01)),p=Math.sin(n._pitch)*d+c;return Math.min(1.01*p,c*(1/n._horizonShift))}function ic(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const o=Math.pow(2,-n.z),a=n.x*o,c=(n.x+1)*o,d=n.y*o,p=(n.y+1)*o,_=To(a),v=To(c),b=Mo(d),C=Mo(p),M=e.project(_,b),I=e.project(v,b),R=e.project(v,C),L=e.project(_,C);let F=Math.min(M.x,I.x,R.x,L.x),B=Math.min(M.y,I.y,R.y,L.y),U=Math.max(M.x,I.x,R.x,L.x),Y=Math.max(M.y,I.y,R.y,L.y);const J=o/16;function Q(ae,me,_e,Ee,Pe,Se){const Ue=(_e+Pe)/2,ot=(Ee+Se)/2,je=e.project(To(Ue),Mo(ot)),Je=Math.max(0,F-je.x,B-je.y,je.x-U,je.y-Y);F=Math.min(F,je.x),U=Math.max(U,je.x),B=Math.min(B,je.y),Y=Math.max(Y,je.y),Je>J&&(Q(ae,je,_e,Ee,Ue,ot),Q(je,me,Ue,ot,Pe,Se))}Q(M,I,a,d,c,d),Q(I,R,c,d,c,p),Q(R,L,c,p,a,p),Q(L,M,a,p,a,d),F-=J,B-=J,U+=J,Y+=J;const oe=1/Math.max(U-F,Y-B);return{scale:oe,x:F*oe,y:B*oe,x2:U*oe,y2:Y*oe,projection:e}}function zg(n,{x:e,y:o},a=0){return new ut(((e-a)*n.scale-n.x)*ct,(o*n.scale-n.y)*ct)}const u1=f.m.identity(new Float32Array(16));class oc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,o){return{x:0,y:0,z:0}}unproject(e,o){return new hr(0,0)}projectTilePoint(e,o,a){return{x:e,y:o,z:0}}locationPoint(e,o,a=!0){return e._coordinatePoint(e.locationCoordinate(o),a)}pixelsPerMeter(e,o){return Vo(1,e)*o}pixelSpaceConversion(e,o,a){return 1}farthestPixelDistance(e){return Ng(e,e.pixelsPerMeter)}pointCoordinate(e,o,a,c){const d=e.horizonLineFromTop(!1),p=new ut(o,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,o,a){const c=new ut(o,a);if(e.elevation)return e.elevation.pointCoordinate(c);{const d=this.pointCoordinate(e,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,o){if(e.elevation)return!this.pointCoordinate3D(e,o.x,o.y);const a=e.horizonLineFromTop();return o.y<a}createInversionMatrix(e,o){return u1}createTileMatrix(e,o,a){let c,d,p;const _=a.canonical,v=f.m.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=ic(_,this);c=1,d=b.x+a.wrap*b.scale,p=b.y,f.m.scale(v,v,[c/b.scale,c/b.scale,e.pixelsPerMeter/o])}else c=o/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*a.wrap)*c,p=_.y*c;return f.m.translate(v,v,[d,p,0]),f.m.scale(v,v,[c/ct,c/ct,1]),v}upVector(e,o,a){return[0,0,1]}upVectorScale(e,o,a){return{metersToTile:1}}}class xE extends oc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[o,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(wt(o));this.n=(c+Math.sin(wt(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,o){const{n:a,c,r0:d}=this,p=wt(e-this.center[0]),_=wt(o),v=Math.sqrt(c-2*a*Math.sin(_))/a;return{x:v*Math.sin(p*a),y:v*Math.cos(p*a)-d,z:0}}unproject(e,o){const{n:a,c,r0:d}=this,p=d+o;let _=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(_-=Math.PI*Math.sign(e)*Math.sign(p));const v=wt(this.center[0])*a;_=fr(_,-Math.PI-v,Math.PI-v);const b=dn(Yi(_/a)+this.center[0],-180,180),C=Math.asin(dn((c-(e*e+p*p)*a*a)/(2*a),-1,1)),M=dn(Yi(C),-Ai,Ai);return new hr(b,M)}}const Yp=1.340264,Jp=-.081106,cf=893e-6,Kp=.003796,Bg=Math.sqrt(3)/2;class bE extends oc{project(e,o){o=o/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Bg*Math.sin(o)),c=a*a,d=c*c*c;return{x:.5*(e*Math.cos(a)/(Bg*(Yp+3*Jp*c+d*(7*cf+9*Kp*c)))/Math.PI+.5),y:1-.5*(a*(Yp+Jp*c+d*(cf+Kp*c))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let a=o=(2*(1-o)-1)*Math.PI,c=a*a,d=c*c*c;for(let C,M,I,R=0;R<12&&(M=a*(Yp+Jp*c+d*(cf+Kp*c))-o,I=Yp+3*Jp*c+d*(7*cf+9*Kp*c),C=M/I,a=dn(a-C,-Math.PI/3,Math.PI/3),c=a*a,d=c*c*c,!(Math.abs(C)<1e-12));++R);const p=Bg*e*(Yp+3*Jp*c+d*(7*cf+9*Kp*c))/Math.cos(a),_=Math.asin(Math.sin(a)/Bg),v=dn(180*p/Math.PI,-180,180),b=dn(180*_/Math.PI,-Ai,Ai);return new hr(v,b)}}class wE extends oc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){return{x:.5+e/360,y:.5-o/360,z:0}}unproject(e,o){const a=360*(e-.5),c=dn(360*(.5-o),-Ai,Ai);return new hr(a,c)}}const Hh=Math.PI/2;function Qp(n){return Math.tan((Hh+n)/2)}class EE extends oc{constructor(e){super(e),this.center=e.center||[0,30];const[o,a]=this.parallels=e.parallels||[30,30];let c=wt(o),d=wt(a);this.southernCenter=c+d<0,this.southernCenter&&(c=-c,d=-d);const p=Math.cos(c),_=Qp(c);this.n=c===d?Math.sin(c):Math.log(p/Math.cos(d))/Math.log(Qp(d)/_),this.f=p*Math.pow(Qp(c),this.n)/this.n}project(e,o){o=wt(o),this.southernCenter&&(o=-o),e=wt(e-this.center[0]);const a=1e-6,{n:c,f:d}=this;d>0?o<-Hh+a&&(o=-Hh+a):o>Hh-a&&(o=Hh-a);const p=d/Math.pow(Qp(o),c);let _=p*Math.sin(c*e),v=d-p*Math.cos(c*e);return _=.5*(_/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:_,y:this.southernCenter?v:1-v,z:0}}unproject(e,o){e=(2*e-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:a,f:c}=this,d=c-o,p=Math.sign(d),_=Math.sign(a)*Math.sqrt(e*e+d*d);let v=Math.atan2(e,Math.abs(d))*p;d*a<0&&(v-=Math.PI*Math.sign(e)*p);const b=dn(Yi(v/a)+this.center[0],-180,180),C=dn(Yi(2*Math.atan(Math.pow(c/_,1/a))-Hh),-Ai,Ai);return new hr(b,this.southernCenter?-C:C)}}class h1 extends oc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,o){return{x:kl(e),y:Da(o),z:0}}unproject(e,o){const a=To(e),c=Mo(o);return new hr(a,c)}}const ra=wt(Ai);class CE extends oc{project(e,o){const a=(o=wt(o))*o,c=a*a;return{x:.5*((e=wt(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let a=o=(2*(1-o)-1)*Math.PI,c=25,d=0,p=a*a;do{p=a*a;const b=p*p;d=(a*(1.007226+p*(.015085+b*(.028874*p-.044475-.005916*b)))-o)/(1.007226+p*(.045255+b*(.259866*p-.311325-.005916*11*b))),a=dn(a-d,-ra,ra)}while(Math.abs(d)>1e-6&&--c>0);p=a*a;const _=dn(Yi(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),v=Yi(a);return new hr(_,v)}}const d1=wt(Ai);class fM extends oc{project(e,o){o=wt(o),e=wt(e);const a=Math.cos(o),c=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),p=Math.sin(d)/d,_=.5*(e*c+2*a*Math.sin(e/2)/p)||0,v=.5*(o+Math.sin(o)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,o){let a=e=(2*e-.5)*Math.PI,c=o=(2*(1-o)-1)*Math.PI,d=25;const p=1e-6;let _=0,v=0;do{const b=Math.cos(c),C=Math.sin(c),M=2*C*b,I=C*C,R=b*b,L=Math.cos(a/2),F=Math.sin(a/2),B=2*L*F,U=F*F,Y=1-R*L*L,J=Y?1/Y:0,Q=Y?Math.acos(b*L)*Math.sqrt(1/Y):0,oe=.5*(2*Q*b*F+2*a/Math.PI)-e,ae=.5*(Q*C+c)-o,me=.5*J*(R*U+Q*b*L*I)+1/Math.PI,_e=J*(B*M/4-Q*C*F),Ee=.125*J*(M*F-Q*C*R*B),Pe=.5*J*(I*L+Q*U*b)+.5,Se=_e*Ee-Pe*me;_=(ae*_e-oe*Pe)/Se,v=(oe*Ee-ae*me)/Se,a=dn(a-_,-Math.PI,Math.PI),c=dn(c-v,-d1,d1)}while((Math.abs(_)>p||Math.abs(v)>p)&&--d>0);return new hr(Yi(a),Yi(c))}}class Vg extends oc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(wt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){const{scale:a,cosPhi:c}=this;return{x:wt(e)*c*a+.5,y:-Math.sin(wt(o))/c*a+.5,z:0}}unproject(e,o){const{scale:a,cosPhi:c}=this,d=-(o-.5)/a,p=dn(Yi((e-.5)/a)/c,-180,180),_=Math.asin(dn(d*c,-1,1)),v=dn(Yi(_),-Ai,Ai);return new hr(p,v)}}class f1 extends h1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,o,a){const c=ku(e,o,a),d=zd(ec(a));return f.v.transformMat4(c,c,d),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,o){const a=Nd(o.lat,o.lng),c=f.v.normalize([],a),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(o),e._centerAltitude):e._centerAltitude,p=Vo(1,0)*ct*d;f.v.scaleAndAdd(a,a,c,p);const _=f.m.identity(new Float64Array(16));return f.m.multiply(_,e.pixelMatrix,e.globeMatrix),f.v.transformMat4(a,a,_),new ut(a[0],a[1])}pixelsPerMeter(e,o){return Vo(1,0)*o}pixelSpaceConversion(e,o,a){const c=Vo(1,e)*o,d=mn(Vo(1,45)*o,c,a);return this.pixelsPerMeter(e,o)/d}createTileMatrix(e,o,a){const c=cg(ec(a.canonical));return f.m.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,o){const{center:a}=e,c=zd(ec(o));return f.m.rotateY(c,c,wt(a.lng)),f.m.rotateX(c,c,wt(a.lat)),f.m.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,o,a,c){return Tp(e,o,a,!0)||new lo(0,0)}pointCoordinate3D(e,o,a){const c=this.pointCoordinate(e,o,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,o){return!Tp(e,o.x,o.y,!1)}farthestPixelDistance(e){const o=function(c,d){const p=c.cameraToCenterDistance,_=c._centerAltitude*d,v=c._camera,b=c._camera.forward(),C=f.v.add([],f.v.scale([],b,-p),[0,0,_]),M=c.worldSize/(2*Math.PI),I=[0,0,-M],R=c.width/c.height,L=Math.tan(c.fovAboveCenter),F=f.v.scale([],v.up(),L),B=f.v.scale([],v.right(),L*R),U=f.v.normalize([],f.v.add([],f.v.add([],b,F),B)),Y=[];let J;if(new Sh(C,U).closestPointOnSphere(I,M,Y)){const Q=f.v.add([],Y,I),oe=f.v.sub([],Q,C);J=Math.cos(c.fovAboveCenter)*f.v.length(oe)}else{const Q=f.v.sub([],C,I),oe=f.v.sub([],I,C);f.v.normalize(oe,oe);const ae=f.v.length(Q)-M;J=Math.sqrt(ae*(ae+2*M));const me=Math.acos(J/(M+ae))-Math.acos(f.v.dot(b,oe));J*=Math.cos(me)}return 1.01*J}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Ma(e.zoom);if(a>0){const c=Ng(e,Vo(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return mn(o,c+d*(1-Math.cos(p)),Math.pow(a,10))}return o}upVector(e,o,a){return ku(o,a,e,1)}upVectorScale(e){return{metersToTile:Cp(lg(ec(e)))}}}function p1(n){const e=n.parallels,o=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new h1(n);case"equirectangular":return new wE(n);case"naturalEarth":return new CE(n);case"equalEarth":return new bE(n);case"winkelTripel":return new fM(n);case"albers":return o?new Vg(n):new xE(n);case"lambertConformalConic":return o?new Vg(n):new EE(n);case"globe":return new f1(n)}throw new Error(`Invalid projection name: ${n.name}`)}const TE=new Xe({"symbol-placement":new re(De.layout_symbol["symbol-placement"]),"symbol-spacing":new re(De.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new re(De.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Me(De.layout_symbol["symbol-sort-key"]),"symbol-z-order":new re(De.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new re(De.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new re(De.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new re(De.layout_symbol["icon-ignore-placement"]),"icon-optional":new re(De.layout_symbol["icon-optional"]),"icon-rotation-alignment":new re(De.layout_symbol["icon-rotation-alignment"]),"icon-size":new Me(De.layout_symbol["icon-size"]),"icon-text-fit":new Me(De.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Me(De.layout_symbol["icon-text-fit-padding"]),"icon-image":new Me(De.layout_symbol["icon-image"]),"icon-rotate":new Me(De.layout_symbol["icon-rotate"]),"icon-padding":new re(De.layout_symbol["icon-padding"]),"icon-keep-upright":new re(De.layout_symbol["icon-keep-upright"]),"icon-offset":new Me(De.layout_symbol["icon-offset"]),"icon-anchor":new Me(De.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new re(De.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new re(De.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new re(De.layout_symbol["text-rotation-alignment"]),"text-field":new Me(De.layout_symbol["text-field"]),"text-font":new Me(De.layout_symbol["text-font"]),"text-size":new Me(De.layout_symbol["text-size"]),"text-max-width":new Me(De.layout_symbol["text-max-width"]),"text-line-height":new Me(De.layout_symbol["text-line-height"]),"text-letter-spacing":new Me(De.layout_symbol["text-letter-spacing"]),"text-justify":new Me(De.layout_symbol["text-justify"]),"text-radial-offset":new Me(De.layout_symbol["text-radial-offset"]),"text-variable-anchor":new re(De.layout_symbol["text-variable-anchor"]),"text-anchor":new Me(De.layout_symbol["text-anchor"]),"text-max-angle":new re(De.layout_symbol["text-max-angle"]),"text-writing-mode":new re(De.layout_symbol["text-writing-mode"]),"text-rotate":new Me(De.layout_symbol["text-rotate"]),"text-padding":new re(De.layout_symbol["text-padding"]),"text-keep-upright":new re(De.layout_symbol["text-keep-upright"]),"text-transform":new Me(De.layout_symbol["text-transform"]),"text-offset":new Me(De.layout_symbol["text-offset"]),"text-allow-overlap":new re(De.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new re(De.layout_symbol["text-ignore-placement"]),"text-optional":new re(De.layout_symbol["text-optional"]),visibility:new re(De.layout_symbol.visibility)});var ov={paint:new Xe({"icon-opacity":new Me(De.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Me(De.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Me(De.paint_symbol["text-emissive-strength"]),"icon-color":new Me(De.paint_symbol["icon-color"]),"icon-halo-color":new Me(De.paint_symbol["icon-halo-color"]),"icon-halo-width":new Me(De.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Me(De.paint_symbol["icon-halo-blur"]),"icon-translate":new re(De.paint_symbol["icon-translate"]),"icon-translate-anchor":new re(De.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Me(De.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Me(De.paint_symbol["text-opacity"]),"text-color":new Me(De.paint_symbol["text-color"],{runtimeType:V,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Me(De.paint_symbol["text-halo-color"]),"text-halo-width":new Me(De.paint_symbol["text-halo-width"]),"text-halo-blur":new Me(De.paint_symbol["text-halo-blur"]),"text-translate":new re(De.paint_symbol["text-translate"]),"text-translate-anchor":new re(De.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new re(De.paint_symbol["icon-color-saturation"])}),layout:TE};class sv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ha,this.defaultValue=e}evaluate(e){if(e.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}It(sv,"FormatSectionOverride",{omit:["defaultValue"]});class jg extends xt{constructor(e,o,a){super(e,ov,o,a)}recalculate(e,o){super.recalculate(e,o),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const d of a)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,o,a,c){const d=this.layout.get(e).evaluate(o,{},a,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Uf(p.value)||!d?d:(_=o.properties,d.replace(/{([^{}]+)}/g,(b,C)=>C in _?String(_[C]):""));var _}createBucket(e){return new uf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ov.paint.overridableProperties){if(!jg.hasPaintOverride(this.layout,e))continue;const o=this.paint.get(e),a=new sv(o),c=new Rm(a,o.property.specification,this.scope,this.options);let d=null;d="constant"===o.value.kind||"source"===o.value.kind?new gd("source",c):new _d("composite",c,o.value.zoomStops,o.value._interpolationType),this.paint._values[e]=new Re(o.property,d,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,a){return!(!this.layout||o.isDataDriven()||a.isDataDriven())&&jg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){const a=e.get("text-field"),c=ov.paint.properties[o];let d=!1;const p=_=>{for(const v of _)if(c.overrides&&c.overrides.hasOverride(v))return void(d=!0)};if("constant"===a.value.kind&&a.value.value instanceof rr)p(a.value.value.sections);else if("source"===a.value.kind){const _=b=>{d||(b instanceof pl&&Ci(b.value)===we?p(b.value.sections):b instanceof cu?p(b.sections):b.eachChild(_))},v=a.value;v._styleExpression&&_(v._styleExpression.expression)}return d}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),o=0!==this.paint.get("text-opacity").constantOr(1),a=[];return e&&a.push("symbolIcon"),o&&a.push("symbolSDF"),a}getDefaultProgramParams(e,o){return{config:new yh(this,o),overrideFog:!1}}}const ME=Hd.types,av=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ug(n,e,o,a,c,d,p,_,v,b,C,M,I){const R=_?Math.min(Bu,Math.round(_[0])):0,L=_?Math.min(Bu,Math.round(_[1])):0;n.emplaceBack(e,o,Math.round(32*a),Math.round(32*c),d,p,(R<<1)+(v?1:0),L,16*b,16*C,256*M,256*I)}function $g(n,e,o){n.emplaceBack(e,o)}function Gg(n,e,o,a,c,d,p){n.emplaceBack(e,o,a,c,d,p)}function Hg(n,e,o,a,c){n.emplaceBack(e,o,a,c),n.emplaceBack(e,o,a,c),n.emplaceBack(e,o,a,c),n.emplaceBack(e,o,a,c)}function DE(n){for(const e of n.sections)if($(e.text))return!0;return!1}class ol{constructor(e){this.layoutVertexArray=new Wi,this.indexArray=new qn,this.programConfigurations=e,this.segments=new Ur,this.dynamicLayoutVertexArray=new lr,this.opacityVertexArray=new Fo,this.placedSymbolArray=new jm,this.iconTransitioningVertexArray=new No,this.globeExtVertexArray=new Ir,this.zOffsetVertexArray=new Sl}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,o,a,c,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Yx.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,av,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,hE.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Hy.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,uE.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}It(ol,"SymbolBuffers");class em{constructor(e,o,a){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new a,this.segments=new Ur,this.collisionVertexArray=new zo,this.collisionVertexArrayExt=new lr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Jx.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,dE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}It(em,"CollisionBuffers");class qg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=f.m.identity([]),this.placementViewportMatrix=f.m.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ag(this.zoom,o["text-size"]),this.iconSizeData=Ag(this.zoom,o["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==d&&void 0!==c.constantOr(1),this.sortFeaturesByY=("viewport-y"===d||"auto"===d&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>na[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate")}createArrays(){this.text=new ol(new Al(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ol(new Al(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new cs,this.lineVertexArray=new Mu,this.symbolInstances=new L0}calculateGlyphDependencies(e,o,a,c,d){for(let p=0;p<e.length;p++){const _=e.codePointAt(p);if(void 0===_)break;if(o[_]=!0,c&&d&&_<=65535){const v=Nh[e.charAt(p)];v&&(o[v.charCodeAt(0)]=!0)}}}populate(e,o,a,c){const d=this.layers[0],p=d.layout,_="globe"===this.projection.name,v=p.get("text-font"),b=p.get("text-field"),C=p.get("icon-image"),M=("constant"!==b.value.kind||b.value.value instanceof rr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&("constant"!==v.value.kind||v.value.value.length>0),I="constant"!==C.value.kind||!!C.value.value||Object.keys(C.parameters).length>0,R=p.get("symbol-sort-key");if(this.features=[],!M&&!I)return;const L=o.iconDependencies,F=o.glyphDependencies,B=o.availableImages,U=new pe(this.zoom);for(const{feature:Y,id:J,index:Q,sourceLayerIndex:oe}of e){const ae=d._featureFilter.needGeometry,me=Fu(Y,ae);if(!d._featureFilter.filter(U,me,a))continue;if(ae||(me.geometry=tc(Y,a,c)),_&&1!==Y.type&&a.z<=5){const Se=me.geometry,Ue=.98078528056,ot=(je,Je)=>{const Fe=ku(je.x,je.y,a,1),_t=ku(Je.x,Je.y,a,1);return f.v.dot(Fe,_t)<Ue};for(let je=0;je<Se.length;je++)Se[je]=Ex(Se[je],ot)}let _e,Ee;if(M){const Se=d.getValueAndResolveTokens("text-field",me,a,B),Ue=rr.factory(Se);DE(Ue)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ie()||this.hasRTLText&&ge.isParsed())&&(_e=uM(Ue,d,me))}if(I){const Se=d.getValueAndResolveTokens("icon-image",me,a,B);Ee=Se instanceof Hi?Se:Hi.fromString(Se)}if(!_e&&!Ee)continue;const Pe=this.sortFeaturesByKey?R.evaluate(me,{},a):void 0;if(this.features.push({id:J,text:_e,icon:Ee,index:Q,sourceLayerIndex:oe,geometry:me.geometry,properties:Y.properties,type:ME[Y.type],sortKey:Pe}),Ee&&(L[Ee.namePrimary]=!0,Ee.nameSecondary&&(L[Ee.nameSecondary]=!0)),_e){const Se=v.evaluate(me,{},a).join(","),Ue="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(na.vertical)>=0;for(const ot of _e.sections)if(ot.image)L[ot.image.namePrimary]=!0;else{const je=w(_e.toString()),Je=ot.fontStack||Se,Fe=F[Je]=F[Je]||{};this.calculateGlyphDependencies(ot.text,Fe,Ue,this.allowVerticalPlacement,je)}}}"line"===p.get("symbol-placement")&&(this.features=function(Y){const J={},Q={},oe=[];let ae=0;function me(Se){oe.push(Y[Se]),ae++}function _e(Se,Ue,ot){const je=Q[Se];return delete Q[Se],Q[Ue]=je,oe[je].geometry[0].pop(),oe[je].geometry[0]=oe[je].geometry[0].concat(ot[0]),je}function Ee(Se,Ue,ot){const je=J[Ue];return delete J[Ue],J[Se]=je,oe[je].geometry[0].shift(),oe[je].geometry[0]=ot[0].concat(oe[je].geometry[0]),je}function Pe(Se,Ue,ot){const je=ot?Ue[0][Ue[0].length-1]:Ue[0][0];return`${Se}:${je.x}:${je.y}`}for(let Se=0;Se<Y.length;Se++){const Ue=Y[Se],ot=Ue.geometry,je=Ue.text?Ue.text.toString():null;if(!je){me(Se);continue}const Je=Pe(je,ot),Fe=Pe(je,ot,!0);if(Je in Q&&Fe in J&&Q[Je]!==J[Fe]){const _t=Ee(Je,Fe,ot),Et=_e(Je,Fe,oe[_t].geometry);delete J[Je],delete Q[Fe],Q[Pe(je,oe[Et].geometry,!0)]=Et,oe[_t].geometry=null}else Je in Q?_e(Je,Fe,ot):Fe in J?Ee(Je,Fe,ot):(me(Se),J[Je]=ae-1,Q[Fe]=ae-1)}return oe.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,J)=>Y.sortKey-J.sortKey)}update(e,o,a,c,d){const p=0!==Object.keys(e).length;if(p&&!this.stateDependentLayers.length)return;const _=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,o,_,a,c,d),this.icon.programConfigurations.updatePaintArrays(e,o,_,a,c,d)}updateZOffset(){const e=(d,p,_)=>{a+=p,a>d.length&&d.resize(a);for(let v=-p;v<0;v++)d.emplace(v+a,_)},o=(d,p,_)=>{c+=p,c>d.length&&d.resize(c);for(let v=-p;v<0;v++)d.emplace(v+c,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:v,numIconVertices:b}=p,C=p.zOffset,M=b>0;if((_>0||v>0)&&(e(this.text.zOffsetVertexArray,_,C),e(this.text.zOffsetVertexArray,v,C)),M){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:R}=p;I>=0&&o(this.icon.zOffsetVertexArray,b,C),R>=0&&o(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=p1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,o){const a=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:c,y:d}of o)this.lineVertexArray.emplaceBack(c,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,o,a,c,d,p,_,v,b,C,M,I,R,L,F,B){const U=e.indexArray,Y=e.layoutVertexArray,J=e.globeExtVertexArray,Q=e.segments.prepareSegment(4*o.length,Y,U,this.canOverlap?p.sortKey:void 0),oe=this.glyphOffsetArray.length,ae=Q.vertexLength,me=this.allowVerticalPlacement&&_===na.vertical?Math.PI/2:0,_e=p.text&&p.text.sections;for(let Pe=0;Pe<o.length;Pe++){const{tl:Se,tr:Ue,bl:ot,br:je,texPrimary:Je,texSecondary:Fe,pixelOffsetTL:_t,pixelOffsetBR:Et,minFontScaleX:rt,minFontScaleY:Jt,glyphOffset:St,isSDF:mt,sectionIndex:Ht}=o[Pe],Nt=Q.vertexLength,Gt=St[1];if(Ug(Y,b.x,b.y,Se.x,Gt+Se.y,Je.x,Je.y,a,mt,_t.x,_t.y,rt,Jt),Ug(Y,b.x,b.y,Ue.x,Gt+Ue.y,Je.x+Je.w,Je.y,a,mt,Et.x,_t.y,rt,Jt),Ug(Y,b.x,b.y,ot.x,Gt+ot.y,Je.x,Je.y+Je.h,a,mt,_t.x,Et.y,rt,Jt),Ug(Y,b.x,b.y,je.x,Gt+je.y,Je.x+Je.w,Je.y+Je.h,a,mt,Et.x,Et.y,rt,Jt),v){const{x:at,y:cn,z:On}=v.anchor,[pn,Dn,Yn]=v.up;Gg(J,at,cn,On,pn,Dn,Yn),Gg(J,at,cn,On,pn,Dn,Yn),Gg(J,at,cn,On,pn,Dn,Yn),Gg(J,at,cn,On,pn,Dn,Yn),Hg(e.dynamicLayoutVertexArray,at,cn,On,me)}else Hg(e.dynamicLayoutVertexArray,b.x,b.y,b.z,me);if(B){const at=Fe||Je;$g(e.iconTransitioningVertexArray,at.x,at.y),$g(e.iconTransitioningVertexArray,at.x+at.w,at.y),$g(e.iconTransitioningVertexArray,at.x,at.y+at.h),$g(e.iconTransitioningVertexArray,at.x+at.w,at.y+at.h)}U.emplaceBack(Nt,Nt+1,Nt+2),U.emplaceBack(Nt+1,Nt+2,Nt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Pe!==o.length-1&&Ht===o[Pe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,p,p.index,{},R,L,F,_e&&_e[Ht])}const Ee=v?v.anchor:b;e.placedSymbolArray.emplaceBack(Ee.x,Ee.y,Ee.z,b.x,b.y,oe,this.glyphOffsetArray.length-oe,ae,C,M,b.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],_,0,!1,0,I,0)}_commitLayoutVertex(e,o,a,c,d,p,_){e.emplaceBack(o,a,c,d,p,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,o,a,c,d,p,_){const v=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),b=v.vertexLength,C=_.tileAnchorX,M=_.tileAnchorY;for(let R=0;R<4;R++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,o,e.padding,_.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,d,p,C,M,new ut(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,p,C,M,new ut(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,d,p,C,M,new ut(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,d,p,C,M,new ut(e.x1,e.y2)),v.vertexLength+=4;const I=a.indexArray;I.emplaceBack(b,b+1),I.emplaceBack(b+1,b+2),I.emplaceBack(b+2,b+3),I.emplaceBack(b+3,b),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,o,a,c,d,p){for(let _=c;_<d;_++){const v=a.get(_),b=this.getSymbolInstanceTextSize(e,p,o,_);this._addCollisionDebugVertices(v,b,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,o,a,c,d,p){for(let _=c;_<d;_++){const v=a.get(_),b=this.getSymbolInstanceIconSize(e,o,p.placedIconSymbolIndex);this._addCollisionDebugVertices(v,b,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new em(Qi,qy.members,No),this.iconCollisionBox=new em(Qi,qy.members,No);const a=jo(this.iconSizeData,e),c=jo(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,o,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,o,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,o,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,o,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,o,a,c){const d=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:c),p=Gp(this.textSizeData,e,d)/Do;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,o,a){const c=this.icon.placedSymbolArray.get(a),d=Gp(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,o,a,c){e.emplaceBack(o,-a,-a,c),e.emplaceBack(o,a,-a,c),e.emplaceBack(o,a,a,c),e.emplaceBack(o,-a,a,c)}_updateTextDebugCollisionBoxes(e,o,a,c,d,p){for(let _=c;_<d;_++){const v=a.get(_),b=this.getSymbolInstanceTextSize(e,p,o,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,v.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,o,a,c,d,p){for(let _=c;_<d;_++){const v=a.get(_),b=this.getSymbolInstanceIconSize(e,o,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,v.padding,p.zOffset)}}updateCollisionDebugBuffers(e,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=jo(this.iconSizeData,e),c=jo(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,o,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,o,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,o,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(a,e,o,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,o,a,c,d,p,_,v,b){const C={};if(o<a){const{x1:M,y1:I,x2:R,y2:L,padding:F,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:Q,featureIndex:oe}=e.get(o);C.textBox={x1:M,y1:I,x2:R,y2:L,padding:F,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:Q},C.textFeatureIndex=oe}if(c<d){const{x1:M,y1:I,x2:R,y2:L,padding:F,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:Q,featureIndex:oe}=e.get(c);C.verticalTextBox={x1:M,y1:I,x2:R,y2:L,padding:F,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:Q},C.verticalTextFeatureIndex=oe}if(p<_){const{x1:M,y1:I,x2:R,y2:L,padding:F,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:Q,featureIndex:oe}=e.get(p);C.iconBox={x1:M,y1:I,x2:R,y2:L,padding:F,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:Q},C.iconFeatureIndex=oe}if(v<b){const{x1:M,y1:I,x2:R,y2:L,padding:F,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:Q,featureIndex:oe}=e.get(v);C.verticalIconBox={x1:M,y1:I,x2:R,y2:L,padding:F,projectedAnchorX:B,projectedAnchorY:U,projectedAnchorZ:Y,tileAnchorX:J,tileAnchorY:Q},C.verticalIconFeatureIndex=oe}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const a=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,o){const a=e.placedSymbolArray.get(o),c=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const o=Math.sin(e),a=Math.cos(e),c=[],d=[],p=[];for(let _=0;_<this.symbolInstances.length;++_){p.push(_);const v=this.symbolInstances.get(_);c.push(0|Math.round(o*v.tileAnchorX+a*v.tileAnchorY)),d.push(v.featureIndex)}return p.sort((_,v)=>c[_]-c[v]||d[v]-d[_]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,o){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===o?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const a=this.symbolInstances.get(o);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:b}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),p>=0&&p!==d&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}It(qg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),qg.MAX_GLYPHS=65535,qg.addDynamicAttributes=Hg;var uf=qg;const SE=Ft([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:m1}=SE,g1=Ft([{name:"a_packed",components:4,type:"Float32"}]),{members:Zg}=g1,lv=Hd.types,pM=Math.cos(Math.PI/180*37.5);class tm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Kr,this.layoutVertexArray2=new lr,this.indexArray=new qn,this.programConfigurations=new Al(e.layers,e.zoom),this.segments=new Ur,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,a,c){this.hasPattern=Bp("line",this.layers,o);const d=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:C,id:M,index:I,sourceLayerIndex:R}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Fu(C,L);if(!this.layers[0]._featureFilter.filter(new pe(this.zoom),F,a))continue;const B=d?d.evaluate(F,{},a):void 0,U={id:M,properties:C.properties,type:C.type,sourceLayerIndex:R,index:I,geometry:L?F.geometry:tc(C,a,c),patterns:{},sortKey:B};p.push(U)}d&&p.sort((C,M)=>C.sortKey-M.sortKey);const{lineAtlas:_,featureIndex:v}=o,b=this.addConstantDashes(_);for(const C of p){const{geometry:M,index:I,sourceLayerIndex:R}=C;if(b&&this.addFeatureDashes(C,_),this.hasPattern){const L=Fy("line",this.layers,C,this.zoom,o);this.patternFeatures.push(L)}else this.addFeature(C,M,I,a,_.positions,o.availableImages,o.brightness);v.insert(e[I].feature,M,I,R,this.index)}}addConstantDashes(e){let o=!1;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if("constant"!==c.kind||"constant"!==d.kind)o=!0;else{const p=d.value,_=c.value;if(!_)continue;e.addDash(_,p)}}return o}addFeatureDashes(e,o){const a=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if("constant"===d.kind&&"constant"===p.kind)continue;let _,v;if("constant"===d.kind){if(_=d.value,!_)continue}else _=d.evaluate({zoom:a},e);v="constant"===p.kind?p.value:p.evaluate({zoom:a},e),o.addDash(_,v),e.patterns[c.id]=o.getKey(_,v)}}update(e,o,a,c,d){const p=0!==Object.keys(e).length;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,o,p?this.stateDependentLayers:this.layers,a,c,d)}addFeatures(e,o,a,c,d,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,a,c,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Zg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,m1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,a,c,d,p,_){const v=this.layers[0].layout,b=v.get("line-join").evaluate(e,{}),C=v.get("line-cap").evaluate(e,{}),M=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of o)this.addLine(R,e,b,C,M,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,c,_)}addLine(e,o,a,c,d,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let U=0;U<e.length-1;U++)this.totalDistance+=e[U].dist(e[U+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _="Polygon"===lv[o.type];let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let b=0;for(;b<v-1&&e[b].equals(e[b+1]);)b++;if(v<(_?3:2))return;"bevel"===a&&(d=1.05);const C=this.overscaling<=16?15*ct/(512*this.overscaling):0,M=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let I,R,L,F,B;this.e1=this.e2=-1,_&&(I=e[v-2],B=e[b].sub(I)._unit()._perp());for(let U=b;U<v;U++){if(L=U===v-1?_?e[b+1]:void 0:e[U+1],L&&e[U].equals(L))continue;B&&(F=B),I&&(R=I),I=e[U],B=L?L.sub(I)._unit()._perp():F,F=F||B;let Y=F.add(B);0===Y.x&&0===Y.y||Y._unit();const J=F.x*B.x+F.y*B.y,Q=Y.x*B.x+Y.y*B.y,oe=0!==Q?1/Q:1/0,ae=2*Math.sqrt(2-2*Q),me=Q<pM&&R&&L,_e=F.x*B.y-F.y*B.x>0;if(me&&U>b){const Se=I.dist(R);if(Se>2*C){const Ue=I.sub(I.sub(R)._mult(C/Se)._round());this.updateDistance(R,Ue),this.addCurrentVertex(Ue,F,0,0,M),R=Ue}}const Ee=R&&L;let Pe=Ee?a:_?"butt":c;if(Ee&&"round"===Pe&&(oe<p?Pe="miter":oe<=2&&(Pe="fakeround")),"miter"===Pe&&oe>d&&(Pe="bevel"),"bevel"===Pe&&(oe>2&&(Pe="flipbevel"),oe<d&&(Pe="miter")),R&&this.updateDistance(R,I),"miter"===Pe)Y._mult(oe),this.addCurrentVertex(I,Y,0,0,M);else if("flipbevel"===Pe){if(oe>100)Y=B.mult(-1);else{const Se=oe*F.add(B).mag()/F.sub(B).mag();Y._perp()._mult(Se*(_e?-1:1))}this.addCurrentVertex(I,Y,0,0,M),this.addCurrentVertex(I,Y.mult(-1),0,0,M)}else if("bevel"===Pe||"fakeround"===Pe){const Se=-Math.sqrt(oe*oe-1),Ue=_e?Se:0,ot=_e?0:Se;if(R&&this.addCurrentVertex(I,F,Ue,ot,M),"fakeround"===Pe){const je=Math.round(180*ae/Math.PI/20);for(let Je=1;Je<je;Je++){let Fe=Je/je;if(.5!==Fe){const Et=Fe-.5;Fe+=Fe*Et*(Fe-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*Et*Et+(.848013+J*(.215638*J-1.06021)))}const _t=B.sub(F)._mult(Fe)._add(F)._unit()._mult(_e?-1:1);this.addHalfVertex(I,_t.x,_t.y,!1,_e,0,M)}}L&&this.addCurrentVertex(I,B,-Ue,-ot,M)}else if("butt"===Pe)this.addCurrentVertex(I,Y,0,0,M);else if("square"===Pe){const Se=R?1:-1;R||this.addCurrentVertex(I,Y,Se,Se,M),this.addCurrentVertex(I,Y,0,0,M),R&&this.addCurrentVertex(I,Y,Se,Se,M)}else"round"===Pe&&(R&&(this.addCurrentVertex(I,F,0,0,M),this.addCurrentVertex(I,F,1,1,M,!0)),L&&(this.addCurrentVertex(I,B,-1,-1,M,!0),this.addCurrentVertex(I,B,0,0,M)));if(me&&U<v-1){const Se=I.dist(L);if(Se>2*C){const Ue=I.add(L.sub(I)._mult(C/Se)._round());this.updateDistance(I,Ue),this.addCurrentVertex(Ue,B,0,0,M),I=Ue}}}}addCurrentVertex(e,o,a,c,d,p=!1){const _=o.y*c-o.x,v=-o.y-o.x*c;this.addHalfVertex(e,o.x+o.y*a,o.y-o.x*a,p,!1,a,d),this.addHalfVertex(e,_,v,p,!0,-c,d)}addHalfVertex({x:e,y:o},a,c,d,p,_,v){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(o<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(0===_?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),v.primitiveLength++),p?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,o){this.distance+=e.dist(o),this.updateScaledDistance()}}It(tm,"LineBucket",{omit:["layers","patternFeatures"]});class sc{constructor(e,o,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(o,c)}update(e,o,a){const{width:c,height:d}=e,{context:p}=this,{gl:_}=p;if(_.bindTexture(_.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!o||!1!==o.premultiply)),a||this.size&&this.size[0]===c&&this.size[1]===d){const{x:v,y:b}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,v,b,_.RGBA,_.UNSIGNED_BYTE,e);else{let C=this.format,M=_.UNSIGNED_BYTE;this.format===_.R32F&&(C=_.RED,M=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,v,b,c,d,C,M,e.data)}}else if(this.size=[c,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let v=this.format;this.format===_.R8&&(v=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,v,_.UNSIGNED_BYTE,e)}else{let v=this.format,b=this.format,C=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(v=_.DEPTH_COMPONENT16,C=_.UNSIGNED_SHORT),this.format===_.R8&&(b=_.RED),this.format===_.R32F&&(C=_.FLOAT,b=_.RED),_.texImage2D(_.TEXTURE_2D,0,v,c,d,0,b,C,e.data)}this.useMipmap=!(!o||!o.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,o,a=!1){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,o),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(e,o,a,c){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),o!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,o),this.magFilter=o),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class nm{constructor(e,o){this.context=e,this.texture=o}bind(e,o){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),o!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,o),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,o),this.wrapS=o)}}const ps=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,o=0,a=0,c=0,d=0,p=0,_=0;for(1&e?c=d=p=32:o=a=_=32;(e>>=1)>1;){const b=o+c>>1,C=a+d>>1;1&e?(c=o,d=a,o=p,a=_):(o=c,a=d,c=p,d=_),p=b,_=C}const v=4*n;ps[v+0]=o,ps[v+1]=a,ps[v+2]=c,ps[v+3]=d}const ac=new Uint16Array(2178),Vu=new Uint8Array(1089),hf=new Uint16Array(1089);function _1(n){return 0===n?-.03125:32===n?.03125:0}var rm=Ft([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const y1={type:2,extent:ct,loadGeometry:()=>[[new ut(0,0),new ut(ct+1,0),new ut(ct+1,ct+1),new ut(0,ct+1),new ut(0,0)]]};class df{constructor(e,o,a,c,d){this.tileID=e,this.uid=ci(),this.uses=0,this.tileSize=o,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,c&&c.style&&(this._lastUpdatedBrightness=c.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const o=e+this.timeAdded;o<ki.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ic(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,o,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const p={};if(!d)return p;for(const _ of c){const v=_.layerIds.map(b=>d.getLayer(b)).filter(Boolean);if(0!==v.length){_.layers=v,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>v.filter(C=>C.id===b)[0]));for(const b of v)p[b.fqid]=_}}return p}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof uf){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof uf&&d.hasRTLText){this.hasRTLText=!0,ge.isLoading()||ge.isLoaded()||"deferred"!==ie()||he();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c],p=o.style.getOwnLayer(c);if(!p)continue;const _=p.queryRadius(d);this.queryPadding=Math.max(this.queryPadding,_)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Vm}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(e)}const o=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){const c=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new sc(e,a.image,o.RGBA,{useMipmap:c}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new sc(e,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new sc(e,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(e,o,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const c=o.style.getBrightness();(this._lastUpdatedBrightness||c)&&(this._lastUpdatedBrightness&&c&&Math.abs(this._lastUpdatedBrightness-c)<.001||(this._lastUpdatedBrightness=c,this.updateBuckets(void 0,o)))}queryRenderedFeatures(e,o,a,c,d,p,_,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:_,transform:p,params:d,tileTransform:this.tileTransform},e,o,a):{}}querySourceFeatures(e,o){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const c=a.loadVTLayers(),d=o?o.sourceLayer:"",p=c._geojsonTileLayer||c[d];if(!p)return;const _=Ya(o&&o.filter),{z:v,x:b,y:C}=this.tileID.canonical,M={z:v,x:b,y:C};for(let I=0;I<p.length;I++){const R=p.feature(I);if(_.needGeometry){const B=Fu(R,!0);if(!_.filter(new pe(this.tileID.overscaledZ),B,this.tileID.canonical))continue}else if(!_.filter(new pe(this.tileID.overscaledZ),R))continue;const L=a.getId(R,d),F=new $x(R,v,b,C,L);F.tile=M,e.push(F)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const a=Ye(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let c=!1;if(this.expirationTime>a)c=!1;else if(o)if(this.expirationTime<o)c=!0;else{const d=this.expirationTime-o;d?this.expirationTime=a+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&o&&this.updateBuckets(e,o)}updateBuckets(e,o){if(!this.latestFeatureIndex)return;const a=this.latestFeatureIndex.loadVTLayers(),c=o.style.listImages(),d=o.style.getBrightness();for(const p in this.buckets){if(!o.style.hasLayer(p))continue;const _=this.buckets[p],v=_.layers[0].sourceLayer||"_geojsonTileLayer",b=a[v];let C={};if(e&&(C=e[v],!b||!C||0===Object.keys(C).length))continue;if(_.update(C,b,c,this.imageAtlas&&this.imageAtlas.patternPositions||{},d),_ instanceof tm||_ instanceof Eg){const I=o.style.getOwnSourceCache(_.layers[0].source);o._terrain&&o._terrain.enabled&&I&&_.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(I.id,this.tileID)}const M=o&&o.style&&o.style.getOwnLayer(p);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ki.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ki.now()+e}setTexture(e,o){const a=o.context,c=a.gl;this.texture=this.texture||o.getTileTexture(e.width),this.texture&&this.texture instanceof sc?this.texture.update(e,{useMipmap:!0}):(this.texture=new sc(a,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,o){const a={};for(const c of o)a[c]=!0;this.dependencies[e]=a}hasDependency(e,o){for(const a of e){const c=this.dependencies[a];if(c)for(const d of o)if(c[d])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,o){if(!o||"mercator"===o.name||this._tileDebugBuffer)return;const a=tc(y1,this.tileID.canonical,this.tileTransform)[0],c=new ke,d=new Cd;for(let p=0;p<a.length;p++){const{x:_,y:v}=a[p];c.emplaceBack(_,v),d.emplaceBack(p)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,Ld.members),this._tileDebugSegments=Ur.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(e,o){if(this._tileBoundsBuffer||!o||"mercator"===o.name)return;const a=tc(y1,this.tileID.canonical,this.tileTransform)[0];let c,d;if(this.isRaster){const p=function(_,v){const b=ic(_,v),C=Math.pow(2,_.z);for(let B=0;B<33;B++)for(let U=0;U<33;U++){const Y=To((_.x+(U+_1(U))/32)/C),J=Mo((_.y+(B+_1(B))/32)/C),Q=v.project(Y,J),oe=33*B+U;ac[2*oe+0]=Math.round((Q.x*b.scale-b.x)*ct),ac[2*oe+1]=Math.round((Q.y*b.scale-b.y)*ct)}Vu.fill(0),hf.fill(0);for(let B=2045;B>=0;B--){const U=4*B,Y=ps[U+0],J=ps[U+1],Q=ps[U+2],oe=ps[U+3],ae=Y+Q>>1,me=J+oe>>1,_e=ae+me-J,Ee=me+Y-ae,Pe=33*J+Y,Se=33*oe+Q,Ue=33*me+ae,ot=Math.hypot((ac[2*Pe+0]+ac[2*Se+0])/2-ac[2*Ue+0],(ac[2*Pe+1]+ac[2*Se+1])/2-ac[2*Ue+1])>=16;Vu[Ue]=Vu[Ue]||(ot?1:0),B<1022&&(Vu[Ue]=Vu[Ue]||Vu[33*(J+Ee>>1)+(Y+_e>>1)]||Vu[33*(oe+Ee>>1)+(Q+_e>>1)])}const M=new ar,I=new qn;let R=0;function L(B,U){const Y=33*U+B;return 0===hf[Y]&&(M.emplaceBack(ac[2*Y+0],ac[2*Y+1],B*ct/32,U*ct/32),hf[Y]=++R),hf[Y]-1}function F(B,U,Y,J,Q,oe){const ae=B+Y>>1,me=U+J>>1;if(Math.abs(B-Q)+Math.abs(U-oe)>1&&Vu[33*me+ae])F(Q,oe,B,U,ae,me),F(Y,J,Q,oe,ae,me);else{const _e=L(B,U),Ee=L(Y,J),Pe=L(Q,oe);I.emplaceBack(_e,Ee,Pe)}}return F(0,0,32,32,32,0),F(32,32,0,0,0,32),{vertices:M,indices:I}}(this.tileID.canonical,o);c=p.vertices,d=p.indices}else{c=new ar,d=new qn;for(const{x:_,y:v}of a)c.emplaceBack(_,v,0,0);const p=Oh(c.int16,void 0,4);for(let _=0;_<p.length;_+=3)d.emplaceBack(p[_],p[_+1],p[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,rm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Ur.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugBuffers(e,o){const a=o.projection;if(!a||"globe"!==a.name||o.freezeTileCoverage)return;const c=this.tileID.canonical,d=zd(sg(c,o)),p=Ma(o.zoom);let _;p>0&&(_=f.m.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,o,d,_,p),this._makeGlobeTileDebugTextBuffer(e,c,o,d,_,p)}_globePoint(e,o,a,c,d,p,_){let v=ku(e,o,a);if(p){const b=1<<a.z,C=kl(c.center.lng),M=Da(c.center.lat),I=(a.x+.5)/b-C;let R=0;I>.5?R=-1:I<-.5&&(R=1);let L=(e/ct+a.x)/b+R,F=(o/ct+a.y)/b;L=(L-C)*c._pixelsPerMercatorPixel+C,F=(F-M)*c._pixelsPerMercatorPixel+M;const B=[L*c.worldSize,F*c.worldSize,0];f.v.transformMat4(B,B,p),v=jc(v,B,_)}return f.v.transformMat4(v,v,d)}_makeGlobeTileDebugBorderBuffer(e,o,a,c,d,p){const _=new ke,v=new Cd,b=new ln,C=(I,R,L,F,B)=>{const U=(L-I)/(B-1),Y=(F-R)/(B-1),J=_.length;for(let Q=0;Q<B;Q++){const oe=I+Q*U,ae=R+Q*Y;_.emplaceBack(oe,ae);const me=this._globePoint(oe,ae,o,a,c,d,p);b.emplaceBack(me[0],me[1],me[2]),v.emplaceBack(J+Q)}},M=ct;C(0,0,M,0,16),C(M,0,M,M,16),C(M,M,0,M,16),C(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(v),this._tileDebugBuffer=e.createVertexBuffer(_,Ld.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,mx.members),this._tileDebugSegments=Ur.simpleSegment(0,0,_.length,v.length)}_makeGlobeTileDebugTextBuffer(e,o,a,c,d,p){const _=ct/4,v=new ke,b=new qn,C=new ln,M=25;b.reserve(32),v.reserve(M),C.reserve(M);const I=(R,L)=>M*R+L;for(let R=0;R<M;R++){const L=R*_;for(let F=0;F<M;F++){const B=F*_;v.emplaceBack(B,L);const U=this._globePoint(B,L,o,a,c,d,p);C.emplaceBack(U[0],U[1],U[2])}}for(let R=0;R<4;R++)for(let L=0;L<4;L++){const F=I(R,L),B=I(R,L+1),U=I(R+1,L),Y=I(R+1,L+1);b.emplaceBack(F,B,U),b.emplaceBack(U,B,Y)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(v,Ld.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(C,mx.members),this._tileDebugTextSegments=Ur.simpleSegment(0,0,M,32)}destroy(e=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof sc&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class im{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,a){const c=e.wrapped().key;void 0===this.data[c]&&(this.data[c]=[]);const d={value:o,timeout:void 0};if(void 0!==a&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const a=e.wrapped().key,c=void 0===o?0:this.data[a].indexOf(o),d=this.data[a][c];return this.data[a].splice(c,1),d.timeout&&clearTimeout(d.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const a in this.data)for(const c of this.data[a])e(c.value)||o.push(c);for(const a of o)this.remove(a.value.tileID,a)}}let v1=(()=>{class n{constructor(o,a,c,d){this.id=n.uniqueIdxCounter,n.uniqueIdxCounter++,this.context=o;const p=o.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||d||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=n.uniqueIdxCounter,n.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return n.uniqueIdxCounter=0,n})();class Jc{constructor(e,o,a){this.func=e,this.mask=o,this.range=a}}Jc.ReadOnly=!1,Jc.ReadWrite=!0,Jc.disabled=new Jc(519,Jc.ReadOnly,[0,1]);class cv{constructor(e,o,a,c,d,p){this.test=e,this.ref=o,this.mask=a,this.fail=c,this.depthFail=d,this.pass=p}}cv.disabled=new cv({func:519,mask:0},0,0,7680,7680,7680);class Aa{constructor(e,o,a,c){this.blendFunction=e,this.blendColor=o,this.mask=a,this.blendEquation=c}}Aa.Replace=[1,0,1,0],Aa.disabled=new Aa(Aa.Replace,un.transparent,[!1,!1,!1,!1]),Aa.unblended=new Aa(Aa.Replace,un.transparent,[!0,!0,!0,!0]),Aa.alphaBlended=new Aa([1,771,1,771],un.transparent,[!0,!0,!0,!0]),Aa.multiply=new Aa([774,0,774,0],un.transparent,[!0,!0,!0,!0]);class Bl{constructor(e,o,a){this.enable=e,this.mode=o,this.frontFace=a}}Bl.disabled=new Bl(!1,1029,2305),Bl.backCCW=new Bl(!0,1029,2305),Bl.backCW=new Bl(!0,1029,2304),Bl.frontCW=new Bl(!0,1028,2304),Bl.frontCCW=new Bl(!0,1028,2305);class ju extends ho{constructor(e,o,a){super(),this.id=e,this._onlySymbols=a,o.on("data",c=>{"source"===c.dataType&&"metadata"===c.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===c.dataType&&"content"===c.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new im(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Gx,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const o=this._tiles[e];if("errored"!==o.state&&("loaded"!==o.state||!o.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,o){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,o)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const a=this._tiles[o];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return ca(this._tiles).map(e=>e.tileID).sort(hv).map(e=>e.key)}getRenderableIds(e,o){const a=[];for(const c in this._tiles)this._isIdRenderable(+c,e,o)&&a.push(this._tiles[c]);return e?a.sort((c,d)=>{const p=c.tileID,_=d.tileID,v=new ut(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new ut(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||b.y-v.y||b.x-v.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(hv).map(c=>c.key)}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,o){const a=this._tiles[e];a&&("loading"!==a.state&&(a.state=o),this._loadTile(a,this._tileLoaded.bind(this,a,e,o)))}_tileLoaded(e,o,a,c){if(c)if(e.state="errored",404!==c.status)this._source.fire(new $s(c,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Ei("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=ki.now(),"expired"===a&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ei("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const o=this.getRenderableIds();for(let c=0;c<o.length;c++){const d=o[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const p=this.getTileByID(d);a(e,p),a(p,e)}}function a(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let p=d.tileID.canonical.x-c.tileID.canonical.x;const _=d.tileID.canonical.y-c.tileID.canonical.y,v=Math.pow(2,c.tileID.canonical.z),b=d.tileID.key;0===p&&0===_||Math.abs(_)>1||(Math.abs(p)>1&&(1===Math.abs(p+v)?p+=v:1===Math.abs(p-v)&&(p-=v)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,p,_),c.neighboringTiles&&c.neighboringTiles[b]&&(c.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,a,c){for(const d in this._tiles){let p=this._tiles[d];if(c[d]||!p.hasData()||p.tileID.overscaledZ<=o||p.tileID.overscaledZ>a)continue;let _=p.tileID;for(;p&&p.tileID.overscaledZ>o+1;){const b=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[b.key],p&&p.hasData()&&(_=b)}let v=_;for(;v.overscaledZ>o;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){c[_.key]=_;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=o?a:null}for(let a=e.overscaledZ-1;a>=o;a--){const c=e.scaledTo(a),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,o){o=o||this._source.tileSize;const a=Math.ceil(e.width/o)+1,c=Math.ceil(e.height/o)+1,d=Math.floor(a*c*5),p="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,d):d,_="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(_)}handleWrapJump(e){const o=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,o){const a={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+o),a[d.tileID.key]=d}this._tiles=a;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,o,a,c){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let d;if(this.updateCacheSize(e,o),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new no(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(d=e.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(v=>this._source.hasTile(v)))):d=[],d.length>0&&this.castsShadows&&c&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!qh(this._source.type)){const v=e.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),b=Math.min(v,this._source.maxzoom),C=e.extendTileCoverForShadows(d,c,b);for(const M of C)this._shadowCasterTiles[M.key]=!0,d.push(M)}const p=this._updateRetainedTiles(d);if(qh(this._source.type)&&0!==d.length){const v={},b={},C=Object.keys(p);for(const I of C){const R=p[I],L=this._tiles[I];if(!L||L.fadeEndTime&&L.fadeEndTime<=ki.now())continue;const F=this.findLoadedParent(R,Math.max(R.overscaledZ-ju.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),v[F.tileID.key]=F.tileID),b[I]=R}const M=d[d.length-1].overscaledZ;for(const I in this._tiles){const R=this._tiles[I];if(p[I]||!R.hasData())continue;let L=R.tileID;for(;L.overscaledZ>M;){L=L.scaledTo(L.overscaledZ-1);const F=this._tiles[L.key];if(F&&F.hasData()&&b[L.key]){p[I]=R.tileID;break}}}for(const I in v)p[I]||(this._coveredTiles[I]=!0,p[I]=v[I])}for(const v in p)this._tiles[v].clearFadeHold();const _=function(v,b){const C=[];for(const M in v)M in b||C.push(M);return C}(this._tiles,p);for(const v of _){const b=this._tiles[v];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const o={};if(0===e.length)return o;const a={},c=e.reduce((b,C)=>Math.min(b,C.overscaledZ),1/0),d=e[0].overscaledZ,p=Math.max(d-ju.maxOverzooming,this._source.minzoom),_=Math.max(d+ju.maxUnderzooming,this._source.minzoom),v={};for(const b of e){const C=this._addTile(b);o[b.key]=b,C.hasData()||c<this._source.maxzoom&&(v[b.key]=b)}this._retainLoadedChildren(v,c,_,o);for(const b of e){let C=this._tiles[b.key];if(C.hasData())continue;if(b.canonical.z>=this._source.maxzoom){const I=b.children(this._source.maxzoom)[0],R=this.getTile(I);if(R&&R.hasData()){o[I.key]=I;continue}}else{const I=b.children(this._source.maxzoom);if(o[I[0].key]&&o[I[1].key]&&o[I[2].key]&&o[I[3].key])continue}let M=C.wasRequested();for(let I=b.overscaledZ-1;I>=p;--I){const R=b.scaledTo(I);if(a[R.key]||(a[R.key]=!0,C=this.getTile(R),!C&&M&&(C=this._addTile(R)),C&&(o[R.key]=R,M=C.wasRequested(),C.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}o.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;c=d}for(const d of o)this._loadedParentTiles[d]=a}}_addTile(e){let o=this._tiles[e.key];if(o)return!0!==o.isExtraShadowCaster||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const a=!!o;if(!a){const c=this.map?this.map.painter:null;o=new df(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,e.key,o.state))}return o?(o.uses++,this._tiles[e.key]=o,a||this._source.fire(new Ei("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=o.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&"reloading"!==o.state?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,o,a){const c=[],d=this.transform;if(!d)return c;const p="globe"===d.projection.name,_=kl(d.center.lng);for(const v in this._tiles){const b=this._tiles[v];if(a&&b.clearQueryDebugViz(),b.holdingForFade())continue;let C;if(p){const M=b.tileID.canonical;if(0===M.z){const I=[Math.abs(dn(_,...om(M,-1))-_),Math.abs(dn(_,...om(M,1))-_)];C=[0,2*I.indexOf(Math.min(...I))-1]}else{const I=[Math.abs(dn(_,...om(M,-1))-_),Math.abs(dn(_,...om(M,0))-_),Math.abs(dn(_,...om(M,1))-_)];C=[I.indexOf(Math.min(...I))-1]}}else C=[0];for(const M of C){const I=e.containsTile(b,d,o,M);I&&c.push(I)}}return c}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,o){const a=this.getRenderableIds(e,o).map(d=>this._tiles[d].tileID),c="globe"===this.transform.projection.name;for(const d of a)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped()),d.expandedProjMatrix=c?this.transform.calculateProjMatrix(d.toUnwrapped(),!1,!0):d.projMatrix;return a}sortCoordinatesByDistance(e){const o=e.slice(),a=this.transform._camera.position,c=this.transform._camera.forward(),d={};for(const p of o){const _=1/(1<<p.canonical.z);d[p.key]=((p.canonical.x+.5)*_+p.wrap-a[0])*c[0]+((p.canonical.y+.5)*_-a[1])*c[1]-a[2]*c[2]}return o.sort((p,_)=>d[p.key]-d[_.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(qh(this._source.type))for(const e in this._tiles){const o=this._tiles[e];if(void 0!==o.fadeEndTime&&o.fadeEndTime>=ki.now())return!0}return!1}setFeatureState(e,o,a){this._state.updateState(e=e||"_geojsonTileLayer",o,a)}removeFeatureState(e,o,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,a)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,a){const c=this._tiles[e];c&&c.setDependencies(o,a)}reloadTilesForDependencies(e,o){for(const a in this._tiles)this._tiles[a].hasDependency(e,o)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,o))}_preloadTiles(e,o){if(!this._sourceLoaded){const _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,o))};return void this._source.on("data",_)}const a=new Map,c=Array.isArray(e)?e:[e],d=this.map.painter.terrain,p=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const _ of c){const v=_.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const b of v)a.set(b.key,b);this.usedForTerrain&&_.updateElevation(!1)}uo(Array.from(a.values()),(_,v)=>{const b=new df(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,C=>{"raster-dem"===this._source.type&&b.dem&&this._backfillDEM(b),v(C,b)})},o)}}function hv(n,e){const o=Math.abs(2*n.wrap)-+(n.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||a-o||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function qh(n){return"raster"===n||"image"===n||"video"===n||"custom"===n}function om(n,e){const o=1<<n.z;return[n.x/o+e,(n.x+1)/o+e]}ju.maxOverzooming=10,ju.maxUnderzooming=3;const b1=Ft([{name:"a_pos_3f",components:3,type:"Float32"}]),w1=Ft([{name:"a_color_3f",components:3,type:"Float32"}]),IE=Ft([{name:"a_color_4f",components:4,type:"Float32"}]),AE=Ft([{name:"a_uv_2f",components:2,type:"Float32"}]),sm=Ft([{name:"a_normal_3f",components:3,type:"Float32"}]),PE=Ft([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),RE=Ft([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function E1(n,e){const o=Xg(n.projection,n.zoom,n.width,n.height),a=function(d,p,_,v,b){const C=new hr(_.lng-180*Uu,_.lat),M=new hr(_.lng+180*Uu,_.lat),I=d.project(C.lng,C.lat),R=d.project(M.lng,M.lat),L=-Math.atan2(R.y-I.y,R.x-I.x),F=lo.fromLngLat(_);F.y=dn(F.y,-1+Uu,1-Uu);const B=F.toLngLat(),U=d.project(B.lng,B.lat),Y=lo.fromLngLat(B);Y.x+=Uu;const J=Y.toLngLat(),Q=d.project(J.lng,J.lat),oe=M1(Q.x-U.x,Q.y-U.y,L),ae=lo.fromLngLat(B);ae.y+=Uu;const me=ae.toLngLat(),_e=d.project(me.lng,me.lat),Ee=M1(_e.x-U.x,_e.y-U.y,L),Pe=Math.abs(oe.x)/Math.abs(Ee.y),Se=f.m.identity([]);f.m.rotateZ(Se,Se,-L*(1-(b?0:v)));const Ue=f.m.identity([]);return f.m.scale(Ue,Ue,[1,1-(1-Pe)*v,1]),Ue[4]=-Ee.x/Ee.y*v,f.m.rotateZ(Ue,Ue,L),f.m.multiply(Ue,Se,Ue),Ue}(n.projection,0,n.center,o,e),c=C1(n);return f.m.scale(a,a,[c,c,1]),a}function C1(n){const e=n.projection,o=Xg(n.projection,n.zoom,n.width,n.height),a=T1(e,n.center),c=T1(e,hr.convert(e.center));return Math.pow(2,a*o+(1-o)*c)}function Xg(n,e,o,a,c=1/0){const d=n.range;if(!d)return 0;const p=Math.min(c,Math.max(o,a)),_=Math.log(p/1024)/Math.LN2;return Bs(d[0]+_,d[1]+_,e)}const Uu=1/4e4;function T1(n,e){const o=dn(e.lat,-Ai,Ai),a=new hr(e.lng-180*Uu,o),c=new hr(e.lng+180*Uu,o),d=n.project(a.lng,o),p=n.project(c.lng,o),_=lo.fromLngLat(a),v=lo.fromLngLat(c),b=p.x-d.x,C=p.y-d.y,M=v.x-_.x,I=v.y-_.y,R=Math.sqrt((M*M+I*I)/(b*b+C*C));return Math.log(R)/Math.LN2}function M1(n,e,o){const a=Math.cos(o),c=Math.sin(o);return{x:n*a-e*c,y:n*c+e*a}}function dv(n,e,o){return e*(ct/(n.tileSize*Math.pow(2,o-n.tileID.overscaledZ)))}function ei(n,e,o){f.m.identity(n),f.m.rotateZ(n,n,wt(e[2])),f.m.rotateX(n,n,wt(e[0])),f.m.rotateY(n,n,wt(e[1])),f.m.scale(n,n,o),f.m.multiply(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Yg(n,e,o,a,c,d,p,_){const v=[o[0]-e[0],o[1]-e[1],0],b=[a[0]-e[0],a[1]-e[1],0];if(f.v.length(v)<1e-12||f.v.length(b)<1e-12)return f.q.identity(n);const C=f.v.cross([],v,b);f.v.normalize(C,C),f.v.subtract(b,a,e),v[2]=(d-c)*_,b[2]=(p-c)*_;const M=v;return f.v.cross(M,v,b),f.v.normalize(M,M),f.q.rotationTo(n,C,M)}function am(n,e,o=!1){const a=Ma(e.zoom),c=function(d,p,_){const v=p.worldSize,b=[d[12],d[13],d[14]],C=Mo(b[1]/v),M=To(b[0]/v),I=f.m.identity([]),R=Vo(1,C)*v,L=Vo(1,0)*v*Gc(C,p.zoom),F=1/Sp(v);let B=L*F;if(_){const Q=Xg(p.projection,p.zoom,p.width,p.height,1024);B=F*p.projection.pixelSpaceConversion(p.center.lat,v,Q)}const U=Nd(C,M);f.v.add(U,U,f.v.scale([],f.v.normalize([],U),R*B*b[2]));const Y=function(Q){const oe=[Q[0],Q[1],Q[2]];let ae=[0,1,0];const me=f.v.cross([],ae,oe);return f.v.cross(ae,oe,me),0===f.v.squaredLength(ae)&&(ae=[0,1,0],f.v.cross(me,oe,ae)),f.v.normalize(me,me),f.v.normalize(ae,ae),f.v.normalize(oe,oe),[me[0],me[1],me[2],0,ae[0],ae[1],ae[2],0,oe[0],oe[1],oe[2],0,Q[0],Q[1],Q[2],1]}(U);f.m.scale(I,I,[B,B,B*R]),f.m.translate(I,I,[-b[0],-b[1],-b[2]]);const J=f.m.multiply([],p.globeMatrix,Y);return f.m.multiply(J,J,I),f.m.multiply(J,J,d),J}(n,e,o);return a>0?function(p,_,v){const b=(L,F,B)=>{const U=f.v.length(L),Y=f.v.length(F),J=jc(L,F,B);return f.v.scale(J,J,1/f.v.length(J)*mn(U,Y,B))},C=b([p[0],p[1],p[2]],[_[0],_[1],_[2]],v),M=b([p[4],p[5],p[6]],[_[4],_[5],_[6]],v),I=b([p[8],p[9],p[10]],[_[8],_[9],_[10]],v),R=jc([p[12],p[13],p[14]],[_[12],_[13],_[14]],v);return[C[0],C[1],C[2],0,M[0],M[1],M[2],0,I[0],I[1],I[2],0,R[0],R[1],R[2],1]}(c,function(p,_){const v=_.worldSize,b=Vo(1,0)*v*Gc(_.center.lat,_.zoom)/Sp(v),C=Vo(1,_.center.lat)*v,M=f.m.identity([]);return f.m.rotateY(M,M,wt(_.center.lng)),f.m.rotateX(M,M,wt(_.center.lat)),f.m.translate(M,M,[0,0,fs]),f.m.scale(M,M,[b,b,b*C]),f.m.translate(M,M,[_.point.x-.5*v,_.point.y-.5*v,0]),f.m.multiply(M,M,p),f.m.multiply(M,_.globeMatrix,M)}(n,e),a):c}const Jg={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4};function lm(n,e,o=!1){n.uploaded||(n.gfxTexture=new sc(e,n.image,o?e.gl.R8:e.gl.RGBA,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function OE(n,e,o){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,b1.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,sm.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,AE.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(12===n.colorArray.bytesPerElement?w1:IE).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,RE.members,!0)),n.segments=Ur.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const a=n.material;a.pbrMetallicRoughness.baseColorTexture&&lm(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&lm(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&lm(a.normalTexture,e),a.occlusionTexture&&lm(a.occlusionTexture,e,o),a.emissionTexture&&lm(a.emissionTexture,e)}function fv(n,e,o){if(n.meshes)for(const a of n.meshes)OE(a,e,o);if(n.children)for(const a of n.children)fv(a,e,o)}function Kg(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)Kg(e)}function Qg(n){if(n.meshes)for(const o of n.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((e=o.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const o of n.children)Qg(o)}class pv{constructor(e,o){this.feature=e,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class mv{constructor(){this.instancedDataArray=new zm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class D1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,o,a,c){this.tileToMeter=Hc(a);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:_,index:v,sourceLayerIndex:b}of e){const C=Fu(p,d);if(!this.layers[0]._featureFilter.filter(new pe(this.zoom),C,a))continue;const M={id:_,sourceLayerIndex:b,index:v,geometry:d?C.geometry:tc(p,a,c),properties:p.properties,type:p.type,patterns:{}},I=this.addFeature(M,M.geometry,C);I&&o.featureIndex.insert(p,M.geometry,v,b,this.index,this.instancesPerModel[I].instancedDataArray.length)}this.lookup=null}update(e,o,a,c){for(const d in this.instancesPerModel){const p=this.instancesPerModel[d];for(const _ in e)p.idToFeaturesIndex.hasOwnProperty(_)&&this.evaluate(p.features[p.idToFeaturesIndex[_]],e[_],p,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const o in this.instancesPerModel){const a=this.instancesPerModel[o];for(const c of a.features){const d=this.layers[0],p=c.feature,_=this.canonical,v=d.paint.get("model-rotation").evaluate(p,{},_),b=d.paint.get("model-scale").evaluate(p,{},_),C=d.paint.get("model-translation").evaluate(p,{},_);f.v.exactEquals(c.rotation,v)&&f.v.exactEquals(c.scale,b)&&f.v.exactEquals(c.translation,C)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const o in this.instancesPerModel){const a=this.instancesPerModel[o];a.instancedDataArray.length<0||0===a.instancedDataArray.length||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,PE.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const o=this.instancesPerModel[e];0!==o.instancedDataArray.length&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}}addFeature(e,o,a){const c=this.layers[0],d=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return Rr(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),d;this.instancesPerModel[d]||(this.instancesPerModel[d]=new mv);const p=this.instancesPerModel[d],_=p.instancedDataArray,v=new pv(a,_.length);for(const b of o)for(const C of b){if(C.x<0||C.x>=ct||C.y<0||C.y>=ct)continue;const M=(this.lookupDim-1)/ct,I=this.lookupDim*(C.y*M|0)+C.x*M|0;if(this.lookup){if(0!==this.lookup[I])continue;this.lookup[I]=1}this.instanceCount++;const R=_.length;_.resize(R+1),p.instancesEvaluatedElevation.push(0),_.float32[16*R]=C.x,_.float32[16*R+1]=C.y}return v.instancedDataCount=p.instancedDataArray.length-v.instancedDataOffset,v.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(v),this.evaluate(v,{},p,!1)),d}evaluate(e,o,a,c){const d=this.layers[0],p=e.feature,_=this.canonical,v=e.rotation=d.paint.get("model-rotation").evaluate(p,o,_),b=e.scale=d.paint.get("model-scale").evaluate(p,o,_),C=e.translation=d.paint.get("model-translation").evaluate(p,o,_),M=d.paint.get("model-color").evaluate(p,o,_);M.a=d.paint.get("model-color-mix-intensity").evaluate(p,o,_);const I=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),ei(I,v,b);const R=Math.round(100*M.a)+M.b/1.05;for(let L=0;L<e.instancedDataCount;++L){const F=e.instancedDataOffset+L,B=16*F,U=a.instancedDataArray.float32;let Y=0;c&&(Y=U[B+6]-a.instancesEvaluatedElevation[F]);const J=0|U[B+1];U[B]=(0|U[B])+M.r/1.05,U[B+1]=J+M.g/1.05,U[B+2]=R,U[B+3]=1/(_.z>10?this.tileToMeter:Hc(_,J)),U[B+4]=C[0],U[B+5]=C[1],U[B+6]=C[2]+Y,U[B+7]=I[0],U[B+8]=I[1],U[B+9]=I[2],U[B+10]=I[4],U[B+11]=I[5],U[B+12]=I[6],U[B+13]=I[8],U[B+14]=I[9],U[B+15]=I[10],a.instancesEvaluatedElevation[F]=C[2]}}}It(D1,"ModelBucket",{omit:["layers"]}),It(mv,"PerModelAttributes"),It(pv,"ModelFeature");const mM=new Xe({visibility:new re(De.layout_model.visibility),"model-id":new Me(De.layout_model["model-id"])});var S1={paint:new Xe({"model-opacity":new re(De.paint_model["model-opacity"]),"model-rotation":new Me(De.paint_model["model-rotation"]),"model-scale":new Me(De.paint_model["model-scale"]),"model-translation":new Me(De.paint_model["model-translation"]),"model-color":new Me(De.paint_model["model-color"]),"model-color-mix-intensity":new Me(De.paint_model["model-color-mix-intensity"]),"model-type":new re(De.paint_model["model-type"]),"model-cast-shadows":new re(De.paint_model["model-cast-shadows"]),"model-receive-shadows":new re(De.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new re(De.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Me(De.paint_model["model-emissive-strength"]),"model-roughness":new Me(De.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Me(De.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new re(De.paint_model["model-cutoff-fade-range"])}),layout:mM};const e_=new Float32Array(262144),ff=new Uint8Array(262144);function cm(n){let e=0;if(n.meshes)for(const o of n.meshes)e=Math.max(e,o.aabb.max[2]);if(n.children)for(const o of n.children)e=Math.max(e,cm(o));return e}const I1=["","wall","door","roof","window","lamp","logo"];class A1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:cm(e)}}}}class t_{constructor(e,o,a,c){this.nodes=e,this.id=o,this.modelTraits|=Jg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Jg.HasMapboxMeshFeatures),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=c,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const a of o){const c=a.node;this.uploaded?this.updatePbrBuffer(c):fv(c,e,!0)}for(const a of o)Kg(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let o=!1;if(!e.meshes)return o;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),o=!0);return o}needsReEvaluation(e,o,a){const c=e.transform.projectionOptions,d=e.style.getBrightness(),p=this.brightness!==d;return!!(!this.uploaded||this.dirty||c.name!==this.projection.name||um(a.paint.get("model-color").value,p)||um(a.paint.get("model-color-mix-intensity").value,p)||um(a.paint.get("model-roughness").value,p)||um(a.paint.get("model-emissive-strength").value,p)||um(a.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=c,this.brightness=d,!0)}evaluateScale(e,o){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),c=this.id.canonical;for(const d of a){const p=d.feature;d.evaluatedScale=o.paint.get("model-scale").evaluate(p,{},c)}}evaluate(e){const o=this.getNodesInfo();for(const a of o){if(!a.node.meshes)continue;const c=a.feature,d=a.node.meshes&&a.node.meshes[0].featureData,p=a.evaluatedColor[2],_=a.evaluatedRMEA[2],v=this.id.canonical;if(a.hasTranslucentParts=!1,d){for(let b=0;b<I1.length;b++){const C=I1[b];C.length&&(c.properties.part=C);const M=e.paint.get("model-color").evaluate(c,{},v),I=e.paint.get("model-color-mix-intensity").evaluate(c,{},v);a.evaluatedColor[b]=[M.r,M.g,M.b,I],a.evaluatedRMEA[b][0]=e.paint.get("model-roughness").evaluate(c,{},v),a.evaluatedRMEA[b][2]=e.paint.get("model-emissive-strength").evaluate(c,{},v),a.evaluatedRMEA[b][3]=M.a,a.emissionHeightBasedParams[b]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,{},v),!a.hasTranslucentParts&&M.a<1&&(a.hasTranslucentParts=!0)}delete c.properties.part,hm(a,p!==a.evaluatedColor[2]||_!==a.evaluatedRMEA[2])}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,{},v);a.evaluatedScale=e.paint.get("model-scale").evaluate(c,{},v),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,o,a,c){const d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const p=ef.create(e,a,d);if(!p)return;this.modelTraits&Jg.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,c);for(const _ of this.getNodesInfo()){const v=_.node;if(!v.footprint||!v.footprint.vertices||!v.footprint.vertices.length)continue;const b=v.footprint.vertices;let C=p.getElevationAt(b[0].x,b[0].y,!0,!0);for(let M=1;M<b.length;M++)C=Math.min(C,p.getElevationAt(b[M].x,b[M].y,!0,!0));v.elevation=C}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=o}}updateDEM(e,o,a,c){let d=o._dem._modifiedForSources[c];if(void 0===d&&(o._dem._modifiedForSources[c]=[],d=o._dem._modifiedForSources[c]),d.includes(a.canonical))return;const p=o._dem.dim;d.push(a.canonical);let _=!1;for(const v of this.getNodesInfo()){const b=v.node;if(!b.footprint||!b.footprint.grid)continue;const C=b.footprint.grid,M=o.tileCoordToPixel(C.min.x,C.min.y),I=o.tileCoordToPixel(C.max.x,C.max.y),R=Math.min(Math.min(p-I.y,M.x),Math.min(M.y,p-I.x));if(R<0)continue;const L=dn(R,2,5);let F=Math.max(0,M.x-L),B=Math.max(0,M.y-L),U=Math.min(I.x+L,p-1),Y=Math.min(I.y+L,p-1);for(let ae=B;ae<=Y;++ae)for(let me=F;me<=U;++me)ff[ae*p+me]=255;let J=0,Q=0;for(let ae=0;ae<C.cellsY;++ae)for(let me=0;me<C.cellsX;++me){if(!C.cells[ae*C.cellsX+me])continue;const _e=o.tileCoordToPixel(C.min.x+me/C.xScale,C.min.y+ae/C.yScale),Ee=o.tileCoordToPixel(C.min.x+(me+1)/C.xScale,C.min.y+(ae+1)/C.yScale);for(let Pe=_e.y;Pe<=Math.min(Ee.y+1,p-1);++Pe)for(let Se=_e.x;Se<=Math.min(Ee.x+1,p-1);++Se)255===ff[Pe*p+Se]&&(ff[Pe*p+Se]=0,J+=o.getElevationAtPixel(Se,Pe),Q++)}const oe=J/Q;F=Math.max(1,M.x-L),B=Math.max(1,M.y-L),U=Math.min(I.x+L,p-2),Y=Math.min(I.y+L,p-2),_=!0;for(let ae=B;ae<=Y;++ae)for(let me=F;me<=U;++me)0===ff[ae*p+me]&&(e_[ae*p+me]=o._dem.set(me,ae,oe));for(let ae=1;ae<L;++ae){F=Math.max(1,M.x-ae),B=Math.max(1,M.y-ae),U=Math.min(I.x+ae,p-2),Y=Math.min(I.y+ae,p-2);for(let me=B;me<=Y;++me)for(let _e=F;_e<=U;++_e){const Ee=me*p+_e;if(255===ff[Ee]){let Pe=0,Se=0,Ue=-1,ot=-1;for(let je=-1;je<=1;++je)for(let Je=-1;Je<=1;++Je){const Fe=(me+je)*p+_e+Je;if(ff[Fe]>=ae)continue;const _t=e_[Fe],Et=Math.abs(_t);Et>Se&&(Pe=_t,Se=Et,Ue=Je,ot=je)}if(Se>.1){const je=1-(ae+.5*Math.abs(Ue*ot))/L;let Je=o._dem.get(_e,me)+Pe*je;const Fe=o._dem.get(_e+Ue,me+ot),_t=o._dem.get(_e-Ue,me-ot,!0);(Je-Fe)*(Je-_t)>0&&(Je=(Fe+_t)/2),e_[Ee]=o._dem.set(_e,me,Je),ff[Ee]=ae}}}}}_&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=ki.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new A1(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Qg(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const o of e)Kg(o.node),Qg(o.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const a=o.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const p=c[d].node;c[d].hiddenByReplacement=!!p.footprint&&!a.find(_=>_.footprint===p.footprint)}}getHeightAtTileCoord(e,o){const a=this.getNodesInfo(),c=[];for(let d=0;d<this.nodesInfo.length;d++){const p=a[d],_=p.node.meshes[0];if(e<_.aabb.min[0]||o<_.aabb.min[1]||e>_.aabb.max[0]||o>_.aabb.max[1])continue;const v=(e-_.aabb.min[0])/(_.aabb.max[0]-_.aabb.min[0])*64|0,b=64*Math.min(63,(o-_.aabb.min[1])/(_.aabb.max[1]-_.aabb.min[1])*64|0)+Math.min(63,v);if(!(_.heightmap[b]<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:_.heightmap[b],maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new ut(e,o),new ut(e,o),c),c.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function um(n,e){return!n.isLightConstant&&e}function lc(n,e,o,a,c,d,p,_){let v=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,C=240&e|(240&e)>>4;o[3]>0&&(v=mn(v,255*o[0],o[3]),b=mn(b,255*o[1],o[3]),C=mn(C,255*o[2],o[3]));const M=v<<8|b,I=C<<8|Math.floor(255*a[3]),R=function(ae){const me=dn(ae,0,2);return Math.min(Math.round(.5*me*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],L=dn(c[0],0,1),F=dn(c[1],0,1),B=dn(c[2],0,1),U=dn(c[3],0,1);let Y,J,Q,oe;if(L!==F&&p!==d&&F!==L){const ae=p-d;J=1/(ae*(F-L)),Q=-(d+ae*L)/(ae*(F-L));const me=dn(c[4],-1,1);oe=Math.pow(10,me),Y=255*B<<8|255*U}else Y=65535,J=0,Q=1,oe=1;if(n.emplaceBack(M,I,R,Y,J,Q,oe),_){const ae=_.length;_.clear();for(let me=0;me<ae;me++)_.emplaceBack(M,I,R,Y,J,Q,oe)}}function hm(n,e){const o=n.node;let a=0;for(const c of o.meshes){if(o.lights&&o.lightMeshIndex===a||!c.featureData)continue;c.featureArray=new Td,c.featureArray.reserve(c.featureData.length);let d=e;for(const p of c.featureData){let _;const v=65535&p,b=(15&v)<8?15&v:0,C=p>>16&65535,M=n.evaluatedRMEA[b],I=n.evaluatedColor[b],R=n.emissionHeightBasedParams[b];if(d&&2===b&&o.lights&&(_=new Td,_.resize(10*o.lights.length)),lc(c.featureArray,C,I,M,R,c.aabb.min[2],c.aabb.max[2],_),_&&d){d=!1;const L=o.meshes[o.lightMeshIndex];L.featureArray=_,L.featureArray._trim()}}c.featureArray._trim(),a++}}function So(n,e){return n.x-e.x||n.y-e.y}function $u(n,e){return 0===So(n.min,e.min)&&0===So(n.max,e.max)}function dm(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function Pa(n,e,o){const a=1/ct,c=1/(1<<o.canonical.z),d=(e.x*a+o.canonical.x)*c+o.wrap,p=(e.y*a+o.canonical.y)*c;return{min:new ut((n.x*a+o.canonical.x)*c+o.wrap,(n.y*a+o.canonical.y)*c),max:new ut(d,p)}}function cc(n,e,o){const a=1<<o.canonical.z,c=((e.x-o.wrap)*a-o.canonical.x)*ct,d=(e.y*a-o.canonical.y)*ct;return{min:new ut(((n.x-o.wrap)*a-o.canonical.x)*ct,(n.y*a-o.canonical.y)*ct),max:new ut(c,d)}}function Wh(n,e,o,a,c,d,p){const _=n.indices,v=n.vertices,b=[];for(let C=a;C<a+c;C+=3){const M=e[o[C+0]+d],I=e[o[C+1]+d],R=e[o[C+2]+d],L=Math.min(M.x,I.x,R.x),F=Math.max(M.x,I.x,R.x),B=Math.min(M.y,I.y,R.y),U=Math.max(M.y,I.y,R.y);b.length=0,n.grid.query(new ut(L,B),new ut(F,U),b);for(let Y=0;Y<b.length;Y++){const J=b[Y];if(Ph(v[_[3*J+0]],v[_[3*J+1]],v[_[3*J+2]],M,I,R,p))return!0}}return!1}function Xh(n,e,o,a){if(!n||!o)return!1;let c=n.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(o.vertices.length<n.vertices.length)return Xh(o,a,n,e);const d=e.canonical,p=a.canonical,_=Math.pow(2,p.z-d.z);c=n.vertices.map(v=>new ut(v.x*d.x*ct*_-p.x*ct,v.y*d.y*ct*_-p.y*ct))}return Wh(o,c,n.indices,0,n.indices.length,0,0)}It(t_,"Tiled3dModelBucket",{omit:["layers"]}),It(A1,"Tiled3dModelFeature");const pf=Hd.types,mf=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],gf=["fill-extrusion-flood-light-ground-radius"],_f=Math.pow(2,13),yf=Math.pow(2,15)-1,Yh=new ut(0,1),Ra=2147483648;function vf(n,e,o,a,c,d,p,_){n.emplaceBack((e<<1)+p,(o<<1)+d,(Math.floor(a*_f)<<1)+c,Math.round(_))}function fm(n,e,o,a,c,d){n.emplaceBack(e.x,e.y,(o.x<<1)+a,(o.y<<1)+c,d)}function xf(n,e,o){n.emplaceBack(e.x,e.y,e.z,16384*o[0],16384*o[1],16384*o[2])}class gv{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class _v{constructor(){this.centroidXY=new ut(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ut(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ut(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ut(this.max.x-this.min.x,this.max.y-this.min.y)}}class yv{constructor(){this.acc=new ut(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,o){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=o.x,e.min.y=e.max.y=o.y)}appendEdge(e,o,a){this.accCount++,this.acc._add(o);let c=!!this.borders;o.x<e.min.x?(e.min.x=o.x,c=!0):o.x>e.max.x&&(e.max.x=o.x,c=!0),o.y<e.min.y?(e.min.y=o.y,c=!0):o.y>e.max.y&&(e.max.y=o.y,c=!0),((0===o.x||o.x===ct)&&o.x===a.x)!=((0===o.y||o.y===ct)&&o.y===a.y)&&this.processBorderOverlap(o,a),c&&this.checkBorderIntersection(o,a)}checkBorderIntersection(e,o){o.x<0!=e.x<0&&this.addBorderIntersection(0,mn(o.y,e.y,(0-o.x)/(e.x-o.x))),o.x>ct!=e.x>ct&&this.addBorderIntersection(1,mn(o.y,e.y,(ct-o.x)/(e.x-o.x))),o.y<0!=e.y<0&&this.addBorderIntersection(2,mn(o.x,e.x,(0-o.y)/(e.y-o.y))),o.y>ct!=e.y>ct&&this.addBorderIntersection(3,mn(o.x,e.x,(ct-o.y)/(e.y-o.y)))}addBorderIntersection(e,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];o<a[0]&&(a[0]=o),o>a[1]&&(a[1]=o)}processBorderOverlap(e,o){if(e.x===o.x){if(e.y===o.y)return;const a=0===e.x?0:1;this.addBorderIntersection(a,o.y),this.addBorderIntersection(a,e.y)}else{const a=0===e.y?2:3;this.addBorderIntersection(a,o.x),this.addBorderIntersection(a,e.x)}}centroid(){return 0===this.accCount?new ut(0,0):new ut(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,o)=>e+ +(o[0]!==Number.MAX_VALUE),0):0}}function vv(n,e){const o=n.add(e)._unit(),a=dn(n.x*o.x+n.y*o.y,-1,1);var c,d,p;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*yf*((d=n).x*(p=e).y-d.y*p.x<0?-1:1)}const P1=[n=>n.x<0,n=>n.x>ct,n=>n.y<0,n=>n.y>ct];function R1(n,e,o,a){const c=[4];if(0===a)return c;o._mult(a);const d=n.sub(o),p=e.sub(o),_=[n,e,d,p];for(let v=0;v<4;v++)for(const b of _)if(P1[v](b)){c.push(v);break}return c}class n_{constructor(e){this.vertexArray=new Eo,this.indexArray=new qn,this.programConfigurations=new Al(e.layers,e.zoom,o=>gf.includes(o)),this._segments=new Ur,this.hiddenByLandmarkVertexArray=new Bm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ur}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,o,a,c=!1){const d=e.length;if(d>2){let p=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let v;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const b=e[0],C=e[1];v=vv(b.sub(e[d-1])._perp()._unit(),C.sub(b)._perp()._unit())}for(let b=0;b<d;b++){const C=b===d-1?0:b+1,M=e[b],I=e[C],R=e[C===d-1?0:C+1],L=I.sub(M)._perp()._unit(),F=vv(L,R.sub(I)._perp()._unit()),B=v,U=F;if(xv(M,I,o)||c&&kE(M,o)&&kE(I,o)){v=F;continue}const Y=_.vertexLength;fm(this.vertexArray,M,I,1,1,B),fm(this.vertexArray,M,I,1,0,B),fm(this.vertexArray,M,I,0,1,U),fm(this.vertexArray,M,I,0,0,U),_.vertexLength+=4;const J=R1(M,I,L,a);for(const Q of J)this._segmentToGroundQuads[p].push({id:Y,region:Q}),this._segmentToRegionTriCounts[p][Q]+=2,_.primitiveLength+=2;v=F}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),o=e.length;for(let a=0;a<o;a++)this._segmentToGroundQuads[a].sort((c,d)=>c.region-d.region);for(let a=0;a<o;a++){const c=this._segmentToGroundQuads[a],d=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((v,b)=>v+b,0);let _=0;for(let v=0;v<=4;v++){const b=p[v];if(0!==b){let C=this.regionSegments[v];C||(C=this.regionSegments[v]=new Ur);const M={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+_,vertexLength:d.vertexLength,primitiveLength:b};C.get().push(M)}_+=b}for(let v=0;v<c.length;v++){const b=c[v].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,o,a,c,d,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,o,a,c,d,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Xw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,o,a,c,d,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,o,a,c,d,p)}updateHiddenByLandmark(e){if(!this.hasData())return;const o=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const a=e.flags&Ra?1:0;for(let c=e.groundVertexArrayOffset;c<o;++c)this.hiddenByLandmarkVertexArray.emplace(c,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Ny.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const o=this.regionSegments[e];o&&o.destroy()}}}}class pm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new qn,this.footprintVertices=new ke,this.footprintSegments=[],this.layoutVertexArray=new ar,this.centroidVertexArray=new F0,this.indexArray=new qn,this.programConfigurations=new Al(e.layers,e.zoom,o=>mf.includes(o)),this.segments=new Ur,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new n_(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,o,a,c){this.features=[],this.hasPattern=Bp("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Hc(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:p,index:_,sourceLayerIndex:v}of e){const b=this.layers[0]._featureFilter.needGeometry,C=Fu(d,b);if(!this.layers[0]._featureFilter.filter(new pe(this.zoom),C,a))continue;const M={id:p,sourceLayerIndex:v,index:_,geometry:b?C.geometry:tc(d,a,c),properties:d.properties,type:d.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(Fy("fill-extrusion",this.layers,M,this.zoom,o)):this.addFeature(M,M.geometry,_,a,{},o.availableImages,c,o.brightness),o.featureIndex.insert(d,M.geometry,_,v,this.index,I)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,o,a,c,d,p){for(const _ of this.features){const{geometry:v}=_;this.addFeature(_,v,_.index,o,a,c,d,p)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,o,a,c,d){const p=0!==Object.keys(e).length;if(p&&!this.stateDependentLayers.length)return;const _=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,o,_,a,c,d),this.groundEffect.update(e,o,_,a,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Cg.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Yw.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,a,c,d,p,_,v){const b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,C=[new ut(0,0),new ut(ct,ct)],M=_.projection,I="globe"===M.name,R="Polygon"===pf[e.type],L=new yv;L.centroidDataIndex=this.centroidData.length;const F=new _v,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,U=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);F.height=U,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Sr);const Y=ta(o,500);for(let _e=Y.length-1;_e>=0;_e--){const Ee=Y[_e];(0===Ee.length||(J=Ee[0]).every(Pe=>Pe.x<=0)||J.every(Pe=>Pe.x>=ct)||J.every(Pe=>Pe.y<=0)||J.every(Pe=>Pe.y>=ct))&&Y.splice(_e,1)}var J;let Q;if(I)Q=F1(Y,C,c);else{Q=[];for(const _e of Y)Q.push({polygon:_e,bounds:C})}const oe=R?this.edgeRadius:0,ae=oe>0&&this.zoom<17,me=(_e,Ee)=>{if(0===_e.length)return!1;const Pe=_e[_e.length-1];return Ee.x===Pe.x&&Ee.y===Pe.y};for(const{polygon:_e,bounds:Ee}of Q){let Pe=0,Se=0;for(const Je of _e)R&&!Je[0].equals(Je[Je.length-1])&&Je.push(Je[0]),Se+=R?Je.length-1:Je.length;const Ue=this.segments.prepareSegment((R?5:4)*Se,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);const ot={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},je=new gv;if(je.vertexOffset=this.footprintVertices.length,je.indexOffset=3*this.footprintIndices.length,je.ringIndices=[],R){const Je=[],Fe=[];Pe=Ue.vertexLength;for(let Et=0;Et<_e.length;Et++){const rt=_e[Et];rt.length&&0!==Et&&Fe.push(Je.length/2);const Jt=[];let St,mt;St=rt[1].sub(rt[0])._perp()._unit(),je.ringIndices.push(rt.length-1);for(let Ht=1;Ht<rt.length;Ht++){const Nt=rt[Ht],Gt=rt[Ht===rt.length-1?1:Ht+1],at=Nt.clone();if(oe){mt=Gt.sub(Nt)._perp()._unit();const cn=St.add(mt)._unit(),On=oe*Math.min(4,1/(St.x*cn.x+St.y*cn.y));at.x+=On*cn.x,at.y+=On*cn.y,at.x=Math.round(at.x),at.y=Math.round(at.y),St=mt}!B||0!==oe&&!ae||me(Jt,at)||Jt.push(at),vf(this.layoutVertexArray,at.x,at.y,0,0,1,1,0),Ue.vertexLength++,this.footprintVertices.emplaceBack(Nt.x,Nt.y),Je.push(Nt.x,Nt.y),I&&xf(this.layoutVertexExtArray,M.projectTilePoint(at.x,at.y,c),M.upVector(c,at.x,at.y))}B&&(0===oe||ae)&&(0!==Jt.length&&me(Jt,Jt[0])&&Jt.pop(),this.groundEffect.addData(Jt,Ee,b))}const _t=Oh(Je,Fe);for(let Et=0;Et<_t.length;Et+=3)this.footprintIndices.emplaceBack(je.vertexOffset+_t[Et+0],je.vertexOffset+_t[Et+1],je.vertexOffset+_t[Et+2]),this.indexArray.emplaceBack(Pe+_t[Et],Pe+_t[Et+2],Pe+_t[Et+1]),Ue.primitiveLength++;je.indexCount+=_t.length,je.vertexCount+=this.footprintVertices.length-je.vertexOffset}for(let Je=0;Je<_e.length;Je++){const Fe=_e[Je];L.startRing(F,Fe[0]);let _t=Fe.length>4&&L1(Fe[Fe.length-2],Fe[0],Fe[1]),Et=oe?gM(Fe[Fe.length-2],Fe[0],Fe[1],oe):0;const rt=[];let Jt,St,mt;St=Fe[1].sub(Fe[0])._perp()._unit();let Ht=!0;for(let Nt=1,Gt=0;Nt<Fe.length;Nt++){let at=Fe[Nt-1],cn=Fe[Nt];const On=Fe[Nt===Fe.length-1?1:Nt+1];if(L.appendEdge(F,cn,at),xv(cn,at,Ee)){oe&&(St=On.sub(cn)._perp()._unit(),Ht=!Ht);continue}const pn=cn.sub(at)._perp(),Dn=pn.x/(Math.abs(pn.x)+Math.abs(pn.y)),Yn=pn.y>0?1:0,br=at.dist(cn);if(Gt+br>32768&&(Gt=0),oe){mt=On.sub(cn)._perp()._unit();let cr=O1(at,cn,On,LE(St,mt),oe);isNaN(cr)&&(cr=0);const dr=cn.sub(at)._unit();at=at.add(dr.mult(Et))._round(),cn=cn.add(dr.mult(-cr))._round(),Et=cr,St=mt,B&&this.zoom>=17&&(me(rt,at)||rt.push(at),me(rt,cn)||rt.push(cn))}const wn=Ue.vertexLength,Fr=Fe.length>4&&L1(at,cn,On);let wr=FE(Gt,_t,Ht);if(vf(this.layoutVertexArray,at.x,at.y,Dn,Yn,0,0,wr),vf(this.layoutVertexArray,at.x,at.y,Dn,Yn,0,1,wr),Gt+=br,wr=FE(Gt,Fr,!Ht),_t=Fr,vf(this.layoutVertexArray,cn.x,cn.y,Dn,Yn,0,0,wr),vf(this.layoutVertexArray,cn.x,cn.y,Dn,Yn,0,1,wr),Ue.vertexLength+=4,this.indexArray.emplaceBack(wn+0,wn+1,wn+2),this.indexArray.emplaceBack(wn+1,wn+3,wn+2),Ue.primitiveLength+=2,oe){const cr=Pe+(1===Nt?Fe.length-2:Nt-2),dr=1===Nt?Pe:cr+1;if(this.indexArray.emplaceBack(wn+1,cr,wn+3),this.indexArray.emplaceBack(cr,dr,wn+3),Ue.primitiveLength+=2,void 0===Jt&&(Jt=wn),!xv(On,Fe[Nt],Ee)){const Qn=Nt===Fe.length-1?Jt:Ue.vertexLength;this.indexArray.emplaceBack(wn+2,wn+3,Qn),this.indexArray.emplaceBack(wn+3,Qn+1,Qn),this.indexArray.emplaceBack(wn+3,dr,Qn+1),Ue.primitiveLength+=3}Ht=!Ht}if(I){const cr=this.layoutVertexExtArray,dr=M.projectTilePoint(at.x,at.y,c),Qn=M.projectTilePoint(cn.x,cn.y,c),si=M.upVector(c,at.x,at.y),Gr=M.upVector(c,cn.x,cn.y);xf(cr,dr,si),xf(cr,dr,si),xf(cr,Qn,Gr),xf(cr,Qn,Gr)}}R&&(Pe+=Fe.length-1),B&&oe&&this.zoom>=17&&(0!==rt.length&&me(rt,rt[0])&&rt.pop(),this.groundEffect.addData(rt,Ee,b,oe>0))}this.footprintSegments.push(je),ot.triangleCount=this.indexArray.length-ot.triangleArrayOffset,this.polygonSegments.push(ot),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,0!==F.vertexCount){if(F.centroidXY=L.borders?Yh:this.encodeCentroid(L,F),this.centroidData.push(F),L.borders){this.featuresOnBorder.push(L);const _e=this.featuresOnBorder.length-1;for(let Ee=0;Ee<L.borders.length;Ee++)L.borders[Ee][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ee].push(_e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,c,v),this.groundEffect.addPaintPropertiesData(e,a,d,p,c,v),this.maxHeight=Math.max(this.maxHeight,U)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((o,a)=>this.featuresOnBorder[o].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let _=0;_<this.centroidData.length;_++){const v=this.centroidData[_],b=+(v.min.y+v.max.y>ct),C=2*b+(+(v.min.x+v.max.x>ct)^b);for(let M=0;M<v.polygonSegLen;M++){const I=v.polygonSegIdx+M;e.push({centroidIdx:_,subtile:C,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const o=new qn;e.sort((_,v)=>_.triangleSegmentIdx===v.triangleSegmentIdx?_.subtile-v.subtile:_.triangleSegmentIdx-v.triangleSegmentIdx);let a=0,c=0,d=0;for(const _ of e){if(_.triangleSegmentIdx!==a)break;d++}const p=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let _=0,v=c,b=c;for(let C=v;C<d&&e[C].subtile===_;C++)b++;for(;v!==d;){const C=e[v];_=C.subtile;const M=this.centroidData[C.centroidIdx].min.clone(),I=this.centroidData[C.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let L=v;L<b;L++){const F=e[L],B=this.polygonSegments[F.polygonSegmentIdx],U=this.centroidData[F.centroidIdx].min,Y=this.centroidData[F.centroidIdx].max,J=this.indexArray.uint16;for(let Q=B.triangleArrayOffset;Q<B.triangleArrayOffset+B.triangleCount;Q++)o.emplaceBack(J[3*Q],J[3*Q+1],J[3*Q+2]);R.primitiveLength+=B.triangleCount,M.x=Math.min(M.x,U.x),M.y=Math.min(M.y,U.y),I.x=Math.max(I.x,Y.x),I.y=Math.max(I.y,Y.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:M,max:I}),v=b;for(let L=v;L<d&&e[L].subtile===e[v].subtile;L++)b++}c=d;for(let C=c;C<p&&e[C].triangleSegmentIdx===e[c].triangleSegmentIdx;C++)d++}o._trim(),this.indexArray=o}getVisibleSegments(e,o,a){let c=0,d=0;const p=1<<e.canonical.z;if(o){const F=o.getMinMaxForTile(e);F&&(c=F.min,d=F.max)}d+=this.maxHeight;const _=e.toUnwrapped();let v;const b=[_.canonical.x/p+_.wrap,_.canonical.y/p],C=[(_.canonical.x+1)/p+_.wrap,(_.canonical.y+1)/p],M=new Ur,I=(F,B,U)=>[F[0]*(1-U[0])+B[0]*U[0],F[1]*(1-U[1])+B[1]*U[1]],R=[],L=[];for(const F of this.triangleSubSegments){R[0]=F.min.x/ct,R[1]=F.min.y/ct,L[0]=F.max.x/ct,L[1]=F.max.y/ct;const B=I(b,C,R),U=I(b,C,L);if(0===new hi([B[0],B[1],c],[U[0],U[1],d]).intersectsPrecise(a)){v&&(M.segments.push(v),v=void 0);continue}const Y=F.segment;v&&v.vertexOffset!==Y.vertexOffset&&(M.segments.push(v),v=void 0),v?(v.vertexLength+=Y.vertexLength,v.primitiveLength+=Y.primitiveLength):v={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return v&&M.segments.push(v),M}encodeCentroid(e,o){const a=e.centroid(),c=o.span(),d=Math.min(7,Math.round(c.x*this.tileToMeter/10)),p=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new ut(dn(a.x,1,ct-1)<<3|d,dn(a.y,1,ct-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new ut(0,0);const o=e.borders,a=Number.MAX_VALUE;if(o[0][0]!==a||o[1][0]!==a){const c=o[0][0]!==a?0:1;return new ut(6|(o[0][0]!==a?0:65528),((o[c][0]+o[c][1])/2|0)<<3|6)}{const c=o[2][0]!==a?2:3;return new ut(((o[c][0]+o[c][1])/2|0)<<3|6,6|(o[2][0]!==a?0:65528))}}showCentroid(e){const o=this.centroidData[e.centroidDataIndex];o.flags&=Ra,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const o=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&Ra?Yh:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==c.y||d!==c.x){for(let p=o;p<a;++p)this.centroidVertexArray.emplace(p,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const a=o.getReplacementRegionsForTile(e.toUnwrapped());if(function(d,p){if(d.length!==p.length)return!1;for(let _=0;_<d.length;_++)if(d[_].sourceId!==p[_].sourceId||!$u(d[_],p[_]))return!1;return!0}(this.activeReplacements,a))return;if(this.activeReplacements=a,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const c=[];for(const d of this.activeReplacements){const p=Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z);for(const _ of this.centroidData)if(!(_.flags&Ra||d.min.x>_.max.x||_.min.x>d.max.x||d.min.y>_.max.y||_.min.y>d.max.y))for(let v=0;v<_.footprintSegLen;v++){const b=this.footprintSegments[_.footprintSegIdx+v];if(c.length=0,NE(this.footprintVertices,b.vertexOffset,b.vertexCount,d.footprintTileId.canonical,e.canonical,c),Wh(d.footprint,c,this.footprintIndices.uint16,b.indexOffset,b.indexCount,-b.vertexOffset,-p)){_.flags|=Ra;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,o,a){let c=!1;for(let d=0;d<a.footprintSegLen;d++){const p=this.footprintSegments[a.footprintSegIdx+d];let _=0;for(const v of p.ringIndices){for(let b=_,C=v+_-1;b<v+_;C=b++){const M=this.footprintVertices.int16[2*(b+p.vertexOffset)+0],I=this.footprintVertices.int16[2*(b+p.vertexOffset)+1],R=this.footprintVertices.int16[2*(C+p.vertexOffset)+1];I>o!=R>o&&e<(this.footprintVertices.int16[2*(C+p.vertexOffset)+0]-M)*(o-I)/(R-I)+M&&(c=!c)}_=v}}return c}getHeightAtTileCoord(e,o){let a=Number.NEGATIVE_INFINITY,c=!0;const d=4*(e+ct)*ct+(o+ct);if(this.partLookup.hasOwnProperty(d)){const p=this.partLookup[d];return p?{height:p.height,hidden:!!(p.flags&Ra)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||o>p.max.y||p.min.y>o||this.footprintContainsPoint(e,o,p)&&p&&p.height>a&&(a=p.height,this.partLookup[d]=p,c=!!(p.flags&Ra));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[d]=void 0}}function LE(n,e){const o=n.add(e)._unit();return n.x*o.x+n.y*o.y}function gM(n,e,o,a){const c=e.sub(n)._perp()._unit(),d=o.sub(e)._perp()._unit();return O1(n,e,o,LE(c,d),a)}function O1(n,e,o,a,c){const d=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(o)/3,c*d/a)}function xv(n,e,o){return n.x<o[0].x&&e.x<o[0].x||n.x>o[1].x&&e.x>o[1].x||n.y<o[0].y&&e.y<o[0].y||n.y>o[1].y&&e.y>o[1].y}function kE(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function L1(n,e,o){if(n.x<0||n.x>=ct||e.x<0||e.x>=ct||o.x<0||o.x>=ct)return!1;const a=o.sub(e),c=a.perp(),d=n.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&c.x*d.x+c.y*d.y<0}function FE(n,e,o){const a=e?2|n:-3&n;return o?1|a:-2&a}function k1(){const n=Math.PI/32,e=Math.tan(n),o=Uc;return o*Math.sqrt(1+2*e*e)-o}function F1(n,e,o){const a=1<<o.z,c=To(o.x/a),d=To((o.x+1)/a),p=Mo(o.y/a),_=Mo((o.y+1)/a);return function(v,b,C,M,I=0,R){const L=[];if(!v.length||!C||!M)return L;const F=(ae,me)=>{for(const _e of ae)L.push({polygon:_e,bounds:me})},B=Math.ceil(Math.log2(C)),U=Math.ceil(Math.log2(M)),Y=B-U,J=[];for(let ae=0;ae<Math.abs(Y);ae++)J.push(Y>0?0:1);for(let ae=0;ae<Math.min(B,U);ae++)J.push(0),J.push(1);let Q=v;if(Q=qd(Q,b[0].y-I,b[1].y+I,1),Q=qd(Q,b[0].x-I,b[1].x+I,0),!Q.length)return L;const oe=[];for(J.length?oe.push({polygons:Q,bounds:b,depth:0}):F(Q,b);oe.length;){const ae=oe.pop(),me=ae.depth,_e=J[me],Ee=ae.bounds[0],Pe=ae.bounds[1],Se=0===_e?Ee.x:Ee.y,Ue=0===_e?Pe.x:Pe.y,ot=R?R(_e,Se,Ue):.5*(Se+Ue),je=qd(ae.polygons,Se-I,ot+I,_e),Je=qd(ae.polygons,ot-I,Ue+I,_e);if(je.length){const Fe=[Ee,new ut(0===_e?ot:Pe.x,1===_e?ot:Pe.y)];J.length>me+1?oe.push({polygons:je,bounds:Fe,depth:me+1}):F(je,Fe)}if(Je.length){const Fe=[new ut(0===_e?ot:Ee.x,1===_e?ot:Ee.y),Pe];J.length>me+1?oe.push({polygons:Je,bounds:Fe,depth:me+1}):F(Je,Fe)}}return L}(n,e,Math.ceil((d-c)/11.25),Math.ceil((p-_)/11.25),1,(v,b,C)=>{if(0===v)return.5*(b+C);{const M=Mo((o.y+b/ct)/a);return(Da(.5*(Mo((o.y+C/ct)/a)+M))*a-o.y)*ct}})}function NE(n,e,o,a,c,d){const p=Math.pow(2,a.z-c.z);for(let _=0;_<o;_++){let v=n.int16[2*(_+e)+0],b=n.int16[2*(_+e)+1];v=(v+c.x*ct)*p-a.x*ct,b=(b+c.y*ct)*p-a.y*ct,d.push(new ut(v,b))}}It(pm,"FillExtrusionBucket",{omit:["layers","features"]}),It(_v,"PartData"),It(gv,"FootprintSegment"),It(yv,"BorderCentroidData"),It(n_,"GroundEffect");const bv=new Xe({visibility:new re(De["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new re(De["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var mm={paint:new Xe({"fill-extrusion-opacity":new re(De["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Me(De["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new re(De["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new re(De["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Me(De["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Me(De["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Me(De["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new re(De["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new re(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new re(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new re(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new re(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new re(De["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new re(De["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new re(De["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Me(De["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Me(De["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new re(De["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new re(De["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new re(De["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new re(De["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new re(De["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:bv};class Gu extends ut{constructor(e,o,a){super(e,o),this.z=a}}function Hu(n,e){return n.x*e.x+n.y*e.y}function wv(n,e){if(1===n.length){let o=0;const a=e[o++];let c;for(;!c||a.equals(c);)if(c=e[o++],!c)return 1/0;for(;o<e.length;o++){const d=e[o],p=n[0],_=c.sub(a),v=d.sub(a),b=p.sub(a),C=Hu(_,_),M=Hu(_,v),I=Hu(v,v),R=Hu(b,_),L=Hu(b,v),F=C*I-M*M,B=(I*R-M*L)/F,U=(C*L-M*R)/F,Y=a.z*(1-B-U)+c.z*B+d.z*U;if(isFinite(Y))return Y}return 1/0}{let o=1/0;for(const a of e)o=Math.min(o,a.z);return o}}function bf(n,e,o,a,c,d,p,_){const v=p*c.getElevationAt(n,e,!0,!0),b=0!==d[0],C=b?0===d[1]?p*(d[0]/7-450):p*function(M,I,R){const L=Math.floor(I[0]/8),F=Math.floor(I[1]/8),B=10*(I[0]-8*L),U=10*(I[1]-8*F),Y=M.getElevationAt(L,F,!0,!0),J=M.getMeterToDEM(R),Q=Math.floor(.5*(B*J-1)),oe=Math.floor(.5*(U*J-1)),ae=M.tileCoordToPixel(L,F),me=2*Q+1,_e=2*oe+1,Ee=(Et=me,rt=_e,[(Je=M).getElevationAtPixel(Fe=ae.x-Q,_t=ae.y-oe,!0),Je.getElevationAtPixel(Fe+rt,_t,!0),Je.getElevationAtPixel(Fe,_t+rt,!0),Je.getElevationAtPixel(Fe+Et,_t+rt,!0)]),Pe=Math.abs(Ee[0]-Ee[1]),Se=Math.abs(Ee[2]-Ee[3]),Ue=Math.abs(Ee[0]-Ee[2])+Math.abs(Ee[1]-Ee[3]),ot=Math.min(.25,.5*J*(Pe+Se)/me),je=Math.min(.25,.5*J*Ue/_e);var Je,Fe,_t,Et,rt;return Y+Math.max(ot*B,je*U)}(c,d,_):v;return{base:v+(0===o)?-1:o,top:b?Math.max(C+a,v+o+2):v+a}}const N1=new Xe({"line-cap":new Me(De.layout_line["line-cap"]),"line-join":new Me(De.layout_line["line-join"]),"line-miter-limit":new re(De.layout_line["line-miter-limit"]),"line-round-limit":new re(De.layout_line["line-round-limit"]),"line-sort-key":new Me(De.layout_line["line-sort-key"]),visibility:new re(De.layout_line.visibility)});var z1={paint:new Xe({"line-opacity":new Me(De.paint_line["line-opacity"]),"line-color":new Me(De.paint_line["line-color"]),"line-translate":new re(De.paint_line["line-translate"]),"line-translate-anchor":new re(De.paint_line["line-translate-anchor"]),"line-width":new Me(De.paint_line["line-width"]),"line-gap-width":new Me(De.paint_line["line-gap-width"]),"line-offset":new Me(De.paint_line["line-offset"]),"line-blur":new Me(De.paint_line["line-blur"]),"line-dasharray":new Me(De.paint_line["line-dasharray"]),"line-pattern":new Me(De.paint_line["line-pattern"]),"line-gradient":new tt(De.paint_line["line-gradient"]),"line-trim-offset":new re(De.paint_line["line-trim-offset"]),"line-emissive-strength":new re(De.paint_line["line-emissive-strength"]),"line-border-width":new Me(De.paint_line["line-border-width"]),"line-border-color":new Me(De.paint_line["line-border-color"])}),layout:N1};function wf(n,e){return 1/dv(n,1,e.tileZoom)}function B1(n,e,o,a){return n.translatePosMatrix(a||e.tileID.projMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const V1=n=>{const e=[];j1(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const o=n.paint.get("line-trim-offset");return 0===o[0]&&0===o[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==n.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER"),e};function j1(n){const e=n.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const U1=new class extends Me{possiblyEvaluate(n,e){return e=new pe(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,o,a){return e=mr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,o,a)}}(z1.paint.properties["line-width"].specification);function r_(n,e){return e>0?e+2*n:n}U1.useIntegerZoom=!0;const i_=new Xe({visibility:new re(De.layout_background.visibility)});var o_={paint:new Xe({"background-color":new re(De.paint_background["background-color"]),"background-pattern":new re(De.paint_background["background-pattern"]),"background-opacity":new re(De.paint_background["background-opacity"]),"background-emissive-strength":new re(De.paint_background["background-emissive-strength"])}),layout:i_};const _M=new Xe({visibility:new re(De.layout_raster.visibility)});var zE={paint:new Xe({"raster-opacity":new re(De.paint_raster["raster-opacity"]),"raster-color":new tt(De.paint_raster["raster-color"]),"raster-color-mix":new re(De.paint_raster["raster-color-mix"]),"raster-color-range":new re(De.paint_raster["raster-color-range"]),"raster-hue-rotate":new re(De.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new re(De.paint_raster["raster-brightness-min"]),"raster-brightness-max":new re(De.paint_raster["raster-brightness-max"]),"raster-saturation":new re(De.paint_raster["raster-saturation"]),"raster-contrast":new re(De.paint_raster["raster-contrast"]),"raster-resampling":new re(De.paint_raster["raster-resampling"]),"raster-fade-duration":new re(De.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new re(De.paint_raster["raster-emissive-strength"]),"raster-array-band":new re(De.paint_raster["raster-array-band"]),"raster-elevation":new re(De.paint_raster["raster-elevation"])}),layout:_M};function s_(n,e,o,a,c,d,p,_){const v=[n,e,1,o,a,1,c,d,1],b=[p,_,1],C=f.bx.adjoint([],v),[M,I,R]=f.v.transformMat3(b,b,C);return f.bx.multiply(v,v,[M,0,0,0,I,0,0,0,R])}function a_(n,e,o,a,c,d,p,_){const v=function(b,C,M,I,R,L,F,B){const U=s_(0,0,1,0,1,1,0,1),Y=s_(b,C,M,I,R,L,F,B),J=f.bx.adjoint([],U);return f.bx.multiply(Y,Y,J)}(n,e,o,a,c,d,p,_);return[v[2]/v[8]/ct,v[5]/v[8]/ct]}function l_(n){return[n[0],Math.min(Math.max(n[1],-Ai),Ai)]}class Ev extends ho{constructor(e,o,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=o,this._dirty=!1}load(e,o){if(this._loaded=o||!1,this.fire(new Ei("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ze(this.map._requestManager.transformRequest(this.url,Gi.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new $s(a)):c&&(this.image=c instanceof HTMLImageElement?ki.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new nm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ei("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof nm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=e[0][1],a=e[0][1];for(const d of e)d[1]>a&&(a=d[1]),d[1]<o&&(o=d[1]);const c=(a+o)/2;if(c>Ai?this.onNorthPole=!0:c<-Ai&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(lo.fromLngLat);this.tileID=function(p){let _=1/0,v=1/0,b=-1/0,C=-1/0;for(const F of p)_=Math.min(_,F.x),v=Math.min(v,F.y),b=Math.max(b,F.x),C=Math.max(C,F.y);const M=Math.max(b-_,C-v),I=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),R=Math.pow(2,I);let L=Math.floor((_+b)/2*R);return L>1&&(L-=1),new Mh(I,L,Math.floor((v+C)/2*R))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ei("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const B in this.tiles){const U=this.tiles[B];"loaded"!==U.state&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=ic(new Mh(0,0,0),this.map.transform.projection),a=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(B){const U=B[1].x-B[0].x,Y=B[1].y-B[0].y,J=B[2].x-B[1].x,Q=B[2].y-B[1].y,oe=B[3].x-B[2].x,ae=B[3].y-B[2].y,me=B[0].x-B[3].x,_e=B[0].y-B[3].y,Ee=U*Q-J*Y,Pe=J*ae-oe*Q,Se=oe*_e-me*ae,Ue=me*Y-U*_e;return Ee>0&&Pe>0&&Se>0&&Ue>0||Ee<0&&Pe<0&&Se<0&&Ue<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=ic(this.tileID,this.map.transform.projection),[d,p,_,v]=this.coordinates.map(B=>{const U=c.projection.project(B[0],B[1]);return zg(c,U)._round()});this.perspectiveTransform=a_(d.x,d.y,p.x,p.y,_.x,_.y,v.x,v.y);const b=this._boundsArray=new ar;b.emplaceBack(d.x,d.y,0,0),b.emplaceBack(p.x,p.y,ct,0),b.emplaceBack(v.x,v.y,0,ct),b.emplaceBack(_.x,_.y,ct,ct),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,rm.members),this.boundsSegments=Ur.simpleSegment(0,0,4,2);const C=[],M=[l_((B=this.coordinates)[0]),l_(B[1]),l_(B[2]),l_(B[3])],[I,R,L,F]=function(B){let U=B[0][0],Y=U,J=B[0][1],Q=J;for(let oe=1;oe<B.length;oe++)B[oe][0]<U?U=B[oe][0]:B[oe][0]>Y&&(Y=B[oe][0]),B[oe][1]<J?J=B[oe][1]:B[oe][1]>Q&&(Q=B[oe][1]);return[U,J,Y-U,Q-J]}(M);var B;{const B=new ar,[U,Y,J,Q]=function(Fe){let _t=Fe[0].x,Et=_t,rt=Fe[0].y,Jt=rt;for(let St=1;St<Fe.length;St++)Fe[St].x<_t?_t=Fe[St].x:Fe[St].x>Et&&(Et=Fe[St].x),Fe[St].y<rt?rt=Fe[St].y:Fe[St].y>Jt&&(Jt=Fe[St].y);return[_t,rt,Et-_t,Jt-rt]}(a),oe=Fe=>[(Fe.x-U)/J,(Fe.y-Y)/Q],[ae,me,_e,Ee]=a.map(oe),Pe=function(Fe,_t,Et,rt,Jt,St,mt,Ht){const Nt=s_(0,0,1,0,1,1,0,1),Gt=s_(Fe,_t,Et,rt,Jt,St,mt,Ht),at=f.bx.adjoint([],Gt);return f.bx.multiply(Nt,Nt,at)}(ae[0],ae[1],me[0],me[1],_e[0],_e[1],Ee[0],Ee[1]);this.elevatedGlobePerspectiveTransform=a_(ae[0],ae[1],me[0],me[1],_e[0],_e[1],Ee[0],Ee[1]);const Se=(Fe,_t)=>{C.push(Fe.lng);const Et=Math.round((Fe.lng-I)/L*ct),rt=Math.round((Fe.lat-R)/F*ct),Jt=oe(_t),St=f.v.transformMat3([],[Jt[0],Jt[1],1],Pe),mt=Math.round(St[0]/St[2]*ct),Ht=Math.round(St[1]/St[2]*ct);B.emplaceBack(Et,rt,mt,Ht)},Ue=a[3].x-a[0].x,ot=a[3].y-a[0].y,je=a[2].x-a[1].x,Je=a[2].y-a[1].y;for(let Fe=0;Fe<65;Fe++){const _t=Fe/64,Et=[a[0].x+_t*Ue,a[0].y+_t*ot],rt=[a[1].x+_t*je,a[1].y+_t*Je],Jt=rt[0]-Et[0],St=rt[1]-Et[1];for(let mt=0;mt<65;mt++){const Ht=mt/64,Nt={x:Et[0]+Jt*Ht,y:Et[1]+St*Ht,z:0};Se(o.projection.unproject(Nt.x,Nt.y),Nt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(B,rm.members)}{this.maxLongitudeTriangleSize=0;let B=[],U=new qn;const Y=(J,Q,oe)=>{U.emplaceBack(J,Q,oe);const ae=C[J],me=C[Q],_e=C[oe],Ee=Math.min(Math.min(ae,me),_e),Pe=Math.max(Math.max(ae,me),_e)-Ee;Pe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Pe),B.push(Ee+Pe/2)};for(let J=0;J<64;J++)for(let Q=0;Q<64;Q++){const oe=65*J+Q,ae=oe+1,me=oe+65,_e=me+1;Y(oe,me,ae),Y(ae,me,_e)}[B,U]=function(J,Q){const oe=Array.from({length:J.length},(_e,Ee)=>Ee);oe.sort((_e,Ee)=>J[_e]-J[Ee]);const ae=[],me=new qn;for(let _e=0;_e<oe.length;_e++){const Ee=oe[_e];ae.push(J[Ee]);const Pe=3*Ee,Se=Pe+1;me.emplaceBack(Q.uint16[Pe],Q.uint16[Se],Q.uint16[Se+1])}return[ae,me]}(B,U),this.elevatedGlobeTrianglesCenterLongitudes=B,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(U)}this.elevatedGlobeSegments=Ur.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,L/ct,0,F/ct,0,0,R,I,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const o=this.map.painter.context,a=o.gl;!this._dirty||this.texture instanceof nm||(this.texture?this.texture.update(this.image):(this.texture=new sc(o,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(o)}loadTile(e,o){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},o(null)):(e.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let c=(C=e+180)+360*Math.round((a[0]-C)/360);var C;const d=new Ur,p=(C,M)=>{d.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:o.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},_=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=_){const C=$t(a,0,a.length,c+_);return C===a.length||p(C,Qe(a,C+1,a.length,c+360-_)-C),d}c<a[0]&&(c+=360);const v=Qe(a,0,a.length,c-_);if(v===a.length)return p(0,a.length),d;p(0,v-0);const b=$t(a,v+1,a.length,c+_);return b!==a.length&&p(b,a.length-b),d}}class BE extends xt{constructor(e,o){super(e,{},o),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const VE=new Xe({visibility:new re(De.layout_sky.visibility)});var c_={paint:new Xe({"sky-type":new re(De.paint_sky["sky-type"]),"sky-atmosphere-sun":new re(De.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new re(De.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new re(De.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new re(De.paint_sky["sky-gradient-radius"]),"sky-gradient":new tt(De.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new re(De.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new re(De.paint_sky["sky-atmosphere-color"]),"sky-opacity":new re(De.paint_sky["sky-opacity"])}),layout:VE};function u_(n,e,o){const a=[0,0,1],c=f.q.identity([]);return f.q.rotateY(c,c,o?-wt(n)+Math.PI:wt(n)),f.q.rotateX(c,c,-wt(e)),f.v.transformQuat(a,a,c),f.v.normalize(a,a)}var $1={paint:new Xe({})};const jE={circle:class extends xt{constructor(n,e,o){super(n,iM,e,o)}createBucket(n){return new Ih(n)}queryRadius(n){const e=n;return Rh("circle-radius",this,e)+Rh("circle-stroke-width",this,e)+Op(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,o,a,c,d,p,_){const v=Vw(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,o)+this.paint.get("circle-stroke-width").evaluate(e,o);return jw(n,a,d,p,_,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),v,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e){const o=mg(this);return{config:new yh(this,e),defines:o,overrideFog:!1}}},heatmap:class extends xt{createBucket(n){return new Ax(n)}constructor(n,e,o){super(n,Gw,e,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Rh("heatmap-radius",this,n)}queryIntersectsFeature(n,e,o,a,c,d,p,_){const v=this.paint.get("heatmap-radius").evaluate(e,o);return jw(n,a,d,p,_,!0,!0,new ut(0,0),v)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e){return"heatmap"===n?{config:new yh(this,e),overrideFog:!1}:{}}},hillshade:class extends xt{constructor(n,e,o){super(n,Lx,e,o)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e){return{overrideFog:!1}}},fill:class extends xt{constructor(n,e,o){super(n,$d,e,o)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),o=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(n,e){return{config:new yh(this,e),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const o=this.paint._values["fill-outline-color"];"constant"===o.value.kind&&void 0===o.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Eg(n)}queryRadius(){return Op(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,o,a,c,d){return!n.queryGeometry.isAboveHorizon&&Bw(Sy(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends xt{constructor(n,e,o){super(n,mm,e,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new pm(n)}queryRadius(){return Op(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,o,a,c,d,p,_,v){const b=Vw(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(e,o),M=this.paint.get("fill-extrusion-base").evaluate(e,o),I=[0,0],R=_&&d.elevation,L=d.elevation?d.elevation.exaggeration():1,F=n.tile.getBucket(this);if(R&&F instanceof pm){const Q=F.centroidVertexArray,oe=v+1;oe<Q.length&&(I[0]=Q.geta_centroid_pos0(oe),I[1]=Q.geta_centroid_pos1(oe))}if(0===I[0]&&1===I[1])return!1;"globe"===d.projection.name&&(a=F1([a],[new ut(0,0),new ut(ct,ct)],n.tileID.canonical).map(Q=>Q.polygon).flat());const B=R?_:null,[U,Y]=(oe=a,ae=M,me=C,_e=b,Ee=p,Pe=B,Se=I,Ue=L,ot=d.center.lat,"globe"===(Q=d).projection.name?function(Je,Fe,_t,Et,rt,Jt,St,mt,Ht,Nt,Gt){const at=[],cn=[],On=Je.projection.upVectorScale(Gt,Je.center.lat,Je.worldSize).metersToTile,pn=[0,0,0,1],Dn=[0,0,0,1],Yn=(wn,Fr,wr,cr)=>{wn[0]=Fr,wn[1]=wr,wn[2]=cr,wn[3]=1},br=k1();_t>0&&(_t+=br),Et+=br;for(const wn of Fe){const Fr=[],wr=[];for(const cr of wn){const dr=cr.x+rt.x,Qn=cr.y+rt.y,si=Je.projection.projectTilePoint(dr,Qn,Gt),Gr=Je.projection.upVector(Gt,cr.x,cr.y);let xi=_t,co=Et;if(St){const ms=bf(dr,Qn,_t,Et,St,mt,Ht,Nt);xi+=ms.base,co+=ms.top}0!==_t?Yn(pn,si.x+Gr[0]*On*xi,si.y+Gr[1]*On*xi,si.z+Gr[2]*On*xi):Yn(pn,si.x,si.y,si.z),Yn(Dn,si.x+Gr[0]*On*co,si.y+Gr[1]*On*co,si.z+Gr[2]*On*co),f.v.transformMat4(pn,pn,Jt),f.v.transformMat4(Dn,Dn,Jt),Fr.push(new Gu(pn[0],pn[1],pn[2])),wr.push(new Gu(Dn[0],Dn[1],Dn[2]))}at.push(Fr),cn.push(wr)}return[at,cn]}(Q,oe,ae,me,_e,Ee,Pe,Se,Ue,ot,n.tileID.canonical):Pe?function(Je,Fe,_t,Et,rt,Jt,St,mt,Ht){const Nt=[],Gt=[],at=[0,0,0,1];for(const cn of Je){const On=[],pn=[];for(const Dn of cn){const Yn=Dn.x+Et.x,br=Dn.y+Et.y,wn=bf(Yn,br,Fe,_t,Jt,St,mt,Ht);at[0]=Yn,at[1]=br,at[2]=wn.base,at[3]=1,f.e.transformMat4(at,at,rt),at[3]=Math.max(at[3],1e-5);const Fr=new Gu(at[0]/at[3],at[1]/at[3],at[2]/at[3]);at[0]=Yn,at[1]=br,at[2]=wn.top,at[3]=1,f.e.transformMat4(at,at,rt),at[3]=Math.max(at[3],1e-5);const wr=new Gu(at[0]/at[3],at[1]/at[3],at[2]/at[3]);On.push(Fr),pn.push(wr)}Nt.push(On),Gt.push(pn)}return[Nt,Gt]}(oe,ae,me,_e,Ee,Pe,Se,Ue,ot):function(Je,Fe,_t,Et,rt){const Jt=[],St=[],mt=rt[8]*Fe,Ht=rt[9]*Fe,Nt=rt[10]*Fe,Gt=rt[11]*Fe,at=rt[8]*_t,cn=rt[9]*_t,On=rt[10]*_t,pn=rt[11]*_t;for(const Dn of Je){const Yn=[],br=[];for(const wn of Dn){const Fr=wn.x+Et.x,wr=wn.y+Et.y,cr=rt[0]*Fr+rt[4]*wr+rt[12],dr=rt[1]*Fr+rt[5]*wr+rt[13],Qn=rt[2]*Fr+rt[6]*wr+rt[14],si=rt[3]*Fr+rt[7]*wr+rt[15],Gr=cr+mt,xi=dr+Ht,co=Qn+Nt,ms=Math.max(si+Gt,1e-5),Ri=cr+at,gi=dr+cn,Ko=Qn+On,Qo=Math.max(si+pn,1e-5);Yn.push(new Gu(Gr/ms,xi/ms,co/ms)),br.push(new Gu(Ri/Qo,gi/Qo,Ko/Qo))}Jt.push(Yn),St.push(br)}return[Jt,St]}(oe,ae,me,_e,Ee)),J=n.queryGeometry;var Q,oe,ae,me,_e,Ee,Pe,Se,Ue,ot;return function(Q,oe,ae){let me=1/0;Bw(ae,oe)&&(me=wv(ae,oe[0]));for(let _e=0;_e<oe.length;_e++){const Ee=oe[_e],Pe=Q[_e];for(let Se=0;Se<Ee.length-1;Se++){const Ue=Ee[Se],ot=[Ue,Ee[Se+1],Pe[Se+1],Pe[Se],Ue];Tx(ae,ot)&&(me=Math.min(me,wv(ae,ot)))}}return me!==1/0&&me}(U,Y,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends xt{constructor(n,e,o){super(n,z1,e,o),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Mi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=U1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new tm(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e){const o=V1(this);return{config:new yh(this,e),defines:o,overrideFog:!1}}queryRadius(n){const e=n,o=r_(Rh("line-width",this,e),Rh("line-gap-width",this,e)),a=Rh("line-offset",this,e);return o/2+Math.abs(a)+Op(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,o,a,c,d){if(n.queryGeometry.isAboveHorizon)return!1;const p=Sy(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),_=n.pixelToTileUnitsFactor/2*r_(this.paint.get("line-width").evaluate(e,o),this.paint.get("line-gap-width").evaluate(e,o)),v=this.paint.get("line-offset").evaluate(e,o);return v&&(a=function(b,C){const M=[],I=new ut(0,0);for(let R=0;R<b.length;R++){const L=b[R],F=[];for(let B=0;B<L.length;B++){const U=L[B],Y=L[B+1],J=0===B?I:U.sub(L[B-1])._unit()._perp(),Q=B===L.length-1?I:Y.sub(U)._unit()._perp(),oe=J._add(Q)._unit();oe._mult(1/(oe.x*Q.x+oe.y*Q.y)),F.push(oe._mult(C)._add(U))}M.push(F)}return M}(a,v*n.pixelToTileUnitsFactor)),function(b,C,M){for(let I=0;I<C.length;I++){const R=C[I];if(b.length>=3)for(let L=0;L<R.length;L++)if(Ah(b,R[L]))return!0;if(tM(b,R,M))return!0}return!1}(p,a,_)}isTileClipped(){return!0}},symbol:jg,background:class extends xt{constructor(n,e,o){super(n,o_,e,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e){return{overrideFog:!1}}},raster:class extends xt{constructor(n,e,o){super(n,zE,e,o),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(n){return!(n&&n._source instanceof Ev)||!n._source.onNorthPole&&!n._source.onSouthPole&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(n){"raster-color"!==n&&"raster-color-range"!==n||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-color"].value.expression,[e,o]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=gg({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:o}],resolution:256}),this.colorRampTexture=null}},sky:class extends xt{constructor(n,e,o){super(n,c_,e,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=gg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const a=this.paint.get("sky-atmosphere-sun"),c=!a,d=n.style.light,p=d.properties.get("position");return c&&"viewport"===d.properties.get("anchor")&&Rr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?u_(p.azimuthal,90-p.polar,e):u_(a[0],90-a[1],e)}const o=this.paint.get("sky-gradient-center");return u_(o[0],90-o[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}},slot:class extends xt{constructor(n,e,o){super(n,$1,e)}},model:class extends xt{constructor(n,e,o){super(n,S1,e,o)}createBucket(n){return new D1(n)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(n,e,o){return!(!this.layout||e.isDataDriven()||o.isDataDriven()||"model-color"!==n&&"model-color-mix-intensity"!==n&&"model-rotation"!==n&&"model-scale"!==n&&"model-translation"!==n&&"model-emissive-strength"!==n)}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof _d}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};class UE{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class $E{constructor(){this.tasks={},this.taskQueue=[],er(["process"],this),this.invoker=new UE(this.process),this.nextId=0}add(e,o){const a=this.nextId++,c=function({type:d,isSymbolTile:p,zoom:_}){return _=_||0,"message"===d?0:"maybePrepare"!==d||p?"parseTile"!==d||p?"parseTile"===d&&p?300-_:"maybePrepare"===d&&p?400-_:500:200-_:100-_}(o);if(0===c){Ce();try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:o,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Ce();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const o=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let e=null,o=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<o&&(o=d.priority,e=c)}if(null===e)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class G1{constructor(e,o,a){this.target=e,this.parent=o,this.mapId=a,this.callbacks={},this.cancelCallbacks={},er(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new $E}send(e,o,a,c,d=!1,p){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[_]=a);const v=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!a,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:h(o,v)},v),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const o=e.data,a=o.id;if(a&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(o.mustQueue||Ce()){const c=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,o),c&&c.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,o)}processTask(e,o){if(delete this.cancelCallbacks[e],"<response>"===o.type){const a=this.callbacks[e];delete this.callbacks[e],a&&(o.error?a(y(o.error)):a(null,y(o.data)))}else{const a=new Set,c=o.hasCallback?(p,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?h(p):null,data:h(_,a)},a)}:p=>{},d=y(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,d,c);else if(this.parent.getWorkerSource){const p=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,p[0],d.source,d.scope)[p[1]](d,c)}else c(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let qu=(()=>{class n{constructor(o,a){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=ci();const c=this.workerPool.acquire(this.id);for(let d=0;d<c.length;d++){const p=new n.Actor(c[d],a,this.id);p.name=`Worker ${d}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,a,c){uo(this.actors,(d,p)=>{d.send(o,a,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}return n.Actor=G1,n})();class h_{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.image=new qc({width:e,height:o}),this.positions={},this.uploaded=!1}getDash(e,o){const a=this.getKey(e,o);return this.positions[a]}trim(){const e=this.width,o=this.height=Va(this.nextRow);this.image.resize({width:e,height:o})}getKey(e,o){return e.join(",")+o}getDashRanges(e,o,a){const c=[];let d=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,_=!0;c.push({left:d,right:p,isDash:_,zeroLength:0===e[0]});let v=e[0];for(let b=1;b<e.length;b++){_=!_;const C=e[b];d=v*a,v+=C,p=v*a,c.push({left:d,right:p,isDash:_,zeroLength:0===C})}return c}addRoundDash(e,o,a){const c=o/2;for(let d=-a;d<=a;d++){const p=this.width*(this.nextRow+a+d);let _=0,v=e[_];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++_]);const C=Math.abs(b-v.left),M=Math.abs(b-v.right),I=Math.min(C,M);let R;const L=d/a*(c+1);if(v.isDash){const F=c-Math.abs(L);R=Math.sqrt(I*I+F*F)}else R=c-Math.sqrt(I*I+L*L);this.image.data[p+b]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,o){for(let v=e.length-1;v>=0;--v){const b=e[v],C=e[v+1];b.zeroLength?e.splice(v,1):C&&C.isDash===b.isDash&&(C.left=b.left,e.splice(v,1))}const a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const d=this.width*this.nextRow;let p=0,_=e[p];for(let v=0;v<this.width;v++){v/_.right>1&&(_=e[++p]);const b=Math.abs(v-_.left),C=Math.abs(v-_.right),M=Math.min(b,C);this.image.data[d+v]=Math.max(0,Math.min(255,(_.isDash?M:-M)+o+128))}}addDash(e,o){const a=this.getKey(e,o);if(this.positions[a])return this.positions[a];const c="round"===o,d=c?7:0,p=2*d+1;if(this.nextRow+p>this.height)return Rr("LineAtlas out of space"),null;0===e.length&&e.push(1);let _=0;for(let C=0;C<e.length;C++)e[C]<0&&(Rr("Negative value is found in line dasharray, replacing values with 0"),e[C]=0),_+=e[C];if(0!==_){const C=this.width/_,M=this.getDashRanges(e,this.width,C);c?this.addRoundDash(M,C,d):this.addRegularDash(M,"square"===o?.5*C:0)}const v=this.nextRow+d;this.nextRow+=p;const b={tl:[v,d],br:[_,0]};return this.positions[a]=b,b}}It(h_,"LineAtlas");const H1=1*zl;class al{constructor(e){const o={},a=[];for(const _ in e){const v=e[_],b=o[_]={};for(const C in v.glyphs){const M=v.glyphs[+C];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const I=M.metrics.localGlyph?H1:1,R={x:0,y:0,w:M.bitmap.width+2*I,h:M.bitmap.height+2*I};a.push(R),b[C]=R}}const{w:c,h:d}=Hp(a),p=new qc({width:c||1,height:d||1});for(const _ in e){const v=e[_];for(const b in v.glyphs){const C=v.glyphs[+b];if(!C||0===C.bitmap.width||0===C.bitmap.height)continue;const M=o[_][b],I=C.metrics.localGlyph?H1:1;qc.copy(C.bitmap,p,{x:0,y:0},{x:M.x+I,y:M.y+I},C.bitmap)}}this.image=p,this.positions=o}}It(al,"GlyphAtlas");class uc{constructor(e){this.tileID=new no(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ic(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,o,a,c,d){this.status="parsing",this.data=e,this.collisionBoxArray=new Vm;const p=new Zd(Object.keys(e.layers).sort()),_=new Fh(this.tileID,this.promoteId);_.bucketLayerIDs=[];const v={},b=new h_(256,256),C={featureIndex:_,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:a,brightness:this.brightness},M=o.familiesBySource[this.source];for(const Y in M){const J=e.layers[Y];if(!J)continue;let Q=!1,oe=!1,ae=!1;for(const Ee of M[Y])"symbol"===Ee[0].type?Q=!0:oe=!0,Ee[0].is3D()&&"model"!==Ee[0].type&&(ae=!0);if(this.extraShadowCaster&&!ae||!0===this.isSymbolTile&&!Q||!1===this.isSymbolTile&&!oe)continue;1===J.version&&Rr(`Vector tile source "${this.source}" layer "${Y}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const me=p.encode(Y),_e=[];for(let Ee=0;Ee<J.length;Ee++){const Pe=J.feature(Ee),Se=_.getId(Pe,Y);_e.push({feature:Pe,id:Se,index:Ee,sourceLayerIndex:me})}for(const Ee of M[Y]){const Pe=Ee[0];(!this.extraShadowCaster||Pe.is3D()&&"model"!==Pe.type)&&(void 0!==this.isSymbolTile&&"symbol"===Pe.type!==this.isSymbolTile||Pe.minzoom&&this.zoom<Math.floor(Pe.minzoom)||Pe.maxzoom&&this.zoom>=Pe.maxzoom||"none"!==Pe.visibility&&(Zu(Ee,this.zoom,C.brightness,a),(v[Pe.id]=Pe.createBucket({index:_.bucketLayerIDs.length,layers:Ee,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:me,sourceID:this.source,projection:this.projection.spec})).populate(_e,C,this.tileID.canonical,this.tileTransform),_.bucketLayerIDs.push(Ee.map(Se=>Se.id))))}}let I,R,L,F;b.trim();const B={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},U=()=>{if(I)return this.status="done",d(I);if(this.extraShadowCaster)this.status="done",d(null,{buckets:ca(v).filter(Y=>!Y.isEmpty()),featureIndex:_,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:C.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(R&&L&&F){const Y=new al(R),J=new nv(L,F);for(const Q in v){const oe=v[Q];oe instanceof uf?(Zu(oe.layers,this.zoom,C.brightness,a),Wp(oe,R,Y.positions,L,J.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):oe.hasPattern&&(oe instanceof tm||oe instanceof Eg||oe instanceof pm)&&(Zu(oe.layers,this.zoom,C.brightness,a),oe.addFeatures(C,this.tileID.canonical,J.patternPositions,a,this.tileTransform,this.brightness))}this.status="done",d(null,{buckets:ca(v).filter(Q=>!Q.isEmpty()),featureIndex:_,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Y.image,lineAtlas:b,imageAtlas:J,brightness:C.brightness})}};if(!this.extraShadowCaster){const Y=_r(C.glyphDependencies,oe=>Object.keys(oe).map(Number));Object.keys(Y).length?c.send("getGlyphs",{uid:this.uid,stacks:Y,scope:this.scope},(oe,ae)=>{I||(I=oe,R=ae,U())},void 0,!1,B):R={};const J=Object.keys(C.iconDependencies);J.length?c.send("getImages",{icons:J,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(oe,ae)=>{I||(I=oe,L=ae,U())},void 0,!1,B):L={};const Q=Object.keys(C.patternDependencies);Q.length?c.send("getImages",{icons:Q,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(oe,ae)=>{I||(I=oe,F=ae,U())},void 0,!1,B):F={}}U()}}function Zu(n,e,o,a){const c=new pe(e,{brightness:o});for(const d of n)d.recalculate(c,a)}class Cv{constructor(e){this.entries={},this.scheduler=e}request(e,o,a,c){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[p,_]=d.result;return this.scheduler?this.scheduler.add(()=>{c(p,_)},o):c(p,_),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=a((p,_)=>{d.result=[p,_];for(const v of d.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,_)},o):v(p,_);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(p=>p!==c),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function q1(n,e,o){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const d=di(n.request,(p,_,v,b)=>{p?c(p):_&&c(null,{vectorTile:o?void 0:new zu(new Qd(_)),rawData:_,cacheControl:v,expires:b})});return()=>{d.cancel(),c()}},e)}var gm={workerUrl:"",workerClass:null,workerParams:void 0};function GE(){return null!=gm.workerClass?new gm.workerClass:new self.Worker(gm.workerUrl,gm.workerParams)}const _m="mapboxgl_preloaded_worker_pool";class Jh{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Jh.workerCount;)this.workers.push(new GE);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_m]}numActive(){return Object.keys(this.active).length}}let Ef;function d_(){return Ef||(Ef=new Jh),Ef}Jh.workerCount=2;let f_,Tv,Oa,Kh=null;function Mv(){return Ce()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Tv||vn.DRACO_URL}const Jo=5123,p_=5126,Dv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[Jo]:Uint16Array,5125:Uint32Array,[p_]:Float32Array},Z1={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[Jo]:"DT_UINT16",5125:"DT_UINT32",[p_]:"DT_FLOAT32"},m_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Sv(n,e,o){const a=o.json.bufferViews.length,c=o.buffers.length;e.bufferView=a,o.json.bufferViews[a]={buffer:c,byteLength:n.byteLength},o.buffers[c]=n}const Cf="KHR_draco_mesh_compression";function HE(n,e){const o=n.extensions&&n.extensions[Cf];if(!o)return;const a=new Oa.Decoder,c=Pv(e,o.bufferView),d=new Oa.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,d))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[n.indices],_=Dv[p.componentType],v=p.count*_.BYTES_PER_ELEMENT,b=Oa._malloc(v);_===Uint16Array?a.GetTrianglesUInt16Array(d,v,b):a.GetTrianglesUInt32Array(d,v,b),Sv(Oa.memory.buffer.slice(b,b+v),p,e),Oa._free(b);for(const C of Object.keys(o.attributes)){const M=a.GetAttributeByUniqueId(d,o.attributes[C]),I=e.json.accessors[n.attributes[C]],R=Z1[I.componentType],L=I.count*m_[I.type]*Dv[I.componentType].BYTES_PER_ELEMENT,F=Oa._malloc(L);a.GetAttributeDataArrayForAllPoints(d,M,Oa[R],L,F),Sv(Oa.memory.buffer.slice(F,F+L),I,e),Oa._free(F)}a.destroy(),d.destroy(),delete n.extensions[Cf]}const W1=1179937895,X1=new TextDecoder("utf8");function Iv(n,e){return new URL(n,e).href}function Av(n,e,o,a){return fetch(Iv(n.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[o]=c})}function Pv(n,e){const o=n.json.bufferViews[e];return new Uint8Array(n.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function Y1(n,e,o,a){if(n.uri){const c=Iv(n.uri,a);return fetch(c).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[o]=d})}if(void 0!==n.bufferView){const c=Pv(e,n.bufferView),d=new Blob([c],{type:n.mimeType});return createImageBitmap(d).then(p=>{e.images[o]=p})}}function Rv(n,e=0,o){const a={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===W1){const b=new Uint32Array(n,e);let C=2;const M=(b[C++]>>2)-3,I=b[C++]>>2;if(C++,a.json=JSON.parse(X1.decode(b.subarray(C,C+I))),C+=I,C<M){const R=b[C++];C++;const L=e+(C<<2);a.buffers[0]=n.slice(L,L+R)}}else a.json=JSON.parse(X1.decode(new Uint8Array(n,e)));const{buffers:c,images:d,meshes:p,extensionsUsed:_}=a.json;let v=Promise.resolve();if(c){const b=[];for(let C=0;C<c.length;C++){const M=c[C];M.uri?b.push(Av(M,a,C,o)):a.buffers[C]||(a.buffers[C]=null)}v=Promise.all(b)}return v.then(()=>{const b=[],C=_&&_.includes(Cf);if(C&&b.push(function(){if(!Oa)return f_||(f_=function(M){let I,R=null;function L(){I=new Uint8Array(R.buffer)}function F(){throw new Error("Unexpected Draco error.")}const B={a:{a:F,d:function(U,Y,J){return I.copyWithin(U,Y,Y+J)},c:function(U){const Y=I.length,J=Math.max(U>>>0,Math.ceil(1.2*Y)),Q=Math.ceil((J-Y)/65536);try{return R.grow(Q),L(),!0}catch{return!1}},b:F}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(M,B):M.then(U=>U.arrayBuffer()).then(U=>WebAssembly.instantiate(U,B))).then(U=>{const{Rb:Y,Qb:J,P:Q,T:oe,X:ae,Ja:me,La:_e,Qa:Ee,Va:Pe,Wa:Se,eb:Ue,jb:ot,f:je,e:Je,yb:Fe,zb:_t,Ab:Et,Bb:rt,Db:Jt,Gb:St}=U.instance.exports;R=Je;const mt=(()=>{let Ht=0,Nt=0,Gt=0,at=0;return cn=>{Gt&&(Y(at),Y(Ht),Nt+=Gt,Gt=Ht=0),Ht||(Nt+=128,Ht=J(Nt));const On=cn.length+7&-8;let pn=Ht;On>=Nt&&(Gt=On,pn=at=J(On));for(let Dn=0;Dn<cn.length;Dn++)I[pn+Dn]=cn[Dn];return pn}})();return L(),je(),{memory:Je,_free:Y,_malloc:J,Mesh:class{constructor(){this.ptr=Q()}destroy(){oe(this.ptr)}},Decoder:class{constructor(){this.ptr=me()}destroy(){ot(this.ptr)}DecodeArrayToMesh(Ht,Nt,Gt){const at=mt(Ht),cn=_e(this.ptr,at,Nt,Gt.ptr);return!!ae(cn)}GetAttributeByUniqueId(Ht,Nt){return{ptr:Ee(this.ptr,Ht.ptr,Nt)}}GetTrianglesUInt16Array(Ht,Nt,Gt){Pe(this.ptr,Ht.ptr,Nt,Gt)}GetTrianglesUInt32Array(Ht,Nt,Gt){Se(this.ptr,Ht.ptr,Nt,Gt)}GetAttributeDataArrayForAllPoints(Ht,Nt,Gt,at,cn){Ue(this.ptr,Ht.ptr,Nt.ptr,Gt,at,cn)}},DT_INT8:Fe(),DT_UINT8:_t(),DT_INT16:Et(),DT_UINT16:rt(),DT_UINT32:Jt(),DT_FLOAT32:St()}})}(fetch(Mv())),f_.then(M=>{Oa=M,f_=void 0}))}()),d)for(let M=0;M<d.length;M++)b.push(Y1(d[M],a,M,o));return(b.length?Promise.all(b):Promise.resolve()).then(()=>{if(C&&p)for(const{primitives:M}of p)for(const I of M)HE(I,a);return a})})}class Ov{constructor(e,o,a){if(this.triangleCount=o.length/3,this.min=new ut(0,0),this.max=new ut(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===a)return;const c=e.map(C=>C.x),d=e.map(C=>C.y);this.min=new ut(Math.min(...c),Math.min(...d)),this.max=new ut(Math.max(...c),Math.max(...d));const p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);const _=Math.max(p.x,p.y)/a;this.cellsX=Math.max(1,Math.ceil(p.x/_)),this.cellsY=Math.max(1,Math.ceil(p.y/_)),this.xScale=1/_,this.yScale=1/_;const v=[];for(let C=0;C<this.triangleCount;C++){const M=e[o[3*C+0]].sub(this.min),I=e[o[3*C+1]].sub(this.min),R=e[o[3*C+2]].sub(this.min),L=Kc(Math.floor(Math.min(M.x,I.x,R.x)),this.xScale,this.cellsX),F=Kc(Math.floor(Math.max(M.x,I.x,R.x)),this.xScale,this.cellsX),B=Kc(Math.floor(Math.min(M.y,I.y,R.y)),this.yScale,this.cellsY),U=Kc(Math.floor(Math.max(M.y,I.y,R.y)),this.yScale,this.cellsY),Y=new ut(0,0),J=new ut(0,0),Q=new ut(0,0),oe=new ut(0,0);for(let ae=B;ae<=U;++ae){Y.y=J.y=ae*_,Q.y=oe.y=(ae+1)*_;for(let me=L;me<=F;++me)Y.x=Q.x=me*_,J.x=oe.x=(me+1)*_,(Ph(M,I,R,Y,J,oe)||Ph(M,I,R,Y,oe,Q))&&v.push({cellIdx:ae*this.cellsX+me,triIdx:C})}}if(0===v.length)return;v.sort((C,M)=>C.cellIdx-M.cellIdx||C.triIdx-M.triIdx);let b=0;for(;b<v.length;){const C=v[b].cellIdx,M={start:this.payload.length,len:0};for(;b<v.length&&v[b].cellIdx===C;)++M.len,this.payload.push(v[b++].triIdx);this.cells[C]=M}}query(e,o,a){if(0===this.triangleCount||0===this.cells.length||e.x>this.max.x||this.min.x>o.x||e.y>this.max.y||this.min.y>o.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let v=0;v<this.lookup.length;v++)this.lookup[v]=0;const c=Kc(e.x-this.min.x,this.xScale,this.cellsX),d=Kc(o.x-this.min.x,this.xScale,this.cellsX),p=Kc(e.y-this.min.y,this.yScale,this.cellsY),_=Kc(o.y-this.min.y,this.yScale,this.cellsY);for(let v=p;v<=_;v++)for(let b=c;b<=d;b++){const C=this.cells[v*this.cellsX+b];if(C)for(let M=0;M<C.len;M++){const I=this.payload[C.start+M],R=Math.floor(I/8),L=1<<I%8;if(!(this.lookup[R]&L)&&(this.lookup[R]|=L,a.push(I),a.length===this.triangleCount))return}}}}function Kc(n,e,o){return Math.max(0,Math.min(o-1,Math.floor(n*e)))}function Wu(n,e){const o=n.json.bufferViews[e.bufferView];return new Dv[e.componentType](n.buffers[o.buffer],(e.byteOffset||0)+(o.byteOffset||0),e.count*m_[e.type])}function J1(n,e,o){const a=n.indices,c=n.attributes,d={};d.indexArray=new qn;const p=e.json.accessors[a],_=p.count/3;d.indexArray.reserve(_);const v=Wu(e,p);for(let I=0;I<_;I++)d.indexArray.emplaceBack(v[3*I],v[3*I+1],v[3*I+2]);d.indexArray._trim(),d.vertexArray=new kc;const b=e.json.accessors[c.POSITION];d.vertexArray.reserve(b.count);const C=Wu(e,b);for(let I=0;I<b.count;I++)d.vertexArray.emplaceBack(C[3*I],C[3*I+1],C[3*I+2]);if(d.vertexArray._trim(),d.aabb=new hi(b.min,b.max),d.centroid=function(I,R){const L=[0,0,0],F=I.length;if(F>0){for(let B=0;B<F;B++){const U=3*I[B];L[0]+=R[U],L[1]+=R[U+1],L[2]+=R[U+2]}L[0]/=F,L[1]/=F,L[2]/=F}return L}(v,C),void 0!==c.COLOR_0){const I=e.json.accessors[c.COLOR_0],R=m_[I.type];if(I.componentType===p_){d.colorArray=3===R?new kc:new lr,d.colorArray.reserve(I.count);const L=Wu(e,I);if(3===R)for(let F=0;F<I.count;F++)d.colorArray.emplaceBack(L[3*F],L[3*F+1],L[3*F+2]);else for(let F=0;F<I.count;F++)d.colorArray.emplaceBack(L[4*F],L[4*F+1],L[4*F+2],L[4*F+3]);d.colorArray._trim()}else if(I.componentType===Jo&&4===R){d.colorArray=new lr,d.colorArray.resize(I.count);const L=Wu(e,I),F=1/65535,B=d.colorArray.float32;for(let U=0;U<4*L.length;++U)B[U]=L[U]*F}else Rr(`glTF color buffer parsing for accessor ${JSON.stringify(I)} is not supported`)}if(void 0!==c.NORMAL){d.normalArray=new kc;const I=e.json.accessors[c.NORMAL];d.normalArray.reserve(I.count);const R=Wu(e,I);for(let L=0;L<I.count;L++)d.normalArray.emplaceBack(R[3*L],R[3*L+1],R[3*L+2]);d.normalArray._trim()}if(void 0!==c.TEXCOORD_0&&o.length>0){d.texcoordArray=new op;const I=e.json.accessors[c.TEXCOORD_0];d.texcoordArray.reserve(I.count);const R=Wu(e,I);for(let L=0;L<I.count;L++)d.texcoordArray.emplaceBack(R[2*L],R[2*L+1]);d.texcoordArray._trim()}const M=n.material;return d.material=function(I,R){const{emissiveFactor:L=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:B=.5,normalTexture:U,occlusionTexture:Y,emissiveTexture:J,doubleSided:Q}=I,{baseColorFactor:oe=[1,1,1,1],metallicFactor:ae=1,roughnessFactor:me=1,baseColorTexture:_e,metallicRoughnessTexture:Ee}=I.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new un(...oe),metallicFactor:ae,roughnessFactor:me,baseColorTexture:_e?R[_e.index]:void 0,metallicRoughnessTexture:Ee?R[Ee.index]:void 0},doubleSided:Q,emissiveFactor:L,alphaMode:F,alphaCutoff:B,normalTexture:U?R[U.index]:void 0,occlusionTexture:Y?R[Y.index]:void 0,emissionTexture:J?R[J.index]:void 0,defined:void 0===I.defined}}(void 0!==M?e.json.materials[M]:{defined:!1},o),void 0!==c._FEATURE_RGBA4444&&(d.featureData=new Uint32Array(Wu(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer)),d}function Lv(n,e,o){const{matrix:a,rotation:c,translation:d,scale:p,mesh:_,extras:v,children:b}=n,C={};if(C.matrix=a||f.m.fromRotationTranslationScale([],c||[0,0,0,1],d||[0,0,0],p||[1,1,1]),void 0!==_){C.meshes=o[_];const M=C.anchor=[0,0];for(const I of C.meshes){const{min:R,max:L}=I.aabb;M[0]+=R[0]+L[0],M[1]+=R[1]+L[1]}M[0]=Math.floor(M[0]/C.meshes.length/2),M[1]=Math.floor(M[1]/C.meshes.length/2)}if(v&&(v.id&&(C.id=v.id),v.lights&&(C.lights=function(M){if(!M.length)return[];const I=function(U){const Y=atob(U),J=new Uint8Array(Y.length);for(let Q=0;Q<Y.length;Q++)J[Q]=Y.codePointAt(Q);return J}(M),R=[],L=I.length/24,F=new Uint16Array(I.buffer),B=new Float32Array(I.buffer);for(let U=0;U<L;U++){const Y=F[2*U*6]/30,J=F[2*U*6+1]/30,Q=F[2*U*6+10]/100,oe=B[6*U+1],ae=B[6*U+2],me=B[6*U+3],_e=B[6*U+4],Ee=me-oe,Pe=_e-ae,Se=Math.hypot(Ee,Pe);R.push({pos:[oe+.5*Ee,ae+.5*Pe,J],normal:[Pe/Se,-Ee/Se,0],width:Se,height:Y,depth:Q,points:[oe,ae,me,_e]})}return R}(v.lights))),b){const M=[];for(const I of b)M.push(Lv(e.json.nodes[I],e,o));C.children=M}return C}function g_(n){if(0===n.vertices.length||0===n.indices.length)return null;const[e,o]=[n.vertices[0].clone(),n.vertices[0].clone()];for(let p=1;p<n.vertices.length;++p){const _=n.vertices[p];e.x=Math.min(e.x,_.x),e.y=Math.min(e.y,_.y),o.x=Math.max(o.x,_.x),o.y=Math.max(o.y,_.y)}const a=Math.ceil(Math.max(o.x-e.x,o.y-e.y)/256),c=Math.max(8,a),d=new Ov(n.vertices,n.indices,c);return{vertices:n.vertices,indices:n.indices,grid:d,min:e,max:o}}function Xu(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const o=e[0];if(!o||!Array.isArray(o)||0===o.length)return null;const a=[];for(const p of o){if(!Array.isArray(p)||2!==p.length)continue;const _=p[0],v=p[1];"number"==typeof _&&"number"==typeof v&&a.push(new ut(_,v))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let p=0;p<a.length;p++){const _=a[p],v=a[(p+1)%a.length],b=a[(p+2)%a.length];c+=(_.x-v.x)*(b.y-v.y)-(b.x-v.x)*(_.y-v.y)}c>0&&a.reverse();const d=Oh(a.flatMap(p=>[p.x,p.y]),[]);return 0===d.length?null:{vertices:a,indices:d}}function qE(n){const e=[],o=[];let a=0;for(const c of n){a=e.length;const d=c.vertexArray.float32,p=c.indexArray.uint16;for(let _=0;_<c.vertexArray.length;_++)e.push(new ut(d[3*_+0],d[3*_+1]));for(let _=0;_<3*c.indexArray.length;_++)o.push(p[_]+a)}if(o.length%3!=0)return null;for(let c=0;c<o.length;c+=3){const d=e[o[c+0]],p=e[o[c+1]],_=e[o[c+2]];(d.x-p.x)*(_.y-p.y)-(_.x-p.x)*(d.y-p.y)>0&&([o[c+1],o[c+2]]=[o[c+2],o[c+1]])}return{vertices:e,indices:o}}function K1(n){const o=function(v,b){const C=[];for(const M of v.json.meshes){const I=[];for(const R of M.primitives)I.push(J1(R,v,b));C.push(I)}return C}(n,function(v,b){const C=[],M=WebGL2RenderingContext;if(v.json.textures)for(const I of v.json.textures){const R={magFilter:M.LINEAR,minFilter:M.NEAREST,wrapS:M.REPEAT,wrapT:M.REPEAT};void 0!==I.sampler&&Object.assign(R,v.json.samplers[I.sampler]),C.push({image:b[I.source],sampler:R,uploaded:!1})}return C}(n,n.images)),{scenes:a,scene:c,nodes:d}=n.json,p=a?a[c||0].nodes:d,_=[];for(const v of p)_.push(Lv(d[v],n,o));return function(v,b,C){const M={},I=new Set;for(let R=0;R<v.length;R++){const L=C[b[R]];if(!L.extras)continue;const F=L.extras["mapbox:footprint:version"],B=L.extras["mapbox:footprint:id"];(F||B)&&I.add(R),"1.0.0"===F&&B&&(M[B]=R)}for(let R=0;R<v.length;R++){if(I.has(R))continue;const L=v[R],F=C[b[R]];if(!F.extras)continue;let B=null;L.id in M&&(B=qE(v[M[L.id]].meshes)),B||(B=Xu(F)),B&&(L.footprint=g_(B))}if(I.size>0){const R=Array.from(I.values()).sort((L,F)=>L-F);for(let L=R.length-1;L>=0;L--)v.splice(R[L],1)}}(_,p,n.json.nodes),_}function kv(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,o=n.aabb.min[0]-1,a=n.aabb.min[1]-1,c=64/(n.aabb.max[0]-o+2),d=64/(n.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){const _=e[p+2],v=(e[p+0]-o)*c|0,b=(e[p+1]-a)*d|0;_>n.heightmap[64*b+v]&&(n.heightmap[64*b+v]=_)}}function Qh(n,e){const o={};o.indexArray=new qn,o.indexArray.reserve(4*n.length),o.vertexArray=new kc,o.vertexArray.reserve(10*n.length),o.colorArray=new lr,o.vertexArray.reserve(10*n.length);let a=0;for(const p of n){const _=Math.min(10,Math.max(4,1.3*p.height))*e,v=[-p.normal[1],p.normal[0],0],b=Math.min(.29,.1*p.width/p.depth),C=p.width-2*p.depth*e*(b+.01),M=f.v.scaleAndAdd([],p.pos,v,C/2),I=f.v.scaleAndAdd([],p.pos,v,-C/2),R=[M[0],M[1],M[2]+p.height],L=[I[0],I[1],I[2]+p.height],F=f.v.scaleAndAdd([],p.normal,v,b);f.v.scale(F,F,_);const B=f.v.scaleAndAdd([],p.normal,v,-b);f.v.scale(B,B,_),f.v.add(F,M,F),f.v.add(B,I,B),M[2]+=.1,I[2]+=.1,o.vertexArray.emplaceBack(F[0],F[1],F[2]),o.vertexArray.emplaceBack(B[0],B[1],B[2]),o.vertexArray.emplaceBack(M[0],M[1],M[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(M[0],M[1],M[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(F[0],F[1],F[2]),o.vertexArray.emplaceBack(B[0],B[1],B[2]);const U=C/_/2;o.colorArray.emplaceBack(-U-b,-1,U,.8),o.colorArray.emplaceBack(U+b,-1,U,.8),o.colorArray.emplaceBack(-U,0,U,1.3),o.colorArray.emplaceBack(U,0,U,1.3),o.colorArray.emplaceBack(U+b,-.8,U,.7),o.colorArray.emplaceBack(U+b,-.8,U,.7),o.colorArray.emplaceBack(0,0,U,1.3),o.colorArray.emplaceBack(0,0,U,1.3),o.colorArray.emplaceBack(U+b,-1.2,U,.8),o.colorArray.emplaceBack(U+b,-1.2,U,.8),o.indexArray.emplaceBack(6+a,4+a,8+a),o.indexArray.emplaceBack(7+a,9+a,5+a),o.indexArray.emplaceBack(0+a,1+a,2+a),o.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const c={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=un.white,c.pbrMetallicRoughness=d,o.material=c,o.aabb=new hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}It(Ov,"TriangleGridIndex");const __=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Fv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,a]=new Uint8Array(e,0,2);if(219!==o)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(1!==c)throw new Error(`Got v${c} data when expected v1.`);const d=__[15&a];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new Fv(_,p,d,e)}constructor(e,o=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=__.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+_+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=e)}add(e,o){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=o,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return ym(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,o,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:_}=this,v=[0,d.length-1,0],b=[];for(;v.length;){const C=v.pop()||0,M=v.pop()||0,I=v.pop()||0;if(M-I<=_){for(let B=I;B<=M;B++){const U=p[2*B],Y=p[2*B+1];U>=e&&U<=a&&Y>=o&&Y<=c&&b.push(d[B])}continue}const R=I+M>>1,L=p[2*R],F=p[2*R+1];L>=e&&L<=a&&F>=o&&F<=c&&b.push(d[R]),(0===C?e<=L:o<=F)&&(v.push(I),v.push(R-1),v.push(1-C)),(0===C?a>=L:c>=F)&&(v.push(R+1),v.push(M),v.push(1-C))}return b}within(e,o,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:p}=this,_=[0,c.length-1,0],v=[],b=a*a;for(;_.length;){const C=_.pop()||0,M=_.pop()||0,I=_.pop()||0;if(M-I<=p){for(let B=I;B<=M;B++)Q1(d[2*B],d[2*B+1],e,o)<=b&&v.push(c[B]);continue}const R=I+M>>1,L=d[2*R],F=d[2*R+1];Q1(L,F,e,o)<=b&&v.push(c[R]),(0===C?e-a<=L:o-a<=F)&&(_.push(I),_.push(R-1),_.push(1-C)),(0===C?e+a>=L:o+a>=F)&&(_.push(R+1),_.push(M),_.push(1-C))}return v}}function ym(n,e,o,a,c,d){if(c-a<=o)return;const p=a+c>>1;ZE(n,e,p,a,c,d),ym(n,e,o,a,p-1,1-d),ym(n,e,o,p+1,c,1-d)}function ZE(n,e,o,a,c,d){for(;c>a;){if(c-a>600){const b=c-a+1,C=o-a+1,M=Math.log(b),I=.5*Math.exp(2*M/3),R=.5*Math.sqrt(M*I*(b-I)/b)*(C-b/2<0?-1:1);ZE(n,e,o,Math.max(a,Math.floor(o-C*I/b+R)),Math.min(c,Math.floor(o+(b-C)*I/b+R)),d)}const p=e[2*o+d];let _=a,v=c;for(y_(n,e,a,o),e[2*c+d]>p&&y_(n,e,a,c);_<v;){for(y_(n,e,_,v),_++,v--;e[2*_+d]<p;)_++;for(;e[2*v+d]>p;)v--}e[2*a+d]===p?y_(n,e,a,v):(v++,y_(n,e,v,c)),v<=o&&(a=v+1),o<=v&&(c=v-1)}}function y_(n,e,o,a){Nv(n,o,a),Nv(e,2*o,2*a),Nv(e,2*o+1,2*a+1)}function Nv(n,e,o){const a=n[e];n[e]=n[o],n[o]=a}function Q1(n,e,o,a){const c=n-o,d=e-a;return c*c+d*d}f.$=45,f.A=Ai,f.B=function(n){const e=f.m.identity(new Float64Array(16));f.m.multiply(e,n.pixelMatrix,n.globeMatrix);const o=[0,rl,0],a=[0,il,0];return f.v.transformMat4(o,o,e),f.v.transformMat4(a,a,e),[o[0]>0&&o[0]<=n.width&&o[1]>0&&o[1]<=n.height&&!Ap(n,new hr(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!Ap(n,new hr(n.center.lat,-90))]},f.C=un,f.D=Nc,f.E=kl,f.F=Ou,f.G=og,f.H=Da,f.I=v1,f.J=ct,f.K=function(n,e){const{scale:o}=n.tileTransform,a=o*ct/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return f.h.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},f.L=hr,f.M=lo,f.N=Xg,f.O=no,f.P=ut,f.Q=E1,f.R=Sh,f.S=function(n){const e=E1(n,!0);return f.h.invert([],[e[0],e[1],e[4],e[5]])},f.T=py,f.U=yx,f.V=function(n){const{x:e,y:o}=n.point,{lng:a,lat:c}=n._center;return Ip(e,o,n.worldSize,a,c)},f.W=na,f.X=Rr,f.Y=Yi,f.Z=ig,f._=function(n){const e=Math.round((n+45+360)%360/90)%4;return zs[e]},f.a=Aa,f.a$=Md,f.a0=ug,f.a1=function(n,e){return ys(mr(n,{type:"json"}),e)},f.a2=Gi,f.a3=Ze,f.a4=ki,f.a5=Ls,f.a6=ho,f.a7=$s,f.a8=Ei,f.a9=sc,f.aA=Ah,f.aB=My,f.aC=fs,f.aD=Cv,f.aE=vt,f.aF=q1,f.aG=function(n){$i++,$i>tr&&(n.getActor().send("enforceCacheSizeLimit",nn),$i=0)},f.aH=Zr,f.aI=wi,f.aJ=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},f.aK=Ev,f.aL=function(n,e){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let a=0;a<n.length;a++){const c=document.createElement("source");Us(n[a])||(o.crossOrigin="Anonymous"),c.src=n[a],o.appendChild(c)}return{cancel:()=>{}}},f.aM=Pt,f.aN=nm,f.aO=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>Rv(e,0,n))},f.aP=K1,f.aQ=class{constructor(n,e,o,a){this.id=n,this.position=null!=e?new hr(e[0],e[1]):new hr(0,0),this.orientation=o??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(f.m.multiply(n.matrix,e,n.matrix),n.meshes)for(const o of n.meshes){const a=hi.applyTransform(o.aabb,n.matrix);this.aabb.encapsulate(a)}if(n.children)for(const o of n.children)this._applyTransformations(o,n.matrix)}computeBoundsAndApplyParent(){const n=f.m.identity([]);for(const e of this.nodes)this._applyTransformations(e,n)}_positionModelOnTerrain(n,e){const o=n.elevation;if(!o)return 0;const a=hi.projectAabbCorners(this.aabb,this.matrix),c=Vo(1,this.position.lat)*n.worldSize,d=function(B,U){const Y=[0,0,1],J=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Q of J){const oe=B[Q.corners[0]],ae=B[Q.corners[1]],me=B[Q.corners[2]],_e=[ae[0]-oe[0],ae[1]-oe[1],U*(ae[2]-oe[2])],Ee=f.v.cross(_e,_e,[me[0]-oe[0],me[1]-oe[1],U*(me[2]-oe[2])]);f.v.normalize(Ee,Ee),Q.dotProductWithUp=f.v.dot(Ee,Y)}return J.sort((Q,oe)=>Q.dotProductWithUp-oe.dotProductWithUp),J[0].corners}(a,c),p=a[d[0]],_=a[d[1]],v=a[d[2]],b=a[d[3]],C=o.getAtPointOrZero(new lo(p[0]/n.worldSize,p[1]/n.worldSize),0),M=o.getAtPointOrZero(new lo(_[0]/n.worldSize,_[1]/n.worldSize),0),I=o.getAtPointOrZero(new lo(v[0]/n.worldSize,v[1]/n.worldSize),0),R=o.getAtPointOrZero(new lo(b[0]/n.worldSize,b[1]/n.worldSize),0),L=(C+R)/2,F=(M+I)/2;return L>F?M<I?Yg(e,_,b,p,M,R,C,c):Yg(e,v,p,b,I,C,R,c):C<R?Yg(e,p,_,v,C,M,I,c):Yg(e,b,v,_,R,I,M,c),Math.max(L,F)}computeModelMatrix(n,e,o,a,c,d,p=!1){const _=n.transform,v=_.zoom,b=_.project(this.position),C=Gc(this.position.lat,v),M=1/C;f.m.identity(this.matrix),f.m.translate(this.matrix,this.matrix,[b.x+a[0]*M,b.y+a[1]*M,a[2]]);let I=1,R=1;const L=_.worldSize;if(p){if("mercator"===_.projection.name){let Y=0;_.elevation&&(Y=_.elevation.getAtPointOrZero(new lo(b.x/L,b.y/L),0));const J=f.e.transformMat4([],[b.x,b.y,Y,1],_.projMatrix)[3]/_.cameraToCenterDistance;I=J,R=J*Gc(_.center.lat,v)}else if("globe"===_.projection.name){const Y=am(this.matrix,_),J=f.m.multiply([],_.projMatrix,Y),Q=[0,0,0,1];f.e.transformMat4(Q,Q,J);const oe=Q[3]/_.cameraToCenterDistance,ae=Ma(v),me=_.projection.pixelsPerMeter(this.position.lat,L)*Gc(this.position.lat,v),_e=_.projection.pixelsPerMeter(_.center.lat,L)*Gc(_.center.lat,v);I=oe/mn(me,bx(_.center.lat),ae),R=oe*C/me,I*=_e,R*=_e}}else I=M;f.m.scale(this.matrix,this.matrix,[I,I,R]);const F=[...this.matrix],B=this.orientation,U=[];if(ei(U,[B[0]+e[0],B[1]+e[1],B[2]+e[2]],o),f.m.multiply(this.matrix,F,U),c&&_.elevation){let Y=0;const J=[];if(d&&_.elevation){Y=this._positionModelOnTerrain(_,J);const Q=f.m.fromQuat([],J),oe=f.m.multiply([],Q,U);f.m.multiply(this.matrix,F,oe)}else Y=_.elevation.getAtPointOrZero(new lo(b.x/L,b.y/L),0);0!==Y&&(this.matrix[14]+=Y)}}upload(n){if(!this.uploaded){for(const e of this.nodes)fv(e,n);for(const e of this.nodes)Kg(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)Qg(n)}},f.aR=er,f.aS=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.aT=tv,f.aU=Tx,f.aV=Do,f.aW=Zn,f.aX=Fg,f.aY=Og,f.aZ=Fv,f.a_=Fc,f.aa=Hp,f.ab=nf,f.ac=Xe,f.ad=re,f.ae=De,f.af=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return de(n.expression.evaluate(e))}interpolate(n,e,o){return{x:mn(n.x,e.x,o),y:mn(n.y,e.y,o),z:mn(n.z,e.z,o),azimuthal:mn(n.azimuthal,e.azimuthal,o),polar:mn(n.polar,e.polar,o)}}},f.ag=Ae,f.ah=n=>wa(Lm(n)),f.ai=np,f.aj=hh,f.ak=mr,f.al=pe,f.am=_d,f.an=Bs,f.ao=Ma,f.ap=n=>wa(Qf(n)),f.aq=Za,f.ar=Ge,f.as=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([o,a]){const c=de([1,o,a]);return{x:c.x,y:c.y,z:c.z}}(n.expression.evaluate(e))}interpolate(n,e,o){return{x:mn(n.x,e.x,o),y:mn(n.y,e.y,o),z:mn(n.z,e.z,o)}}},f.at=function(n,e,o=0,a=!0){const c=new ut(o,o),d=n.sub(c),p=e.add(c),_=[d,new ut(p.x,d.y),p,new ut(d.x,p.y)];return a&&_.push(d.clone()),_},f.au=function(n,e){const o=[];for(let a=0;a<n.length;a++){const c=fr(a-1,-1,n.length-1),d=fr(a+1,-1,n.length-1),p=n[a],_=n[d],v=n[c].sub(p).unit(),b=_.sub(p).unit(),C=b.angleWithSep(v.x,v.y),M=v.add(b).unit().mult(-1*e/Math.sin(C/2));o.push(p.add(M))}return o},f.av=zg,f.aw=Ix,f.ax=function(n,e,o=0){return f.v.fromValues(((e.x-o)*n.scale-n.x)*ct,(e.y*n.scale-n.y)*ct,xx(e.z,e.y))},f.ay=dv,f.az=function(n){let e=1/0,o=1/0,a=-1/0,c=-1/0;for(const d of n)e=Math.min(e,d.x),o=Math.min(o,d.y),a=Math.max(a,d.x),c=Math.max(c,d.y);return{min:new ut(e,o),max:new ut(a,c)}},f.b=Vo,f.b$=0,f.b0=gh,f.b1=dw,f.b2=Os,f.b3=function(n,e,o){const a=Math.sqrt(n*n+e*e+o*o),c=a>0?Math.acos(o/a)*Ns:0;let d=0!==n||0!==e?Math.atan2(-e,-n)*Ns+90:0;return d<0&&(d+=360),[a,d,c]},f.b4=Jc,f.b5=Bl,f.b6=cv,f.b7=W_,f.b8=class extends Su{constructor(n){super(n),this.current=fw}set(n,e,o){if(this.fetchUniformLocation(n,e))for(let a=0;a<9;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},f.b9=hw,f.bA=function(n,e){const o=[0,0,0],a=zd(ec(e.canonical));return f.v.transformMat4(o,o,a),f.v.transformMat4(o,o,n),o},f.bB=n=>({u_camera_to_center_distance:new Os(n),u_extrude_scale:new up(n),u_device_pixel_ratio:new Os(n),u_matrix:new Fc(n),u_inv_rot_matrix:new Fc(n),u_merc_center:new gh(n),u_tile_id:new W_(n),u_zoom_transition:new Os(n),u_up_dir:new W_(n),u_emissive_strength:new Os(n)}),f.bC=n=>({u_matrix:new Fc(n),u_pixels_to_tile_units:new up(n),u_device_pixel_ratio:new Os(n),u_units_to_pixels:new gh(n),u_dash_image:new Md(n),u_gradient_image:new Md(n),u_image_height:new Os(n),u_texsize:new gh(n),u_tile_units_to_pixels:new Os(n),u_alpha_discard_threshold:new Os(n),u_trim_offset:new gh(n),u_emissive_strength:new Os(n)}),f.bD=n=>({u_matrix:new Fc(n),u_texsize:new gh(n),u_pixels_to_tile_units:new up(n),u_device_pixel_ratio:new Os(n),u_image:new Md(n),u_units_to_pixels:new gh(n),u_tile_units_to_pixels:new Os(n),u_alpha_discard_threshold:new Os(n)}),f.bE=Qa,f.bF=fE,f.bG=Kx,f.bH=mg,f.bI=(n,e,o,a,c,d)=>{const p=n.transform,_="globe"===p.projection.name;let v;if("map"===d.paint.get("circle-pitch-alignment"))if(_){const C=wy(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;v=Float32Array.from([C,0,0,C])}else v=p.calculatePixelsToTileUnitsMatrix(o);else v=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const b={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(p.projection),u_matrix:n.translatePosMatrix(e.projMatrix,o,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ki.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:Iy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(_){b.u_inv_rot_matrix=a,b.u_merc_center=c,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=Ma(p.zoom);const C=c[0]*ct,M=c[1]*ct;b.u_up_dir=p.projection.upVector(new Mh(0,0,0),C,M)}return b},f.bJ=V1,f.bK=(n,e,o,a,c)=>{const d=n.transform;return{u_matrix:B1(n,e,o,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_image:0,u_tile_units_to_pixels:wf(e,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}},f.bL=(n,e,o,a,c,d,p)=>{const _=n.transform,v=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:B1(n,e,o,a),u_pixels_to_tile_units:v,u_device_pixel_ratio:d,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:j1(o)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:wf(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_emissive_strength:o.paint.get("line-emissive-strength")}},f.bM=Va,f.bN=gg,f.bO=k1,f.bP=Ow,f.bQ=pm,f.bR=Ra,f.bS=450,f.bT=7,f.bU=sg,f.bV=cg,f.bW=Ft,f.bX=kc,f.bY=fh,f.bZ=1,f.b_=771,f.ba=gc,f.bb=function(n,e,o){const a=Ma(o.zoom),c=n.style.map._antialias,d=e.options.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===a&&!c&&!d},f.bc=function(n){const e=n.pixelsPerMeter,o=e/Vo(1,n.center.lat),a=f.m.identity(new Float64Array(16));return f.m.translate(a,a,[n.point.x,n.point.y,0]),f.m.scale(a,a,[o,o,e]),Float32Array.from(a)},f.bd=ws,f.be=Dp,f.bf=function(n){const e=Ai-5;n=dn(n,-e,e)/e*90;const o=Math.pow(Math.abs(Math.sin(wt(n))),3);return Math.round(o*(yy.length-1))},f.bg=function(n,e,o,a){const c=e.getNorth(),d=e.getSouth(),p=e.getWest(),_=e.getEast(),v=1<<n.z,b=_-p,C=c-d,M=b/64,I=-C/yy[o],R=[0,M,0,I,0,0,c,p,0];if(n.z>0){const L=180/a;f.bx.multiply(R,R,[L/b+1,0,0,0,L/C+1,0,-.5*L/M,.5*L/I,1])}return R[2]=v,R[5]=n.x,R[8]=n.y,R},f.bh=zd,f.bi=ec,f.bj=function(n,e,o){const a=f.m.identity(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return f.m.rotateY(a,o.globeMatrix,c),Float32Array.from(a)},f.bk=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const o=e.getSource().maxzoom,a=1<<o,c=Math.floor(n.x),d=Math.floor((n.x-c)*a),p=Math.floor(n.y*a),_=this.findDEMTileFor(new no(o,c,o,d,p));return!(!_||!_.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,o=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const c=a.getSource().maxzoom,d=1<<c,p=Math.floor(n.x),_=n.x-p,v=new no(c,p,c,Math.floor(_*d),Math.floor(n.y*d)),b=this.findDEMTileFor(v);if(!b||!b.dem)return e;const C=b.dem,M=1<<b.tileID.canonical.z,I=(_*M-b.tileID.canonical.x)*C.dim,R=(n.y*M-b.tileID.canonical.y)*C.dim,L=Math.floor(I),F=Math.floor(R);return(o?this.exaggeration():1)*mn(mn(C.get(L,F),C.get(L,F+1),R-F),mn(C.get(L+1,F),C.get(L+1,F+1),R-F),I-L)}getAtTileOffset(n,e,o){const a=1<<n.canonical.z;return this.getAtPointOrZero(new lo(n.wrap+(n.canonical.x+e/ct)/a,(n.canonical.y+o/ct)/a))}getAtTileOffsetFunc(n,e,o,a){return c=>{const d=this.getAtTileOffset(n,c.x,c.y),p=a.upVector(n.canonical,c.x,c.y),_=a.upVectorScale(n.canonical,e,o).metersToTile;return f.v.scale(p,p,d*_),p}}getForTilePoints(n,e,o,a){if(this.isUsingMockSource())return!1;const c=ef.create(this,n,a);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],o)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const o=e.dem.tree,a=e.tileID,c=1<<n.canonical.z-a.canonical.z;let d=n.canonical.x/c-a.canonical.x,p=n.canonical.y/c-a.canonical.y,_=0;for(let v=0;v<n.canonical.z-a.canonical.z&&!o.leaves[_];v++){d*=2,p*=2;const b=2*Math.floor(p)+Math.floor(d);_=o.childOffsets[_]+b,d%=1,p%=1}return{min:this.exaggeration()*o.minimums[_],max:this.exaggeration()*o.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,o){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(0===n.length)return null;let e=!1,o=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const c of n){const d=this.getMinMaxForTile(c.tileID);d&&(o=Math.min(o,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:o,max:a}:null}},f.bl=Ld,f.bm=Ur,f.bn=Cp,f.bo=ke,f.bp=qn,f.bq=ju,f.br=qu,f.bs=d_,f.bt=df,f.bu=Rx,f.bv=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},f.bw=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},f.by=wy,f.bz=256,f.c=dn,f.c$=en,f.c0=rp,f.c1=function(n,e,o,a,c){return dn((n-e)/(o-e)*(c-a)+a,a,c)},f.c2=Ss,f.c3=hi,f.c4=Gc,f.c5=am,f.c6=[1,1,1],f.c7=ef,f.c8=Jg,f.c9=No,f.cA=$l,f.cB=n=>wa(Kf(n)),f.cC=K,f.cD=ys,f.cE=la,f.cF=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},f.cG=rs,f.cH=wx,f.cI=Nd,f.cJ=function([n,e,o]){const a=Math.hypot(n,e,o),c=Math.atan2(n,o),d=.5*Math.PI-Math.acos(-e/a);return new hr(Yi(c),Yi(d))},f.cK=To,f.cL=Uc,f.cM=vn,f.cN=Ap,f.cO=Ey,f.cP=function(n){const e=[0,0,0],o=f.m.identity(new Float64Array(16));return f.m.multiply(o,n.pixelMatrix,n.globeMatrix),f.v.transformMat4(e,e,o),new ut(e[0],e[1])},f.cQ=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(o){if(null==Ke){const a=o.navigator?o.navigator.userAgent:null;Ke=!!o.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ke}(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.cR=ci,f.cS=class{constructor(n,e,o){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let o=0;o<10;o++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ba,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!lt(n))return n;const o=dt(n);return o.params.push(`sdk=js-${en}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!lt(n))return n;const o=dt(n);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeModelURL(n,e){if(!lt(n))return n;const o=dt(n);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeSourceURL(n,e,o,a){if(!lt(n))return n;const c=dt(n);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),o&&c.params.push(`language=${o}`),a&&c.params.push(`worldview=${a}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(n,e,o,a){const c=dt(n);return lt(n)?(c.path=`/styles/v1${c.path}/sprite${e}${o}`,this._makeAPIURL(c,this._customAccessToken||a)):(c.path+=`${e}${o}`,tn(c))}normalizeTileURL(n,e,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!lt(n))return n;const a=dt(n);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||o&&"raster"!==a.authority&&512===o?"@2x":""}${bi.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${vn.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${vn.TILE_URL_VERSION}${a.path}`);const c=this._customAccessToken||function(d){for(const p of d){const _=p.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(a.params)||vn.ACCESS_TOKEN;return vn.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,c)}canonicalizeTileURL(n,e){const o=dt(n);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return n;let a="mapbox://";o.path.match(/^\/raster\/v1\//)?a+=`raster/${o.path.replace(`/${vn.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${o.path.replace(`/${vn.TILE_URL_VERSION}/`,"")}`;let c=o.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(a+=`?${c.join("&")}`),a}canonicalizeTileset(n,e){const o=!!e&&lt(e),a=[];for(const c of n.tiles||[])ht(c)?a.push(this.canonicalizeTileURL(c,o)):a.push(c);return a}_makeAPIURL(n,e){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=dt(vn.API_URL);if(n.protocol=a.protocol,n.authority=a.authority,"http"===n.protocol){const c=n.params.indexOf("secure");c>=0&&n.params.splice(c,1)}if("/"!==a.path&&(n.path=`${a.path}${n.path}`),!vn.REQUIRE_ACCESS_TOKEN)return tn(n);if(e=e||vn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return n.params=n.params.filter(c=>-1===c.indexOf("access_token")),n.params.push(`access_token=${e||""}`),tn(n)}},f.cT=function(n,e){e?yi.add(n):yi.delete(n)},f.cU=bi,f.cV=Ho,f.cW=so,f.cX=it,f.cY=Li,f.cZ=function(n){yi.delete(n)},f.c_=uo,f.ca=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n){const e=Pa(new ut(0,0),new ut(ct,ct),n),o=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!dm(e,a))continue;const c=cc(a.min,a.max,n);o.push({min:c.min,max:c.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return o}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const o=[];for(const a of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(a).buckets[e.layer];if(c)for(const d of c.getNodesInfo()){const p=d.node;p.footprint&&o.push({footprint:p.footprint,id:a.toUnwrapped()})}}return o}})))}_addSource(n){const e=n.getFootprints();if(0!==e.length){for(const o of e){if(!o.footprint)continue;const a=Pa(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint})}this._sourceIds.push(n.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,o)=>e.priority-o.priority||So(e.min,o.min)||So(e.max,o.max));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0,o=0;for(;!n&&e!==this._activeRegions.length;){const a=this._activeRegions[e],c=this._prevRegions[o];n=a.priority!==c.priority||!$u(a,c),++e,++o}}if(n){++this._updateTime;const e=o=>{const a=this._activeRegions;if(o>=a.length)return o;const c=a[o].priority;for(;o<a.length&&a[o].priority===c;)++o;return o};if(this._sourceIds.length>1){let o=0,a=e(o);for(;o!==a;){let c=o;const d=o;for(;c!==a;){const p=this._activeRegions[c];p.hiddenByOverlap=!1;for(let _=0;_<d;_++){const v=this._activeRegions[_];if(!v.hiddenByOverlap&&dm(p,v)&&(p.hiddenByOverlap=Xh(p.footprint,p.tileId,v.footprint,v.tileId),p.hiddenByOverlap))break}++c}o=a,a=e(o)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},f.cb=ar,f.cc=rm,f.cd=Cd,f.ce=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const o=new ke,a=new qn,c=[],d=n+1+2,p=e[0]+1,_=e[0]+1+(1+e.length),v=(b,C,M)=>{let I=b===d-1?b-2:0===b?b:b-1;return I+=M?24575:0,[I,C]};for(let b=0;b<d;++b)o.emplaceBack(...v(b,0,!0));for(let b=0;b<p;++b)for(let C=0;C<d;++C)o.emplaceBack(...v(C,b,(0===C||C===d-1)&&!0));for(let b=0;b<e.length;++b){const C=e[b];for(let M=0;M<d;++M)o.emplaceBack(...v(M,C,!0))}for(let b=0;b<e.length;++b){const C=a.length,M=e[b]+1+2,I=new qn;for(let F=0;F<M-1;F++){const B=F===M-2,U=B?d*(_-e.length+b-F):d;for(let Y=0;Y<d-1;Y++){const J=F*d+Y;0===F||B||0===Y||Y===d-2?(I.emplaceBack(J+1,J,J+U),I.emplaceBack(J+U,J+U+1,J+1)):(a.emplaceBack(J+1,J,J+U),a.emplaceBack(J+U,J+U+1,J+1))}}const R=Ur.simpleSegment(0,C,o.length,a.length-C);for(let F=0;F<I.uint16.length;F+=3)a.emplaceBack(I.uint16[F],I.uint16[F+1],I.uint16[F+2]);const L=Ur.simpleSegment(0,C,o.length,a.length-C);c.push({withoutSkirts:R,withSkirts:L})}return{vertices:o,indices:a,segments:c}}_createGrid(n){const e=this._fillGridMeshWithLods(64,yy);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Ld.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new qn;for(let p=0;p<=64;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const o=new fh,a=new fh,c=new fh,d=new fh;this._poleSegments=[];for(let p=0,_=0;p<ig;p++){const v=360/(1<<p);o.emplaceBack(0,-fs,0,.5,0),a.emplaceBack(0,-fs,0,.5,1),c.emplaceBack(0,-fs,0,.5,.5),d.emplaceBack(0,-fs,0,.5,.5);for(let b=0;b<=64;b++){let C=b/64,M=0;const I=mn(0,v,C),[R,L,F]=Fd(vx,Cy,I,fs);o.emplaceBack(R,L,F,C,M),a.emplaceBack(R,L,F,C,1-M);const B=wt(I);C=.5+.5*Math.sin(B),M=.5+.5*Math.cos(B),c.emplaceBack(R,L,F,C,M),d.emplaceBack(R,L,F,C,1-M)}this._poleSegments.push(Ur.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(o,wp,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,wp,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(c,wp,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(d,wp,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},f.cf=function(n){return yi.has(n)},f.cg=Hc,f.ch=de,f.ci=function(n){return n({pluginStatus:Z,pluginURL:ee}),K.on("pluginStateChange",n),n},f.cj=Vh,f.ck=rv,f.cl=_o,f.cm=se,f.cn=lt,f.co=_s,f.cp=function(n,e,o){return"custom"===n.type?new BE(n,e):new jE[n.type](n,e,o)},f.cq=function(n){const e=n.indexOf("\x1f");return e>=0?n.slice(0,e):n},f.cr=n=>wa(G_(n)),f.cs=n=>wa(Lc(n)),f.ct=n=>wa(km(n)),f.cu=function(n){return n.indexOf("\x1f")>=0},f.cv=function(n){const e=n.indexOf("\x1f");return e>=0?n.slice(e+1):""},f.cw=md,f.cx=function(n){const e=[],o=n.id;return void 0===o&&e.push({message:`layers.${o}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${o}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},f.cy=n=>wa(Yf(n)),f.cz=n=>wa(bd(n)),f.d=wt,f.d0=function(n,e){nn=n,tr=e},f.d1=function(n,e,o=!1){if(Z===G||Z===W||Z===X)throw new Error("setRTLTextPlugin cannot be called multiple times.");ee=ki.resolveURL(n),Z=G,q=e,ue(),o||he()},f.d2=ie,f.d3=function(){d_().acquire(_m)},f.d4=function(){const n=Ef;n&&(n.isPreloaded()&&1===n.numActive()?(n.release(_m),Ef=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.d5=Jh,f.d6=function(n){const e=gr();if(!e)return;const o=e.delete(Kt);n&&o.catch(n).then(()=>n())},f.d7=gm,f.d8=Mv,f.d9=function(n){Tv=ki.resolveURL(n),Kh||(Kh=new qu(d_(),new ho)),Kh.broadcast("setDracoUrl",Tv)},f.da=ca,f.db=Ig,f.dc=yr,f.dd=Hd,f.de=Vp,f.df=aa,f.dg=Lh,f.dh=class extends ho{constructor(n,e,o,a,c,d){super(),this.actor=n,this.layerIndex=e,this.availableImages=o,this.loadVectorData=c||q1,this.loading={},this.loaded={},this.deduped=new Cv(n.scheduler),this.isSpriteLoaded=a,this.scheduler=n.scheduler,this.brightness=d}loadTile(n,e){const o=n.uid,a=n&&n.request,c=a&&a.collectResourceTiming,d=this.loading[o]=new uc(n);d.abort=this.loadVectorData(n,(p,_)=>{const v=!this.loading[o];if(delete this.loading[o],v||p||!_)return d.status="done",v||(this.loaded[o]=d),e(p);const b=_.rawData,C={};_.expires&&(C.expires=_.expires),_.cacheControl&&(C.cacheControl=_.cacheControl),d.vectorTile=_.vectorTile||new zu(new Qd(b));const M=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(I,R)=>{if(I||!R)return e(I);const L={};if(c){const F=ja(a);F.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(F)))}e(null,mr({rawTileData:b.slice(0)},R,C,L))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[o]=d})}reloadTile(n,e){const o=this.loaded,a=n.uid,c=this;if(o&&o[a]){const d=o[a];d.showCollisionBoxes=n.showCollisionBoxes,d.projection=n.projection,d.brightness=n.brightness,d.tileTransform=ic(n.tileID.canonical,n.projection),d.extraShadowCaster=n.extraShadowCaster;const p=(_,v)=>{const b=d.reloadCallback;b&&(delete d.reloadCallback,d.parse(d.vectorTile,c.layerIndex,this.availableImages,c.actor,b)),e(_,v)};"parsing"===d.status?d.reloadCallback=p:"done"===d.status&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}else e(null,void 0)}abortTile(n,e){const o=n.uid,a=this.loading[o];a&&(a.abort&&a.abort(),delete this.loading[o]),e()}removeTile(n,e){const o=this.loaded,a=n.uid;o&&o[a]&&delete o[a],e()}},f.di=ja,f.dj=di,f.dk=Fh,f.dl=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==W1){const o=new Uint32Array(n,0,7),[,,a,c,d,p]=o;e=o.byteLength+c+d+p+d,(a!==n.byteLength||e>=n.byteLength)&&Rr("Invalid b3dm header information.")}return Rv(n,e)},f.dm=function(n,e){const o=K1(n);for(const a of o){for(const c of a.meshes)kv(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(Qh(a.lights,e)))}return o},f.dn=t_,f.dp=G1,f.dq=ge,f.dr=function(n){Jn(),vr&&vr.then(e=>{e.keys().then(o=>{for(let a=0;a<o.length-n;a++)e.delete(o[a])})})},f.f=function(n,e){const{x:o,y:a}=n.point,c=Ip(o,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return f.m.multiply(c,c,cg(ec(e)))},f.g=Ot,f.i=jo,f.j=Gp,f.k=Hg,f.l=Mo,f.n=mn,f.o=p1,f.p=function(n,e){const o={};for(let a=0;a<e.length;a++){const c=e[a];c in n&&(o[c]=n[c])}return o},f.r=C1,f.s=function(n,e,o){n[4*e+0]=o[0],n[4*e+1]=o[1],n[4*e+2]=o[2],n[4*e+3]=o[3]},f.t=Mh,f.u=function(n,e,o,a,c){const d=5*e+2;n.float32[d+0]=o,n.float32[d+1]=a,n.float32[d+2]=c},f.w=fr,f.x=Lu,f.y=function(n,e,o,a,c,d,p,_,v){if("globe"===v.name)return Lu(n,e,new Mh(o,a,c),!1);const b=ic({z:o,x:a,y:c},v);return new hi([(d+b.x/b.scale)*e,e*(b.y/b.scale),p],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),_])},f.z=function(n,e,o){let a=0;for(let c=0;c<2;++c){const d=o?o[c]:0;n[c]>d&&(a+=(n[c]-d)*(n[c]-d)),e[c]<d&&(a+=(d-e[c])*(d-e[c]))}return a}}),mc(0,function(f){function en(qe){if("number"==typeof qe||"boolean"==typeof qe||"string"==typeof qe||null==qe)return JSON.stringify(qe);if(Array.isArray(qe)){let de="[";for(const Ce of qe)de+=`${en(Ce)},`;return`${de}]`}let le="{";for(const de of Object.keys(qe).sort())le+=`${de}:${en(qe[de])},`;return`${le}}`}function ts(qe){let le="";for(const de of f.aS)le+=`/${en(qe[de])}`;return le}class vn{constructor(le){this.keyCache={},this._layers={},this._layerConfigs={},le&&this.replace(le)}replace(le,de){this._layerConfigs={},this._layers={},this.update(le,[],de)}update(le,de,Ce){this._options=Ce;for(const Ke of le)this._layerConfigs[Ke.id]=Ke,(this._layers[Ke.id]=f.cp(Ke,this.scope,this._options)).compileFilter(),this.keyCache[Ke.id]&&delete this.keyCache[Ke.id];for(const Ke of de)delete this.keyCache[Ke],delete this._layerConfigs[Ke],delete this._layers[Ke];this.familiesBySource={};const Ye=function(Ke,Ct){const Ot={};for(let $t=0;$t<Ke.length;$t++){const Kt=Ct&&Ct[Ke[$t].id]||ts(Ke[$t]);Ct&&(Ct[Ke[$t].id]=Kt);let nn=Ot[Kt];nn||(nn=Ot[Kt]=[]),nn.push(Ke[$t])}const Qe=[];for(const $t in Ot)Qe.push(Ot[$t]);return Qe}(f.da(this._layerConfigs),this.keyCache);for(const Ke of Ye){const Ct=Ke.map(tr=>this._layers[tr.id]),Ot=Ct[0];if("none"===Ot.visibility)continue;const Qe=Ot.source||"";let $t=this.familiesBySource[Qe];$t||($t=this.familiesBySource[Qe]={});const Kt=Ot.sourceLayer||"_geojsonTileLayer";let nn=$t[Kt];nn||(nn=$t[Kt]=[]),nn.push(Ct)}}}class bi{loadTile(le,de){const{uid:Ce,encoding:Ye,rawImageData:Ke,padding:Ct}=le,Ot=ImageBitmap&&Ke instanceof ImageBitmap?this.getImageData(Ke,Ct):Ke;de(null,new f.db(Ce,Ot,Ye,Ct<1))}getImageData(le,de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(le.width,le.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=le.width,this.offscreenCanvas.height=le.height,this.offscreenCanvasContext.drawImage(le,0,0,le.width,le.height);const Ce=this.offscreenCanvasContext.getImageData(-de,-de,le.width+2*de,le.height+2*de);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ce}}function hn(qe,le){if(0!==qe.length){Un(qe[0],le);for(var de=1;de<qe.length;de++)Un(qe[de],!le)}}function Un(qe,le){for(var de=0,Ce=0,Ye=0,Ke=qe.length,Ct=Ke-1;Ye<Ke;Ct=Ye++){var Ot=(qe[Ye][0]-qe[Ct][0])*(qe[Ct][1]+qe[Ye][1]),Qe=de+Ot;Ce+=Math.abs(de)>=Math.abs(Ot)?de-Qe+Ot:Ot-Qe+de,de=Qe}de+Ce>=0!=!!le&&qe.reverse()}var ti=f.dc(function qe(le,de){var Ce,Ye=le&&le.type;if("FeatureCollection"===Ye)for(Ce=0;Ce<le.features.length;Ce++)qe(le.features[Ce],de);else if("GeometryCollection"===Ye)for(Ce=0;Ce<le.geometries.length;Ce++)qe(le.geometries[Ce],de);else if("Feature"===Ye)qe(le.geometry,de);else if("Polygon"===Ye)hn(le.coordinates,de);else if("MultiPolygon"===Ye)for(Ce=0;Ce<le.coordinates.length;Ce++)hn(le.coordinates[Ce],de);return le});const on=f.dd.prototype.toGeoJSON;var Ln={exports:{}},io=f.df,Ba=f.de.VectorTileFeature,yr=Cr;function Cr(qe,le){this.options=le||{},this.features=qe,this.length=qe.length}function go(qe,le){this.id="number"==typeof qe.id?qe.id:void 0,this.type=qe.type,this.rawGeometry=1===qe.type?[qe.geometry]:qe.geometry,this.properties=qe.tags,this.extent=le||4096}Cr.prototype.feature=function(qe){return new go(this.features[qe],this.options.extent)},go.prototype.loadGeometry=function(){var qe=this.rawGeometry;this.geometry=[];for(var le=0;le<qe.length;le++){for(var de=qe[le],Ce=[],Ye=0;Ye<de.length;Ye++)Ce.push(new io(de[Ye][0],de[Ye][1]));this.geometry.push(Ce)}return this.geometry},go.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var qe=this.geometry,le=1/0,de=-1/0,Ce=1/0,Ye=-1/0,Ke=0;Ke<qe.length;Ke++)for(var Ct=qe[Ke],Ot=0;Ot<Ct.length;Ot++){var Qe=Ct[Ot];le=Math.min(le,Qe.x),de=Math.max(de,Qe.x),Ce=Math.min(Ce,Qe.y),Ye=Math.max(Ye,Qe.y)}return[le,Ce,de,Ye]},go.prototype.toGeoJSON=Ba.prototype.toGeoJSON;var sa=f.dg,aa=yr;function ns(qe){var le=new sa;return function(de,Ce){for(var Ye in de.layers)Ce.writeMessage(3,ut,de.layers[Ye])}(qe,le),le.finish()}function ut(qe,le){var de;le.writeVarintField(15,qe.version||1),le.writeStringField(1,qe.name||""),le.writeVarintField(5,qe.extent||4096);var Ce={keys:[],values:[],keycache:{},valuecache:{}};for(de=0;de<qe.length;de++)Ce.feature=qe.feature(de),le.writeMessage(2,su,Ce);var Ye=Ce.keys;for(de=0;de<Ye.length;de++)le.writeStringField(3,Ye[de]);var Ke=Ce.values;for(de=0;de<Ke.length;de++)le.writeMessage(4,gc,Ke[de])}function su(qe,le){var de=qe.feature;void 0!==de.id&&le.writeVarintField(1,de.id),le.writeMessage(2,Ns,qe),le.writeVarintField(3,de.type),le.writeMessage(4,zs,de)}function Ns(qe,le){var de=qe.feature,Ce=qe.keys,Ye=qe.values,Ke=qe.keycache,Ct=qe.valuecache;for(var Ot in de.properties){var Qe=de.properties[Ot],$t=Ke[Ot];if(null!==Qe){void 0===$t&&(Ce.push(Ot),Ke[Ot]=$t=Ce.length-1),le.writeVarint($t);var Kt=typeof Qe;"string"!==Kt&&"boolean"!==Kt&&"number"!==Kt&&(Qe=JSON.stringify(Qe));var nn=Kt+":"+Qe,tr=Ct[nn];void 0===tr&&(Ye.push(Qe),Ct[nn]=tr=Ye.length-1),le.writeVarint(tr)}}}function wt(qe,le){return(le<<3)+(7&qe)}function Yi(qe){return qe<<1^qe>>31}function zs(qe,le){for(var de=qe.loadGeometry(),Ce=qe.type,Ye=0,Ke=0,Ct=de.length,Ot=0;Ot<Ct;Ot++){var Qe=de[Ot],$t=1;1===Ce&&($t=Qe.length),le.writeVarint(wt(1,$t));for(var Kt=3===Ce?Qe.length-1:Qe.length,nn=0;nn<Kt;nn++){1===nn&&1!==Ce&&le.writeVarint(wt(2,Kt-1));var tr=Qe[nn].x-Ye,vr=Qe[nn].y-Ke;le.writeVarint(Yi(tr)),le.writeVarint(Yi(vr)),Ye+=tr,Ke+=vr}3===Ce&&le.writeVarint(wt(7,1))}}function gc(qe,le){var de=typeof qe;"string"===de?le.writeStringField(1,qe):"boolean"===de?le.writeBooleanField(7,qe):"number"===de&&(qe%1!=0?le.writeDoubleField(3,qe):qe<0?le.writeSVarintField(6,qe):le.writeVarintField(5,qe))}Ln.exports=ns,Ln.exports.fromVectorTileJs=ns,Ln.exports.fromGeojsonVt=function(qe,le){le=le||{};var de={};for(var Ce in qe)de[Ce]=new aa(qe[Ce].features,le),de[Ce].name=Ce,de[Ce].version=le.version,de[Ce].extent=le.extent;return ns({layers:de})},Ln.exports.GeoJSONWrapper=aa;var la=f.dc(Ln.exports);const rs={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:qe=>qe},dn=Math.fround||(Bs=new Float32Array(1),qe=>(Bs[0]=+qe,Bs[0]));var Bs;const fr=3,uo=5,ca=6;class mr{constructor(le){this.options=Object.assign(Object.create(rs),le),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(le){const{log:de,minZoom:Ce,maxZoom:Ye}=this.options;de&&console.time("total time");const Ke=`prepare ${le.length} points`;de&&console.time(Ke),this.points=le;const Ct=[];for(let Qe=0;Qe<le.length;Qe++){const $t=le[Qe];if(!$t.geometry)continue;const[Kt,nn]=$t.geometry.coordinates,tr=dn(Ui(Kt)),vr=dn(Va(nn));Ct.push(tr,vr,1/0,Qe,-1,1),this.options.reduce&&Ct.push(0)}let Ot=this.trees[Ye+1]=this._createTree(Ct);de&&console.timeEnd(Ke);for(let Qe=Ye;Qe>=Ce;Qe--){const $t=+Date.now();Ot=this.trees[Qe]=this._createTree(this._cluster(Ot,Qe)),de&&console.log("z%d: %d clusters in %dms",Qe,Ot.numItems,+Date.now()-$t)}return de&&console.timeEnd("total time"),this}getClusters(le,de){let Ce=((le[0]+180)%360+360)%360-180;const Ye=Math.max(-90,Math.min(90,le[1]));let Ke=180===le[2]?180:((le[2]+180)%360+360)%360-180;const Ct=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)Ce=-180,Ke=180;else if(Ce>Ke){const nn=this.getClusters([Ce,Ye,180,Ct],de),tr=this.getClusters([-180,Ye,Ke,Ct],de);return nn.concat(tr)}const Ot=this.trees[this._limitZoom(de)],Qe=Ot.range(Ui(Ce),Va(Ct),Ui(Ke),Va(Ye)),$t=Ot.data,Kt=[];for(const nn of Qe){const tr=this.stride*nn;Kt.push($t[tr+uo]>1?Vs($t,tr,this.clusterProps):this.points[$t[tr+fr]])}return Kt}getChildren(le){const de=this._getOriginId(le),Ce=this._getOriginZoom(le),Ye="No cluster with the specified id.",Ke=this.trees[Ce];if(!Ke)throw new Error(Ye);const Ct=Ke.data;if(de*this.stride>=Ct.length)throw new Error(Ye);const Ot=this.options.radius/(this.options.extent*Math.pow(2,Ce-1)),Qe=Ke.within(Ct[de*this.stride],Ct[de*this.stride+1],Ot),$t=[];for(const Kt of Qe){const nn=Kt*this.stride;Ct[nn+4]===le&&$t.push(Ct[nn+uo]>1?Vs(Ct,nn,this.clusterProps):this.points[Ct[nn+fr]])}if(0===$t.length)throw new Error(Ye);return $t}getLeaves(le,de,Ce){const Ye=[];return this._appendLeaves(Ye,le,de=de||10,Ce=Ce||0,0),Ye}getTile(le,de,Ce){const Ye=this.trees[this._limitZoom(le)],Ke=Math.pow(2,le),{extent:Ct,radius:Ot}=this.options,Qe=Ot/Ct,$t=(Ce-Qe)/Ke,Kt=(Ce+1+Qe)/Ke,nn={features:[]};return this._addTileFeatures(Ye.range((de-Qe)/Ke,$t,(de+1+Qe)/Ke,Kt),Ye.data,de,Ce,Ke,nn),0===de&&this._addTileFeatures(Ye.range(1-Qe/Ke,$t,1,Kt),Ye.data,Ke,Ce,Ke,nn),de===Ke-1&&this._addTileFeatures(Ye.range(0,$t,Qe/Ke,Kt),Ye.data,-1,Ce,Ke,nn),nn.features.length?nn:null}getClusterExpansionZoom(le){let de=this._getOriginZoom(le)-1;for(;de<=this.options.maxZoom;){const Ce=this.getChildren(le);if(de++,1!==Ce.length)break;le=Ce[0].properties.cluster_id}return de}_appendLeaves(le,de,Ce,Ye,Ke){const Ct=this.getChildren(de);for(const Ot of Ct){const Qe=Ot.properties;if(Qe&&Qe.cluster?Ke+Qe.point_count<=Ye?Ke+=Qe.point_count:Ke=this._appendLeaves(le,Qe.cluster_id,Ce,Ye,Ke):Ke<Ye?Ke++:le.push(Ot),le.length===Ce)break}return Ke}_createTree(le){const de=new f.aZ(le.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ce=0;Ce<le.length;Ce+=this.stride)de.add(le[Ce],le[Ce+1]);return de.finish(),de.data=le,de}_addTileFeatures(le,de,Ce,Ye,Ke,Ct){for(const Ot of le){const Qe=Ot*this.stride,$t=de[Qe+uo]>1;let Kt,nn,tr;if($t)Kt=ci(de,Qe,this.clusterProps),nn=de[Qe],tr=de[Qe+1];else{const gr=this.points[de[Qe+fr]];Kt=gr.properties;const[Jn,nr]=gr.geometry.coordinates;nn=Ui(Jn),tr=Va(nr)}const vr={type:1,geometry:[[Math.round(this.options.extent*(nn*Ke-Ce)),Math.round(this.options.extent*(tr*Ke-Ye))]],tags:Kt};let qr;qr=$t||this.options.generateId?de[Qe+fr]:this.points[de[Qe+fr]].id,void 0!==qr&&(vr.id=qr),Ct.features.push(vr)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(Math.floor(+le),this.options.maxZoom+1))}_cluster(le,de){const{radius:Ce,extent:Ye,reduce:Ke,minPoints:Ct}=this.options,Ot=Ce/(Ye*Math.pow(2,de)),Qe=le.data,$t=[],Kt=this.stride;for(let nn=0;nn<Qe.length;nn+=Kt){if(Qe[nn+2]<=de)continue;Qe[nn+2]=de;const tr=Qe[nn],vr=Qe[nn+1],qr=le.within(Qe[nn],Qe[nn+1],Ot),gr=Qe[nn+uo];let Jn=gr;for(const nr of qr){const $i=nr*Kt;Qe[$i+2]>de&&(Jn+=Qe[$i+uo])}if(Jn>gr&&Jn>=Ct){let nr,$i=tr*gr,Gi=vr*gr,oo=-1;const _o=((nn/Kt|0)<<5)+(de+1)+this.points.length;for(const ys of qr){const di=ys*Kt;if(Qe[di+2]<=de)continue;Qe[di+2]=de;const Us=Qe[di+uo];$i+=Qe[di]*Us,Gi+=Qe[di+1]*Us,Qe[di+4]=_o,Ke&&(nr||(nr=this._map(Qe,nn,!0),oo=this.clusterProps.length,this.clusterProps.push(nr)),Ke(nr,this._map(Qe,di)))}Qe[nn+4]=_o,$t.push($i/Jn,Gi/Jn,1/0,_o,-1,Jn),Ke&&$t.push(oo)}else{for(let nr=0;nr<Kt;nr++)$t.push(Qe[nn+nr]);if(Jn>1)for(const nr of qr){const $i=nr*Kt;if(!(Qe[$i+2]<=de)){Qe[$i+2]=de;for(let Gi=0;Gi<Kt;Gi++)$t.push(Qe[$i+Gi])}}}}return $t}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,de,Ce){if(le[de+uo]>1){const Ct=this.clusterProps[le[de+ca]];return Ce?Object.assign({},Ct):Ct}const Ye=this.points[le[de+fr]].properties,Ke=this.options.map(Ye);return Ce&&Ke===Ye?Object.assign({},Ke):Ke}}function Vs(qe,le,de){return{type:"Feature",id:qe[le+fr],properties:ci(qe,le,de),geometry:{type:"Point",coordinates:[(Ce=qe[le],360*(Ce-.5)),ni(qe[le+1])]}};var Ce}function ci(qe,le,de){const Ce=qe[le+uo],Ye=Ce>=1e4?`${Math.round(Ce/1e3)}k`:Ce>=1e3?Math.round(Ce/100)/10+"k":Ce,Ke=qe[le+ca],Ct=-1===Ke?{}:Object.assign({},de[Ke]);return Object.assign(Ct,{cluster:!0,cluster_id:qe[le+fr],point_count:Ce,point_count_abbreviated:Ye})}function Ui(qe){return qe/360+.5}function Va(qe){const le=Math.sin(qe*Math.PI/180),de=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return de<0?0:de>1?1:de}function ni(qe){const le=(180-360*qe)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}var er={exports:{}};er.exports=function(){function qe(Be,Ze,it,lt){for(var ht,yt=lt,gt=it-Ze>>1,pt=it-Ze,Tt=Be[Ze],dt=Be[Ze+1],tn=Be[it],Wn=Be[it+1],Ut=Ze+3;Ut<it;Ut+=3){var Xn=le(Be[Ut],Be[Ut+1],Tt,dt,tn,Wn);if(Xn>yt)ht=Ut,yt=Xn;else if(Xn===yt){var Vn=Math.abs(Ut-gt);Vn<pt&&(ht=Ut,pt=Vn)}}yt>lt&&(ht-Ze>3&&qe(Be,Ze,ht,lt),Be[ht+2]=yt,it-ht>3&&qe(Be,ht,it,lt))}function le(Be,Ze,it,lt,ht,yt){var gt=ht-it,pt=yt-lt;if(0!==gt||0!==pt){var Tt=((Be-it)*gt+(Ze-lt)*pt)/(gt*gt+pt*pt);Tt>1?(it=ht,lt=yt):Tt>0&&(it+=gt*Tt,lt+=pt*Tt)}return(gt=Be-it)*gt+(pt=Ze-lt)*pt}function de(Be,Ze,it,lt){var ht={id:void 0===Be?null:Be,type:Ze,geometry:it,tags:lt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(yt){var gt=yt.geometry,pt=yt.type;if("Point"===pt||"MultiPoint"===pt||"LineString"===pt)Ce(yt,gt);else if("Polygon"===pt||"MultiLineString"===pt)for(var Tt=0;Tt<gt.length;Tt++)Ce(yt,gt[Tt]);else if("MultiPolygon"===pt)for(Tt=0;Tt<gt.length;Tt++)for(var dt=0;dt<gt[Tt].length;dt++)Ce(yt,gt[Tt][dt])}(ht),ht}function Ce(Be,Ze){for(var it=0;it<Ze.length;it+=3)Be.minX=Math.min(Be.minX,Ze[it]),Be.minY=Math.min(Be.minY,Ze[it+1]),Be.maxX=Math.max(Be.maxX,Ze[it]),Be.maxY=Math.max(Be.maxY,Ze[it+1])}function Ye(Be,Ze,it,lt){if(Ze.geometry){var ht=Ze.geometry.coordinates,yt=Ze.geometry.type,gt=Math.pow(it.tolerance/((1<<it.maxZoom)*it.extent),2),pt=[],Tt=Ze.id;if(it.promoteId?Tt=Ze.properties[it.promoteId]:it.generateId&&(Tt=lt||0),"Point"===yt)Ke(ht,pt);else if("MultiPoint"===yt)for(var dt=0;dt<ht.length;dt++)Ke(ht[dt],pt);else if("LineString"===yt)Ct(ht,pt,gt,!1);else if("MultiLineString"===yt){if(it.lineMetrics){for(dt=0;dt<ht.length;dt++)Ct(ht[dt],pt=[],gt,!1),Be.push(de(Tt,"LineString",pt,Ze.properties));return}Ot(ht,pt,gt,!1)}else if("Polygon"===yt)Ot(ht,pt,gt,!0);else{if("MultiPolygon"!==yt){if("GeometryCollection"===yt){for(dt=0;dt<Ze.geometry.geometries.length;dt++)Ye(Be,{id:Tt,geometry:Ze.geometry.geometries[dt],properties:Ze.properties},it,lt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(dt=0;dt<ht.length;dt++){var tn=[];Ot(ht[dt],tn,gt,!0),pt.push(tn)}}Be.push(de(Tt,yt,pt,Ze.properties))}}function Ke(Be,Ze){Ze.push(Qe(Be[0])),Ze.push($t(Be[1])),Ze.push(0)}function Ct(Be,Ze,it,lt){for(var ht,yt,gt=0,pt=0;pt<Be.length;pt++){var Tt=Qe(Be[pt][0]),dt=$t(Be[pt][1]);Ze.push(Tt),Ze.push(dt),Ze.push(0),pt>0&&(gt+=lt?(ht*dt-Tt*yt)/2:Math.sqrt(Math.pow(Tt-ht,2)+Math.pow(dt-yt,2))),ht=Tt,yt=dt}var tn=Ze.length-3;Ze[2]=1,qe(Ze,0,tn,it),Ze[tn+2]=1,Ze.size=Math.abs(gt),Ze.start=0,Ze.end=Ze.size}function Ot(Be,Ze,it,lt){for(var ht=0;ht<Be.length;ht++){var yt=[];Ct(Be[ht],yt,it,lt),Ze.push(yt)}}function Qe(Be){return Be/360+.5}function $t(Be){var Ze=Math.sin(Be*Math.PI/180),it=.5-.25*Math.log((1+Ze)/(1-Ze))/Math.PI;return it<0?0:it>1?1:it}function Kt(Be,Ze,it,lt,ht,yt,gt,pt){if(lt/=Ze,yt>=(it/=Ze)&&gt<lt)return Be;if(gt<it||yt>=lt)return null;for(var Tt=[],dt=0;dt<Be.length;dt++){var tn=Be[dt],Wn=tn.geometry,Ut=tn.type,Xn=0===ht?tn.minX:tn.minY,Vn=0===ht?tn.maxX:tn.maxY;if(Xn>=it&&Vn<lt)Tt.push(tn);else if(!(Vn<it||Xn>=lt)){var Zr=[];if("Point"===Ut||"MultiPoint"===Ut)nn(Wn,Zr,it,lt,ht);else if("LineString"===Ut)tr(Wn,Zr,it,lt,ht,!1,pt.lineMetrics);else if("MultiLineString"===Ut)qr(Wn,Zr,it,lt,ht,!1);else if("Polygon"===Ut)qr(Wn,Zr,it,lt,ht,!0);else if("MultiPolygon"===Ut)for(var Wr=0;Wr<Wn.length;Wr++){var Li=[];qr(Wn[Wr],Li,it,lt,ht,!0),Li.length&&Zr.push(Li)}if(Zr.length){if(pt.lineMetrics&&"LineString"===Ut){for(Wr=0;Wr<Zr.length;Wr++)Tt.push(de(tn.id,Ut,Zr[Wr],tn.tags));continue}"LineString"!==Ut&&"MultiLineString"!==Ut||(1===Zr.length?(Ut="LineString",Zr=Zr[0]):Ut="MultiLineString"),"Point"!==Ut&&"MultiPoint"!==Ut||(Ut=3===Zr.length?"Point":"MultiPoint"),Tt.push(de(tn.id,Ut,Zr,tn.tags))}}}return Tt.length?Tt:null}function nn(Be,Ze,it,lt,ht){for(var yt=0;yt<Be.length;yt+=3){var gt=Be[yt+ht];gt>=it&&gt<=lt&&(Ze.push(Be[yt]),Ze.push(Be[yt+1]),Ze.push(Be[yt+2]))}}function tr(Be,Ze,it,lt,ht,yt,gt){for(var pt,Tt,dt=vr(Be),tn=0===ht?Jn:nr,Wn=Be.start,Ut=0;Ut<Be.length-3;Ut+=3){var Xn=Be[Ut],Vn=Be[Ut+1],Zr=Be[Ut+2],Wr=Be[Ut+3],Li=Be[Ut+4],Go=0===ht?Xn:Vn,Ho=0===ht?Wr:Li,Br=!1;gt&&(pt=Math.sqrt(Math.pow(Xn-Wr,2)+Math.pow(Vn-Li,2))),Go<it?Ho>it&&(Tt=tn(dt,Xn,Vn,Wr,Li,it),gt&&(dt.start=Wn+pt*Tt)):Go>lt?Ho<lt&&(Tt=tn(dt,Xn,Vn,Wr,Li,lt),gt&&(dt.start=Wn+pt*Tt)):gr(dt,Xn,Vn,Zr),Ho<it&&Go>=it&&(Tt=tn(dt,Xn,Vn,Wr,Li,it),Br=!0),Ho>lt&&Go<=lt&&(Tt=tn(dt,Xn,Vn,Wr,Li,lt),Br=!0),!yt&&Br&&(gt&&(dt.end=Wn+pt*Tt),Ze.push(dt),dt=vr(Be)),gt&&(Wn+=pt)}var so=Be.length-3;Xn=Be[so],Vn=Be[so+1],Zr=Be[so+2],(Go=0===ht?Xn:Vn)>=it&&Go<=lt&&gr(dt,Xn,Vn,Zr),so=dt.length-3,yt&&so>=3&&(dt[so]!==dt[0]||dt[so+1]!==dt[1])&&gr(dt,dt[0],dt[1],dt[2]),dt.length&&Ze.push(dt)}function vr(Be){var Ze=[];return Ze.size=Be.size,Ze.start=Be.start,Ze.end=Be.end,Ze}function qr(Be,Ze,it,lt,ht,yt){for(var gt=0;gt<Be.length;gt++)tr(Be[gt],Ze,it,lt,ht,yt,!1)}function gr(Be,Ze,it,lt){Be.push(Ze),Be.push(it),Be.push(lt)}function Jn(Be,Ze,it,lt,ht,yt){var gt=(yt-Ze)/(lt-Ze);return Be.push(yt),Be.push(it+(ht-it)*gt),Be.push(1),gt}function nr(Be,Ze,it,lt,ht,yt){var gt=(yt-it)/(ht-it);return Be.push(Ze+(lt-Ze)*gt),Be.push(yt),Be.push(1),gt}function $i(Be,Ze){for(var it=[],lt=0;lt<Be.length;lt++){var ht,yt=Be[lt],gt=yt.type;if("Point"===gt||"MultiPoint"===gt||"LineString"===gt)ht=Gi(yt.geometry,Ze);else if("MultiLineString"===gt||"Polygon"===gt){ht=[];for(var pt=0;pt<yt.geometry.length;pt++)ht.push(Gi(yt.geometry[pt],Ze))}else if("MultiPolygon"===gt)for(ht=[],pt=0;pt<yt.geometry.length;pt++){for(var Tt=[],dt=0;dt<yt.geometry[pt].length;dt++)Tt.push(Gi(yt.geometry[pt][dt],Ze));ht.push(Tt)}it.push(de(yt.id,gt,ht,yt.tags))}return it}function Gi(Be,Ze){var it=[];it.size=Be.size,void 0!==Be.start&&(it.start=Be.start,it.end=Be.end);for(var lt=0;lt<Be.length;lt+=3)it.push(Be[lt]+Ze,Be[lt+1],Be[lt+2]);return it}function oo(Be,Ze){if(Be.transformed)return Be;var it,lt,ht,yt=1<<Be.z,gt=Be.x,pt=Be.y;for(it=0;it<Be.features.length;it++){var Tt=Be.features[it],dt=Tt.geometry,tn=Tt.type;if(Tt.geometry=[],1===tn)for(lt=0;lt<dt.length;lt+=2)Tt.geometry.push(_o(dt[lt],dt[lt+1],Ze,yt,gt,pt));else for(lt=0;lt<dt.length;lt++){var Wn=[];for(ht=0;ht<dt[lt].length;ht+=2)Wn.push(_o(dt[lt][ht],dt[lt][ht+1],Ze,yt,gt,pt));Tt.geometry.push(Wn)}}return Be.transformed=!0,Be}function _o(Be,Ze,it,lt,ht,yt){return[Math.round(it*(Be*lt-ht)),Math.round(it*(Ze*lt-yt))]}function ys(Be,Ze,it,lt,ht){for(var yt=Ze===ht.maxZoom?0:ht.tolerance/((1<<Ze)*ht.extent),gt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:it,y:lt,z:Ze,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pt=0;pt<Be.length;pt++){gt.numFeatures++,di(gt,Be[pt],yt,ht);var Tt=Be[pt].minX,dt=Be[pt].minY,tn=Be[pt].maxX,Wn=Be[pt].maxY;Tt<gt.minX&&(gt.minX=Tt),dt<gt.minY&&(gt.minY=dt),tn>gt.maxX&&(gt.maxX=tn),Wn>gt.maxY&&(gt.maxY=Wn)}return gt}function di(Be,Ze,it,lt){var ht=Ze.geometry,yt=Ze.type,gt=[];if("Point"===yt||"MultiPoint"===yt)for(var pt=0;pt<ht.length;pt+=3)gt.push(ht[pt]),gt.push(ht[pt+1]),Be.numPoints++,Be.numSimplified++;else if("LineString"===yt)Us(gt,ht,Be,it,!1,!1);else if("MultiLineString"===yt||"Polygon"===yt)for(pt=0;pt<ht.length;pt++)Us(gt,ht[pt],Be,it,"Polygon"===yt,0===pt);else if("MultiPolygon"===yt)for(var Tt=0;Tt<ht.length;Tt++){var dt=ht[Tt];for(pt=0;pt<dt.length;pt++)Us(gt,dt[pt],Be,it,!0,0===pt)}if(gt.length){var tn=Ze.tags||null;if("LineString"===yt&&lt.lineMetrics){for(var Wn in tn={},Ze.tags)tn[Wn]=Ze.tags[Wn];tn.mapbox_clip_start=ht.start/ht.size,tn.mapbox_clip_end=ht.end/ht.size}var Ut={geometry:gt,type:"Polygon"===yt||"MultiPolygon"===yt?3:"LineString"===yt||"MultiLineString"===yt?2:1,tags:tn};null!==Ze.id&&(Ut.id=Ze.id),Be.features.push(Ut)}}function Us(Be,Ze,it,lt,ht,yt){var gt=lt*lt;if(lt>0&&Ze.size<(ht?gt:lt))it.numPoints+=Ze.length/3;else{for(var pt=[],Tt=0;Tt<Ze.length;Tt+=3)(0===lt||Ze[Tt+2]>gt)&&(it.numSimplified++,pt.push(Ze[Tt]),pt.push(Ze[Tt+1])),it.numPoints++;ht&&function(dt,tn){for(var Wn=0,Ut=0,Xn=dt.length,Vn=Xn-2;Ut<Xn;Vn=Ut,Ut+=2)Wn+=(dt[Ut]-dt[Vn])*(dt[Ut+1]+dt[Vn+1]);if(Wn>0===tn)for(Ut=0,Xn=dt.length;Ut<Xn/2;Ut+=2){var Zr=dt[Ut],Wr=dt[Ut+1];dt[Ut]=dt[Xn-2-Ut],dt[Ut+1]=dt[Xn-1-Ut],dt[Xn-2-Ut]=Zr,dt[Xn-1-Ut]=Wr}}(pt,yt),Be.push(pt)}}function vs(Be,Ze){var it=(Ze=this.options=function(ht,yt){for(var gt in yt)ht[gt]=yt[gt];return ht}(Object.create(this.options),Ze)).debug;if(it&&console.time("preprocess data"),Ze.maxZoom<0||Ze.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ze.promoteId&&Ze.generateId)throw new Error("promoteId and generateId cannot be used together.");var ht,yt,gt,pt,Tt,dt,lt=function(ht,yt){var gt=[];if("FeatureCollection"===ht.type)for(var pt=0;pt<ht.features.length;pt++)Ye(gt,ht.features[pt],yt,pt);else Ye(gt,"Feature"===ht.type?ht:{geometry:ht},yt);return gt}(Be,Ze);this.tiles={},this.tileCoords=[],it&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ze.indexMaxZoom,Ze.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ht=lt,yt=Ze,gt=yt.buffer/yt.extent,pt=ht,Tt=Kt(ht,1,-1-gt,gt,0,-1,2,yt),dt=Kt(ht,1,1-gt,2+gt,0,-1,2,yt),(Tt||dt)&&(pt=Kt(ht,1,-gt,1+gt,0,-1,2,yt)||[],Tt&&(pt=$i(Tt,1).concat(pt)),dt&&(pt=pt.concat($i(dt,-1)))),lt=pt).length&&this.splitTile(lt,0,0,0),it&&(lt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Or(Be,Ze,it){return 32*((1<<Be)*it+Ze)+Be}return vs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vs.prototype.splitTile=function(Be,Ze,it,lt,ht,yt,gt){for(var pt=[Be,Ze,it,lt],Tt=this.options,dt=Tt.debug;pt.length;){lt=pt.pop(),it=pt.pop(),Ze=pt.pop(),Be=pt.pop();var tn=1<<Ze,Wn=Or(Ze,it,lt),Ut=this.tiles[Wn];if(!Ut&&(dt>1&&console.time("creation"),Ut=this.tiles[Wn]=ys(Be,Ze,it,lt,Tt),this.tileCoords.push({z:Ze,x:it,y:lt}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ze,it,lt,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));var Xn="z"+Ze;this.stats[Xn]=(this.stats[Xn]||0)+1,this.total++}if(Ut.source=Be,ht){if(Ze===Tt.maxZoom||Ze===ht)continue;var Vn=1<<ht-Ze;if(it!==Math.floor(yt/Vn)||lt!==Math.floor(gt/Vn))continue}else if(Ze===Tt.indexMaxZoom||Ut.numPoints<=Tt.indexMaxPoints)continue;if(Ut.source=null,0!==Be.length){dt>1&&console.time("clipping");var Zr,Wr,Li,Go,Ho,Br,so=.5*Tt.buffer/Tt.extent,yi=.5-so,ua=.5+so,fi=1+so;Zr=Wr=Li=Go=null,Ho=Kt(Be,tn,it-so,it+ua,0,Ut.minX,Ut.maxX,Tt),Br=Kt(Be,tn,it+yi,it+fi,0,Ut.minX,Ut.maxX,Tt),Be=null,Ho&&(Zr=Kt(Ho,tn,lt-so,lt+ua,1,Ut.minY,Ut.maxY,Tt),Wr=Kt(Ho,tn,lt+yi,lt+fi,1,Ut.minY,Ut.maxY,Tt),Ho=null),Br&&(Li=Kt(Br,tn,lt-so,lt+ua,1,Ut.minY,Ut.maxY,Tt),Go=Kt(Br,tn,lt+yi,lt+fi,1,Ut.minY,Ut.maxY,Tt),Br=null),dt>1&&console.timeEnd("clipping"),pt.push(Zr||[],Ze+1,2*it,2*lt),pt.push(Wr||[],Ze+1,2*it,2*lt+1),pt.push(Li||[],Ze+1,2*it+1,2*lt),pt.push(Go||[],Ze+1,2*it+1,2*lt+1)}}},vs.prototype.getTile=function(Be,Ze,it){var lt=this.options,ht=lt.extent,yt=lt.debug;if(Be<0||Be>24)return null;var gt=1<<Be,pt=Or(Be,Ze=(Ze%gt+gt)%gt,it);if(this.tiles[pt])return oo(this.tiles[pt],ht);yt>1&&console.log("drilling down to z%d-%d-%d",Be,Ze,it);for(var Tt,dt=Be,tn=Ze,Wn=it;!Tt&&dt>0;)dt--,tn=Math.floor(tn/2),Wn=Math.floor(Wn/2),Tt=this.tiles[Or(dt,tn,Wn)];return Tt&&Tt.source?(yt>1&&console.log("found parent tile z%d-%d-%d",dt,tn,Wn),yt>1&&console.time("drilling down"),this.splitTile(Tt.source,dt,tn,Wn,Be,Ze,it),yt>1&&console.timeEnd("drilling down"),this.tiles[pt]?oo(this.tiles[pt],ht):null):null},function(Be,Ze){return new vs(Be,Ze)}}();var kn=f.dc(er.exports);function _r(qe,le){const de=qe.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);const Ce=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!Ce)return le(null,null);const Ye=new class{constructor(Ct){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.J,this.length=Ct.length,this._features=Ct}feature(Ct){return new class{constructor(Ot){this._feature=Ot,this.extent=f.J,this.type=Ot.type,this.properties=Ot.tags,"id"in Ot&&!isNaN(Ot.id)&&(this.id=parseInt(Ot.id,10))}loadGeometry(){if(1===this._feature.type){const Ot=[];for(const Qe of this._feature.geometry)Ot.push([new f.P(Qe[0],Qe[1])]);return Ot}{const Ot=[];for(const Qe of this._feature.geometry){const $t=[];for(const Kt of Qe)$t.push(new f.P(Kt[0],Kt[1]));Ot.push($t)}return Ot}}toGeoJSON(Ot,Qe,$t){return on.call(this,Ot,Qe,$t)}}(this._features[Ct])}}(Ce.features);let Ke=la(Ye);0===Ke.byteOffset&&Ke.byteLength===Ke.buffer.byteLength||(Ke=new Uint8Array(Ke)),le(null,{vectorTile:Ye,rawData:Ke.buffer})}class $l extends f.dh{constructor(le,de,Ce,Ye,Ke,Ct){super(le,de,Ce,Ye,_r,Ct),Ke&&(this.loadGeoJSON=Ke)}loadData(le,de){const Ce=le&&le.request,Ye=Ce&&Ce.collectResourceTiming;this.loadGeoJSON(le,(Ke,Ct)=>{if(Ke||!Ct)return de(Ke);if("object"!=typeof Ct)return de(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));{ti(Ct,!0);try{if(le.filter){const Qe=f.cw(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Qe.result)throw new Error(Qe.value.map(Kt=>`${Kt.key}: ${Kt.message}`).join(", "));Ct={type:"FeatureCollection",features:Ct.features.filter(Kt=>Qe.value.evaluate({zoom:0},Kt))}}this._geoJSONIndex=le.cluster?new mr(function({superclusterOptions:Qe,clusterProperties:$t}){if(!$t||!Qe)return Qe;const Kt={},nn={},tr={accumulated:null,zoom:0},vr={properties:null},qr=Object.keys($t);for(const gr of qr){const[Jn,nr]=$t[gr],$i=f.cw(nr),Gi=f.cw("string"==typeof Jn?[Jn,["accumulated"],["get",gr]]:Jn);Kt[gr]=$i.value,nn[gr]=Gi.value}return Qe.map=gr=>{vr.properties=gr;const Jn={};for(const nr of qr)Jn[nr]=Kt[nr].evaluate(tr,vr);return Jn},Qe.reduce=(gr,Jn)=>{vr.properties=Jn;for(const nr of qr)tr.accumulated=gr[nr],gr[nr]=nn[nr].evaluate(tr,vr)},Qe}(le)).load(Ct.features):kn(Ct,le.geojsonVtOptions)}catch(Qe){return de(Qe)}this.loaded={};const Ot={};if(Ye){const Qe=f.di(Ce);Qe&&(Ot.resourceTiming={},Ot.resourceTiming[le.source]=JSON.parse(JSON.stringify(Qe)))}de(null,Ot)}})}reloadTile(le,de){const Ce=this.loaded;return Ce&&Ce[le.uid]?super.reloadTile(le,de):this.loadTile(le,de)}loadGeoJSON(le,de){if(le.request)f.a1(le.request,de);else{if("string"!=typeof le.data)return de(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));try{return de(null,JSON.parse(le.data))}catch{return de(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(le,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(Ce){de(Ce)}}getClusterChildren(le,de){try{de(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(Ce){de(Ce)}}getClusterLeaves(le,de){try{de(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(Ce){de(Ce)}}}class _s{constructor(le,de){this.tileID=new f.O(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=le.projection,this.brightness=de}parse(le,de,Ce,Ye){this.status="parsing";const Ke=new f.O(Ce.tileID.overscaledZ,Ce.tileID.wrap,Ce.tileID.canonical.z,Ce.tileID.canonical.x,Ce.tileID.canonical.y),Ct={},Ot=de.familiesBySource[Ce.source],Qe=new f.dk(Ke,Ce.promoteId);return Qe.bucketLayerIDs=[],f.dl(le).then($t=>{if(!$t)return Ye(new Error("Could not parse tile"));const Kt=f.dm($t,1/f.cg(Ce.tileID.canonical)),nn=$t.json.extensionsUsed&&$t.json.extensionsUsed.includes("MAPBOX_mesh_features"),tr=new f.al(this.zoom,{brightness:this.brightness});for(const vr in Ot)for(const qr of Ot[vr]){const gr=qr[0],Jn=$t.json.extensionsUsed;gr.recalculate(tr,[]);const nr=new f.dn(Kt,Ke,Jn&&Jn.includes("MAPBOX_mesh_features"),this.brightness);nn||(nr.needsUpload=!0),Ct[gr.fqid]=nr,nr.evaluate(gr)}this.status="done",Ye(null,{buckets:Ct,featureIndex:Qe})}).catch($t=>Ye(new Error($t.message)))}}class js{constructor(le,de,Ce,Ye,Ke,Ct){this.actor=le,this.layerIndex=de,this.brightness=Ct,this.loading={},this.loaded={}}loadTile(le,de){const Ce=le.uid,Ye=this.loading[Ce]=new _s(le,this.brightness);f.dj(le.request,(Ke,Ct)=>{const Ot=!this.loading[Ce];return delete this.loading[Ce],Ot||Ke?(Ye.status="done",Ot||(this.loaded[Ce]=Ye),de(Ke)):Ct&&0!==Ct.byteLength?void Ye.parse(Ct,this.layerIndex,le,(Qe,$t)=>{Ye.status="done",this.loaded=this.loaded||{},this.loaded[Ce]=Ye,Qe||!$t?de(Qe):de(null,$t)}):(Ye.status="done",this.loaded[Ce]=Ye,de())})}reloadTile(le,de){const Ce=this.loaded,Ye=le.uid;if(Ce&&Ce[Ye]){const Ke=Ce[Ye];Ke.projection=le.projection,Ke.brightness=le.brightness;const Ct=(Ot,Qe)=>{Ke.reloadCallback&&(delete Ke.reloadCallback,this.loadTile(le,de)),de(Ot,Qe)};"parsing"===Ke.status?Ke.reloadCallback=Ct:"done"===Ke.status&&this.loadTile(le,de)}}abortTile(le,de){const Ce=le.uid;this.loading[Ce]&&delete this.loading[Ce],de()}removeTile(le,de){const Ce=this.loaded,Ye=le.uid;Ce&&Ce[Ye]&&delete Ce[Ye],de()}}class Rr{constructor(le){this.self=le,this.actor=new f.dp(le,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.o({name:"mercator"}),this.workerSourceTypes={vector:f.dh,geojson:$l,"batched-model":js},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(de,Ce)=>{if(this.workerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.workerSourceTypes[de]=Ce},this.self.registerRTLTextPlugin=de=>{if(f.dq.isParsed())throw new Error("RTL text plugin already registered.");f.dq.applyArabicShaping=de.applyArabicShaping,f.dq.processBidirectionalText=de.processBidirectionalText,f.dq.processStyledBidirectionalText=de.processStyledBidirectionalText}}clearCaches(le,de,Ce){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le],Ce()}checkIfReady(le,de,Ce){Ce()}setReferrer(le,de){this.referrer=de}spriteLoaded(le,{scope:de,isLoaded:Ce}){if(this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),this.isSpriteLoaded[le][de]=Ce,this.workerSources[le]&&this.workerSources[le][de])for(const Ye in this.workerSources[le][de]){const Ke=this.workerSources[le][de][Ye];for(const Ct in Ke)Ke[Ct]instanceof f.dh&&(Ke[Ct].isSpriteLoaded=Ce,Ke[Ct].fire(new f.a8("isSpriteLoaded")))}}setImages(le,{scope:de,images:Ce},Ye){if(this.availableImages[le]||(this.availableImages[le]={}),this.availableImages[le][de]=Ce,this.workerSources[le]&&this.workerSources[le][de]){for(const Ke in this.workerSources[le][de]){const Ct=this.workerSources[le][de][Ke];for(const Ot in Ct)Ct[Ot].availableImages=Ce}Ye()}else Ye()}setProjection(le,de){this.projections[le]=f.o(de)}setBrightness(le,de,Ce){this.brightness=de,Ce()}setLayers(le,de,Ce){this.getLayerIndex(le,de.scope).replace(de.layers,de.options),Ce()}updateLayers(le,de,Ce){this.getLayerIndex(le,de.scope).update(de.layers,de.removedIds,de.options),Ce()}loadTile(le,de,Ce){de.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,de.type,de.source,de.scope).loadTile(de,Ce)}loadDEMTile(le,de,Ce){this.getDEMWorkerSource(le,de.source,de.scope).loadTile(de,Ce)}reloadTile(le,de,Ce){de.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,de.type,de.source,de.scope).reloadTile(de,Ce)}abortTile(le,de,Ce){this.getWorkerSource(le,de.type,de.source,de.scope).abortTile(de,Ce)}removeTile(le,de,Ce){this.getWorkerSource(le,de.type,de.source,de.scope).removeTile(de,Ce)}removeSource(le,de,Ce){if(!(this.workerSources[le]&&this.workerSources[le][de.scope]&&this.workerSources[le][de.scope][de.type]&&this.workerSources[le][de.scope][de.type][de.source]))return;const Ye=this.workerSources[le][de.scope][de.type][de.source];delete this.workerSources[le][de.scope][de.type][de.source],void 0!==Ye.removeSource?Ye.removeSource(de,Ce):Ce()}loadWorkerSource(le,de,Ce){try{this.self.importScripts(de.url),Ce()}catch(Ye){Ce(Ye.toString())}}syncRTLPluginState(le,de,Ce){try{f.dq.setState(de);const Ye=f.dq.getPluginURL();if(f.dq.isLoaded()&&!f.dq.isParsed()&&null!=Ye){this.self.importScripts(Ye);const Ke=f.dq.isParsed();Ce(Ke?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ye}`),Ke)}}catch(Ye){Ce(Ye.toString())}}setDracoUrl(le,de){this.dracoUrl=de}getAvailableImages(le,de){this.availableImages[le]||(this.availableImages[le]={});let Ce=this.availableImages[le][de];return Ce||(Ce=[]),Ce}getLayerIndex(le,de){this.layerIndexes[le]||(this.layerIndexes[le]={});let Ce=this.layerIndexes[le][de];return Ce||(Ce=this.layerIndexes[le][de]=new vn,Ce.scope=de),Ce}getWorkerSource(le,de,Ce,Ye){return this.workerSources[le]||(this.workerSources[le]={}),this.workerSources[le][Ye]||(this.workerSources[le][Ye]={}),this.workerSources[le][Ye][de]||(this.workerSources[le][Ye][de]={}),this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),this.workerSources[le][Ye][de][Ce]||(this.workerSources[le][Ye][de][Ce]=new this.workerSourceTypes[de]({send:(Ct,Ot,Qe,$t,Kt,nn)=>{this.actor.send(Ct,Ot,Qe,le,Kt,nn)},scheduler:this.actor.scheduler},this.getLayerIndex(le,Ye),this.getAvailableImages(le,Ye),this.isSpriteLoaded[le][Ye],void 0,this.brightness)),this.workerSources[le][Ye][de][Ce]}getDEMWorkerSource(le,de,Ce){return this.demWorkerSources[le]||(this.demWorkerSources[le]={}),this.demWorkerSources[le][Ce]||(this.demWorkerSources[le][Ce]={}),this.demWorkerSources[le][Ce][de]||(this.demWorkerSources[le][Ce][de]=new bi),this.demWorkerSources[le][Ce][de]}enforceCacheSizeLimit(le,de){f.dr(de)}getWorkerPerformanceMetrics(le,de,Ce){Ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Rr(self)),Rr}),mc(0,function(f){function en(m,l){if(Array.isArray(m)){if(!Array.isArray(l)||m.length!==l.length)return!1;for(let h=0;h<m.length;h++)if(!en(m[h],l[h]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==l){if("object"!=typeof l||Object.keys(m).length!==Object.keys(l).length)return!1;for(const h in m)if(!en(m[h],l[h]))return!1;return!0}return m===l}var ts=vn;function vn(m){return l=m,!(typeof window>"u"||typeof document>"u"||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,w=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(w);try{x=new Worker(T),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(T),y}()||!function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===y.width}()||(void 0===bi[h=l&&l.failIfMajorPerformanceCaveat]&&(bi[h]=function(y){var x,T,S,O,w=(T=y,S=document.createElement("canvas"),(O=Object.create(vn.webGLContextAttributes)).failIfMajorPerformanceCaveat=T,S.getContext("webgl2",O));if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),!0===w.getShaderParameter(x,w.COMPILE_STATUS))}(h)),!bi[h]||document.documentMode));var l,h}var bi={};function hn(m,l,h){const y=document.createElement(m);return null!=l&&(y.className=l),h&&h.appendChild(y),y}function Un(m,l,h){const y=document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(l))y.setAttributeNS(null,x,String(l[x]));return h&&h.appendChild(y),y}vn.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ti=typeof document<"u"?document.documentElement&&document.documentElement.style:null,on=ti&&void 0!==ti.userSelect?"userSelect":"WebkitUserSelect";let Ln;function io(){ti&&on&&(Ln=ti[on],ti[on]="none")}function Ba(){ti&&on&&(ti[on]=Ln)}function yr(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",yr,!0)}function Cr(){window.addEventListener("click",yr,!0),window.setTimeout(()=>{window.removeEventListener("click",yr,!0)},0)}function go(m,l){const h=m.getBoundingClientRect();return ns(m,h,l)}function sa(m,l){const h=m.getBoundingClientRect(),y=[];for(let x=0;x<l.length;x++)y.push(ns(m,h,l[x]));return y}function aa(m){return void 0!==window.InstallTrigger&&2===m.button&&m.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function ns(m,l,h){const y=m.offsetWidth===l.width?1:m.offsetWidth/l.width;return new f.P((h.clientX-l.left)*y,(h.clientY-l.top)*y)}class ut{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,h){this._updatedSourceCaches[l]=h,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const h=l.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(l.id),this.setDirty()}removeLayer(l){const h=l.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][l.id]=l,this._updatedLayers[h].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const h in this._updatedLayers)l[h]=l[h]||{},l[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)l[h]=l[h]||{},l[h].removedIds=Object.keys(this._removedLayers[h]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const su={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ns{constructor(l,h,y,x,w,T){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.instanceCount=T,this.context=l;const S=l.gl;this.buffer=S.createBuffer(),l.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||w||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,h){for(let y=0;y<this.attributes.length;y++){const x=h.attributes[this.attributes[y].name];void 0!==x&&l.enableVertexAttribArray(x)}}setVertexAttribPointers(l,h,y){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],T=h.attributes[w.name];void 0!==T&&l.vertexAttribPointer(T,w.components,l[su[w.type]],!1,this.itemSize,w.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(l,h,y){for(let x=0;x<this.attributes.length;x++){const w=h.attributes[this.attributes[x].name];void 0!==w&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(w,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class wt{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yi extends wt{getDefault(){return f.C.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class zs extends wt{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class gc extends wt{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class la extends wt{getDefault(){return[!0,!0,!0,!0]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class rs extends wt{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class dn extends wt{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Bs extends wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class fr extends wt{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class uo extends wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}}class ca extends wt{getDefault(){return[0,1]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class mr extends wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}}class Vs extends wt{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class ci extends wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}}class Ui extends wt{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Va extends wt{getDefault(){return f.C.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class ni extends wt{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class er extends wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}}class kn extends wt{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class _r extends wt{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let $l=class extends wt{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class _s extends wt{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class js extends wt{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Rr extends wt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class qe extends wt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class le extends wt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class de extends wt{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ce extends wt{getDefault(){return null}set(l){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ye extends wt{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class Ke extends wt{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Ct extends wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Ot extends wt{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Qe extends wt{constructor(l,h){super(l),this.context=l,this.parent=h}getDefault(){return null}}class $t extends Qe{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Kt extends Qe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class nn extends Qe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class tr extends Kt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class vr{constructor(l,h,y,x,w){this.context=l,this.width=h,this.height=y;const T=this.framebuffer=l.gl.createFramebuffer();x&&(this.colorAttachment=new $t(l,T)),w&&(this.depthAttachmentType=w,this.depthAttachment="renderbuffer"===w?new Kt(l,T):new nn(l,T))}destroy(){const l=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&l.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const h=this.depthAttachment.get();h&&l.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&l.deleteTexture(h)}l.deleteFramebuffer(this.framebuffer)}}class qr{constructor(l,h){this.gl=l,this.clearColor=new Yi(this),this.clearDepth=new zs(this),this.clearStencil=new gc(this),this.colorMask=new la(this),this.depthMask=new rs(this),this.stencilMask=new dn(this),this.stencilFunc=new Bs(this),this.stencilOp=new fr(this),this.stencilTest=new uo(this),this.depthRange=new ca(this),this.depthTest=new mr(this),this.depthFunc=new Vs(this),this.blend=new ci(this),this.blendFunc=new Ui(this),this.blendColor=new Va(this),this.blendEquation=new ni(this),this.cullFace=new er(this),this.cullFaceSide=new kn(this),this.frontFace=new _r(this),this.program=new $l(this),this.activeTexture=new _s(this),this.viewport=new js(this),this.bindFramebuffer=new Rr(this),this.bindRenderbuffer=new qe(this),this.bindTexture=new le(this),this.bindVertexBuffer=new de(this),this.bindElementBuffer=new Ce(this),this.bindVertexArrayOES=new Ye(this),this.pixelStoreUnpack=new Ke(this),this.pixelStoreUnpackPremultiplyAlpha=new Ct(this),this.pixelStoreUnpackFlipY=new Ot(this),this.options=h?{...h}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,h,y){return new f.I(this,l,h,y)}createVertexBuffer(l,h,y,x,w){return new Ns(this,l,h,y,x,w)}createRenderbuffer(l,h,y){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,l,h,y),this.bindRenderbuffer.set(null),w}createFramebuffer(l,h,y,x){return new vr(this,l,h,y,x)}clear({color:l,depth:h,stencil:y,colorMask:x}){const w=this.gl;let T=0;l&&(T|=w.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(x||[!0,!0,!0,!0])),void 0!==h&&(T|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==y&&(T|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),w.clear(T)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){en(l.blendFunction,f.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class gr{constructor(l=0,h=0,y=0,x=0){if(isNaN(l)||l<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=y,this.right=x}interpolate(l,h,y){return null!=h.top&&null!=l.top&&(this.top=f.n(l.top,h.top,y)),null!=h.bottom&&null!=l.bottom&&(this.bottom=f.n(l.bottom,h.bottom,y)),null!=h.left&&null!=l.left&&(this.left=f.n(l.left,h.left,y)),null!=h.right&&null!=l.right&&(this.right=f.n(l.right,h.right,y)),this}getCenter(l,h){const y=f.c((this.left+l-this.right)/2,0,l),x=f.c((this.top+h-this.bottom)/2,0,h);return new f.P(y,x)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new gr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Jn(m,l){const h=f.g(m,3);f.m.fromQuat(m,l),f.s(m,3,h)}function nr(m,l){const h=f.q.identity([]);return f.q.rotateZ(h,h,-l),f.q.rotateX(h,h,-m),h}function $i(m,l){const h=[m[0],m[1],0],y=[l[0],l[1],0];if(f.v.length(h)>=1e-15){const T=f.v.normalize([],h);f.v.scale(y,T,f.v.dot(y,T)),l[0]=y[0],l[1]=y[1]}const x=f.v.cross([],l,m);if(f.v.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return nr(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}class Gi{constructor(l,h){this.position=l,this.orientation=h}get position(){return this._position}set position(l){if(l){const h=l instanceof f.M?l:new f.M(l[0],l[1],l[2]);this._renderWorldCopies&&(h.x=f.w(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(l,h){if(this.orientation=null,!this.position)return;const y=this.position,x=this._elevation?this._elevation.getAtPointOrZero(f.M.fromLngLat(l)):0,w=f.M.fromLngLat(l,x),T=[w.x-y.x,w.y-y.y,w.z-y.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=$i(T,h)}setPitchBearing(l,h){this.orientation=nr(f.d(l),f.d(-h))}}class oo{constructor(l,h){this._transform=f.m.identity([]),this.orientation=h,this.position=l}get mercatorPosition(){const l=this.position;return new f.M(l[0],l[1],l[2])}get position(){const l=f.g(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var h;l&&f.s(this._transform,3,[(h=l)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||f.q.identity([]),l&&Jn(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,h){this._orientation=nr(l,h),Jn(this._transform,this._orientation)}forward(){const l=f.g(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=f.g(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=f.g(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,h){const y=new Float64Array(16);return f.m.invert(y,this.getWorldToCamera(l,h)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,h,y){const x=this.position;f.v.scale(x,x,-l);const w=new Float64Array(16);return f.m.fromScaling(w,[y,y,y]),f.m.translate(w,w,x),w[10]*=h,w}getWorldToCamera(l,h){const y=new Float64Array(16),x=new Float64Array(4),w=this.position;return f.q.conjugate(x,this._orientation),f.v.scale(w,w,-l),f.m.fromQuat(y,x),f.m.translate(y,y,w),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=h,y[9]*=h,y[10]*=h,y[11]*=h,y}getCameraToClipPerspective(l,h,y,x){const w=new Float64Array(16);return f.m.perspective(w,l,h,y,x),w}getCameraToClipOrthographic(l,h,y,x,w,T){const S=new Float64Array(16);return f.m.ortho(S,l,h,y,x,w,T),S}getDistanceToElevation(l,h=!1){const y=0===l?0:f.b(l,h?f.l(this.position[1]):this.position[1]),x=this.forward();return(y-this.position[2])/x[2]}clone(){return new oo([...this.position],[...this.orientation])}}const _o={unknown:0,flipRequired:1,flipNotRequired:2},ys=Math.tan(85*Math.PI/180);function di(m,l,h,y,x,w,T){const S=f.m.create();if(h)if("globe"===w.name){const O=f.f(x,l);f.m.multiply(S,S,O)}else{const O=f.h.invert([],T);S[0]=O[0],S[1]=O[1],S[4]=O[2],S[5]=O[3],y||f.m.rotateZ(S,S,x.angle)}else f.m.multiply(S,x.labelPlaneMatrix,m);return S}function Us(m,l,h,y,x,w,T){const S=di(m,l,h,y,x,w,T);return"globe"===w.name&&h||(S[2]=S[6]=S[10]=S[14]=0),S}function vs(m,l,h,y,x,w,T){if(h){if("globe"===w.name){const S=di(m,l,h,y,x,w,T);return f.m.invert(S,S),f.m.multiply(S,m,S),S}{const S=f.m.clone(m),O=f.m.identity([]);return O[0]=T[0],O[1]=T[1],O[4]=T[2],O[5]=T[3],f.m.multiply(S,S,O),y||f.m.rotateZ(S,S,-x.angle),S}}return x.glCoordMatrix}function Or(m,l,h,y){const x=[m,l,h,1];h?f.e.transformMat4(x,x,y):tn(x,x,y);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function Be(m,l){return Math.min(.5+m/l*.5,1.5)}function Ze(m,l){const h=m[0]/m[3],y=m[1]/m[3];return h>=-l[0]&&h<=l[0]&&y>=-l[1]&&y<=l[1]}function it(m,l,h,y,x,w,T,S,O,k){const z=h.transform,j=y?m.textSizeData:m.iconSizeData,$=f.i(j,h.transform.zoom),G="globe"===z.projection.name,W=[256/h.width*2+1,256/h.height*2+1],X=y?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;X.clear();let q=null;G&&(q=y?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const Z=m.lineVertexArray,ee=y?m.text.placedSymbolArray:m.icon.placedSymbolArray,se=h.transform.width/h.transform.height;let ue,K=!1;for(let ie=0;ie<ee.length;ie++){const he=ee.get(ie),{numGlyphs:ge,writingMode:pe}=he;if(pe!==f.W.vertical||K||ue===f.W.horizontal||(K=!0),ue=pe,(he.hidden||pe===f.W.vertical)&&!K){dt(ge,X);continue}K=!1;const ye=new f.P(he.tileAnchorX,he.tileAnchorY);let{x:Ne,y:Ae,z:Oe}=z.projection.projectTilePoint(ye.x,ye.y,k.canonical);if(O){const[vt,Vt,xt]=O(ye);Ne+=vt,Ae+=Vt,Oe+=xt}const be=[Ne,Ae,Oe,1];if(f.e.transformMat4(be,be,l),!Ze(be,W)){dt(ge,X);continue}const Ve=be[3],Re=Be(h.transform.getCameraToCenterDistance(z.projection),Ve),Ge=f.j(j,$,he),re=T?Ge/Re:Ge*Re,Me=Or(Ne,Ae,Oe,x);if(Me[3]<=0){dt(ge,X);continue}let tt={};const Xe=T?null:O,At=yt(he,re,!1,S,l,x,w,m.glyphOffsetArray,Z,X,q,Me,ye,tt,se,Xe,z.projection,k,T);K=At.useVertical,Xe&&At.needsFlipping&&(tt={}),(At.notEnoughRoom||K||At.needsFlipping&&yt(he,re,!0,S,l,x,w,m.glyphOffsetArray,Z,X,q,Me,ye,tt,se,Xe,z.projection,k,T).notEnoughRoom)&&dt(ge,X)}y?(m.text.dynamicLayoutVertexBuffer.updateData(X),q&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(q)):(m.icon.dynamicLayoutVertexBuffer.updateData(X),q&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(q))}function lt(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W,X){const{lineStartIndex:q,glyphStartIndex:Z,segment:ee}=S,se=Z+S.numGlyphs,ue=q+S.lineLength,K=l.getoffsetX(Z),ie=l.getoffsetX(se-1),he=Tt(m*K,h,y,x,w,T,ee,q,ue,O,k,z,j,$,!0,G,W,X);if(!he)return null;const ge=Tt(m*ie,h,y,x,w,T,ee,q,ue,O,k,z,j,$,!0,G,W,X);return ge?{first:he,last:ge}:null}function ht(m,l,h,y){return m===f.W.horizontal&&Math.abs(y)>Math.abs(h)?{useVertical:!0}:m===f.W.vertical?y>0?{needsFlipping:!0}:null:l!==_o.unknown&&(0===(x=h)||Math.abs(y/x)>ys)?l===_o.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var x}function yt(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W,X,q,Z,ee){const se=l/24,ue=m.lineOffsetX*se,K=m.lineOffsetY*se,{lineStartIndex:ie,glyphStartIndex:he,numGlyphs:ge,segment:pe,writingMode:ye,flipState:Ne}=m,Ae=ie+m.lineLength,Oe=be=>{if(z){const[re,Me,tt]=be.up,Xe=k.length;f.u(z,Xe+0,re,Me,tt),f.u(z,Xe+1,re,Me,tt),f.u(z,Xe+2,re,Me,tt),f.u(z,Xe+3,re,Me,tt)}const[Ve,Re,Ge]=be.point;f.k(k,Ve,Re,Ge,be.angle)};if(ge>1){const be=lt(se,S,ue,K,h,j,$,m,O,w,G,X,!1,q,Z,ee);if(!be)return{notEnoughRoom:!0};if(y&&!h){let[Ve,Re,Ge]=be.first.point,[re,Me,tt]=be.last.point;[Ve,Re]=Or(Ve,Re,Ge,T),[re,Me]=Or(re,Me,tt,T);const Xe=ht(ye,Ne,(re-Ve)*W,Me-Re);if(m.flipState=Xe&&Xe.needsFlipping?_o.flipRequired:_o.flipNotRequired,Xe)return Xe}Oe(be.first);for(let Ve=he+1;Ve<he+ge-1;Ve++){const Re=Tt(se*S.getoffsetX(Ve),ue,K,h,j,$,pe,ie,Ae,O,w,G,X,!1,!1,q,Z,ee);if(!Re)return k.length-=4*(Ve-he),{notEnoughRoom:!0};Oe(Re)}Oe(be.last)}else{if(y&&!h){const Ve=Or($.x,$.y,0,x),Re=ie+pe+1,Ge=new f.P(O.getx(Re),O.gety(Re)),re=Or(Ge.x,Ge.y,0,x),Me=re[3]>0?re:pt($,Ge,Ve,1,x,void 0,q,Z.canonical),tt=ht(ye,Ne,(Me[0]-Ve[0])*W,Me[1]-Ve[1]);if(m.flipState=tt&&tt.needsFlipping?_o.flipRequired:_o.flipNotRequired,tt)return tt}const be=Tt(se*S.getoffsetX(he),ue,K,h,j,$,pe,ie,Ae,O,w,G,X,!1,!1,q,Z,ee);if(!be)return{notEnoughRoom:!0};Oe(be)}return{}}function gt(m,l,h,y,x){const{x:w,y:T,z:S}=y.projectTilePoint(m.x,m.y,l);if(!x)return Or(w,T,S,h);const[O,k,z]=x(m);return Or(w+O,T+k,S+z,h)}function pt(m,l,h,y,x,w,T,S){const O=gt(m.sub(l)._unit()._add(m),S,x,T,w);return f.v.sub(O,h,O),f.v.normalize(O,O),f.v.scaleAndAdd(O,h,O,y)}function Tt(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W,X,q,Z){const ee=y?m-l:m+l;let se=ee>0?1:-1,ue=0;y&&(se*=-1,ue=Math.PI),se<0&&(ue+=Math.PI);let K=S+T+(se>0?0:1)|0,ie=x,he=x,ge=0,pe=0;const ye=Math.abs(ee),Ne=[],Ae=[];let Oe=w,be=Oe;const Ve=()=>pt(be,Oe,he,ye-ge+1,z,$,X,q.canonical);for(;ge+pe<=ye;){if(K+=se,K<S||K>=O)return null;if(he=ie,be=Oe,Ne.push(he),G&&Ae.push(be),Oe=new f.P(k.getx(K),k.gety(K)),ie=j[K],!ie){const Vt=gt(Oe,q.canonical,z,X,$);ie=Vt[3]>0?j[K]=Vt:Ve()}ge+=pe,pe=f.v.distance(he,ie)}W&&$&&(j[K]&&(ie=Ve(),pe=f.v.distance(he,ie)),j[K]=ie);const Re=(ye-ge)/pe,Ge=Oe.sub(be)._mult(Re)._add(be),re=f.v.sub([],ie,he),Me=f.v.scaleAndAdd([],he,re,Re);let tt=[0,0,1],Xe=re[0],At=re[1];if(Z&&(tt=X.upVector(q.canonical,Ge.x,Ge.y),0!==tt[0]||0!==tt[1]||1!==tt[2])){const Vt=[tt[2],0,-tt[0]],xt=f.v.cross([],tt,Vt);f.v.normalize(Vt,Vt),f.v.normalize(xt,xt),Xe=f.v.dot(re,Vt),At=f.v.dot(re,xt)}if(h){const Vt=f.v.cross([],tt,re);f.v.normalize(Vt,Vt),f.v.scaleAndAdd(Me,Me,Vt,h*se)}const vt=ue+Math.atan2(At,Xe);return Ne.push(Me),G&&Ae.push(Ge),{point:Me,angle:vt,path:Ne,tilePath:Ae,up:tt}}function dt(m,l){const h=l.length,y=h+4*m;l.resize(y),l.float32.fill(-1/0,4*h,4*y)}function tn(m,l,h){const y=l[0],x=l[1];return m[0]=h[0]*y+h[4]*x+h[12],m[1]=h[1]*y+h[5]*x+h[13],m[3]=h[3]*y+h[7]*x+h[15],m}const Wn=(m,l,h)=>(1-h)*m+h*l,Ut=m=>m*m*m*m*m;class Xn{constructor(l,h,y,x,w,T,S){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=x??60,this.setProjection(T),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new f.L(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new gr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new oo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new Xn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(l,h=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||y)&&this._updateCameraOnTerrain(),(l||y)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return f.p(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=f.o(this.projectionOptions);const y=!en(h,this.getProjection());return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=f.o({name:"mercator"});const h=l!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return f.b(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.P(this.width,this.height)}get bearing(){return f.w(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const h=-l*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=f.h.create(),f.h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const h=f.c(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=f.d(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let x=0,w=0;for(let T=0;T<h.length;T++){const S=new f.P(h[T][0]*this.width,y+h[T][1]*(this.height-y)),O=l.pointCoordinate(S);if(!O)continue;const k=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);x+=O[3]*k,w+=k}return 0===w?NaN:x/w}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const l=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(l),w=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-y,w);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let y;y=l.z<this._camera.position[2]?[h.x,h.y,h.z]:[l.x,l.y,l.z];const x=f.v.length(f.v.sub([],this._camera.position,y));return f.c(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let h=!1;if(l.orientation&&!f.q.exactEquals(l.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(l.orientation)),l.position){const y=[l.position.x,l.position.y,l.position.z];f.v.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,h=new Gi;return h.position=new f.M(l[0],l[1],l[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(l){if(!f.q.length(l))return!1;f.q.normalize(l,l);const h=f.v.transformQuat([],[0,0,-1],l),y=f.v.transformQuat([],[0,-1,0],l);if(y[2]<0)return!1;const x=$i(h,y);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(l){const h=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;l[2]=f.c(l[2],x/y,x/h),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,h,y){this._unmodified=!1,this._edgeInsets.interpolate(l,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(l){const h=[new f.U(0,l)];if(this.renderWorldCopies){const y=this.pointCoordinate(new f.P(0,0)),x=this.pointCoordinate(new f.P(this.width,0)),w=this.pointCoordinate(new f.P(this.width,this.height)),T=this.pointCoordinate(new f.P(0,this.height)),S=Math.floor(Math.min(y.x,x.x,w.x,T.x)),O=Math.floor(Math.max(y.x,x.x,w.x,T.x)),k=1;for(let z=S-k;z<=O+k;z++)0!==z&&h.push(new f.U(z,l))}return h}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(l,h,y){let x=[];if(0===h[0]&&0===h[1])return x;for(const T of l){const S=T.canonical,O=T.overscaledZ,k=T.wrap,z=1<<S.z,j=S.x+1<z,$=S.x>0,G=S.y+1<z,W=S.y>0,X=T.wrap-($?0:1),q=T.wrap+(j?0:1),Z=$?S.x-1:z-1,ee=j?S.x+1:0;h[0]<0?(x.push(new f.O(O,q,S.z,ee,S.y)),h[1]<0&&G&&(x.push(new f.O(O,k,S.z,S.x,S.y+1)),x.push(new f.O(O,q,S.z,ee,S.y+1))),h[1]>0&&W&&(x.push(new f.O(O,k,S.z,S.x,S.y-1)),x.push(new f.O(O,q,S.z,ee,S.y-1)))):h[0]>0?(x.push(new f.O(O,X,S.z,Z,S.y)),h[1]<0&&G&&(x.push(new f.O(O,k,S.z,S.x,S.y+1)),x.push(new f.O(O,X,S.z,Z,S.y+1))),h[1]>0&&W&&(x.push(new f.O(O,k,S.z,S.x,S.y-1)),x.push(new f.O(O,X,S.z,Z,S.y-1)))):h[1]<0&&G?x.push(new f.O(O,k,S.z,S.x,S.y+1)):W&&x.push(new f.O(O,k,S.z,S.x,S.y-1))}if(x.length>1){x.sort((O,k)=>O.overscaledZ-k.overscaledZ||O.wrap-k.wrap||O.canonical.z-k.canonical.z||O.canonical.x-k.canonical.x||O.canonical.y-k.canonical.y);let T=0,S=0;for(;S<x.length;)x[S].equals(x[T])?++S:x[++T]=x[S++];x.length=T+1}const w=[];for(const T of x)x.some(S=>T.isChildOf(S))||w.push(T);return x=w.filter(T=>!l.some(S=>!!(T.overscaledZ<y&&S.isChildOf(T))||T.equals(S)||T.isChildOf(S))),x}coveringTiles(l){let h=this.coveringZoomLevel(l);const y=h,x=this.elevation&&this.elevation.exaggeration(),w=x&&!l.isTerrainDEM,T="mercator"===this.projection.name;if(void 0!==l.minzoom&&h<l.minzoom)return[];void 0!==l.maxzoom&&h>l.maxzoom&&(h=l.maxzoom);const S=this.locationCoordinate(this.center),O=this.center.lat,k=1<<h,z=[k*S.x,k*S.y,0],j="globe"===this.projection.name,$=!j,G=f.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,$),W=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=k*f.b(1,this.center.lat),q=this._camera.position[2]/f.b(1,this.center.lat),Z=[k*W.x,k*W.y,q*($?1:X)],ee=j||x,se=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),ue=this.isLODDisabled(!0)?h:0;let K;if(this._elevation&&l.isTerrainDEM)K=1e4*this._elevation.exaggeration();else if(this._elevation){const re=this._elevation.getMinMaxForVisibleTiles();K=re?re.max:this._centerAltitude}else K=this._centerAltitude;const ie=l.isTerrainDEM?-K:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?f.r(this):1,ge=re=>{const tt=new f.M(re.x+25e-6,re.y,re.z),Xe=new f.M(re.x,re.y+25e-6,re.z),At=re.toLngLat(),vt=tt.toLngLat(),Vt=Xe.toLngLat(),xt=this.locationCoordinate(At),Xt=this.locationCoordinate(vt),Yt=this.locationCoordinate(Vt),Lt=Math.hypot(Xt.x-xt.x,Xt.y-xt.y),Ft=Math.hypot(Yt.x-xt.x,Yt.y-xt.y);return Math.sqrt(Lt*Ft)*he/25e-6},pe=re=>{const Me=K,tt=ie;return{aabb:f.y(this,k,0,0,0,re,tt,Me,this.projection),zoom:0,x:0,y:0,minZ:tt,maxZ:Me,wrap:re,fullyVisible:!1}},ye=[];let Ne=[];const Ae=h,Oe=l.reparseOverscaled?y:h,be=re=>re*re,Ve=be((q-this._centerAltitude)*X),Re=re=>{if(!this._elevation||!re.tileID||!T)return;const Me=this._elevation.getMinMaxForTile(re.tileID),tt=re.aabb;Me?(tt.min[2]=Me.min,tt.max[2]=Me.max,tt.center[2]=(tt.min[2]+tt.max[2])/2):(re.shouldSplit=Ge(re),re.shouldSplit||(tt.min[2]=tt.max[2]=tt.center[2]=this._centerAltitude))},Ge=re=>{if(re.zoom<ue)return!0;if(re.zoom===Ae)return!1;if(null!=re.shouldSplit)return re.shouldSplit;const Me=re.aabb.distanceX(Z),tt=re.aabb.distanceY(Z);let Xe=Ve,At=1;if(j){Xe=be(re.aabb.distanceZ(Z));const xt=Math.pow(2,re.zoom),Xt=f.l((re.y+1)/xt),Yt=f.l(re.y/xt),Lt=Math.min(Math.max(O,Xt),Yt),Ft=f.a0(Lt)/f.a0(O);if(At=Lt===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ft/this._mercatorScaleRatio),this.zoom<=f.Z&&re.zoom===Ae-1&&Ft>=.9)return!0}else if(w&&(Xe=be(re.aabb.distanceZ(Z)*X)),this.projection.isReprojectedInTileSpace&&y<=5){const xt=Math.pow(2,re.zoom),Xt=ge(new f.M((re.x+.5)/xt,(re.y+.5)/xt));At=Xt>.85?1:Xt}const vt=Me*Me+tt*tt+Xe;return vt<be((1<<Ae-re.zoom)*se*At*((xt,Xt)=>{if(Xt*be(.707)<xt)return 1;const Yt=Math.sqrt(Xt/xt);return Yt/(1.4144271570014144+(Math.pow(1.1,Yt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Xe,Ve),vt))};if(this.renderWorldCopies)for(let re=1;re<=3;re++)ye.push(pe(-re)),ye.push(pe(re));for(ye.push(pe(0));ye.length>0;){const re=ye.pop(),Me=re.x,tt=re.y;let Xe=re.fullyVisible;const At=()=>"globe"===this.projection.name&&(0===re.y||re.y===(1<<re.zoom)-1);if(!Xe){let vt=ee?re.aabb.intersects(G):re.aabb.intersectsFlat(G);if(0===vt&&At()){const Vt=new f.t(re.zoom,Me,tt);vt=f.x(this,k,Vt,!0).intersects(G)}if(0===vt)continue;Xe=2===vt}if(re.zoom!==Ae&&Ge(re))for(let vt=0;vt<4;vt++){const Vt=(Me<<1)+vt%2,xt=(tt<<1)+(vt>>1),Xt={aabb:T?re.aabb.quadrant(vt):f.y(this,k,re.zoom+1,Vt,xt,re.wrap,re.minZ,re.maxZ,this.projection),zoom:re.zoom+1,x:Vt,y:xt,wrap:re.wrap,fullyVisible:Xe,tileID:void 0,shouldSplit:void 0,minZ:re.minZ,maxZ:re.maxZ};w&&!j&&(Xt.tileID=new f.O(re.zoom+1===Ae?Oe:re.zoom+1,re.wrap,re.zoom+1,Vt,xt),Re(Xt)),ye.push(Xt)}else{const vt=re.zoom===Ae?Oe:re.zoom;if(l.minzoom&&l.minzoom>vt)continue;if(!Xe){let Yt=ee?re.aabb.intersectsPrecise(G):re.aabb.intersectsPreciseFlat(G);if(0===Yt&&At()){const Lt=new f.t(re.zoom,Me,tt);Yt=f.x(this,k,Lt,!0).intersectsPrecise(G)}if(0===Yt)continue}const Vt=z[0]-(.5+Me+(re.wrap<<re.zoom))*(1<<h-re.zoom),xt=z[1]-.5-tt,Xt=re.tileID?re.tileID:new f.O(vt,re.wrap,re.zoom,Me,tt);Ne.push({tileID:Xt,distanceSq:Vt*Vt+xt*xt})}}if(this.fogCullDistSq){const re=this.fogCullDistSq,Me=this.horizonLineFromTop();Ne=Ne.filter(tt=>{const Xe=[0,0,0,1],At=[f.J,f.J,0,1],vt=this.calculateFogTileMatrix(tt.tileID.toUnwrapped());f.e.transformMat4(Xe,Xe,vt),f.e.transformMat4(At,At,vt);const Vt=f.e.min([],Xe,At),xt=f.e.max([],Xe,At),Xt=f.z(Vt,xt);if(0===Xt)return!0;let Yt=!1;const Lt=this._elevation;if(Lt&&Xt>re&&0!==Me){const Ft=this.calculateProjMatrix(tt.tileID.toUnwrapped());let zn;l.isTerrainDEM||(zn=Lt.getMinMaxForTile(tt.tileID)),zn||(zn={min:ie,max:K});const ke=f._(this.rotation),ln=[ke[0]*f.J,ke[1]*f.J,zn.max];f.v.transformMat4(ln,ln,Ft),Yt=(1-ln[1])*this.height*.5<Me}return Xt<re||Yt})}return Ne.sort((re,Me)=>re.distanceSq-Me.distanceSq).map(re=>re.tileID)}resize(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const h=f.c(l.lat,-f.A,f.A),y=this.projection.project(l.lng,h);return new f.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/f.b(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,h){let y,x;const w=this.centerPoint;if("globe"===this.projection.name){const S=this.worldSize;y=(h.x-w.x)/S,x=(h.y-w.y)/S}else{const S=this.pointCoordinate(h),O=this.pointCoordinate(w);y=S.x-O.x,x=S.y-O.y}const T=this.locationCoordinate(l);this.setLocation(new f.M(T.x-y,T.y-x))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,h){const y=h?f.b(h,l.lat):void 0,x=this.projection.project(l.lng,l.lat);return new f.M(x.x,x.y,y)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,h){const y=h??this._centerAltitude,x=[l.x,l.y,0,1],w=[l.x,l.y,1,1];f.e.transformMat4(x,x,this.pixelMatrixInverse),f.e.transformMat4(w,w,this.pixelMatrixInverse);const T=w[3];f.e.scale(x,x,1/x[3]),f.e.scale(w,w,1/T);const S=x[2],O=w[2];return{p0:x,p1:w,t:S===O?0:(y-S)/(O-S)}}screenPointToMercatorRay(l){const h=[l.x,l.y,0,1],y=[l.x,l.y,1,1];return f.e.transformMat4(h,h,this.pixelMatrixInverse),f.e.transformMat4(y,y,this.pixelMatrixInverse),f.e.scale(h,h,1/h[3]),f.e.scale(y,y,1/y[3]),h[2]=f.b(h[2],this._center.lat)*this.worldSize,y[2]=f.b(y[2],this._center.lat)*this.worldSize,f.e.scale(h,h,1/this.worldSize),f.e.scale(y,y,1/this.worldSize),new f.R([h[0],h[1],h[2]],f.v.normalize([],f.v.sub([],y,h)))}rayIntersectionCoordinate(l){const{p0:h,p1:y,t:x}=l,w=f.b(h[2],this._center.lat),T=f.b(y[2],this._center.lat);return new f.M(f.n(h[0],y[0],x)/this.worldSize,f.n(h[1],y[1],x)/this.worldSize,f.n(w,T,x))}pointCoordinate(l,h=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,h)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let h=this.projection.pointCoordinate3D(this,l.x,l.y);if(h)return new f.M(h[0],h[1],h[2]);let y=0,x=this.horizonLineFromTop();if(l.y>x)return this.pointCoordinate(l);const w=.02*x,T=l.clone();for(let S=0;S<10&&x-y>w;S++){T.y=f.n(y,x,.66);const O=this.projection.pointCoordinate3D(this,T.x,T.y);O?(x=T.y,h=O):y=T.y}return h?new f.M(h[0],h[1],h[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=f.G)return!this.isPointAboveHorizon(l);const h=this.pointCoordinate(l);return h.y>=0&&h.y<=1}_coordinatePoint(l,h){const y=h&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,x=[l.x*this.worldSize,l.y*this.worldSize,y+l.toAltitude(),1];return f.e.transformMat4(x,x,this.pixelMatrix),x[3]>0?new f.P(x[0]/x[3],x[1]/x[3]):new f.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:h}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new f.P(h,l)),T=this.pointLocation3D(new f.P(x,l)),S=this.pointLocation3D(new f.P(x,y)),O=this.pointLocation3D(new f.P(h,y));let k=Math.min(w.lng,T.lng,S.lng,O.lng),z=Math.max(w.lng,T.lng,S.lng,O.lng),j=Math.min(w.lat,T.lat,S.lat,O.lat),$=Math.max(w.lat,T.lat,S.lat,O.lat);const G=Math.pow(2,-this.zoom)/16*270,W="globe"===this.projection.name?1:4,X=(q,Z,ee,se,ue)=>{const K=(q+ee)/2,ie=(Z+se)/2,he=new f.P(K,ie),{lng:ge,lat:pe}=this.pointLocation3D(he),ye=Math.max(0,k-ge,j-pe,ge-z,pe-$);k=Math.min(k,ge),z=Math.max(z,ge),j=Math.min(j,pe),$=Math.max($,pe),(ue<W||ye>G)&&(X(q,Z,K,ie,ue+1),X(K,ie,ee,se,ue+1))};if(X(h,l,x,l,1),X(x,l,x,y,1),X(x,y,h,y,1),X(h,y,h,l,1),"globe"===this.projection.name){const[q,Z]=f.B(this);q?($=90,z=180,k=-180):Z&&(j=-90,z=180,k=-180)}return new f.D(new f.L(k,j),new f.L(z,$))}_getBoundsRectangular(l,h){const{top:y,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,S=new f.P(x,y),O=new f.P(T,y),k=new f.P(T,w),z=new f.P(x,w);let j=this.pointCoordinate(S,l),$=this.pointCoordinate(O,l);const G=this.pointCoordinate(k,h),W=this.pointCoordinate(z,h),X=(q,Z)=>(Z.y-q.y)/(Z.x-q.x);return j.y>1&&$.y>=0?j=new f.M((1-W.y)/X(W,j)+W.x,1):j.y<0&&$.y<=1&&(j=new f.M(-W.y/X(W,j)+W.x,0)),$.y>1&&j.y>=0?$=new f.M((1-G.y)/X(G,$)+G.x,1):$.y<0&&j.y<=1&&($=new f.M(-G.y/X(G,$)+G.x,0)),(new f.D).extend(this.coordinateLocation(j)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=l.visibleDemTiles.reduce((y,x)=>{if(x.dem){const w=x.dem.tree;y.min=Math.min(y.min,w.minimums[0]),y.max=Math.max(y.max,w.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*l.exaggeration(),h.max*l.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-h*(1-this._horizonShift);return l?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-f.A,this.maxLat=f.A,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.E(this.minLng)*this.tileSize,this.worldMaxX=f.E(this.maxLng)*this.tileSize,this.worldMinY=f.H(this.maxLat)*this.tileSize,this.worldMaxY=f.H(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,h){return this.projection.createTileMatrix(this,h,l)}calculateDistanceTileData(l){const h=l.key,y=this._distanceTileDataCache;if(y[h])return y[h];const x=l.canonical,w=1/this.height,T=this.cameraWorldSize,S=T/this.zoomScale(x.z),O=(x.x+Math.pow(2,x.z)*l.wrap)*S,k=x.y*S,z=this.point;z.x*=T/this.worldSize,z.y*=T/this.worldSize;const j=this.angle,$=Math.sin(-j),G=-Math.cos(-j);return y[h]={bearing:[$,G],center:[(z.x-O)*w,(z.y-k)*w],scale:S/f.J*w},y[h]}calculateFogTileMatrix(l){const h=l.key,y=this._fogTileMatrixCache;if(y[h])return y[h];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return f.m.multiply(x,this.worldToFogMatrix,x),y[h]=new Float32Array(x),y[h]}calculateProjMatrix(l,h=!1,y=!1){const x=l.key;let w;if(w=y?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];const T=this.calculatePosMatrix(l,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,f.m.multiply(T,S,T),w[x]=new Float32Array(T),w[x]}calculatePixelsToTileUnitsMatrix(l){const h=l.tileID.key,y=this._pixelsToTileUnitsCache;if(y[h])return y[h];const x=f.K(l,this);return y[h]=x,y[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const l=1/this.worldSize,h=f.m.fromScaling([],[l,l,l]);return f.m.multiply(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const l=this._elevation;this._updateCameraState();const h=f.b(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(h),x=this._camera.forward(),w=f.b(1,this._center.lat);y[2]/=w,x[2]/=w,f.v.normalize(x,x);const T=l.raycast(y,x,l.exaggeration());if(T){const S=f.v.scaleAndAdd([],y,x,T),O=new f.M(S[0],S[1],f.b(S[2],f.l(S[1]))),k=(O.z+f.v.length([O.x-y[0],O.y-y[1],O.z-y[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const h=this._elevation,y=f.b(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(y),w=h.getAtPointOrZero(new f.M(...x)),T=this.pixelsPerMeter/this.worldSize*w,S=this._minimumHeightOverTerrain(),O=x[2]-T;if(O<=S)if(O<0||l){const k=this.locationCoordinate(this._center,this._centerAltitude),z=[x[0],x[1],k.z-x[2]],j=f.v.length(z);z[2]-=(S-O)/this._pixelsPerMercatorPixel;const $=f.v.length(z);if(0===$)return;f.v.scale(z,z,j/$*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],k.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const $=this.center;return $.lat=f.c($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&($.lng=f.c($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const h=this._unmodified,{x:y,y:x}=this.point;let w=0,T=y,S=x;const O=this.width/2,k=this.height/2,z=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(x-k<z&&(S=z+k),x+k>j&&(S=j-k),j-z<this.height&&(w=Math.max(w,this.height/(j-z)),S=(j+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,W=this.worldSize/2-($+G)/2;T=(y+W+this.worldSize)%this.worldSize-W,T-O<$&&(T=$+O),T+O>G&&(T=G-O),G-$<this.width&&(w=Math.max(w,this.width/(G-$)),T=(G+$)/2)}T===y&&S===x||(this.center=this.unproject(new f.P(T,S))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,h="globe"===this.projection.name,y=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=f.b(1,this.center.lat)/f.b(1,f.$));const x=f.N(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w="meters"===this.projection.zAxisUnit?y:1,T=this._camera.getWorldToCamera(this.worldSize,w);let S;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-l.x/this.width,O[9]=2*l.y/this.height,this.isOrthographic){let pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ye=pe*this.aspect,Ne=-ye,Ae=-pe;ye-=l.x,Ne-=l.x,pe+=l.y,Ae+=l.y,S=this._camera.getCameraToClipOrthographic(Ne,ye,Ae,pe,this._nearZ,this._farZ),((Oe,be,Ve,Re)=>{for(let Ge=0;Ge<16;Ge++)Oe[Ge]=Wn(be[Ge],Ve[Ge],Re)})(S,S,O,Ut(this.pitch>=15?1:this.pitch/15))}else S=O;const k=f.m.mul([],O,T);let z=f.m.mul([],S,T);if(this.projection.isReprojectedInTileSpace){const pe=this.locationCoordinate(this.center),ye=f.m.identity([]);f.m.translate(ye,ye,[pe.x*this.worldSize,pe.y*this.worldSize,0]),f.m.multiply(ye,ye,f.Q(this)),f.m.translate(ye,ye,[-pe.x*this.worldSize,-pe.y*this.worldSize,0]),f.m.multiply(z,z,ye),f.m.multiply(k,k,ye),this.inverseAdjustmentMatrix=f.S(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=f.m.scale([],z,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=z,this.invProjMatrix=f.m.invert(new Float64Array(16),this.projMatrix),h){const pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);pe[8]=2*-l.x/this.width,pe[9]=2*l.y/this.height,this.expandedFarZProjMatrix=f.m.mul([],pe,T)}else this.expandedFarZProjMatrix=this.projMatrix;const j=f.m.invert([],S);this.frustumCorners=f.T.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=f.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const $=new Float32Array(16);f.m.identity($),f.m.scale($,$,[1,-1,1]),f.m.rotateX($,$,this._pitch),f.m.rotateZ($,$,this.angle);const G=f.m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=f.m.clone(G);const W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-l.x/this.width,G[9]=2*(l.y+W)/this.height,this.skyboxMatrix=f.m.multiply($,G,$);const X=this.point,q=X.x,Z=X.y,ee=this.width%2/2,se=this.height%2/2,ue=Math.cos(this.angle),K=Math.sin(this.angle),ie=q-Math.round(q)+ue*ee+K*se,he=Z-Math.round(Z)+ue*se+K*ee,ge=new Float64Array(z);if(f.m.translate(ge,ge,[ie>.5?ie-1:ie,he>.5?he-1:he,0]),this.alignedProjMatrix=ge,z=f.m.create(),f.m.scale(z,z,[this.width/2,-this.height/2,1]),f.m.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=f.m.create(),f.m.scale(z,z,[1,-1,1]),f.m.translate(z,z,[-1,-1,0]),f.m.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=f.m.multiply(new Float64Array(16),this.labelPlaneMatrix,k),this._calcFogMatrices(),this._distanceTileDataCache={},z=f.m.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=f.V(this);const pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=f.v.transformMat4(pe,pe,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,y=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[l,l,h];f.v.scale(w,w,x),f.v.scale(y,y,-1),f.v.multiply(y,y,w);const T=f.m.create();f.m.translate(T,T,y),f.m.scale(T,T,w),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,h,x)}_computeCameraPosition(l){const h=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-l/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-y[0]*w,x.y/this.worldSize-y[1]*w,l/this.worldSize*this._centerAltitude-y[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],x=l[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((h-y)/x,1)),this._camera.position=f.v.scaleAndAdd([],this._camera.position,l,w),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,h=this._camera.forward(),{pitch:y,bearing:x}=this._camera.getPitchBearing(),w=f.b(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.d(this._maxPitch)),S=Math.max((l[2]-w)/Math.cos(y),T),O=this._zoomFromMercatorZ(S);f.v.scaleAndAdd(l,l,h,S),this._pitch=f.c(y,f.d(this.minPitch),f.d(this.maxPitch)),this.angle=f.w(x,-Math.PI,Math.PI),this._setZoom(f.c(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f.M(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let h=0,y=f.G,x=0,w=1/0;for(;y-h>1e-6&&y>h;){const T=h+.5*(y-h),S=this.tileSize*Math.pow(2,T),O=this.getCameraToCenterDistance(this.projection,T,S),k=this.scaleZoom(O/(l*this.tileSize)),z=Math.abs(T-k);z<w&&(w=z,x=T),T<k?h=T:y=T}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,h){const y=Math.min(l.x,h.x),x=Math.max(l.x,h.x),w=Math.min(l.y,h.y),T=Math.max(l.y,h.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new f.P(y,w),new f.P(x,T),new f.P(y,T),new f.P(x,w)],O=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const z of S){const j=this.pointRayIntersection(z);if(j.t<0)return!0;const $=this.rayIntersectionCoordinate(j);if($.x<O||$.y<0||$.x>k||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.Y(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.P(0,0),new f.P(this.width,this.height))}zoomDeltaToMovement(l,h){const y=f.v.length(f.v.sub([],this._camera.position,l)),x=this._zoomFromMercatorZ(y)+h;return y-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const l=function([h,y,x],w){const T=[h,y,x,1];f.e.transformMat4(T,T,w);const S=T[3]=Math.max(T[3],1e-6);return T[0]/=S,T[1]/=S,T[2]/=S,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new f.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.P(0,l))}}getCameraToCenterDistance(l,h=this.zoom,y=this.worldSize){const x=f.N(l,h,this.width,this.height,1024),w=l.pixelSpaceConversion(this.center.lat,y,x);let T=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(T=Wn(1,T,Ut(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&f.m.multiply(l,l,this.globeMatrix),l}getFrustum(l){return f.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,"meters"===this.projection.zAxisUnit)}}function Vn(m){const{userImage:l}=m;return!!(l&&l.render&&l.render())&&(m.data.replace(new Uint8Array(l.data.buffer)),!0)}class Zr extends f.a6{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new f.a5({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,h){if(this.loaded[h]!==l&&(this.loaded[h]=l,l)){for(const{ids:y,callback:x}of this.requestors)this._notify(y,h,x);this.requestors=[]}}hasImage(l,h){return!!this.getImage(l,h)}getImage(l,h){return this.images[h][l]}addImage(l,h,y){this._validate(l,y)&&(this.images[h][l]=y)}_validate(l,h){let y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new f.a7(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new f.a7(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new f.a7(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,h){if(!l)return!0;let y=0;for(const x of l){if(x[0]<y||x[1]<x[0]||h<x[1])return!1;y=x[1]}return!0}_validateContent(l,h){return!(l&&(4!==l.length||l[0]<0||h.data.width<l[0]||l[1]<0||h.data.height<l[1]||l[2]<0||h.data.width<l[2]||l[3]<0||h.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,h,y){y.version=this.images[h][l].version+1,this.images[h][l]=y,this.updatedImages[h][l]=!0}removeImage(l,h){const y=this.images[h][l];delete this.images[h][l],delete this.patterns[h][l],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,h,y){let x=!0;const w=!!this.loaded[h];if(!w)for(const T of l)this.images[h][T]||(x=!1);w||x?this._notify(l,h,y):this.requestors.push({ids:l,scope:h,callback:y})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,h,y){const x={};for(const w of l){this.images[h][w]||this.fire(new f.a8("styleimagemissing",{id:w}));const T=this.images[h][w];T?x[w]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!(!T.userImage||!T.userImage.render)}:f.X(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,x)}getPixelSize(l){const{width:h,height:y}=this.atlasImage[l];return{width:h,height:y}}getPattern(l,h){const y=this.patterns[h][l],x=this.getImage(l,h);if(!x)return null;if(y&&y.position.version===x.version)return y.position;if(y)y.position.version=x.version;else{const w={w:x.data.width+2,h:x.data.height+2,x:0,y:0},T=new f.ab(w,x);this.patterns[h][l]={bin:w,position:T}}return this._updatePatternAtlas(h),this.patterns[h][l].position}bind(l,h){const y=l.gl;let x=this.atlasTexture[h];x?this.dirty&&(x.update(this.atlasImage[h]),this.dirty=!1):(x=new f.a9(l,this.atlasImage[h],y.RGBA),this.atlasTexture[h]=x),x.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(l){const h=[];for(const T in this.patterns[l])h.push(this.patterns[l][T].bin);const{w:y,h:x}=f.aa(h),w=this.atlasImage[l];w.resize({width:y||1,height:x||1});for(const T in this.patterns[l]){const{bin:S}=this.patterns[l][T],O=S.x+1,k=S.y+1,z=this.images[l][T].data,j=z.width,$=z.height;f.a5.copy(z,w,{x:0,y:0},{x:O,y:k},{width:j,height:$}),f.a5.copy(z,w,{x:0,y:$-1},{x:O,y:k-1},{width:j,height:1}),f.a5.copy(z,w,{x:0,y:0},{x:O,y:k+$},{width:j,height:1}),f.a5.copy(z,w,{x:j-1,y:0},{x:O-1,y:k},{width:1,height:$}),f.a5.copy(z,w,{x:0,y:0},{x:O+j,y:k},{width:1,height:$})}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,h){for(const y of l){if(this.callbackDispatchedThisFrame[h][y])continue;this.callbackDispatchedThisFrame[h][y]=!0;const x=this.images[h][y];Vn(x)&&this.updateImage(y,h,x)}}}const Wr=new f.ac({anchor:new f.ad(f.ae.light.anchor),position:new f.af(f.ae.light.position),color:new f.ad(f.ae.light.color),intensity:new f.ad(f.ae.light.intensity)});class Li extends f.a6{constructor(l,h="flat"){super(),this._transitionable=new f.ag(Wr),this.setLight(l,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,h,y={}){this._validate(f.ah,l,y)||(this._transitionable.setTransitionOrValue(l),this.id=h)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,y){return(!y||!1!==y.validate)&&f.ai(this,l.call(f.aj,f.ak({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.ae})))}}const Go=new f.ac({source:new f.ad(f.ae.terrain.source),exaggeration:new f.ad(f.ae.terrain.exaggeration)});let Ho=class extends f.a6{constructor(m,l,h,y){super(),this.scope=h,this._transitionable=new f.ag(Go,h,y),this._transitionable.setTransitionOrValue(m,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(m,l){this._transitionable.setTransitionOrValue(m,l)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new f.al(m)).get("exaggeration")}isZoomDependent(){const m=this._transitionable._values.exaggeration;return null!=m&&null!=m.value&&null!=m.value.expression&&m.value.expression instanceof f.am}};const Br=45,so=65,yi=.05;function ua(m,l,h,y){const x=f.an(Br,so,h),[w,T]=fi(m,y);let S=1-Math.min(1,Math.exp((l-w)/(T-w)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*x*m.alpha}function fi(m,l){const h=.5/Math.tan(.5*l);return[m.range[0]+h,m.range[1]+h]}function ja(m,l,h,y,x){const w=f.v.transformMat4([],[l,h,y],x.mercatorFogMatrix);return ua(m,f.v.length(w),x.pitch,x._fov)}function yo(m,l,h,y,x,w,T){const S=[[h,y,0],[x,y,0],[x,w,0],[h,w,0]];let O=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(const z of S){const j=f.v.transformMat4([],z,l),$=f.v.length(j);O=Math.min(O,$),k=Math.max(k,$)}return[ua(m,O,T.pitch,T._fov),ua(m,k,T.pitch,T._fov)]}const eh=new f.ac({range:new f.ad(f.ae.fog.range),color:new f.ad(f.ae.fog.color),"high-color":new f.ad(f.ae.fog["high-color"]),"space-color":new f.ad(f.ae.fog["space-color"]),"horizon-blend":new f.ad(f.ae.fog["horizon-blend"]),"star-intensity":new f.ad(f.ae.fog["star-intensity"]),"vertical-range":new f.ad(f.ae.fog["vertical-range"])});class Gl extends f.a6{constructor(l,h){super(),this._transitionable=new f.ag(eh),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const l=this._transform,h="globe"===l.projection.name,y=f.ao(l.zoom),x=this.properties.get("range"),w=[.5,3];return{range:h?[f.n(w[0],x[0],y),f.n(w[1],x[1],y)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,h={}){if(this._validate(f.ap,l,h))return;const y=f.ak({},l);for(const x of Object.keys(f.ae.fog))void 0===y[x]&&(y[x]=f.ae.fog[x].default);this._transitionable.setTransitionOrValue(y)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:f.an(Br,so,l))*h.a}getOpacityAtLatLng(l,h){return this._transform.projection.supportsFog?function(y,x,w){const T=f.M.fromLngLat(x),S=w.elevation?w.elevation.getAtPointOrZero(T):0;return ja(y,T.x,T.y,S,w)}(this.state,l,h):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(l.toUnwrapped());return yo(this.state,h,0,0,f.J,f.J,this._transform)}getOpacityForBounds(l,h,y,x,w){return this._transform.projection.supportsFog?yo(this.state,l,h,y,x,w,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?fi(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const y of h){const x=l.points[y];let w;if(x[2]>=0)w=x;else{const T=l.points[y-4];w=f.aq(T,x,T[2]/(T[2]-x[2]))}if(ja(this.state,w[0],w[1],0,this._transform)>=yi)return!0}return!1}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,y){return(!y||!1!==y.validate)&&f.ai(this,l.call(f.aj,f.ak({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.ae})))}}class dl extends f.a6{constructor(l,h,y,x){super(),this.scope=y,this._options=l,this.properties=new f.ar(h),this._transitionable=new f.ag(h,y,new Map(x)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,h){this._options=l,this._transitionable.setTransitionOrValue(l.properties,h)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const xs=new f.ac({color:new f.ad(f.ae.properties_light_ambient.color),intensity:new f.ad(f.ae.properties_light_ambient.intensity)}),wi=new f.ac({direction:new f.as(f.ae.properties_light_directional.direction),color:new f.ad(f.ae.properties_light_directional.color),intensity:new f.ad(f.ae.properties_light_directional.intensity),"cast-shadows":new f.ad(f.ae.properties_light_directional["cast-shadows"]),"shadow-intensity":new f.ad(f.ae.properties_light_directional["shadow-intensity"])});class ki{constructor(l,h,y,x){this.screenBounds=l,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(l,h){let y,x;if(l instanceof f.P||"number"==typeof l[0]){const w=f.P.convert(l);y=[w],x=h.isPointAboveHorizon(w)}else{const w=f.P.convert(l[0]),T=f.P.convert(l[1]);y=[w,T],x=f.at(w,T).every(S=>h.isPointAboveHorizon(S))}return new ki(y,h.getCameraPoint(),x,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(l){return f.at(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const h=this.screenBounds[0],y=1===this.screenBounds.length?this.screenBounds[0].add(new f.P(1,1)):this.screenBounds[1],x=f.at(h,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<y.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),f.au(x,l)}bufferedCameraGeometryGlobe(l){const h=this.screenBounds[0],y=1===this.screenBounds.length?this.screenBounds[0].add(new f.P(1,1)):this.screenBounds[1],x=f.at(h,y,l),w=this.cameraPoint.clone();switch(3*((w.y>h.y)+(w.y>y.y))+((w.x>h.x)+(w.x>y.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(l,h,y,x=0){const w=l.queryPadding/h._pixelsPerMercatorPixel+1,T=y?this._bufferedCameraMercator(w,h):this._bufferedScreenMercator(w,h);let S=l.tileID.wrap+(T.unwrapped?x:0);const O=T.polygon.map(q=>f.av(l.tileTransform,q,S));if(!f.aw(O,0,0,f.J,f.J))return;S=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const k=this.screenGeometryMercator.polygon.map(q=>f.ax(l.tileTransform,q,S)),z=k.map(q=>new f.P(q[0],q[1])),j=h.getFreeCameraOptions().position||new f.M(0,0,0),$=f.ax(l.tileTransform,j,S),G=k.map(q=>{const Z=f.v.sub(q,q,$);return f.v.normalize(Z,Z),new f.R($,Z)}),W=f.ay(l,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:G,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(X=f.az(O),X.min.x=f.c(X.min.x,0,f.J),X.min.y=f.c(X.min.y,0,f.J),X.max.x=f.c(X.max.x,0,f.J),X.max.y=f.c(X.max.y,0,f.J),X),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:W};var X}_bufferedScreenMercator(l,h){const y=Ei(l);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(l),h):{polygon:this.bufferedScreenGeometry(l).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[y]=x,x}}_bufferedCameraMercator(l,h){const y=Ei(l);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),h):{polygon:this.bufferedCameraGeometry(l).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[y]=x,x}}_projectAndResample(l,h){const y=function(w,T){const S=f.m.multiply([],T.pixelMatrix,T.globeMatrix),O=[0,-f.aC,0,1],k=[0,f.aC,0,1],z=[0,0,0,1];f.e.transformMat4(O,O,S),f.e.transformMat4(k,k,S),f.e.transformMat4(z,z,S);const j=new f.P(O[0]/O[3],O[1]/O[3]),$=new f.P(k[0]/k[3],k[1]/k[3]),G=f.aA(w,j)&&O[3]<z[3],W=f.aA(w,$)&&k[3]<z[3];if(!G&&!W)return null;const X=function(he,ge,pe){for(let ye=1;ye<he.length;ye++){const Ne=vo(ge.pointCoordinate3D(he[ye-1]).x),Ae=vo(ge.pointCoordinate3D(he[ye]).x);if(pe<0){if(Ne<Ae)return{idx:ye,t:-Ne/(Ae-1-Ne)}}else if(Ae<Ne)return{idx:ye,t:(1-Ne)/(Ae+1-Ne)}}return null}(w,T,G?-1:1);if(!X)return null;const{idx:q,t:Z}=X;let ee=q>1?_c(w.slice(0,q),T):[],se=q<w.length?_c(w.slice(q),T):[];ee=ee.map(he=>new f.P(vo(he.x),he.y)),se=se.map(he=>new f.P(vo(he.x),he.y));const ue=[...ee];0===ue.length&&ue.push(se[se.length-1]);const K=f.n(ue[ue.length-1].y,(0===se.length?ee[0]:se[0]).y,Z);let ie;return ie=G?[new f.P(0,K),new f.P(0,0),new f.P(1,0),new f.P(1,K)]:[new f.P(1,K),new f.P(1,1),new f.P(0,1),new f.P(0,K)],ue.push(...ie),0===se.length?ue.push(ee[0]):ue.push(...se),{polygon:ue.map(he=>new f.M(he.x,he.y)),unwrapped:!1}}(l,h);if(y)return y;const x=function(w,T){let S=!1,O=-1/0,k=0;for(let j=0;j<w.length-1;j++)w[j].x>O&&(O=w[j].x,k=j);for(let j=0;j<w.length-1;j++){const $=(k+j)%(w.length-1),G=w[$],W=w[$+1];Math.abs(G.x-W.x)>.5&&(G.x<W.x?(G.x+=1,0===$&&(w[w.length-1].x+=1)):(W.x+=1,$+1===w.length-1&&(w[0].x+=1)),S=!0)}const z=f.E(T.center.lng);return S&&z<Math.abs(z-1)&&w.forEach(j=>{j.x-=1}),{polygon:w,unwrapped:S}}(_c(l,h).map(w=>new f.P(vo(w.x),w.y)),h);return{polygon:x.polygon.map(w=>new f.M(w.x,w.y)),unwrapped:x.unwrapped}}}function _c(m,l){return f.aB(m,h=>{const y=l.pointCoordinate3D(h);h.x=y.x,h.y=y.y},1/256)}function vo(m){return m<0?1+m%1:m%1}function Ei(m){return 100*m|0}function $s(m,l,h,y,x){const w=function(T,S){if(T)return x(T);if(S){m.url&&S.tiles&&m.tiles&&delete m.tiles;const O=f.p(f.ak(S,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(O.vectorLayers=S.vector_layers,O.vectorLayerIds=O.vectorLayers.map(k=>k.id)),O.tiles=l.canonicalizeTileset(O,m.url),x(null,O)}};return m.url?f.a1(l.transformRequest(l.normalizeSourceURL(m.url,null,h,y),f.a2.Source),w):f.a4.frame(()=>w(null,m))}class ho{constructor(l,h,y){this.bounds=f.D.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const h=Math.pow(2,l.z),y=Math.floor(f.E(this.bounds.getWest())*h),x=Math.floor(f.H(this.bounds.getNorth())*h),w=Math.ceil(f.E(this.bounds.getEast())*h),T=Math.ceil(f.H(this.bounds.getSouth())*h);return l.x>=y&&l.x<w&&l.y>=x&&l.y<T}}class De extends f.a6{constructor(l,h,y,x){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.ak(this,f.p(h,["url","scheme","tileSize","promoteId"])),this._options=f.ak({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new f.aD}load(l){this._loaded=!1,this.fire(new f.a8("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=$s(this._options,this.map._requestManager,h,y,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),y&&2!==y.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new f.a7(x))):w&&(f.ak(this,w),w.bounds&&(this.tileBounds=new ho(w.bounds,this.minzoom,this.maxzoom)),f.aH(w.tiles,this.map._requestManager._customAccessToken),this.fire(new f.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.a8("data",{dataType:"source",sourceDataType:"content"}))),l&&l(x)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=f.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return f.ak({},this._options)}loadTile(l,h){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(y,f.a2.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:f.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster};if(x.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state)"loading"===l.state?l.reloadCallback=h:l.request=l.actor.send("reloadTile",x,w.bind(this));else if(l.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",x,w.bind(this),void 0,!0);else{const T=f.aF.call({deduped:this._deduped},x,(S,O)=>{S||!O?w.call(this,S):(x.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},l.actor&&l.actor.send("loadTile",x,w.bind(this),void 0,!0))},!0);l.request={cancel:T}}function w(T,S){return delete l.request,l.aborted?h(null):T&&404!==T.status?h(T):(S&&S.resourceTiming&&(l.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&l.setExpiryData(S),l.loadVectorData(S,this.map.painter),f.aG(this.dispatcher),h(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Pt extends f.a6{constructor(l,h,y,x){super(),this.id=l,this.dispatcher=y,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.ak({type:"raster"},h),f.ak(this,f.p(h,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new f.a8("dataloading",{dataType:"source"})),this._tileJSONRequest=$s(this._options,this.map._requestManager,null,null,(h,y)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new f.a7(h)):y&&(f.ak(this,y),y.bounds&&(this.tileBounds=new ho(y.bounds,this.minzoom,this.maxzoom)),f.aH(y.tiles),this.fire(new f.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.a8("data",{dataType:"source",sourceDataType:"content"}))),l&&l(h)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=f.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return f.ak({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,h){const y=f.a4.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);l.request=f.a3(this.map._requestManager.transformRequest(x,f.a2.Tile),(w,T,S,O)=>(delete l.request,l.aborted?(l.state="unloaded",h(null)):w?(l.state="errored",h(w)):T?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:S,expires:O}),l.setTexture(T,this.map.painter),l.state="loaded",f.aG(this.dispatcher),void h(null)):h(null)))}abortTile(l,h){l.request&&(l.request.cancel(),delete l.request),h()}unloadTile(l,h){l.texture&&l.texture instanceof f.a9?(l.destroy(!0),l.texture&&l.texture instanceof f.a9&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const bs={vector:De,raster:Pt,"raster-dem":class extends Pt{constructor(m,l,h,y){super(m,l,h,y),this.type="raster-dem",this.maxzoom=22,this._options=f.ak({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(m,l){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(x,w){x&&(m.state="errored",l(x)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",l(null))}m.request=f.a3(this.map._requestManager.transformRequest(h,f.a2.Tile),function(x,w,T,S){if(delete m.request,m.aborted)m.state="unloaded",l(null);else if(x)m.state="errored",l(x);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:T,expires:S});const O=ImageBitmap&&w instanceof ImageBitmap&&f.aI(),k=1-(w.width-f.aJ(w.width))/2;k<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const z=O?w:f.a4.getImageData(w,k),j={uid:m.uid,coord:m.tileID,source:this.id,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:k};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",j,y.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const l=m.canonical,h=Math.pow(2,l.z),y=(l.x-1+h)%h,x=0===l.x?m.wrap-1:m.wrap,w=(l.x+1+h)%h,T=l.x+1===h?m.wrap+1:m.wrap,S={};return S[new f.O(m.overscaledZ,x,l.z,y,l.y).key]={backfilled:!1},S[new f.O(m.overscaledZ,T,l.z,w,l.y).key]={backfilled:!1},l.y>0&&(S[new f.O(m.overscaledZ,x,l.z,y,l.y-1).key]={backfilled:!1},S[new f.O(m.overscaledZ,m.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},S[new f.O(m.overscaledZ,T,l.z,w,l.y-1).key]={backfilled:!1}),l.y+1<h&&(S[new f.O(m.overscaledZ,x,l.z,y,l.y+1).key]={backfilled:!1},S[new f.O(m.overscaledZ,m.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},S[new f.O(m.overscaledZ,T,l.z,w,l.y+1).key]={backfilled:!1}),S}},geojson:class extends f.a6{constructor(m,l,h,y){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(y),this._data=l.data,this._options=f.ak({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const x=f.J/this.tileSize;this.workerOptions=f.ak({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(void 0!==l.buffer?l.buffer:128)*x,tolerance:(void 0!==l.tolerance?l.tolerance:.375)*x,extent:f.J,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:void 0!==l.clusterMaxZoom?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:f.J,radius:(void 0!==l.clusterRadius?l.clusterRadius:50)*x,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},l),this}getClusterChildren(m,l){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},l),this}getClusterLeaves(m,l,h,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:l,offset:h},y),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.a8("dataloading",{dataType:"source"})),this._loaded=!1;const m=f.ak({},this.workerOptions);m.scope=this.scope;const l=this._data;"string"==typeof l?(m.request=this.map._requestManager.transformRequest(f.a4.resolveURL(l),f.a2.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(h,y)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new f.a7(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(x.resourceTiming=y.resourceTiming[this.id]),this.fire(new f.a8("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,l){const h=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const y={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:f.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};m.request=this.actor.send(h,y,(x,w)=>(delete m.request,m.destroy(),m.aborted?l(null):x?l(x):(m.loadVectorData(w,this.map.painter,"reloadTile"===h),l(null))),void 0,"loadTile"===h)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.ak({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends f.aK{constructor(m,l,h,y){super(m,l,h,y),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const l of m.urls)this.urls.push(this.map._requestManager.transformRequest(l,f.a2.Source).url);f.aL(this.urls,(l,h)=>{this._loaded=!0,l?this.fire(new f.a7(l)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const l=this.video.seekable;m<l.start(0)||m>l.end(0)?this.fire(new f.a7(new f.aM(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,l=m.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new f.a9(m,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:f.aK,model:class extends f.a6{constructor(m,l,h,y){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const m=[];for(const l in this._options.models){const h=this._options.models[l],y=f.aO(this.map._requestManager.transformRequest(h.uri,f.a2.Model).url).then(x=>{if(!x)return;const w=f.aP(x),T=new f.aQ(l,h.position,h.orientation,w);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(x=>{this.fire(new f.a7(new Error(`Could not load model ${l} from ${h.uri}: ${x.message}`)))});m.push(y)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new f.a8("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new f.a7(new Error(`Could not load models: ${l.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,l){}serialize(){return{type:"model"}}},"batched-model":class extends f.a6{constructor(m,l,h,y){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(m){this.map=m,this.load()}load(m){this._loaded=!1,this.fire(new f.a8("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=$s(this._options,this.map._requestManager,l,h,(y,x)=>{this._tileJSONRequest=null,this._loaded=!0,y?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),h&&2!==h.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new f.a7(y))):x&&(f.ak(this,x),x.bounds&&(this.tileBounds=new ho(x.bounds,this.minzoom,this.maxzoom)),f.aH(x.tiles,this.map._requestManager._customAccessToken),this.fire(new f.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.a8("data",{dataType:"source",sourceDataType:"content"}))),m&&m(y)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,l){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(h,f.a2.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(m.actor&&"expired"!==m.state)if("loading"===m.state)m.reloadCallback=l;else{if(m.buckets){const w=Object.values(m.buckets);for(const T of w)T.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",y,x.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",y,x.bind(this),void 0,!0);function x(w,T){return m.aborted?l(null):w&&404!==w.status?l(w):(T&&(T.resourceTiming&&(m.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&m.setExpiryData(T),m.buckets={...m.buckets,...T.buckets}),m.state="loaded",void l(null))}}serialize(){return f.ak({},this._options)}},canvas:class extends f.aK{constructor(m,l,h,y){super(m,l,h,y),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(w=>"number"!=typeof w))||this.fire(new f.a7(new f.aM(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.a7(new f.aM(`sources.${m}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new f.a7(new f.aM(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof HTMLCanvasElement||this.fire(new f.a7(new f.aM(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.a7(new f.aM(`sources.${m}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.a7(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const l=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof f.aN||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.a9(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends f.a6{constructor(m,l,h,y){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=l,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.a7(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.a7(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ho(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),f.ak(this,f.p(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.p(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.a8("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new f.a8("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:l,y:h,z:y}=m.canonical;return this._implementation.hasTile({x:l,y:h,z:y})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,l){const{x:h,y,z:x}=m.tileID.canonical,w=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:h,y,z:x},{signal:w.signal})).then(function(T){return delete m.request,m.aborted?(m.state="unloaded",l(null)):void 0===T?(m.state="errored",l(null)):null===T?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",l(null)):(S=T)instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement?(this.loadTileData(m,T),m.state="loaded",void l(null)):(m.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var S}.bind(this)).catch(T=>{20!==T.code&&(m.state="errored",l(T))}),m.request.cancel=()=>w.abort()}loadTileData(m,l){m.setTexture(l,this._map.painter)}unloadTile(m,l){if(m.texture&&m.texture instanceof f.a9?(m.destroy(!0),m.texture&&m.texture instanceof f.a9&&this._map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:h,y,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:h,y,z:x})}l()}abortTile(m,l){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=f.aE(this.id,this.scope);this._map.style.clearSource(m)}_update(){this.fire(new f.a8("data",{dataType:"source",sourceDataType:"content"}))}}},ws=function(m,l,h,y){const x=new bs[l.type](m,l,h,y);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return f.aR(["load","abort","unload","serialize","prepare"],x),x};function pi(m,l){const h=f.m.identity([]);return f.m.scale(h,h,[.5*m.width,.5*-m.height,1]),f.m.translate(h,h,[1,-1,0]),f.m.multiply(h,h,m.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(h)}function Vr(m,l,h,y,x,w,T,S=!1){const O=m.tilesIn(y,T,S);O.sort(mi);const k=[];for(const j of O)k.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(l,h,m._state,j,x,w,pi(m.transform,j.tile.tileID),S)});const z=function(j){const $={},G={};for(const W of j){const X=W.queryResults,q=W.wrappedTileID,Z=G[q]=G[q]||{};for(const ee in X){const se=X[ee],ue=Z[ee]=Z[ee]||{},K=$[ee]=$[ee]||[];for(const ie of se)ue[ie.featureIndex]||(ue[ie.featureIndex]=!0,K.push(ie))}}return $}(k);for(const j in z)z[j].forEach($=>{const G=$.feature,W=G.layer;W&&"background"!==W.type&&"sky"!==W.type&&"slot"!==W.type&&(G.source=W.source,W["source-layer"]&&(G.sourceLayer=W["source-layer"]),G.state=void 0!==G.id?m.getFeatureState(W["source-layer"],G.id):{})});return z}function th(m,l){const h=m.getRenderableIds().map(w=>m.getTileByID(w)),y=[],x={};for(let w=0;w<h.length;w++){const T=h[w],S=T.tileID.canonical.key;x[S]||(x[S]=!0,T.querySourceFeatures(y,l))}return y}function mi(m,l){const h=m.tileID,y=l.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}class Tn{constructor(l){this.style=l}processLayersChanged(){this.layers=[];for(const l in this.style._mergedLayers){const h=this.style._mergedLayers[l];if("fill-extrusion"===h.type)this.layers.push(h);else if("model"===h.type){const y=this.style.getLayerSource(h);y&&"batched-model"===y.type&&this.layers.push(h)}}}updateZOffset(l,h){this.currentBuildingBuckets=[];for(let x=0;x<this.layers.length;++x){const w=this.layers[x],T=this.style.getLayerSourceCache(w);let S=1;"fill-extrusion"===w.type&&(S=w.paint.get("fill-extrusion-opacity")>0?w.paint.get("fill-extrusion-vertical-scale"):0);let O=T?T.getTile(h):null;if(!O&&T&&h.canonical.z>T.getSource().minzoom){let k=h.scaledTo(Math.min(T.getSource().maxzoom,h.overscaledZ-1));for(;k.overscaledZ>=T.getSource().minzoom&&(O=T.getTile(k),!O&&0!==k.overscaledZ);)k=k.scaledTo(k.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:O?O.getBucket(w):null,tileID:O?O.tileID:h,verticalScale:S})}l.hasAnyZOffset=!1;let y=!1;for(let x=0;x<l.symbolInstances.length;x++){const w=l.symbolInstances.get(x),T=w.zOffset,S=this._getHeightAtTileOffset(h,w.tileAnchorX,w.tileAnchorY);w.zOffset=-1!==S?S:T,y||T===w.zOffset||(y=!0),l.hasAnyZOffset||0===w.zOffset||(l.hasAnyZOffset=!0)}y&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,h,y,x){let w=h,T=y;if(l.canonical.z!==x.canonical.z){const S=x.canonical,O=1/(1<<l.canonical.z-S.z);w=(h+l.canonical.x*f.J)*O-S.x*f.J|0,T=(y+l.canonical.y*f.J)*O-S.y*f.J|0}return{tileX:w,tileY:T}}_getHeightAtTileOffset(l,h,y){let x,w;for(let T=0;T<this.layers.length;++T){if("fill-extrusion"!==this.layers[T].type)continue;const{bucket:S,tileID:O,verticalScale:k}=this.currentBuildingBuckets[T];if(!S)continue;const{tileX:z,tileY:j}=this._mapCoordToOverlappingTile(l,h,y,O),$=S.getHeightAtTileCoord(z,j);$&&void 0!==$.height&&($.hidden?x=$.height:w=Math.max($.height*k,w||0))}if(void 0!==w)return w;for(let T=0;T<this.layers.length;++T){if("model"!==this.layers[T].type)continue;const{bucket:S,tileID:O}=this.currentBuildingBuckets[T];if(!S)continue;const{tileX:k,tileY:z}=this._mapCoordToOverlappingTile(l,h,y,O),j=S.getHeightAtTileCoord(k,z);if(j&&!j.hidden)return void 0===j.height&&void 0!==x?Math.min(j.maxHeight,x)*j.verticalScale:(j.height||0)*j.verticalScale}return-1}}function cd(m,l){const h={};for(const y in m)"ref"!==y&&(h[y]=m[y]);return f.aS.forEach(y=>{y in l&&(h[y]=l[y])}),h}function ha(m){m=m.slice();const l=Object.create(null);for(let h=0;h<m.length;h++)l[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=cd(m[h],l[m[h].ref]));return m}const He={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function Mn(m,l,h){h.push({command:He.addSource,args:[m,l[m]]})}function P(m,l,h){l.push({command:He.removeSource,args:[m]}),h[m]=!0}function V(m,l,h,y){P(m,h,y),Mn(m,l,h)}function te(m,l,h){let y;for(y in m[h])if(m[h].hasOwnProperty(y)&&"data"!==y&&!en(m[h][y],l[h][y]))return!1;for(y in l[h])if(l[h].hasOwnProperty(y)&&"data"!==y&&!en(m[h][y],l[h][y]))return!1;return!0}function ce(m,l,h,y,x,w){let T;for(T in l=l||{},m=m||{})m.hasOwnProperty(T)&&(en(m[T],l[T])||h.push({command:w,args:[y,T,l[T],x]}));for(T in l)l.hasOwnProperty(T)&&!m.hasOwnProperty(T)&&(en(m[T],l[T])||h.push({command:w,args:[y,T,l[T],x]}))}function xe(m){return m.id}function we(m,l){return m[l.id]=l,m}class Te{constructor(l,h){this.reset(l,h)}reset(l,h){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=f.c(l,0,1);let h=1,y=this._distances[h];const x=l*this.paddedLength+this.padding;for(;y<x&&h<this._distances.length;)y=this._distances[++h];const w=h-1,T=this._distances[w],S=y-T,O=S>0?(x-T)/S:0;return this.points[w].mult(1-O).add(this.points[h].mult(O))}}class Le{constructor(l,h,y){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(h/y);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,h,y,x,w){this._forEachCell(h,y,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(l,h,y,x){this._forEachCell(h-x,y-x,h+x,y+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(y),this.circles.push(x)}_insertBoxCell(l,h,y,x,w,T){this.boxCells[w].push(T)}_insertCircleCell(l,h,y,x,w,T){this.circleCells[w].push(T)}_query(l,h,y,x,w,T){if(y<0||l>this.width||x<0||h>this.height)return!w&&[];const S=[];if(l<=0&&h<=0&&this.width<=y&&this.height<=x){if(w)return!0;for(let O=0;O<this.boxKeys.length;O++)S.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const k=this.circles[3*O],z=this.circles[3*O+1],j=this.circles[3*O+2];S.push({key:this.circleKeys[O],x1:k-j,y1:z-j,x2:k+j,y2:z+j})}return T?S.filter(T):S}return this._forEachCell(l,h,y,x,this._queryCell,S,{hitTest:w,seenUids:{box:{},circle:{}}},T),w?S.length>0:S}_queryCircle(l,h,y,x,w){const T=l-y,S=l+y,O=h-y,k=h+y;if(S<0||T>this.width||k<0||O>this.height)return!x&&[];const z=[];return this._forEachCell(T,O,S,k,this._queryCellCircle,z,{hitTest:x,circle:{x:l,y:h,radius:y},seenUids:{box:{},circle:{}}},w),x?z.length>0:z}query(l,h,y,x,w){return this._query(l,h,y,x,!1,w)}hitTest(l,h,y,x,w){return this._query(l,h,y,x,!0,w)}hitTestCircle(l,h,y,x){return this._queryCircle(l,h,y,!0,x)}_queryCell(l,h,y,x,w,T,S,O){const k=S.seenUids,z=this.boxCells[w];if(null!==z){const $=this.bboxes;for(const G of z)if(!k.box[G]){k.box[G]=!0;const W=4*G;if(l<=$[W+2]&&h<=$[W+3]&&y>=$[W+0]&&x>=$[W+1]&&(!O||O(this.boxKeys[G]))){if(S.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[G],x1:$[W],y1:$[W+1],x2:$[W+2],y2:$[W+3]})}}}const j=this.circleCells[w];if(null!==j){const $=this.circles;for(const G of j)if(!k.circle[G]){k.circle[G]=!0;const W=3*G;if(this._circleAndRectCollide($[W],$[W+1],$[W+2],l,h,y,x)&&(!O||O(this.circleKeys[G]))){if(S.hitTest)return T.push(!0),!0;{const X=$[W],q=$[W+1],Z=$[W+2];T.push({key:this.circleKeys[G],x1:X-Z,y1:q-Z,x2:X+Z,y2:q+Z})}}}}}_queryCellCircle(l,h,y,x,w,T,S,O){const k=S.circle,z=S.seenUids,j=this.boxCells[w];if(null!==j){const G=this.bboxes;for(const W of j)if(!z.box[W]){z.box[W]=!0;const X=4*W;if(this._circleAndRectCollide(k.x,k.y,k.radius,G[X+0],G[X+1],G[X+2],G[X+3])&&(!O||O(this.boxKeys[W])))return T.push(!0),!0}}const $=this.circleCells[w];if(null!==$){const G=this.circles;for(const W of $)if(!z.circle[W]){z.circle[W]=!0;const X=3*W;if(this._circlesCollide(G[X],G[X+1],G[X+2],k.x,k.y,k.radius)&&(!O||O(this.circleKeys[W])))return T.push(!0),!0}}}_forEachCell(l,h,y,x,w,T,S,O){const k=this._convertToXCellCoord(l),z=this._convertToYCellCoord(h),j=this._convertToXCellCoord(y),$=this._convertToYCellCoord(x);for(let G=k;G<=j;G++)for(let W=z;W<=$;W++)if(w.call(this,l,h,y,x,this.xCellCount*W+G,T,S,O))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,h,y,x,w,T){const S=x-l,O=w-h,k=y+T;return k*k>S*S+O*O}_circleAndRectCollide(l,h,y,x,w,T,S){const O=(T-x)/2,k=Math.abs(l-(x+O));if(k>O+y)return!1;const z=(S-w)/2,j=Math.abs(h-(w+z));if(j>z+y)return!1;if(k<=O||j<=z)return!0;const $=k-O,G=j-z;return $*$+G*G<=y*y}}const nt=100;class jt{constructor(l,h,y=new Le(l.width+200,l.height+200,25),x=new Le(l.width+200,l.height+200,25)){this.transform=l,this.grid=y,this.ignoredGrid=x,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+nt,this.screenBottomBoundary=l.height+nt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=h}placeCollisionBox(l,h,y,x,w,T,S,O){let k=y.projectedAnchorX,z=y.projectedAnchorY,j=y.projectedAnchorZ;const $=y.elevation,G=y.tileID,W=l.getProjection();if($&&G){const[ie,he,ge]=W.upVector(G.canonical,y.tileAnchorX,y.tileAnchorY),pe=W.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=ie*$*pe,z+=he*$*pe,j+=ge*$*pe}const X=this.projectAndGetPerspectiveRatio(S,k,z,j,y.tileID,"globe"===W.name||!!$||this.transform.pitch>0,W),q=T*X.perspectiveRatio,Z=(y.x1*h+x.x-y.padding)*q+X.point.x,ee=(y.y1*h+x.y-y.padding)*q+X.point.y,se=(y.x2*h+x.x+y.padding)*q+X.point.x,ue=(y.y2*h+x.y+y.padding)*q+X.point.y,K=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(Z,ee,se,ue)||!w&&this.grid.hitTest(Z,ee,se,ue,O)||K?{box:[],offscreen:!1,occluded:X.occluded}:{box:[Z,ee,se,ue],offscreen:this.isOffscreen(Z,ee,se,ue),occluded:!1}}placeCollisionCircles(l,h,y,x,w,T,S,O,k,z,j,$,G,W,X){const q=[],Z=this.transform.elevation,ee=l.getProjection(),se=Z?Z.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,ee):null,ue=new f.P(y.tileAnchorX,y.tileAnchorY);let{x:K,y:ie,z:he}=ee.projectTilePoint(ue.x,ue.y,X.canonical);if(se){const[Ge,re,Me]=se(ue);K+=Ge,ie+=re,he+=Me}const ge="globe"===ee.name,pe=this.projectAndGetPerspectiveRatio(S,K,ie,he,X,ge||!!Z||this.transform.pitch>0,ee),{perspectiveRatio:ye}=pe,Ne=(j?T/ye:T*ye)/f.aV,Ae=Or(K,ie,he,O),Oe=pe.signedDistanceFromCamera>0?lt(Ne,w,y.lineOffsetX*Ne,y.lineOffsetY*Ne,!1,Ae,ue,y,x,O,{},Z&&!j?se:null,j&&!!Z,ee,X,j):null;let be=!1,Ve=!1,Re=!0;if(Oe&&!pe.occluded){const Ge=.5*G*ye+W,re=new f.P(-100,-100),Me=new f.P(this.screenRightBoundary,this.screenBottomBoundary),tt=new Te,{first:Xe,last:At}=Oe,vt=Xe.path.length;let Vt=[];for(let Yt=vt-1;Yt>=1;Yt--)Vt.push(Xe.path[Yt]);for(let Yt=1;Yt<At.path.length;Yt++)Vt.push(At.path[Yt]);const xt=2.5*Ge;k&&(Vt=Vt.map(([Yt,Lt,Ft],zn)=>(se&&!ge&&(Ft=se(zn<vt-1?Xe.tilePath[vt-1-zn]:At.tilePath[zn-vt+2])[2]),Or(Yt,Lt,Ft,k))),Vt.some(Yt=>Yt[3]<=0)&&(Vt=[]));let Xt=[];if(Vt.length>0){let Yt=1/0,Lt=-1/0,Ft=1/0,zn=-1/0;for(const ke of Vt)Yt=Math.min(Yt,ke[0]),Ft=Math.min(Ft,ke[1]),Lt=Math.max(Lt,ke[0]),zn=Math.max(zn,ke[1]);Lt>=re.x&&Yt<=Me.x&&zn>=re.y&&Ft<=Me.y&&(Xt=[Vt.map(ke=>new f.P(ke[0],ke[1]))],(Yt<re.x||Lt>Me.x||Ft<re.y||zn>Me.y)&&(Xt=f.aT(Xt,re.x,re.y,Me.x,Me.y)))}for(const Yt of Xt){tt.reset(Yt,.25*Ge);let Lt=0;Lt=tt.length<=.5*Ge?1:Math.ceil(tt.paddedLength/xt)+1;for(let Ft=0;Ft<Lt;Ft++){const zn=Ft/Math.max(Lt-1,1),ke=tt.lerp(zn),ln=ke.x+nt,ar=ke.y+nt;q.push(ln,ar,Ge,0);const Eo=ln-Ge,Kr=ar-Ge,lr=ln+Ge,Rn=ar+Ge;if(Re=Re&&this.isOffscreen(Eo,Kr,lr,Rn),Ve=Ve||this.isInsideGrid(Eo,Kr,lr,Rn),!h&&this.grid.hitTestCircle(ln,ar,Ge,$)&&(be=!0,!z))return{circles:[],offscreen:!1,collisionDetected:be,occluded:!1}}}}return{circles:!z&&be||!Ve?[]:q,offscreen:Re,collisionDetected:be,occluded:pe.occluded}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let y=1/0,x=1/0,w=-1/0,T=-1/0;for(const z of l){const j=new f.P(z.x+nt,z.y+nt);y=Math.min(y,j.x),x=Math.min(x,j.y),w=Math.max(w,j.x),T=Math.max(T,j.y),h.push(j)}const S=this.grid.query(y,x,w,T).concat(this.ignoredGrid.query(y,x,w,T)),O={},k={};for(const z of S){const j=z.key;if(void 0===O[j.bucketInstanceId]&&(O[j.bucketInstanceId]={}),O[j.bucketInstanceId][j.featureIndex])continue;const $=[new f.P(z.x1,z.y1),new f.P(z.x2,z.y1),new f.P(z.x2,z.y2),new f.P(z.x1,z.y2)];f.aU(h,$)&&(O[j.bucketInstanceId][j.featureIndex]=!0,void 0===k[j.bucketInstanceId]&&(k[j.bucketInstanceId]=[]),k[j.bucketInstanceId].push(j.featureIndex))}return k}insertCollisionBox(l,h,y,x,w){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:x,collisionGroupID:w},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,h,y,x,w){const T=h?this.ignoredGrid:this.grid,S={bucketInstanceId:y,featureIndex:x,collisionGroupID:w};for(let O=0;O<l.length;O+=4)T.insertCircle(S,l[O],l[O+1],l[O+2])}projectAndGetPerspectiveRatio(l,h,y,x,w,T,S){const O=[h,y,x,1];let k=!1;x||this.transform.pitch>0?(f.e.transformMat4(O,O,l),this.fogState&&w&&"globe"!==S.name&&(k=function($,G,W,X,q,Z){const ee=Z.calculateFogTileMatrix(q),se=[G,W,X];return f.v.transformMat4(se,se,ee),ua($,f.v.length(se),Z.pitch,Z._fov)}(this.fogState,h,y,x,w.toUnwrapped(),this.transform)>.9)):tn(O,O,l);const z=O[3];return{point:new f.P((O[0]/z+1)/2*this.transform.width+nt,(-O[1]/z+1)/2*this.transform.height+nt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/z*.5,1.5),signedDistanceFromCamera:z,occluded:T&&O[2]>z||k}}isOffscreen(l,h,y,x){return y<nt||l>=this.screenRightBoundary||x<nt||h>this.screenBottomBoundary}isInsideGrid(l,h,y,x){return y>=0&&l<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const l=f.m.identity([]);return f.m.translate(l,l,[-100,-100,0]),l}}function zt(m,l,h){const y=l.createTileMatrix(m,m.worldSize,h.toUnwrapped());return f.m.multiply(new Float32Array(16),m.projMatrix,y)}function Rt(m,l,h){if(l.projection.name===h.projection.name)return m.projMatrix;const y=h.clone();return y.setProjection(l.projection),zt(y,l.getProjection(),m)}function $e(m,l,h){return l.name===h.projection.name?m.projMatrix:zt(h,l,m)}class Tr{constructor(l,h,y,x){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):x&&y?1:0,this.placed=y}isHidden(){return 0===this.opacity&&!this.placed}}class Mt{constructor(l,h,y,x,w,T=!1){this.text=new Tr(l?l.text:null,h,y,w),this.icon=new Tr(l?l.icon:null,h,x,w),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _n{constructor(l,h,y,x=!1){this.text=l,this.icon=h,this.skipFade=y,this.clipped=x}}class ft{constructor(){this.invProjMatrix=f.m.create(),this.viewportMatrix=f.m.create(),this.circles=[]}}class rn{constructor(l,h,y,x,w){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=x,this.tileID=w}}class xr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[l]}}function pr(m,l,h,y,x){const{horizontalAlign:w,verticalAlign:T}=f.aY(m),S=-(w-.5)*l,O=-(T-.5)*h,k=f.aW(m,y);return new f.P(S+k[0]*x,O+k[1]*x)}function un(m,l,h,y,x){const w=new f.P(m,l);return h&&w._rotate(y?x:-x),w}class au{constructor(l,h,y,x,w,T){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new jt(this.transform,w),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new xr(y),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,h,y,x){const w=y.getBucket(h),T=y.latestFeatureIndex;if(!w||!T||h.fqid!==w.layerIds[0])return;const S=w.layers[0].layout,O=y.collisionBoxArray,k=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),z=y.tileSize/f.J,j=y.tileID.toUnwrapped();this.transform.setProjection(w.projection);const $=(G=y.tileID,W=w.getProjection(),X=this.transform,W.name===this.projection?X.calculateProjMatrix(G.toUnwrapped()):zt(X,W,G));var G,W,X;const q="map"===S.get("text-pitch-alignment"),Z="map"===S.get("text-rotation-alignment");h.compileFilter();const ee=h.dynamicFilter(),se=h.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(y),K=Us($,y.tileID.canonical,q,Z,this.transform,w.getProjection(),ue);let ie=null;if(q){const pe=vs($,y.tileID.canonical,q,Z,this.transform,w.getProjection(),ue);ie=f.m.multiply([],this.transform.labelPlaneMatrix,pe)}let he=null;ee&&y.latestFeatureIndex&&(he={unwrappedTileID:j,dynamicFilter:ee,dynamicFilterNeedsFeature:se,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new rn(w.bucketInstanceId,T,w.sourceLayerIndex,w.index,y.tileID);const ge={bucket:w,layout:S,posMatrix:$,textLabelPlaneMatrix:K,labelToScreenMatrix:ie,clippingData:he,scale:k,textPixelRatio:z,holdingForFade:y.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:f.i(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.i(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(const pe of w.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:Ne,symbolInstanceEnd:Ae}=pe;l.push({sortKey:ye,symbolInstanceStart:Ne,symbolInstanceEnd:Ae,parameters:ge})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(l,h,y,x,w,T,S,O,k,z,j,$,G,W,X,q,Z,ee){const{textOffset0:se,textOffset1:ue,crossTileID:K}=$,ie=[se,ue],he=pr(l,y,x,ie,w),ge=this.collisionIndex.placeCollisionBox(W,w,h,un(he.x,he.y,T,S,this.transform.angle),j,O,k,z.predicate);if(q){const pe=W.getSymbolInstanceIconSize(ee,this.transform.zoom,$.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(W,pe,q,un(he.x,he.y,T,S,this.transform.angle),j,O,k,z.predicate).box.length)return}if(ge.box.length>0){let pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[K]&&this.prevPlacement.placements[K]&&this.prevPlacement.placements[K].text&&(pe=this.prevPlacement.variableOffsets[K].anchor),this.variableOffsets[K]={textOffset:ie,width:y,height:x,anchor:l,textScale:w,prevAnchor:pe},this.markUsedJustification(W,l,$,X),W.allowVerticalPlacement&&(this.markUsedOrientation(W,X,$),this.placedOrientations[K]=X),{shift:he,placedGlyphBoxes:ge}}}placeLayerBucketPart(l,h,y,x){const{bucket:w,layout:T,posMatrix:S,textLabelPlaneMatrix:O,labelToScreenMatrix:k,clippingData:z,textPixelRatio:j,holdingForFade:$,collisionBoxArray:G,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:X,collisionGroup:q}=l.parameters,Z=T.get("text-optional"),ee=T.get("icon-optional"),se=T.get("text-allow-overlap"),ue=T.get("icon-allow-overlap"),K="map"===T.get("text-rotation-alignment"),ie="map"===T.get("text-pitch-alignment"),he="viewport-y"===T.get("symbol-z-order"),ge=T.get("symbol-z-elevate");this.transform.setProjection(w.projection);let pe=se&&(ue||!w.hasIconData()||ee),ye=ue&&(se||!w.hasTextData()||Z);!w.collisionArrays&&G&&w.deserializeCollisionBoxes(G),y&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,G);const Ne=(Ae,Oe,be)=>{const{crossTileID:Ve,numVerticalGlyphVertices:Re}=Ae;if(z){const lr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Rn=null;if(z.dynamicFilterNeedsFeature){const In=this.retainedQueryData[w.bucketInstanceId];Rn=z.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:In.bucketIndex,sourceLayerIndex:In.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(lr,Rn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new f.P(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Ve]=new _n(!1,!1,!1,!0),void h.add(Ve)}if(h.has(Ve))return;if($)return void(this.placements[Ve]=new _n(!1,!1,!1));let Ge=!1,re=!1,Me=!0,tt=!1,Xe=!1,At=null,vt={box:null,offscreen:null,occluded:null},Vt={box:null,offscreen:null,occluded:null},xt=null,Xt=null,Yt=null,Lt=0,Ft=0,zn=0;be.textFeatureIndex?Lt=be.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(Lt=Ae.featureIndex),be.verticalTextFeatureIndex&&(Ft=be.verticalTextFeatureIndex);const ke=lr=>{lr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Rn=this.transform.elevation;lr.elevation=Ae.zOffset+(Rn?Rn.getAtTileOffset(lr.tileID,lr.tileAnchorX,lr.tileAnchorY):0)},ln=be.textBox;if(ln){ke(ln);const lr=In=>{let Sr=f.W.horizontal;if(w.allowVerticalPlacement&&!In&&this.prevPlacement){const Wi=this.prevPlacement.placedOrientations[Ve];Wi&&(this.placedOrientations[Ve]=Wi,Sr=Wi,this.markUsedOrientation(w,Sr,Ae))}return Sr},Rn=(In,Sr)=>{if(w.allowVerticalPlacement&&Re>0&&be.verticalTextBox){for(const Wi of w.writingModes)if(Wi===f.W.vertical?(vt=Sr(),Vt=vt):vt=In(),vt&&vt.box&&vt.box.length)break}else vt=In()};if(T.get("text-variable-anchor")){let In=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ve]){const Ir=this.prevPlacement.variableOffsets[Ve];In.indexOf(Ir.anchor)>0&&(In=In.filter(Fo=>Fo!==Ir.anchor),In.unshift(Ir.anchor))}const Sr=(Ir,Fo,No)=>{const Ar=w.getSymbolInstanceTextSize(W,Ae,this.transform.zoom,Oe),Qi=(Ir.x2-Ir.x1)*Ar+2*Ir.padding,Qa=(Ir.y2-Ir.y1)*Ar+2*Ir.padding,zo=Ae.hasIconTextFit&&!ue?Fo:null;zo&&ke(zo);let qn={box:[],offscreen:!1,occluded:!1};const Ea=se?2*In.length:In.length;for(let Ca=0;Ca<Ea;++Ca){const Sl=this.attemptAnchorPlacement(In[Ca%In.length],Ir,Qi,Qa,Ar,K,ie,j,S,q,Ca>=In.length,Ae,Oe,w,No,zo,W,X);if(Sl&&(qn=Sl.placedGlyphBoxes,qn&&qn.box&&qn.box.length)){Ge=!0,At=Sl.shift;break}}return qn};Rn(()=>Sr(ln,be.iconBox,f.W.horizontal),()=>{const Ir=be.verticalTextBox;return Ir&&ke(Ir),w.allowVerticalPlacement&&!(vt&&vt.box&&vt.box.length)&&Re>0&&Ir?Sr(Ir,be.verticalIconBox,f.W.vertical):{box:null,offscreen:null,occluded:null}}),vt&&(Ge=vt.box,Me=vt.offscreen,tt=vt.occluded);const Wi=lr(!(!vt||!vt.box));if(!Ge&&this.prevPlacement){const Ir=this.prevPlacement.variableOffsets[Ve];Ir&&(this.variableOffsets[Ve]=Ir,this.markUsedJustification(w,Ir.anchor,Ae,Wi))}}else{const In=(Sr,Wi)=>{const Ir=w.getSymbolInstanceTextSize(W,Ae,this.transform.zoom,Oe),Fo=this.collisionIndex.placeCollisionBox(w,Ir,Sr,new f.P(0,0),se,j,S,q.predicate);return Fo&&Fo.box&&Fo.box.length&&(this.markUsedOrientation(w,Wi,Ae),this.placedOrientations[Ve]=Wi),Fo};Rn(()=>In(ln,f.W.horizontal),()=>{const Sr=be.verticalTextBox;return w.allowVerticalPlacement&&Re>0&&Sr?(ke(Sr),In(Sr,f.W.vertical)):{box:null,offscreen:null,occluded:null}}),lr(!!(vt&&vt.box&&vt.box.length))}}if(xt=vt,Ge=xt&&xt.box&&xt.box.length>0,Me=xt&&xt.offscreen,tt=xt&&xt.occluded,Ae.useRuntimeCollisionCircles){const lr=w.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),Rn=f.j(w.textSizeData,W,lr),In=T.get("text-padding");Xt=this.collisionIndex.placeCollisionCircles(w,se,lr,w.lineVertexArray,w.glyphOffsetArray,Rn,S,O,k,y,ie,q.predicate,Ae.collisionCircleDiameter*Rn/f.aV,In,this.retainedQueryData[w.bucketInstanceId].tileID),Ge=se||Xt.circles.length>0&&!Xt.collisionDetected,Me=Me&&Xt.offscreen,tt=Xt.occluded}if(be.iconFeatureIndex&&(zn=be.iconFeatureIndex),be.iconBox){const lr=Rn=>{ke(Rn);const In=Ae.hasIconTextFit&&At?un(At.x,At.y,K,ie,this.transform.angle):new f.P(0,0),Sr=w.getSymbolInstanceIconSize(X,this.transform.zoom,Ae.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Sr,Rn,In,ue,j,S,q.predicate)};Vt&&Vt.box&&Vt.box.length&&be.verticalIconBox?(Yt=lr(be.verticalIconBox),re=Yt.box.length>0):(Yt=lr(be.iconBox),re=Yt.box.length>0),Me=Me&&Yt.offscreen,Xe=Yt.occluded}const ar=Z||0===Ae.numHorizontalGlyphVertices&&0===Re,Eo=ee||0===Ae.numIconVertices;if(ar||Eo?Eo?ar||(re=re&&Ge):Ge=re&&Ge:re=Ge=re&&Ge,Ge&&xt&&xt.box&&this.collisionIndex.insertCollisionBox(xt.box,T.get("text-ignore-placement"),w.bucketInstanceId,Vt&&Vt.box&&Ft?Ft:Lt,q.ID),re&&Yt&&this.collisionIndex.insertCollisionBox(Yt.box,T.get("icon-ignore-placement"),w.bucketInstanceId,zn,q.ID),Xt&&(Ge&&this.collisionIndex.insertCollisionCircles(Xt.circles,T.get("text-ignore-placement"),w.bucketInstanceId,Lt,q.ID),y)){const lr=w.bucketInstanceId;let Rn=this.collisionCircleArrays[lr];void 0===Rn&&(Rn=this.collisionCircleArrays[lr]=new ft);for(let In=0;In<Xt.circles.length;In+=4)Rn.circles.push(Xt.circles[In+0]),Rn.circles.push(Xt.circles[In+1]),Rn.circles.push(Xt.circles[In+2]),Rn.circles.push(Xt.collisionDetected?1:0)}const Kr="globe"!==w.projection.name;pe=pe&&(Kr||!tt),ye=ye&&(Kr||!Xe),this.placements[Ve]=new _n(Ge||pe,re||ye,Me||w.justReloaded),h.add(Ve)};if(ge&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),he){const Ae=w.getSortedSymbolIndexes(this.transform.angle);for(let Oe=Ae.length-1;Oe>=0;--Oe){const be=Ae[Oe];Ne(w.symbolInstances.get(be),be,w.collisionArrays[be])}w.hasAnyZOffset&&f.X(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Ae=w.getSortedIndexesByZOffset();for(let Oe=0;Oe<Ae.length;++Oe){const be=Ae[Oe];Ne(w.symbolInstances.get(be),be,w.collisionArrays[be])}}else for(let Ae=l.symbolInstanceStart;Ae<l.symbolInstanceEnd;Ae++)Ne(w.symbolInstances.get(Ae),Ae,w.collisionArrays[Ae]);if(y&&w.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[w.bucketInstanceId];f.m.invert(Ae.invProjMatrix,S),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(l,h,y,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:O,crossTileID:k}=y,z=f.aX(h),j=x===f.W.vertical?O:"left"===z?w:"center"===z?T:"right"===z?S:-1;w>=0&&(l.text.placedSymbolArray.get(w).crossTileID=j>=0&&w!==j?0:k),T>=0&&(l.text.placedSymbolArray.get(T).crossTileID=j>=0&&T!==j?0:k),S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=j>=0&&S!==j?0:k),O>=0&&(l.text.placedSymbolArray.get(O).crossTileID=j>=0&&O!==j?0:k)}markUsedOrientation(l,h,y){const x=h===f.W.horizontal||h===f.W.horizontalOnly?h:0,w=h===f.W.vertical?h:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:k}=y,z=l.text.placedSymbolArray;T>=0&&(z.get(T).placedOrientation=x),S>=0&&(z.get(S).placedOrientation=x),O>=0&&(z.get(O).placedOrientation=x),k>=0&&(z.get(k).placedOrientation=w)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(l):1,w=h?h.opacities:{},T=h?h.variableOffsets:{},S=h?h.placedOrientations:{};for(const O in this.placements){const k=this.placements[O],z=w[O];z?(this.opacities[O]=new Mt(z,x,k.text,k.icon,null,k.clipped),y=y||k.text!==z.text.placed||k.icon!==z.icon.placed):(this.opacities[O]=new Mt(null,x,k.text,k.icon,k.skipFade,k.clipped),y=y||k.text||k.icon)}for(const O in w){const k=w[O];if(!this.opacities[O]){const z=new Mt(k,x,!1,!1);z.isHidden()||(this.opacities[O]=z,y=y||k.text.placed||k.icon.placed)}}for(const O in T)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=T[O]);for(const O in S)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=S[O]);y?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)}updateLayerOpacities(l,h){const y=new Set;for(const x of h){const w=x.getBucket(l);w&&x.latestFeatureIndex&&l.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,y,x.collisionBoxArray),w.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,x.tileID),w.updateZOffset()))}}updateBucketOpacities(l,h,y){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const x=l.layers[0].layout,w=!!l.layers[0].dynamicFilter(),T=new Mt(null,0,!1,!1,!0),S=x.get("text-allow-overlap"),O=x.get("icon-allow-overlap"),k=x.get("text-variable-anchor"),z="map"===x.get("text-rotation-alignment"),j="map"===x.get("text-pitch-alignment"),$=new Mt(null,0,S&&(O||!l.hasIconData()||x.get("icon-optional")),O&&(S||!l.hasTextData()||x.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const G=(X,q,Z)=>{for(let ee=0;ee<q/4;ee++)X.opacityVertexArray.emplaceBack(Z)};let W=0;for(let X=0;X<l.symbolInstances.length;X++){const q=l.symbolInstances.get(X),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:ee,crossTileID:se,numIconVertices:ue}=q,K=h.has(se);let ie=this.opacities[se];K?ie=T:ie||(ie=$,this.opacities[se]=ie),h.add(se);const he=Z>0||ee>0,ge=ue>0,pe=this.placedOrientations[se],ye=pe===f.W.vertical,Ne=pe===f.W.horizontal||pe===f.W.horizontalOnly;if(!he&&!ge||ie.isHidden()||W++,he){const Ae=pl(ie.text);G(l.text,Z,ye?ui:Ae),G(l.text,ee,Ne?ui:Ae);const Oe=ie.text.isHidden(),{leftJustifiedTextSymbolIndex:be,centerJustifiedTextSymbolIndex:Ve,rightJustifiedTextSymbolIndex:Re,verticalPlacedTextSymbolIndex:Ge}=q,re=l.text.placedSymbolArray,Me=Oe||ye?1:0;be>=0&&(re.get(be).hidden=Me),Ve>=0&&(re.get(Ve).hidden=Me),Re>=0&&(re.get(Re).hidden=Me),Ge>=0&&(re.get(Ge).hidden=Oe||Ne?1:0);const tt=this.variableOffsets[se];tt&&this.markUsedJustification(l,tt.anchor,q,pe);const Xe=this.placedOrientations[se];Xe&&(this.markUsedJustification(l,"left",q,Xe),this.markUsedOrientation(l,Xe,q))}if(ge){const Ae=pl(ie.icon),{placedIconSymbolIndex:Oe,verticalPlacedIconSymbolIndex:be}=q,Ve=l.icon.placedSymbolArray,Re=ie.icon.isHidden()?1:0;Oe>=0&&(G(l.icon,ue,ye?ui:Ae),Ve.get(Oe).hidden=Re),be>=0&&(G(l.icon,q.numVerticalIconVertices,Ne?ui:Ae),Ve.get(be).hidden=Re)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Ae=l.collisionArrays[X];if(Ae){let Oe=new f.P(0,0),be=!0;if(Ae.textBox||Ae.verticalTextBox){if(k){const Re=this.variableOffsets[se];Re?(Oe=pr(Re.anchor,Re.width,Re.height,Re.textOffset,Re.textScale),z&&Oe._rotate(j?this.transform.angle:-this.transform.angle)):be=!1}w&&(be=!ie.clipped),Ae.textBox&&fl(l.textCollisionBox.collisionVertexArray,ie.text.placed,!be||ye,Oe.x,Oe.y),Ae.verticalTextBox&&fl(l.textCollisionBox.collisionVertexArray,ie.text.placed,!be||Ne,Oe.x,Oe.y)}const Ve=be&&!(Ne||!Ae.verticalIconBox);Ae.iconBox&&fl(l.iconCollisionBox.collisionVertexArray,ie.icon.placed,Ve,q.hasIconTextFit?Oe.x:0,q.hasIconTextFit?Oe.y:0),Ae.verticalIconBox&&fl(l.iconCollisionBox.collisionVertexArray,ie.icon.placed,!Ve,q.hasIconTextFit?Oe.x:0,q.hasIconTextFit?Oe.y:0)}}}if(l.fullyClipped=0===W,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=X.invProjMatrix,l.placementViewportMatrix=X.viewportMatrix,l.collisionCircleArray=X.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function fl(m,l,h,y,x){m.emplaceBack(l?1:0,h?1:0,y||0,x||0),m.emplaceBack(l?1:0,h?1:0,y||0,x||0),m.emplaceBack(l?1:0,h?1:0,y||0,x||0),m.emplaceBack(l?1:0,h?1:0,y||0,x||0)}const rr=Math.pow(2,25),Hi=Math.pow(2,24),Nf=Math.pow(2,17),qo=Math.pow(2,16),Ci=Math.pow(2,9),yc=Math.pow(2,8),lu=Math.pow(2,1);function pl(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const l=m.placed?1:0,h=Math.floor(127*m.opacity);return h*rr+l*Hi+h*Nf+l*qo+h*Ci+l*yc+h*lu+l}const ui=0;class nh{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&void 0!==l.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,h,y,x,w){const T=this._bucketParts;for(;this._currentTileIndex<l.length;)if(h.getBucketParts(T,x,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((S,O)=>S.sortKey-O.sortKey));this._currentPartIndex<T.length;){const S=T[this._currentPartIndex];if(h.placeLayerBucketPart(S,this._seenCrossTileIDs,y,0===S.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class Ao{constructor(l,h,y,x,w,T,S,O,k){this.placement=new au(l,w,T,S,O,k),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(l,h,y,x){const w=f.a4.now(),T=()=>{const S=f.a4.now()-w;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=h[l[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if("symbol"===S.type&&(!S.minzoom||S.minzoom<=O)&&(!S.maxzoom||S.maxzoom>O)){const k=S,z=k.layout.get("symbol-z-elevate"),j=this._inProgressLayer=this._inProgressLayer||new nh(k),$=f.aE(S.source,S.scope);if(j.continuePlacement(z?x[$]:y[$],this.placement,this._showCollisionBoxes,S,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const fn=512/f.J/2;class cu{constructor(l,h,y){this.tileID=l,this.bucketInstanceId=y,this.index=new f.aZ(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=l.canonical.x*f.J,w=l.canonical.y*f.J;for(let T=0;T<h.length;T++){const{key:S,crossTileID:O,tileAnchorX:k,tileAnchorY:z}=h.get(T),j=Math.floor((x+k)*fn),$=Math.floor((w+z)*fn);this.index.add(j,$),this.keys.push(S),this.crossTileIDs.push(O)}this.index.finish()}findMatches(l,h,y){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),w=fn/Math.pow(2,h.canonical.z-this.tileID.canonical.z),T=h.canonical.x*f.J,S=h.canonical.y*f.J;for(let O=0;O<l.length;O++){const k=l.get(O);if(k.crossTileID)continue;const{key:z,tileAnchorX:j,tileAnchorY:$}=k,G=Math.floor((T+j)*w),W=Math.floor((S+$)*w),X=this.index.range(G-x,W-x,G+x,W+x);for(const q of X){const Z=this.crossTileIDs[q];if(this.keys[q]===z&&!y.has(Z)){y.add(Z),k.crossTileID=Z;break}}}}}class vc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const h=Math.round((l-this.lng)/360);if(0!==h)for(const y in this.indexes){const x=this.indexes[y],w={};for(const T in x){const S=x[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),w[S.tileID.key]=S}this.indexes[y]=w}this.lng=l}addBucket(l,h,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const x=this.usedCrossTileIDs[l.overscaledZ];for(const w in this.indexes){const T=this.indexes[w];if(Number(w)>l.overscaledZ)for(const S in T){const O=T[S];O.tileID.isChildOf(l)&&O.findMatches(h.symbolInstances,l,x)}else{const S=T[l.scaledTo(Number(w)).key];S&&S.findMatches(h.symbolInstances,l,x)}}for(let w=0;w<h.symbolInstances.length;w++){const T=h.symbolInstances.get(w);T.crossTileID||(T.crossTileID=y.generate(),x.add(T.crossTileID))}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new cu(l,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(l,h){for(const y of h.crossTileIDs)this.usedCrossTileIDs[l].delete(y)}removeStaleBuckets(l){let h=!1;for(const y in this.indexes){const x=this.indexes[y];for(const w in x)l[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,x[w]),delete x[w],h=!0)}return h}}class Cn{constructor(){this.layerIndexes={},this.crossTileIDs=new vc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,h,y,x){let w=this.layerIndexes[l.fqid];void 0===w&&(w=this.layerIndexes[l.fqid]=new Kn);let T=!1;const S={};"globe"!==x.name&&w.handleWrapJump(y);for(const O of h){const k=O.getBucket(l);k&&l.fqid===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,k,this.crossTileIDs)&&(T=!0),S[k.bucketInstanceId]=!0)}return w.removeStaleBuckets(S)&&(T=!0),T}pruneUnusedLayers(l){const h={};l.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}var rh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Ji="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",Ua="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",xc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gs="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Es="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",xo="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",da="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",bc="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",uu="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const ml=[];$a(rh,ml),$a(Ua,ml),$a(Ji,ml);const Pn={"_prelude_fog.vertex.glsl":Es,"_prelude_terrain.vertex.glsl":Gs,"_prelude_shadow.vertex.glsl":bc,"_prelude_fog.fragment.glsl":xo,"_prelude_shadow.fragment.glsl":uu,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":da},Cs={};Wt("",Gs),Wt(xo,Es),Wt(uu,bc),Wt(da,"");const ih=Wt(Ji,Ua),Xr=rh;var wc={background:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Wt("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Wt('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Wt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Wt("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Wt("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Wt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Wt("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Wt('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Wt("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Wt("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),symbolIcon:Wt('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Wt('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Wt('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:Wt("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Wt('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',xc),skyboxGradient:Wt('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',xc),skyboxCapture:Wt("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Wt('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Wt('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Wt("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Wt("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function $a(m,l){const h=m.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let y of h)if(y=y.trim(),"#"===y[0]&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=y.split(" ");for(const w of x)l.includes(w)||l.push(w)}}function Wt(m,l){const h=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(k=>{const z=k.split(" ");return z[z.length-1]}),x=[...new Set(x)]);const w={},T=[],S=[];if(m=m.replace(h,(k,z)=>(S.push(z),"")),(l=l.replace(h,(k,z)=>(T.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...ml];$a(m,O),$a(l,O);for(const k of[...T,...S])Pn[k]||console.error(`Undefined include: ${k}`),Cs[k]||(Cs[k]=[],$a(Pn[k],Cs[k])),O=[...O,...Cs[k]];return{fragmentSource:m=m.replace(y,(k,z,j,$,G)=>(w[G]=!0,"define"===z?`\n#ifndef HAS_UNIFORM_u_${G}\nin ${j} ${$} ${G};\n#else\nuniform ${j} ${$} u_${G};\n#endif\n`:"initialize"===z?`\n#ifdef HAS_UNIFORM_u_${G}\n    ${j} ${$} ${G} = u_${G};\n#endif\n`:"define-attribute"===z?`\n#ifdef HAS_ATTRIBUTE_a_${G}\n    in ${j} ${$} ${G};\n#endif\n`:"initialize-attribute"===z?"":void 0)),vertexSource:l=l.replace(y,(k,z,j,$,G)=>{const W="float"===$?"vec2":$,X=G.match(/color/)?"color":W;return"define-attribute-vertex-shader-only"===z?`\n#ifdef HAS_ATTRIBUTE_a_${G}\nin ${j} ${$} a_${G};\n#endif\n`:w[G]?"define"===z?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nin ${j} ${W} a_${G};\nout ${j} ${$} ${G};\n#else\nuniform ${j} ${$} u_${G};\n#endif\n`:"initialize"===z?"vec4"===X?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = a_${G};\n#else\n    ${j} ${$} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = unpack_mix_${X}(a_${G}, u_${G}_t);\n#else\n    ${j} ${$} ${G} = u_${G};\n#endif\n`:"define-attribute"===z?`\n#ifdef HAS_ATTRIBUTE_a_${G}\n    in ${j} ${$} a_${G};\n    out ${j} ${$} ${G};\n#endif\n`:"initialize-attribute"===z?`\n#ifdef HAS_ATTRIBUTE_a_${G}\n    ${G} = a_${G};\n#endif\n`:void 0:"define"===z?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nin ${j} ${W} a_${G};\n#else\nuniform ${j} ${$} u_${G};\n#endif\n`:"define-instanced"===z?"mat4"===X?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${G}0;\nin vec4 a_${G}1;\nin vec4 a_${G}2;\nin vec4 a_${G}3;\n#else\nuniform ${j} ${$} u_${G};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${j} ${W} a_${G};\n#else\nuniform ${j} ${$} u_${G};\n#endif\n`:"initialize-attribute-custom"===z?`\n#ifdef HAS_ATTRIBUTE_a_${G}\n    ${j} ${$} ${G} = a_${G};\n#endif\n`:"vec4"===X?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${j} ${$} ${G} = a_${G};\n#else\n    ${j} ${$} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${j} ${$} ${G} = unpack_mix_${X}(a_${G}, u_${G}_t);\n#else\n    ${j} ${$} ${G} = u_${G};\n#endif\n`}),staticAttributes:x,usedDefines:O,vertexIncludes:T,fragmentIncludes:S}}class ud{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,h,y,x,w,T,S,O){this.context=l;let k=this.boundPaintVertexBuffers.length!==x.length;for(let j=0;!k&&j<x.length;j++)this.boundPaintVertexBuffers[j]!==x[j]&&(k=!0);let z=this.boundDynamicVertexBuffers.length!==S.length;for(let j=0;!z&&j<S.length;j++)this.boundDynamicVertexBuffers[j]!==S[j]&&(z=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||k||z||this.boundIndexBuffer!==w||this.boundVertexOffset!==T)this.freshBind(h,y,x,w,T,S,O);else{l.bindVertexArrayOES.set(this.vao);for(const j of S)j&&(j.bind(),O&&j.instanceCount&&j.setVertexAttribDivisor(l.gl,h,O));w&&w.dynamicDraw&&w.bind()}}freshBind(l,h,y,x,w,T,S){const O=l.numAttributes,k=this.context,z=k.gl;this.vao&&this.destroy(),this.vao=k.gl.createVertexArray(),k.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=T,h.enableAttributes(z,l),h.bind(),h.setVertexAttribPointers(z,l,w);for(const j of y)j.enableAttributes(z,l),j.bind(),j.setVertexAttribPointers(z,l,w);for(const j of T)j&&(j.enableAttributes(z,l),j.bind(),j.setVertexAttribPointers(z,l,w),S&&j.instanceCount&&j.setVertexAttribDivisor(z,l,S));x&&x.bind(),k.currentNumAttributes=O}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function hu(m,l){const h=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new f.M(0,y/h).toLngLat().lat,new f.M(0,(y+1)/h).toLngLat().lat]}function sn(m,l,h,y,x,w,T){const S=m.context,O=S.gl,k=h.hillshadeFBO;if(!k)return;m.prepareDrawTile();const z=m.isTileAffectedByFog(l),j=m.getOrCreateProgram("hillshade",{overrideFog:z});S.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,k.colorAttachment.get());const $=((q,Z,ee,se)=>{const ue=ee.paint.get("hillshade-shadow-color"),K=ee.paint.get("hillshade-highlight-color"),ie=ee.paint.get("hillshade-accent-color"),he=ee.paint.get("hillshade-emissive-strength");let ge=f.d(ee.paint.get("hillshade-illumination-direction"));if("viewport"===ee.paint.get("hillshade-illumination-anchor"))ge-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){const ye=q.style.directionalLight.properties.get("direction"),Ne=f.b3(ye.x,ye.y,ye.z);ge=f.d(Ne[1])}const pe=!q.options.moving;return{u_matrix:se||q.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),pe),u_image:0,u_latrange:hu(0,Z.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),ge],u_shadow:ue,u_highlight:K,u_emissive_strength:he,u_accent:ie}})(m,h,y,m.terrain?l.projMatrix:null);m.uploadCommonUniforms(S,j,l.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:W,tileBoundsSegments:X}=m.getTileBoundsBuffers(h);j.draw(m,O.TRIANGLES,x,w,T,f.b5.disabled,$,y.id,G,W,X)}function gl(m,l,h){if(!l.needsDEMTextureUpload)return;const y=m.context,x=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||m.getTileTexture(h.stride);const w=h.getPixels();l.demTexture?l.demTexture.update(w,{premultiply:!1}):l.demTexture=new f.a9(y,w,x.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Ec(m,l,h){const y=m.context,x=y.gl;if(!l.dem)return;const w=l.dem;if(y.activeTexture.set(x.TEXTURE1),gl(m,l,w),!l.demTexture)return;l.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const T=w.dim;y.activeTexture.set(x.TEXTURE0);let S=l.hillshadeFBO;if(!S){const $=new f.a9(y,{width:T,height:T,data:null},x.RGBA);$.bind(x.LINEAR,x.CLAMP_TO_EDGE),S=l.hillshadeFBO=y.createFramebuffer(T,T,!0,"renderbuffer"),S.colorAttachment.set($.texture)}y.bindFramebuffer.set(S.framebuffer),y.viewport.set([0,0,T,T]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:k,tileBoundsSegments:z}=m.getMercatorTileBoundsBuffers(),j=[];m.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(m,x.TRIANGLES,f.b4.disabled,f.b6.disabled,f.a.unblended,f.b5.disabled,(($,G)=>{const W=G.stride,X=f.m.create();return f.m.ortho(X,0,f.J,-f.J,0,0,1),f.m.translate(X,X,[0,-f.J,0]),{u_matrix:X,u_image:1,u_dimension:[W,W],u_zoom:$.overscaledZ}})(l.tileID,w),h.id,O,k,z),l.needsHillshadePrepare=!1}const fa=m=>({u_matrix:new f.a_(m),u_image0:new f.a$(m),u_skirt_height:new f.b2(m),u_ground_shadow_factor:new f.b7(m)}),Cc=(m,l,h)=>({u_matrix:m,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:h}),oh=(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:h,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:T,u_frustum_tr:S,u_frustum_br:O,u_frustum_bl:k,u_globe_pos:z,u_globe_radius:j,u_viewport:$,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:G}),pa=(m,l)=>{if(l>0&&m.terrain&&f.X("Cutoff is currently disabled on terrain"),l<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=m.transform,y=Math.max(Math.abs(h._zoom-(m.minCutoffZoom-1)),1),x=h.isLODDisabled(!1)?f.an(60,45,h.pitch):f.an(30,15,h.pitch),w=h._farZ-h._nearZ,T=l*h.height,S=((1-(O=x))*h.cameraToCenterDistance+O*(h._farZ+T))*y;var O;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(S-h._nearZ)/w,(S-T-h._nearZ)/w]}}};function hd(m,l){return null!=m&&null!=l&&!(!m.hasData()||!l.hasData())&&null!=m.demTexture&&null!=l.demTexture&&m.tileID.key!==l.tileID.key}const ma=new class{constructor(){this.operations={}}newMorphing(m,l,h,y,x){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==h.tileID.key&&(w.queued=h)}else this.operations[m]={startTime:y,phase:0,duration:x,from:l,to:h,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const l=this.operations[m];return{from:l.from,to:l.to,phase:l.phase}}update(m){for(const l in this.operations){const h=this.operations[l];for(h.phase=(m-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,m)){delete this.operations[l];break}}}_nextOp(m,l){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=l,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},du={0:null,1:"TERRAIN_VERTEX_MORPHING"};function fu(m,l,h){if(0===l)return 0;const y=l<1&&514===h?.25/l:1;return 6*Math.pow(1.5,22-m)*Math.max(l,1)*y}function Ga(m,l){const h=1<<m.z;return!l&&(0===m.x||m.x===h-1)||0===m.y||m.y===h-1}const fo=m=>({u_matrix:m});function is(m,l,h,y,x){if(x>0){const w=f.a4.now(),T=(w-m.timeAdded)/x,S=l?(w-l.timeAdded)/x:-1,O=h.getSource(),k=y.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),z=!l||Math.abs(l.tileID.overscaledZ-k)>Math.abs(m.tileID.overscaledZ-k),j=z&&m.refreshedUponExpiration?1:f.c(z?T:1-S,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),l?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class ct extends f.bq{constructor(l){const h={type:"raster-dem",maxzoom:l.transform.maxZoom},y=new f.br(f.bs(),null),x=ws("mock-dem",h,y,l.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,h){l.state="loaded",h(null)}}class ga extends f.bq{constructor(l){const h=ws("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new f.br(f.bs(),null),l.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,h,y){if(l.freezeTileCoverage)return;this.transform=l;const x=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,T)=>{if(w[T.key]="",!this._tiles[T.key]){const S=new f.bt(T,this._source.tileSize*T.overscaleFactor(),l.tileZoom);S.state="loaded",this._tiles[T.key]=S}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(l){const h=this.proxyCachedFBO[l];if(void 0!==h){const y=Object.values(h);this.renderCachePool.push(...y),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pu extends f.O{constructor(l,h,y){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=h,this.projMatrix=y}}class Hl extends f.bk{constructor(l,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,x,w]=function(O){const k=new f.bo,z=new f.bp,j=131;k.reserve(17161),z.reserve(33800);const $=f.J/128,G=f.J+$/2,W=G+$;for(let q=-$;q<W;q+=$)for(let Z=-$;Z<W;Z+=$){const ee=Z<0||Z>G||q<0||q>G?24575:0,se=f.c(Math.round(Z),0,f.J),ue=f.c(Math.round(q),0,f.J);k.emplaceBack(se+ee,ue)}const X=(q,Z)=>{const ee=Z*j+q;z.emplaceBack(ee+1,ee,ee+j),z.emplaceBack(ee+j,ee+j+1,ee+1)};for(let q=1;q<129;q++)for(let Z=1;Z<129;Z++)X(Z,q);return[0,129].forEach(q=>{for(let Z=0;Z<130;Z++)X(Z,q),X(q,Z)}),[k,z,32768]}(),T=l.context;this.gridBuffer=T.createVertexBuffer(y,f.bl.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=f.bm.simpleSegment(0,0,y.length,x.length),this.gridNoSkirtSegments=f.bm.simpleSegment(0,0,y.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ga(h.map),this.orthoMatrix=f.m.create(),f.m.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,f.J,0,f.J,0,1);const S=T.gl;this._overlapStencilMode=new f.b6({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ct(h.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,h,y){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const x=l.terrain.properties,w=0===l.terrain.drapeRenderMode,T=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=f.a4.now();const S=l.terrain&&l.terrain.scope,O=x.get("source"),k=w?this._mockSourceCache:l.getSourceCache(O,S);if(!k)return void f.X(`Couldn't find terrain source "${O}".`);if(this.sourceCache=k,this._exaggeration=T?this.calculateExaggeration(h):x.get("exaggeration"),!h.projection.requiresDraping&&T&&0===this._exaggeration)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&f.X(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(h,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),h.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(l){const h=this._previousCameraAltitude,y=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=y;const x=null!=h?y-h:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const w=l.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(w);let S=w-this._previousZoom;const O=this._previousUpdateTimestamp;let k=w;null!=this._evaluationZoom&&(k=this._evaluationZoom,Math.abs(w-k)>.5&&(S=.5*(w-k+S)),S*x<0&&(k+=S)),this._evaluationZoom=k;const z=T.getExaggeration(k),j=z===T.getExaggeration(Math.max(0,k-.1));if(j&&Math.abs(z-this._exaggeration)<.01)return z;let $=Math.min(.1,.00375*(this._updateTimestamp-O));return(j||z<.1||Math.abs(S)<1e-4)&&($=Math.min(.2,4*$)),f.n(this._exaggeration,z,$)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&"source"===l.dataType?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):"style"===l.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=0===y._centerAltitude&&-1===this.getAtPointOrZero(f.M.fromLngLat(y.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(O=>{const k=h.getTileByID(O).tileID;return k.projMatrix=y.calculateProjMatrix(k.toUnwrapped()),k});!function(O,k){const z=k.transform.pointCoordinate(k.transform.getCameraPoint()),j=new f.P(z.x,z.y);O.sort(($,G)=>{if(G.overscaledZ-$.overscaledZ)return G.overscaledZ-$.overscaledZ;const W=new f.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),X=new f.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),q=j.mult(1<<$.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(W)-q.distSqr(X)})}(x,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const O in T){const k=T[O];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,l[O],w),k.usedForTerrain))continue;const z=l[O];k.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[h.id]=x.map(O=>new pu(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const k=this.terrainTileForTile[O.key];if(!k)continue;const z=k.tileID.key;z in S||(this._visibleDemTiles.push(k),S[z]=z)}}_assignTerrainTiles(l){this._initializing||l.forEach(h=>{if(this.terrainTileForTile[h.key])return;const y=this._findTileCoveringTileID(h,this.sourceCache);y&&(this.terrainTileForTile[h.key]=y)})}_prepareDEMTextures(){const l=this.painter.context,h=l.gl;for(const y in this.terrainTileForTile){const x=this.terrainTileForTile[y],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(l.activeTexture.set(h.TEXTURE1),gl(this.painter,x,w))}}_prepareDemTileUniforms(l,h,y,x){if(!h||null==h.demTexture)return!1;const w=l.tileID.canonical,T=Math.pow(2,h.tileID.canonical.z-w.z),S=x||"";return y[`u_dem_tl${S}`]=[w.x*T%1,w.y*T%1],y[`u_dem_scale${S}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,h=l.gl;if(!this._emptyDepthBufferTexture){const y=new f.a5({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new f.a9(l,y,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const h=this._visibleDemTiles.reduce((y,x)=>{if(!x.dem)return y;const w=x.dem.tree.minimums[0];return w>0&&l++,y+w},0);return l?h/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,h=l.gl;l.activeTexture.set(h.TEXTURE2);const y=this._getLoadedAreaMinimum(),[x,w]=(()=>{const S=new f.bu({width:1,height:1},new Float32Array([y]));return[h.R32F,S]})();this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(w,{premultiply:!1}):T=this._emptyDEMTexture=new f.a9(l,w,x,{premultiply:!1}),T}setupElevationDraw(l,h,y){const x=this.painter.context,w=x.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};T.u_exaggeration=this.exaggeration();let S=null,O=null,k=1;if(y&&y.morphing&&this._useVertexMorphing){const $=y.morphing.srcDemTile,G=y.morphing.dstDemTile;k=y.morphing.phase,$&&G&&(this._prepareDemTileUniforms(l,$,T,"_prev")&&(O=$),this._prepareDemTileUniforms(l,G,T)&&(S=G))}const z=$=>$&&$.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST,j=$=>{T.u_dem_size=1===$.size[0]?1:$.size[0]-2};if(O&&S)x.activeTexture.set(w.TEXTURE2),S.demTexture.bind(z(S),w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE4),O.demTexture.bind(z(O),w.CLAMP_TO_EDGE),S.demTexture&&j(S.demTexture),T.u_dem_lerp=k;else{S=this.terrainTileForTile[l.tileID.key],x.activeTexture.set(w.TEXTURE2);const $=this._prepareDemTileUniforms(l,S,T)?S.demTexture:this.emptyDEMTexture;$.bind(z(S),w.CLAMP_TO_EDGE),j($)}if(x.activeTexture.set(w.TEXTURE3),y&&y.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),y&&y.useMeterToDem&&S){const $=(1<<S.tileID.canonical.z)*f.b(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=$}if(y&&y.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),h.setTerrainUniformValues(x,T),"globe"===this.painter.transform.projection.name){const $=this.globeUniformValues(this.painter.transform,l.tileID.canonical,y&&y.useDenormalizedUpVectorScale);h.setGlobeUniformValues(x,$)}}globeUniformValues(l,h,y){const x=l.projection;return{u_tile_tl_up:x.upVector(h,0,0),u_tile_tr_up:x.upVector(h,f.J,0),u_tile_br_up:x.upVector(h,f.J,f.J),u_tile_bl_up:x.upVector(h,0,f.J),u_tile_up_scale:y?f.bn(1):x.upVectorScale(h,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const h=this.painter,y=this.painter.context;0!==l.length&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,T,S,O){if("globe"===x.transform.projection.name)!function(k,z,j,$,G){const W=k.context,X=W.gl;let q,Z;const ee=k.transform,se=f.bb(k,W,ee),ue=(Oe,be)=>{if(Z===be)return;const Ve=[du[be],"PROJECTION_GLOBE_VIEW"];se&&Ve.push("CUSTOM_ANTIALIASING");const Re=k.isTileAffectedByFog(Oe);q=k.getOrCreateProgram("globeRaster",{defines:Ve,overrideFog:Re}),Z=be},K=k.colorModeForRenderPass(),ie=new f.b4(X.LEQUAL,f.b4.ReadWrite,k.depthRangeFor3D);ma.update(G);const he=f.bc(ee),ge=[f.E(ee.center.lng),f.H(ee.center.lat)],pe=k.globeSharedBuffers,ye=[ee.width*f.a4.devicePixelRatio,ee.height*f.a4.devicePixelRatio],Ne=Float32Array.from(ee.globeMatrix),Ae={useDenormalizedUpVectorScale:!0};{const Oe=k.transform,be=fu(Oe.zoom,z.exaggeration(),z.sourceCache._source.tileSize);Z=-1;const Ve=X.TRIANGLES;for(const Re of $){const Ge=j.getTile(Re),re=f.b6.disabled,Me=z.prevTerrainTileForTile[Re.key],tt=z.terrainTileForTile[Re.key];hd(Me,tt)&&ma.newMorphing(Re.key,Me,tt,G,250),W.activeTexture.set(X.TEXTURE0),Ge.texture&&Ge.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Xe=ma.getMorphValuesForProxy(Re.key),At=Xe?1:0;Xe&&f.bd(Ae,{morphing:{srcDemTile:Xe.from,dstDemTile:Xe.to,phase:f.ba(Xe.phase)}});const vt=f.be(Re.canonical),Vt=f.bf(vt.getCenter().lat),xt=f.bg(Re.canonical,vt,Vt,Oe.worldSize/Oe._pixelsPerMercatorPixel),Xt=f.bh(f.bi(Re.canonical)),Yt=oh(Oe.expandedFarZProjMatrix,Ne,he,Xt,f.ao(Oe.zoom),ge,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,ye,be,xt);if(ue(Re,At),q&&(z.setupElevationDraw(Ge,q,Ae),k.uploadCommonUniforms(W,q,Re.toUnwrapped()),pe)){const[Lt,Ft,zn]=pe.getGridBuffers(Vt,0!==be);q.draw(k,Ve,ie,re,K,f.b5.backCCW,Yt,"globe_raster",Lt,Ft,zn)}}}if(pe&&(k.renderDefaultNorthPole||k.renderDefaultSouthPole)){const Oe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];se&&Oe.push("CUSTOM_ANTIALIASING"),q=k.getOrCreateProgram("globeRaster",{defines:Oe});for(const be of $){const{x:Ve,y:Re,z:Ge}=be.canonical,re=0===Re,Me=Re===(1<<Ge)-1,[tt,Xe,At,vt]=pe.getPoleBuffers(Ge,!1);if(vt&&(re||Me)){const Vt=j.getTile(be);W.activeTexture.set(X.TEXTURE0),Vt.texture&&Vt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let xt=f.bj(Ge,Ve,ee);const Xt=f.bh(f.bi(be.canonical)),Yt=(Lt,Ft)=>Lt.draw(k,X.TRIANGLES,ie,f.b6.disabled,K,f.b5.disabled,oh(ee.expandedFarZProjMatrix,xt,xt,Xt,0,ge,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,ye,0),"globe_pole_raster",Ft,At,vt);z.setupElevationDraw(Vt,q,Ae),k.uploadCommonUniforms(W,q,be.toUnwrapped()),re&&k.renderDefaultNorthPole&&Yt(q,tt),Me&&k.renderDefaultSouthPole&&(xt=f.m.scale(f.m.create(),xt,[1,-1,1]),Yt(q,Xe))}}}}(x,w,T,S,O);else{const k=x.context,z=k.gl;let j,$;const G=x.shadowRenderer,W=pa(x,x.longestCutoffRange),X=K=>{if($===K)return;const ie=[];ie.push(du[K]),W.shouldRenderCutoff&&ie.push("RENDER_CUTOFF"),j=x.getOrCreateProgram("terrainRaster",{defines:ie}),$=K},q=x.colorModeForRenderPass(),Z=new f.b4(z.LEQUAL,f.b4.ReadWrite,x.depthRangeFor3D);ma.update(O);const ee=x.transform,se=fu(ee.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let ue=[0,0,0];if(G){const K=x.style.directionalLight,ie=x.style.ambientLight;K&&ie&&(ue=Xl(K,ie))}{$=-1;const K=z.TRIANGLES,[ie,he]=[w.gridIndexBuffer,w.gridSegments];for(const ge of S){const pe=T.getTile(ge),ye=f.b6.disabled,Ne=w.prevTerrainTileForTile[ge.key],Ae=w.terrainTileForTile[ge.key];hd(Ne,Ae)&&ma.newMorphing(ge.key,Ne,Ae,O,250),k.activeTexture.set(z.TEXTURE0),pe.texture&&pe.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Oe=ma.getMorphValuesForProxy(ge.key),be=Oe?1:0;let Ve;Oe&&(Ve={morphing:{srcDemTile:Oe.from,dstDemTile:Oe.to,phase:f.ba(Oe.phase)}});const Re=Cc(ge.projMatrix,Ga(ge.canonical,ee.renderWorldCopies)?se/10:se,ue);if(X(be),!j)continue;w.setupElevationDraw(pe,j,Ve);const Ge=ge.toUnwrapped();G&&G.setupShadows(Ge,j),x.uploadCommonUniforms(k,j,Ge,null,W),j.draw(x,K,Z,ye,q,f.b5.backCCW,Re,"terrain_raster",w.gridBuffer,ie,he)}}}}(h,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(0===this._drapedRenderBatches.length)return l+1;this.renderingToTexture=!0;const h=this.painter,y=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),S=h.style.order,O=[];let k=0;for(const z of w){const j=x.getTileByID(z.proxyTileKey),$=x.proxyCachedFBO[z.key]?x.proxyCachedFBO[z.key][l]:void 0,G=void 0!==$?x.renderCache[$]:this.pool[k++],W=void 0!==$;if(j.texture=G.tex,W&&!G.dirty){O.push(j.tileID);continue}let X;y.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(y.clear({color:f.C.transparent,stencil:0}),G.dirty=!1);for(let q=T.start;q<=T.end;++q){const Z=h.style._mergedLayers[S[q]];if(Z.isHidden(h.transform.zoom))continue;const ee=h.style.getLayerSourceCache(Z),se=ee?this.proxyToSource[z.key][ee.id]:[z];if(!se)continue;const ue=se;y.viewport.set([0,0,G.fb.width,G.fb.height]),X!==(ee?ee.id:null)&&(this._setupStencil(G,se,Z,ee),X=ee?ee.id:null),h.renderLayer(h,ee,Z,ue)}if(0===this._drapedRenderBatches.length)for(const q of this._pendingGroundEffectLayers){const Z=h.style._mergedLayers[S[q]];if(Z.isHidden(h.transform.zoom))continue;const ee=h.style.getLayerSourceCache(Z),se=ee?this.proxyToSource[z.key][ee.id]:[z];if(!se)continue;const ue=se;y.viewport.set([0,0,G.fb.width,G.fb.height]),X!==(ee?ee.id:null)&&(this._setupStencil(G,se,Z,ee),X=ee?ee.id:null),h.renderLayer(h,ee,Z,ue)}this.renderedToTile?(G.dirty=!0,O.push(j.tileID)):W||--k,5===k&&(k=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,h.width,h.height]),T.end+1}postRender(){}isLayerOrderingCorrect(l){const h=l.order.length;let y=-1,x=h;for(let w=0;w<h;++w)this._style.isLayerDraped(l._mergedLayers[l.order[w]])?y=Math.max(y,w):x=Math.min(x,w);return x>y}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{l=Math.min(l,h.dem.tree.minimums[0])}),0===l?l:(l-30)*this._exaggeration}raycast(l,h,y){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const T=w.tileID,S=1<<T.overscaledZ,{x:O,y:k}=T.canonical,z=O/S,j=(O+1)/S,$=k/S,G=(k+1)/S;return{minx:z,miny:$,maxx:j,maxy:G,t:w.dem.tree.raycastRoot(z,$,j,G,l,h,y),tile:w}});x.sort((w,T)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==T.t?T.t:Number.MAX_VALUE));for(const w of x){if(null==w.t)return null;const T=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,l,h,y);if(null!=T)return T}return null}_createFBO(){const l=this.painter.context,h=l.gl,y=this.drapeBufferSize;l.activeTexture.set(h.TEXTURE0);const x=new f.a9(l,{width:y[0],height:y[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const w=l.createFramebuffer(y[0],y[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new tr(l,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const h=this._style._mergedLayers[l],y=h.isHidden(this.painter.transform.zoom);return"custom"===h.type?!y&&h.shouldRedrape():!y&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const y of this._style.getSources())if(y instanceof De){l=!0;break}if(!l)return;const h={};for(let y=0;y<this._style.order.length;++y){const x=this._style._mergedLayers[this._style.order[y]],w=this._style.getLayerSourceCache(x);if(w&&!h[w.id]&&!x.isHidden(this.painter.transform.zoom)&&"line"===x.type&&x.widthExpression()instanceof f.am){h[w.id]=!0;for(const T of this.proxyCoords){const S=this.proxyToSource[T.key][w.id];if(S)for(const O of S)this._clearRenderCacheForTile(w.id,O)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof Pt){l=!0;break}if(!l)return;const h={};for(let y=0;y<this._style.order.length;++y){const x=this._style._mergedLayers[this._style.order[y]],w=this._style.getLayerSourceCache(x);if(!w||h[w.id]||x.isHidden(this.painter.transform.zoom)||"raster"!==x.type)continue;const T=x.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const O=this.proxyToSource[S.key][w.id];if(O)for(const k of O){const z=is(w.getTile(k),w.findLoadedParent(k,0),w,this.painter.transform,T);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(w.id,k)}}}}_setupDrapedRenderBatches(){const l=this._style.order,h=l.length;if(0===h)return;const y=[];this._pendingGroundEffectLayers=[];let x,w=0,T=this._style._mergedLayers[l[w]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++w<h;)T=this._style._mergedLayers[l[w]];for(;w<h;++w){const S=this._style._mergedLayers[l[w]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===x&&(x=w):("fill-extrusion"===S.type&&this._pendingGroundEffectLayers.push(w),void 0!==x&&(y.push({start:x,end:w-1}),x=void 0)))}if(void 0!==x&&y.push({start:x,end:w-1}),0!==y.length){const S=y[y.length-1];this._pendingGroundEffectLayers.every(O=>O>S.end)||f.X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(l){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const T=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let S=0;S<T.length;++S){const O=Object.values(T[S]);h.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,x=this._tilesDirty;for(let T=y.length-1;T>=0;T--){const S=y[T];if(h.getTileByID(S.key),void 0!==h.proxyCachedFBO[S.key]){const O=l[S.key],k=this.proxyToSource[S.key];let z=0;for(const j in k){const $=k[j],G=O[j];if(!G||G.length!==$.length||$.some((W,X)=>W!==G[X]||x[j]&&x[j].hasOwnProperty(W.key))){z=-1;break}++z}for(const j in h.proxyCachedFBO[S.key])h.renderCache[h.proxyCachedFBO[S.key][j]].dirty=z<0||z!==Object.values(O).length}}const w=[...this._drapedRenderBatches];w.sort((T,S)=>S.end-S.start-(T.end-T.start));for(const T of w)for(const S of y){if(h.proxyCachedFBO[S.key])continue;let O=h.renderCachePool.pop();void 0===O&&h.renderCache.length<50&&(O=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==O&&(h.proxyCachedFBO[S.key]={},h.proxyCachedFBO[S.key][T.start]=O,h.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(l,h,y,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,T=w.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let S;if(y.isTileClipped())S=h.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):f.b6.disabled}_renderTileClippingMasks(l,h){const y=this.painter,x=this.painter.context,w=x.gl;y._tileClippingMaskIDs={},x.setColorMode(f.a.disabled),x.setDepthMode(f.b4.disabled);const T=y.getOrCreateProgram("clippingMask");for(const S of l){const O=y._tileClippingMaskIDs[S.key]=--h;T.draw(y,w.TRIANGLES,f.b4.disabled,new f.b6({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),f.a.disabled,f.b5.disabled,fo(S.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(l){const h=this.painter.transform;if(l.x<0||l.x>h.width||l.y<0||l.y>h.height)return null;const y=[l.x,l.y,1,1];f.e.transformMat4(y,y,h.pixelMatrixInverse),f.e.scale(y,y,1/y[3]),y[0]/=h.worldSize,y[1]/=h.worldSize;const x=h._camera.position,w=f.b(1,h.center.lat),T=[x[0],x[1],x[2]/w,0],S=f.v.subtract([],y.slice(0,3),T);f.v.normalize(S,S);const O=this.raycast(T,S,this._exaggeration);return null!==O&&O?(f.v.scaleAndAdd(T,T,S,O),T[3]=T[2],T[2]*=w,T):null}drawDepth(){const l=this.painter,h=l.context,y=this.proxySourceCache,x=Math.ceil(l.width),w=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=h.gl,S=h.createFramebuffer(x,w,!0,"renderbuffer");h.activeTexture.set(T.TEXTURE0);const O=new f.a9(h,{width:x,height:w,data:null},T.RGBA);O.bind(T.NEAREST,T.CLAMP_TO_EDGE),S.colorAttachment.set(O.texture);const k=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,w);S.depthAttachment.set(k),this._depthFBO=S,this._depthTexture=O}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,w]),function(T,S,O,k){if("globe"===T.transform.projection.name)return;const z=T.context,j=z.gl;z.clear({depth:1});const $=T.getOrCreateProgram("terrainDepth"),G=new f.b4(j.LESS,f.b4.ReadWrite,T.depthRangeFor3D);for(const W of k){const X=O.getTile(W),q=Cc(W.projMatrix,0,[0,0,0]);S.setupElevationDraw(X,$),$.draw(T,j.TRIANGLES,G,f.b6.disabled,f.a.unblended,f.b5.backCCW,q,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(l,this,y,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,h,y){if(l.getSource()instanceof f.aK)return this._setupProxiedCoordsForImageSource(l,h,y);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const x=this.proxiedCoords[l.id]=[],w=this.proxyCoords;for(let O=0;O<w.length;O++){const k=w[O],z=this._findTileCoveringTileID(k,l);if(z){const j=this._createProxiedId(k,z,y[k.key]&&y[k.key][l.id]);x.push(j),this.proxyToSource[k.key][l.id]=[j]}}let T=!1;const S=new Set;for(let O=0;O<h.length;O++){const k=l.getTile(h[O]);if(!k||!k.hasData())continue;const z=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==k.tileID.canonical.z){const j=this.proxyToSource[z.tileID.key][l.id],$=this._createProxiedId(z.tileID,k,y[z.tileID.key]&&y[z.tileID.key][l.id]);j?j.splice(j.length-1,0,$):this.proxyToSource[z.tileID.key][l.id]=[$];const G=this.proxyToSource[z.tileID.key][l.id];S.has(G)||S.add(G),x.push($),T=!0}}if(this._sourceTilesOverlap[l.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const O of S)O.sort((k,z)=>z.overscaledZ-k.overscaledZ)}_setupProxiedCoordsForImageSource(l,h,y){if(!l.getSource().loaded())return;const x=this.proxiedCoords[l.id]=[],w=this.proxyCoords,T=l.getSource(),S=T.tileID;if(!S)return;const O=new f.P(S.x,S.y)._div(1<<S.z),k=T.coordinates.map(f.M.fromLngLat).reduce((j,$)=>(j.min.x=Math.min(j.min.x,$.x-O.x),j.min.y=Math.min(j.min.y,$.y-O.y),j.max.x=Math.max(j.max.x,$.x-O.x),j.max.y=Math.max(j.max.y,$.y-O.y),j),{min:new f.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(j,$)=>{const G=j.wrap+j.canonical.x/(1<<j.canonical.z),W=j.canonical.y/(1<<j.canonical.z),X=f.J/(1<<j.canonical.z),q=$.wrap+$.canonical.x/(1<<$.canonical.z),Z=$.canonical.y/(1<<$.canonical.z);return G+X<q+k.min.x||G>q+k.max.x||W+X<Z+k.min.y||W>Z+k.max.y};for(let j=0;j<w.length;j++){const $=w[j];for(let G=0;G<h.length;G++){const W=l.getTile(h[G]);if(!W||!W.hasData()||z($,W.tileID))continue;const X=this._createProxiedId($,W,y[$.key]&&y[$.key][l.id]),q=this.proxyToSource[$.key][l.id];q?q.push(X):this.proxyToSource[$.key][l.id]=[X],x.push(X)}}}_createProxiedId(l,h,y){let x=this.orthoMatrix;if(y){const w=y.find(T=>T.key===h.tileID.key);if(w)return w}if(h.tileID.key!==l.key){const w=l.canonical.z-h.tileID.canonical.z;let T,S,O;x=f.m.create();const k=h.tileID.wrap-l.wrap<<l.overscaledZ;w>0?(T=f.J>>w,S=T*((h.tileID.canonical.x<<w)-l.canonical.x+k),O=T*((h.tileID.canonical.y<<w)-l.canonical.y)):(T=f.J<<-w,S=f.J*(h.tileID.canonical.x-(l.canonical.x+k<<-w)),O=f.J*(h.tileID.canonical.y-(l.canonical.y<<-w))),f.m.ortho(x,0,T,0,T,0,1),f.m.translate(x,x,[S,O,0])}return new pu(h.tileID,l.key,x)}_findTileCoveringTileID(l,h){let y=h.getTile(l);if(y&&y.hasData())return y;const x=this._findCoveringTileCache[h.id],w=x[l.key];if(y=w?h.getTileByID(w):null,y&&y.hasData()||null===w)return y;let T=y?y.tileID:l,S=T.overscaledZ;const O=h.getSource().minzoom,k=[];if(!w){const j=h.getSource().maxzoom;if(l.canonical.z>=j){const $=l.canonical.z-j;h.getSource().reparseOverscaled?(S=Math.max(l.canonical.z+2,h.transform.tileZoom),T=new f.O(S,l.wrap,j,l.canonical.x>>$,l.canonical.y>>$)):0!==$&&(S=j,T=new f.O(S,l.wrap,j,l.canonical.x>>$,l.canonical.y>>$))}T.key!==l.key&&(k.push(T.key),y=h.getTile(T))}const z=j=>{k.forEach($=>{x[$]=j}),k.length=0};for(S-=1;S>=O&&(!y||!y.hasData());S--){y&&z(y.tileID.key);const j=T.calculateScaledKey(S);if(y=h.getTileByID(j),y&&y.hasData())break;const $=x[j];if(null===$)break;void 0===$?k.push(j):y=h.getTileByID($)}return z(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,h){let y=this._tilesDirty[l];y||(y=this._tilesDirty[l]={}),y[h.key]=!0}}function _l(m,l,h){const y=function(S,O,k){const z=f.v.dot(O,S),j=f.v.dot(k,[.2126,.7152,.0722]),$=(W,X,q)=>(1-q)*W+q*X,G=$(1-.3*Math.min(j,1),1,Math.min(z+1,1));return $(.92,1,Math.asin(f.c(O[2],-1,1))/Math.PI+.5)*G}(m,[0,0,1],l),x=[0,0,0];f.v.scale(x,h.slice(0,3),y);const w=[0,0,0];f.v.scale(w,l.slice(0,3),m[2]);const T=[0,0,0];return f.v.add(T,x,w),f.bw(T)}const Hs=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],qs=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ts{static cacheKey(l,h,y,x){let w=`${h}${x?x.cacheKey:""}`;for(const T of y)l.usedDefines.includes(T)&&(w+=`/${T}`);return w}constructor(l,h,y,x,w,T){const S=l.gl;this.program=S.createProgram(),this.configuration=x,this.name=h,this.fixedDefines=[...T];const O=x?x.getBinderAttributes():[],k=(y.staticAttributes||[]).concat(O);let z=x?x.defines():[];z=z.concat(T.map(q=>`#define ${q}`));const j="#version 300 es\n";let $=j+z.concat("precision mediump float;",Xr,ih.fragmentSource).join("\n");for(const q of y.fragmentIncludes)$+=`\n${Pn[q]}`;$+=`\n${y.fragmentSource}`;let G=j+z.concat("precision highp float;",Xr,ih.vertexSource).join("\n");for(const q of y.vertexIncludes)G+=`\n${Pn[q]}`;G+=`\n${y.vertexSource}`;const W=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(W,$),S.compileShader(W),S.attachShader(this.program,W);const X=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(X,G),S.compileShader(X),S.attachShader(this.program,X),this.attributes={},this.numAttributes=k.length;for(let q=0;q<this.numAttributes;q++)if(k[q]){const Z=k[q].startsWith("a_")?k[q]:`a_${k[q]}`;S.bindAttribLocation(this.program,q,Z),this.attributes[Z]=q}S.linkProgram(this.program),S.deleteShader(X),S.deleteShader(W),this.fixedUniforms=w(l),this.binderUniforms=x?x.getUniforms(l):[],T.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new f.a$(q=l),u_dem_prev:new f.a$(q),u_dem_tl:new f.b0(q),u_dem_scale:new f.b2(q),u_dem_tl_prev:new f.b0(q),u_dem_scale_prev:new f.b2(q),u_dem_size:new f.b2(q),u_dem_lerp:new f.b2(q),u_exaggeration:new f.b2(q),u_depth:new f.a$(q),u_depth_size_inv:new f.b0(q),u_meter_to_dem:new f.b2(q),u_label_plane_matrix_inv:new f.a_(q)}),T.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new f.b7(q),u_tile_tr_up:new f.b7(q),u_tile_br_up:new f.b7(q),u_tile_bl_up:new f.b7(q),u_tile_up_scale:new f.b2(q)}))(l)),T.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new f.a_(q),u_fog_range:new f.b0(q),u_fog_color:new f.b9(q),u_fog_horizon_blend:new f.b2(q),u_fog_vertical_limit:new f.b0(q),u_fog_temporal_offset:new f.b2(q),u_frustum_tl:new f.b7(q),u_frustum_tr:new f.b7(q),u_frustum_br:new f.b7(q),u_frustum_bl:new f.b7(q),u_globe_pos:new f.b7(q),u_globe_radius:new f.b2(q),u_globe_transition:new f.b2(q),u_is_globe:new f.a$(q),u_viewport:new f.b0(q)}))(l)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new f.b9(q)}))(l)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new f.b7(q),u_lighting_directional_dir:new f.b7(q),u_lighting_directional_color:new f.b7(q),u_ground_radiance:new f.b7(q)}))(l)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new f.a_(q),u_light_matrix_1:new f.a_(q),u_fade_range:new f.b0(q),u_shadow_normal_offset:new f.b7(q),u_shadow_intensity:new f.b2(q),u_shadow_texel_size:new f.b2(q),u_shadow_map_resolution:new f.b2(q),u_shadow_direction:new f.b7(q),u_shadow_bias:new f.b7(q),u_shadowmap_0:new f.a$(q),u_shadowmap_1:new f.a$(q)}))(l))}var q}setTerrainUniformValues(l,h){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in h)y[x]&&y[x].set(this.program,x,h[x])}}setGlobeUniformValues(l,h){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in h)y[x]&&y[x].set(this.program,x,h[x])}}setFogUniformValues(l,h){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in h)y[x].set(this.program,x,h[x])}}setCutoffUniformValues(l,h){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in h)y[x].set(this.program,x,h[x])}}setLightsUniformValues(l,h){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in h)y[x].set(this.program,x,h[x])}}setShadowUniformValues(l,h){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;l.program.set(this.program);for(const x in h)y[x].set(this.program,x,h[x])}_drawDebugWireframe(l,h,y,x,w,T,S,O,k,z){const j=l.options.wireframe;if(!1===j.terrain&&!1===j.layers2D&&!1===j.layers3D)return;const $=l.context;if(!(()=>!(!j.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!j.layers2D||l._terrain&&l._terrain.renderingToTexture||!Hs.includes(this.name))||!(!j.layers3D||!qs.includes(this.name)))())return;const G=$.gl,W=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,w,$);if(!W)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const q=l.getOrCreateProgram(this.name,{config:this.configuration,defines:X});$.program.set(q.program);const Z=(ue,K,ie)=>{if(K[ue]&&ie[ue])for(const he in K[ue])ie[ue][he]&&ie[ue][he].set(ie.program,he,K[ue][he].current)};k&&k.setUniforms(q.program,$,q.binderUniforms,S,{zoom:O}),Z("fixedUniforms",this,q),Z("terrainUniforms",this,q),Z("globeUniforms",this,q),Z("fogUniforms",this,q),Z("lightsUniforms",this,q),Z("shadowUniforms",this,q),W.bind(),$.setColorMode(new f.a([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],f.C.transparent,[!0,!0,!0,!1])),$.setDepthMode(new f.b4(h.func===G.LESS?G.LEQUAL:h.func,f.b4.ReadOnly,h.range)),$.setStencilMode(f.b6.disabled);const ee=3*T.primitiveLength*2,se=3*T.primitiveOffset*2*2;z&&z>1?G.drawElementsInstanced(G.LINES,ee,G.UNSIGNED_SHORT,se,z):G.drawElements(G.LINES,ee,G.UNSIGNED_SHORT,se),w.bind(),$.program.set(this.program),$.setDepthMode(h),$.setStencilMode(y),$.setColorMode(x)}draw(l,h,y,x,w,T,S,O,k,z,j,$,G,W,X,q){const Z=l.context,ee=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(y),Z.setStencilMode(x),Z.setColorMode(w),Z.setCullFace(T);for(const K of Object.keys(this.fixedUniforms))this.fixedUniforms[K].set(this.program,K,S[K]);W&&W.setUniforms(this.program,Z,this.binderUniforms,$,{zoom:G});const se={[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[h],ue=q&&q>0?1:void 0;for(const K of j.get()){const ie=K.vaos||(K.vaos={});(ie[O]||(ie[O]=new ud)).bind(Z,this,k,W?W.getPaintVertexBuffers():[],z,K.vertexOffset,X||[],ue),q&&q>1?ee.drawElementsInstanced(h,K.primitiveLength*se,ee.UNSIGNED_SHORT,K.primitiveOffset*se*2,q):ee.drawElements(h,K.primitiveLength*se,ee.UNSIGNED_SHORT,K.primitiveOffset*se*2),h===ee.TRIANGLES&&this._drawDebugWireframe(l,y,x,w,z,K,$,G,W,q)}}}function Ha(m,l){const h=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,m.transform.tileZoom)/h,x=y*(l.tileID.canonical.x+l.tileID.wrap*h),w=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/f.ay(l,1,m.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const yn=f.m.create(),_a=(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W,X)=>{const q=l.style.light,Z=q.properties.get("position"),ee=[Z.x,Z.y,Z.z],se=f.bx.create();"viewport"===q.properties.get("anchor")&&(f.bx.fromRotation(se,-l.transform.angle),f.v.transformMat3(ee,ee,se));const ue=q.properties.get("color"),K=l.transform,ie={u_matrix:m,u_lightpos:ee,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ue.r,ue.g,ue.b],u_vertical_gradient:+h,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w,u_flood_light_color:j,u_vertical_scale:$,u_flood_light_intensity:G,u_ground_shadow_factor:W,u_emissive_strength:X};return"globe"===K.projection.name&&(ie.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],ie.u_zoom_transition=O,ie.u_inv_rot_matrix=z,ie.u_merc_center=k,ie.u_up_dir=K.projection.upVector(new f.t(0,0,0),k[0]*f.J,k[1]*f.J),ie.u_height_lift=S),ie},Qt=(m,l,h)=>({u_matrix:m,u_edge_radius:l,u_vertical_scale:h}),ya=(m,l,h,y,x,w,T,S,O,k,z,j,$,G)=>{const W=_a(m,l,h,y,x,w,T,O,k,z,j,$,G,1,[0,0,0],0),X={u_height_factor:-Math.pow(2,T.overscaledZ)/S.tileSize/8};return f.ak(W,Ha(l,S),X)},Tc=(m,l)=>({u_matrix:m,u_emissive_strength:l}),Po=(m,l,h,y)=>f.ak(Tc(m,l),Ha(h,y)),sh=(m,l,h)=>({u_matrix:m,u_world:h,u_emissive_strength:l}),yl=(m,l,h,y,x)=>f.ak(Po(m,l,h,y),{u_world:x}),dd=(m,l,h,y)=>{const x=f.J/h.tileSize;return{u_matrix:m,u_camera_to_center_distance:l.getCameraToCenterDistance(y),u_extrude_scale:[l.pixelsToGLUnits[0]/x,l.pixelsToGLUnits[1]/x]}},Zs=(m,l,h=1)=>({u_matrix:m,u_color:l,u_overlay:0,u_overlay_scale:h}),vl=f.m.create(),Ro=(m,l,h,y,x,w,T)=>{const S=m.transform,O="globe"===S.projection.name,k=O?f.by(S.zoom,l.canonical)*S._pixelsPerMercatorPixel:f.ay(h,1,w),z={u_matrix:l.projMatrix,u_extrude_scale:k,u_intensity:T,u_inv_rot_matrix:vl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){z.u_inv_rot_matrix=y,z.u_merc_center=x,z.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],z.u_zoom_transition=f.ao(S.zoom);const j=x[0]*f.J,$=x[1]*f.J;z.u_up_dir=S.projection.upVector(new f.t(0,0,0),j,$)}return z},os=(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W,X,q,Z,ee,se,ue)=>{return{u_matrix:m,u_normalize_matrix:l,u_globe_matrix:h,u_merc_matrix:y,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:k,u_fade_t:z.mix,u_opacity:z.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:(ie=j.paint.get("raster-saturation"),ie>0?1-1/(1.001-ie):-ie),u_contrast_factor:(K=j.paint.get("raster-contrast"),K>0?1/(1-K):1+K),u_spin_weights:or(j.paint.get("raster-hue-rotate")),u_perspective_transform:$,u_raster_elevation:G,u_zoom_transition:T,u_merc_center:S,u_cutoff_params:O,u_colorization_mix:Mc(X,Z),u_colorization_offset:qa(q,Z),u_color_ramp:W,u_texture_offset:[se/(ee+2*se),ee/(ee+2*se)],u_texture_res:[ee+2*se,ee+2*se],u_emissive_strength:ue};var K,ie};function or(m){m*=Math.PI/180;const l=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*l-h+1)/3,(Math.sqrt(3)*l-h+1)/3]}function Mc([m,l,h,y],[x,w]){if(x===w)return[0,0,0,0];const T=(f.bz+3)/(f.bz+1)/(w-x);return[m*T,l*T,h*T,y*T]}function qa(m,[l,h]){return l===h?0:((m-l)/(h-l)*(f.bz+3)-1)/(f.bz+1)}const xl=f.m.create(),ql=(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W,X,q,Z)=>{const ee=x.transform,se={u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ee.getCameraToCenterDistance(X),u_rotate_symbol:+h,u_aspect_ratio:ee.width/ee.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+O,u_pitch_with_map:+y,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xl,u_up_vector:[0,-1,0],u_icon_transition:Z||0,u_icon_saturation:q};return"globe"===X.name&&(se.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],se.u_zoom_transition=j,se.u_inv_rot_matrix=G,se.u_merc_center=$,se.u_camera_forward=ee._camera.forward(),se.u_ecef_origin=f.bA(ee.globeMatrix,z.toUnwrapped()),se.u_tile_matrix=Float32Array.from(ee.globeMatrix),se.u_up_vector=W),se},Ie=(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W,X,q)=>f.ak(ql(m,l,h,y,x,w,T,S,O,k,j,$,G,W,X,q,1),{u_gamma_scale:y?x.transform.getCameraToCenterDistance(q)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:f.a4.devicePixelRatio,u_is_halo:+z,undefined:void 0}),We=(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W,X)=>f.ak(Ie(m,l,h,y,x,w,T,S,!0,O,!0,z,j,$,G,W,X),{u_texsize_icon:k,u_texture_icon:1}),Bt=(m,l,h,y)=>({u_matrix:m,u_emissive_strength:l,u_opacity:h,u_color:y}),an=(m,l,h,y,x,w,T)=>f.ak(function(S,O,k,z){const j=k.imageManager.getPattern(S.toString(),O),{width:$,height:G}=k.imageManager.getPixelSize(O),W=Math.pow(2,z.tileID.overscaledZ),X=z.tileSize*Math.pow(2,k.transform.tileZoom)/W,q=X*(z.tileID.canonical.x+z.tileID.wrap*W),Z=X*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[$,G],u_pattern_size:j.displaySize,u_tile_units_to_pixels:1/f.ay(z,1,k.transform.tileZoom),u_pixel_coord_upper:[q>>16,Z>>16],u_pixel_coord_lower:[65535&q,65535&Z]}}(x,w,y,T),{u_matrix:m,u_emissive_strength:l,u_opacity:h}),Fn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Hn=(m,l,h,y,x,w,T,S,O,k,z,j,$=[0,0,0])=>{const G=y.style.light,W=G.properties.get("position"),X=[-W.x,-W.y,W.z],q=f.bx.create();"viewport"===G.properties.get("anchor")&&(f.bx.fromRotation(q,-y.transform.angle),f.v.transformMat3(X,X,q));const Z="MASK"===k.alphaMode,ee=G.properties.get("color"),se=j.paint.get("model-ambient-occlusion-intensity"),ue=j.paint.get("model-color").constantOr(f.C.white),K=j.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:l,u_normal_matrix:h,u_lightpos:X,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_camera_pos:$,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+Z,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:[w.r,w.g,w.b,w.a],u_emissiveFactor:[T[0],T[1],T[2],1],u_metallicFactor:S,u_roughnessFactor:O,u_baseColorTexture:Fn.BaseColor,u_metallicRoughnessTexture:Fn.MetallicRoughness,u_normalTexture:Fn.Normal,u_occlusionTexture:Fn.Occlusion,u_emissionTexture:Fn.Emission,u_color_mix:[ue.r,ue.g,ue.b,K],u_aoIntensity:se,u_emissive_strength:z}},Mr=new Float32Array(16),jr=(m,l=Mr,h=Mr)=>({u_matrix:m,u_instance:l,u_node_matrix:h}),Zo={fillExtrusion:m=>({u_matrix:new f.a_(m),u_lightpos:new f.b7(m),u_lightintensity:new f.b2(m),u_lightcolor:new f.b7(m),u_vertical_gradient:new f.b2(m),u_opacity:new f.b2(m),u_edge_radius:new f.b2(m),u_ao:new f.b0(m),u_tile_id:new f.b7(m),u_zoom_transition:new f.b2(m),u_inv_rot_matrix:new f.a_(m),u_merc_center:new f.b0(m),u_up_dir:new f.b7(m),u_height_lift:new f.b2(m),u_flood_light_color:new f.b7(m),u_vertical_scale:new f.b2(m),u_flood_light_intensity:new f.b2(m),u_ground_shadow_factor:new f.b7(m),u_emissive_strength:new f.b2(m)}),fillExtrusionDepth:m=>({u_matrix:new f.a_(m),u_edge_radius:new f.b2(m),u_vertical_scale:new f.b2(m)}),fillExtrusionPattern:m=>({u_matrix:new f.a_(m),u_lightpos:new f.b7(m),u_lightintensity:new f.b2(m),u_lightcolor:new f.b7(m),u_vertical_gradient:new f.b2(m),u_height_factor:new f.b2(m),u_edge_radius:new f.b2(m),u_ao:new f.b0(m),u_tile_id:new f.b7(m),u_zoom_transition:new f.b2(m),u_inv_rot_matrix:new f.a_(m),u_merc_center:new f.b0(m),u_up_dir:new f.b7(m),u_height_lift:new f.b2(m),u_image:new f.a$(m),u_texsize:new f.b0(m),u_pixel_coord_upper:new f.b0(m),u_pixel_coord_lower:new f.b0(m),u_tile_units_to_pixels:new f.b2(m),u_opacity:new f.b2(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new f.a_(m),u_opacity:new f.b2(m),u_ao_pass:new f.b2(m),u_meter_to_tile:new f.b2(m),u_ao:new f.b0(m),u_flood_light_intensity:new f.b2(m),u_flood_light_color:new f.b7(m),u_attenuation:new f.b2(m),u_edge_radius:new f.b2(m),u_fb:new f.a$(m),u_fb_size:new f.b2(m)}),fill:m=>({u_matrix:new f.a_(m),u_emissive_strength:new f.b2(m)}),fillPattern:m=>({u_matrix:new f.a_(m),u_emissive_strength:new f.b2(m),u_image:new f.a$(m),u_texsize:new f.b0(m),u_pixel_coord_upper:new f.b0(m),u_pixel_coord_lower:new f.b0(m),u_tile_units_to_pixels:new f.b2(m)}),fillOutline:m=>({u_matrix:new f.a_(m),u_emissive_strength:new f.b2(m),u_world:new f.b0(m)}),fillOutlinePattern:m=>({u_matrix:new f.a_(m),u_emissive_strength:new f.b2(m),u_world:new f.b0(m),u_image:new f.a$(m),u_texsize:new f.b0(m),u_pixel_coord_upper:new f.b0(m),u_pixel_coord_lower:new f.b0(m),u_tile_units_to_pixels:new f.b2(m)}),circle:f.bB,collisionBox:m=>({u_matrix:new f.a_(m),u_camera_to_center_distance:new f.b2(m),u_extrude_scale:new f.b0(m)}),collisionCircle:m=>({u_matrix:new f.a_(m),u_inv_matrix:new f.a_(m),u_camera_to_center_distance:new f.b2(m),u_viewport_size:new f.b0(m)}),debug:m=>({u_color:new f.b1(m),u_matrix:new f.a_(m),u_overlay:new f.a$(m),u_overlay_scale:new f.b2(m)}),clippingMask:m=>({u_matrix:new f.a_(m)}),heatmap:m=>({u_extrude_scale:new f.b2(m),u_intensity:new f.b2(m),u_matrix:new f.a_(m),u_inv_rot_matrix:new f.a_(m),u_merc_center:new f.b0(m),u_tile_id:new f.b7(m),u_zoom_transition:new f.b2(m),u_up_dir:new f.b7(m)}),heatmapTexture:m=>({u_image:new f.a$(m),u_color_ramp:new f.a$(m),u_opacity:new f.b2(m)}),hillshade:m=>({u_matrix:new f.a_(m),u_image:new f.a$(m),u_latrange:new f.b0(m),u_light:new f.b0(m),u_shadow:new f.b1(m),u_highlight:new f.b1(m),u_emissive_strength:new f.b2(m),u_accent:new f.b1(m)}),hillshadePrepare:m=>({u_matrix:new f.a_(m),u_image:new f.a$(m),u_dimension:new f.b0(m),u_zoom:new f.b2(m)}),line:f.bC,linePattern:f.bD,raster:m=>({u_matrix:new f.a_(m),u_normalize_matrix:new f.a_(m),u_globe_matrix:new f.a_(m),u_merc_matrix:new f.a_(m),u_grid_matrix:new f.b8(m),u_tl_parent:new f.b0(m),u_scale_parent:new f.b2(m),u_fade_t:new f.b2(m),u_opacity:new f.b2(m),u_image0:new f.a$(m),u_image1:new f.a$(m),u_brightness_low:new f.b2(m),u_brightness_high:new f.b2(m),u_saturation_factor:new f.b2(m),u_contrast_factor:new f.b2(m),u_spin_weights:new f.b7(m),u_perspective_transform:new f.b0(m),u_raster_elevation:new f.b2(m),u_zoom_transition:new f.b2(m),u_merc_center:new f.b0(m),u_cutoff_params:new f.b9(m),u_colorization_mix:new f.b9(m),u_colorization_offset:new f.b2(m),u_color_ramp:new f.a$(m),u_texture_offset:new f.b0(m),u_texture_res:new f.b0(m),u_emissive_strength:new f.b2(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new f.a$(m),u_is_size_feature_constant:new f.a$(m),u_size_t:new f.b2(m),u_size:new f.b2(m),u_camera_to_center_distance:new f.b2(m),u_rotate_symbol:new f.a$(m),u_aspect_ratio:new f.b2(m),u_fade_change:new f.b2(m),u_matrix:new f.a_(m),u_label_plane_matrix:new f.a_(m),u_coord_matrix:new f.a_(m),u_is_text:new f.a$(m),u_pitch_with_map:new f.a$(m),u_texsize:new f.b0(m),u_tile_id:new f.b7(m),u_zoom_transition:new f.b2(m),u_inv_rot_matrix:new f.a_(m),u_merc_center:new f.b0(m),u_camera_forward:new f.b7(m),u_tile_matrix:new f.a_(m),u_up_vector:new f.b7(m),u_ecef_origin:new f.b7(m),u_texture:new f.a$(m),u_icon_transition:new f.b2(m),u_icon_saturation:new f.b2(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new f.a$(m),u_is_size_feature_constant:new f.a$(m),u_size_t:new f.b2(m),u_size:new f.b2(m),u_camera_to_center_distance:new f.b2(m),u_rotate_symbol:new f.a$(m),u_aspect_ratio:new f.b2(m),u_fade_change:new f.b2(m),u_matrix:new f.a_(m),u_label_plane_matrix:new f.a_(m),u_coord_matrix:new f.a_(m),u_is_text:new f.a$(m),u_pitch_with_map:new f.a$(m),u_texsize:new f.b0(m),u_texture:new f.a$(m),u_gamma_scale:new f.b2(m),u_device_pixel_ratio:new f.b2(m),u_tile_id:new f.b7(m),u_zoom_transition:new f.b2(m),u_inv_rot_matrix:new f.a_(m),u_merc_center:new f.b0(m),u_camera_forward:new f.b7(m),u_tile_matrix:new f.a_(m),u_up_vector:new f.b7(m),u_ecef_origin:new f.b7(m),u_is_halo:new f.a$(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new f.a$(m),u_is_size_feature_constant:new f.a$(m),u_size_t:new f.b2(m),u_size:new f.b2(m),u_camera_to_center_distance:new f.b2(m),u_rotate_symbol:new f.a$(m),u_aspect_ratio:new f.b2(m),u_fade_change:new f.b2(m),u_matrix:new f.a_(m),u_label_plane_matrix:new f.a_(m),u_coord_matrix:new f.a_(m),u_is_text:new f.a$(m),u_pitch_with_map:new f.a$(m),u_texsize:new f.b0(m),u_texsize_icon:new f.b0(m),u_texture:new f.a$(m),u_texture_icon:new f.a$(m),u_gamma_scale:new f.b2(m),u_device_pixel_ratio:new f.b2(m),u_is_halo:new f.a$(m)}),background:m=>({u_matrix:new f.a_(m),u_emissive_strength:new f.b2(m),u_opacity:new f.b2(m),u_color:new f.b1(m)}),backgroundPattern:m=>({u_matrix:new f.a_(m),u_emissive_strength:new f.b2(m),u_opacity:new f.b2(m),u_image:new f.a$(m),u_pattern_tl:new f.b0(m),u_pattern_br:new f.b0(m),u_texsize:new f.b0(m),u_pattern_size:new f.b0(m),u_pixel_coord_upper:new f.b0(m),u_pixel_coord_lower:new f.b0(m),u_tile_units_to_pixels:new f.b2(m)}),terrainRaster:fa,terrainDepth:fa,skybox:m=>({u_matrix:new f.a_(m),u_sun_direction:new f.b7(m),u_cubemap:new f.a$(m),u_opacity:new f.b2(m),u_temporal_offset:new f.b2(m)}),skyboxGradient:m=>({u_matrix:new f.a_(m),u_color_ramp:new f.a$(m),u_center_direction:new f.b7(m),u_radius:new f.b2(m),u_opacity:new f.b2(m),u_temporal_offset:new f.b2(m)}),skyboxCapture:m=>({u_matrix_3f:new f.b8(m),u_sun_direction:new f.b7(m),u_sun_intensity:new f.b2(m),u_color_tint_r:new f.b9(m),u_color_tint_m:new f.b9(m),u_luminance:new f.b2(m)}),globeRaster:m=>({u_proj_matrix:new f.a_(m),u_globe_matrix:new f.a_(m),u_normalize_matrix:new f.a_(m),u_merc_matrix:new f.a_(m),u_zoom_transition:new f.b2(m),u_merc_center:new f.b0(m),u_image0:new f.a$(m),u_grid_matrix:new f.b8(m),u_skirt_height:new f.b2(m),u_frustum_tl:new f.b7(m),u_frustum_tr:new f.b7(m),u_frustum_br:new f.b7(m),u_frustum_bl:new f.b7(m),u_globe_pos:new f.b7(m),u_globe_radius:new f.b2(m),u_viewport:new f.b0(m)}),globeAtmosphere:m=>({u_frustum_tl:new f.b7(m),u_frustum_tr:new f.b7(m),u_frustum_br:new f.b7(m),u_frustum_bl:new f.b7(m),u_horizon:new f.b2(m),u_transition:new f.b2(m),u_fadeout_range:new f.b2(m),u_color:new f.b9(m),u_high_color:new f.b9(m),u_space_color:new f.b9(m),u_temporal_offset:new f.b2(m),u_horizon_angle:new f.b2(m)}),model:m=>({u_matrix:new f.a_(m),u_lighting_matrix:new f.a_(m),u_normal_matrix:new f.a_(m),u_lightpos:new f.b7(m),u_lightintensity:new f.b2(m),u_lightcolor:new f.b7(m),u_camera_pos:new f.b7(m),u_opacity:new f.b2(m),u_baseColorFactor:new f.b9(m),u_emissiveFactor:new f.b9(m),u_metallicFactor:new f.b2(m),u_roughnessFactor:new f.b2(m),u_baseTextureIsAlpha:new f.a$(m),u_alphaMask:new f.a$(m),u_alphaCutoff:new f.b2(m),u_baseColorTexture:new f.a$(m),u_metallicRoughnessTexture:new f.a$(m),u_normalTexture:new f.a$(m),u_occlusionTexture:new f.a$(m),u_emissionTexture:new f.a$(m),u_color_mix:new f.b9(m),u_aoIntensity:new f.b2(m),u_emissive_strength:new f.b2(m)}),modelDepth:m=>({u_matrix:new f.a_(m),u_instance:new f.a_(m),u_node_matrix:new f.a_(m)}),groundShadow:m=>({u_matrix:new f.a_(m),u_ground_shadow_factor:new f.b7(m)}),stars:m=>({u_matrix:new f.a_(m),u_up:new f.b7(m),u_right:new f.b7(m),u_intensity_multiplier:new f.b2(m)})};let ri;function Ti(m,l,h,y,x,w,T){const S=m.context,O=S.gl,k=m.transform,z=m.getOrCreateProgram("collisionBox"),j=[];let $=0,G=0;for(let ue=0;ue<y.length;ue++){const K=y[ue],ie=l.getTile(K),he=ie.getBucket(h);if(!he)continue;const ge=Rt(K,he,k);let pe=ge;0===x[0]&&0===x[1]||(pe=m.translatePosMatrix(ge,ie,x,w));const ye=T?he.textCollisionBox:he.iconCollisionBox,Ne=he.collisionCircleArray;if(Ne.length>0){const Ae=f.m.create(),Oe=pe;f.m.mul(Ae,he.placementInvProjMatrix,k.glCoordMatrix),f.m.mul(Ae,Ae,he.placementViewportMatrix),j.push({circleArray:Ne,circleOffset:G,transform:Oe,invTransform:Ae,projection:he.getProjection()}),$+=Ne.length/4,G=$}ye&&(m.terrain&&m.terrain.setupElevationDraw(ie,z),z.draw(m,O.LINES,f.b4.disabled,f.b6.disabled,m.colorModeForRenderPass(),f.b5.disabled,dd(pe,k,ie,he.getProjection()),h.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,null,k.zoom,null,[ye.collisionVertexBuffer,ye.collisionVertexBufferExt]))}if(!T||!j.length)return;const W=m.getOrCreateProgram("collisionCircle"),X=new f.bE;X.resize(4*$),X._trim();let q=0;for(const ue of j)for(let K=0;K<ue.circleArray.length/4;K++){const ie=4*K,he=ue.circleArray[ie+0],ge=ue.circleArray[ie+1],pe=ue.circleArray[ie+2],ye=ue.circleArray[ie+3];X.emplace(q++,he,ge,pe,ye,0),X.emplace(q++,he,ge,pe,ye,1),X.emplace(q++,he,ge,pe,ye,2),X.emplace(q++,he,ge,pe,ye,3)}(!ri||ri.length<2*$)&&(ri=function(ue){const K=2*ue,ie=new f.bp;ie.resize(K),ie._trim();for(let he=0;he<K;he++){const ge=6*he;ie.uint16[ge+0]=4*he+0,ie.uint16[ge+1]=4*he+1,ie.uint16[ge+2]=4*he+2,ie.uint16[ge+3]=4*he+2,ie.uint16[ge+4]=4*he+3,ie.uint16[ge+5]=4*he+0}return ie}($));const Z=S.createIndexBuffer(ri,!0),ee=S.createVertexBuffer(X,f.bF.members,!0);for(const ue of j){const K={u_matrix:ue.transform,u_inv_matrix:ue.invTransform,u_camera_to_center_distance:(se=k).getCameraToCenterDistance(ue.projection),u_viewport_size:[se.width,se.height]};W.draw(m,O.TRIANGLES,f.b4.disabled,f.b6.disabled,m.colorModeForRenderPass(),f.b5.disabled,K,h.id,ee,Z,f.bm.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,k.zoom)}var se;ee.destroy(),Z.destroy()}const Oo=f.m.create();function ss({width:m,height:l,anchor:h,textOffset:y,textScale:x},w){const{horizontalAlign:T,verticalAlign:S}=f.aY(h),O=-(T-.5)*m,k=-(S-.5)*l,z=f.aW(h,y);return new f.P((O/x+z[0])*w,(k/x+z[1])*w)}function ao(m,l,h,y,x,w,T,S,O,k,z){const j=m.text.placedSymbolArray,$=m.text.dynamicLayoutVertexArray,G=m.icon.dynamicLayoutVertexArray,W={},X=m.getProjection(),q=$e(S,X,w),Z=w.elevation,ee=X.upVectorScale(S.canonical,w.center.lat,w.worldSize).metersToTile;$.clear();for(let se=0;se<j.length;se++){const ue=j.get(se),{tileAnchorX:K,tileAnchorY:ie,numGlyphs:he}=ue,ge=ue.hidden||!ue.crossTileID||m.allowVerticalPlacement&&!ue.placedOrientation?null:y[ue.crossTileID];if(ge){let pe=0,ye=0,Ne=0;if(Z){const tt=Z?Z.getAtTileOffset(S,K,ie):0,[Xe,At,vt]=X.upVector(S.canonical,K,ie);pe=tt*Xe*ee,ye=tt*At*ee,Ne=tt*vt*ee}let[Ae,Oe,be,Ve]=Or(ue.projectedAnchorX+pe,ue.projectedAnchorY+ye,ue.projectedAnchorZ+Ne,h?q:T);const Re=Be(w.getCameraToCenterDistance(X),Ve);let Ge=x.evaluateSizeForFeature(m.textSizeData,k,ue)*Re/f.aV;h&&(Ge*=m.tilePixelRatio/O);const re=ss(ge,Ge);h?(({x:Ae,y:Oe,z:be}=X.projectTilePoint(K+re.x,ie+re.y,S.canonical)),[Ae,Oe,be]=Or(Ae+pe,Oe+ye,be+Ne,T)):(l&&re._rotate(-w.angle),Ae+=re.x,Oe+=re.y,be=0);const Me=m.allowVerticalPlacement&&ue.placedOrientation===f.W.vertical?Math.PI/2:0;for(let tt=0;tt<he;tt++)f.k($,Ae,Oe,be,Me);z&&ue.associatedIconIndex>=0&&(W[ue.associatedIconIndex]={x:Ae,y:Oe,z:be,angle:Me})}else dt(he,$)}if(z){G.clear();const se=m.icon.placedSymbolArray;for(let ue=0;ue<se.length;ue++){const K=se.get(ue),{numGlyphs:ie}=K,he=W[ue];if(K.hidden||!he)dt(ie,G);else{const{x:ge,y:pe,z:ye,angle:Ne}=he;for(let Ae=0;Ae<ie;Ae++)f.k(G,ge,pe,ye,Ne)}}m.icon.dynamicLayoutVertexBuffer.updateData(G)}m.text.dynamicLayoutVertexBuffer.updateData($)}function Mi(m,l,h){return h.iconsInText&&l?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function mn(m,l,h,y,x,w,T,S,O,k,z,j,$){const G=m.context,W=G.gl,X=m.transform,q="map"===S,Z="map"===O,ee=q&&"point"!==h.layout.get("symbol-placement"),se=q&&!Z&&!ee,ue=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let K=!1;const ie=m.depthModeForSublayer(0,f.b4.ReadOnly),he=[f.E(X.center.lng),f.H(X.center.lat)],ge=h.layout.get("text-variable-anchor"),pe="globe"===X.projection.name,ye=[],Ne=[0,-1,0];let Ae=Ne;!pe&&!X.mercatorFromTransition||q||(Ae=function(Oe){const be=Oe._camera.getWorldToCamera(Oe.worldSize,1),Ve=f.m.multiply([],be,Oe.globeMatrix);f.m.invert(Ve,Ve);const Re=[0,0,0],Ge=[0,1,0,0];return f.e.transformMat4(Ge,Ge,Ve),Re[0]=Ge[0],Re[1]=Ge[1],Re[2]=Ge[2],f.v.normalize(Re,Re),Re}(X));for(const Oe of y){const be=l.getTile(Oe),Ve=be.getBucket(h);if(!Ve||"mercator"===Ve.projection.name&&pe)continue;const Re=x?Ve.text:Ve.icon;if(!Re||Ve.fullyClipped||!Re.segments.get().length)continue;const Ge=Re.programConfigurations.get(h.id),re=x||Ve.sdfIcons,Me=x?Ve.textSizeData:Ve.iconSizeData,tt=Z||0!==X.pitch,Xe=f.i(Me,X.zoom);let At,vt,Vt,xt,Xt=[0,0],Yt=null;if(x)vt=be.glyphAtlasTexture?be.glyphAtlasTexture:null,Vt=W.LINEAR,At=be.glyphAtlasTexture?be.glyphAtlasTexture.size:[0,0],Ve.iconsInText&&(Xt=be.imageAtlasTexture?be.imageAtlasTexture.size:[0,0],Yt=be.imageAtlasTexture?be.imageAtlasTexture:null,xt=tt||m.options.rotating||m.options.zooming||"composite"===Me.kind||"camera"===Me.kind?W.LINEAR:W.NEAREST);else{const qn=1!==h.layout.get("icon-size").constantOr(0)||Ve.iconsNeedLinear;vt=be.imageAtlasTexture?be.imageAtlasTexture:null,Vt=re||m.options.rotating||m.options.zooming||qn||tt?W.LINEAR:W.NEAREST,At=be.imageAtlasTexture?be.imageAtlasTexture.size:[0,0]}const Lt="globe"===Ve.projection.name,Ft=Lt?Ae:Ne,zn=Lt?f.ao(X.zoom):0,ke=$e(Oe,Ve.getProjection(),X),ln=X.calculatePixelsToTileUnitsMatrix(be),ar=di(ke,be.tileID.canonical,Z,q,X,Ve.getProjection(),ln),Eo=m.terrain&&Z&&ee?f.m.invert(f.m.create(),ar):Oo,Kr=vs(ke,be.tileID.canonical,Z,q,X,Ve.getProjection(),ln),lr=ge&&Ve.hasTextData(),Rn=Ve.hasIconTextFit()&&lr&&Ve.hasIconData();if(ee){const qn=X.elevation,Ea=qn?qn.getAtTileOffsetFunc(Oe,X.center.lat,X.worldSize,Ve.getProjection()):null,Ca=Us(ke,be.tileID.canonical,Z,q,X,Ve.getProjection(),ln);it(Ve,ke,m,x,Ca,Kr,Z,k,Ea,Oe)}const In=ee||x&&ge||Rn,Sr=m.translatePosMatrix(ke,be,w,T),Wi=In?Oo:ar,Ir=m.translatePosMatrix(Kr,be,w,T,!0),Fo=Ve.getProjection().createInversionMatrix(X,Oe.canonical),No=h.paint.get("icon-image-cross-fade").constantOr(0),Ar=[];m.terrainRenderModeElevated()&&Z&&Ar.push("PITCH_WITH_MAP_TERRAIN"),Lt&&(Ar.push("PROJECTION_GLOBE_VIEW"),In&&Ar.push("PROJECTED_POS_ON_VIEWPORT")),No>0&&Ar.push("ICON_TRANSITION"),Re.zOffsetVertexBuffer&&Ar.push("Z_OFFSET");const Qi=re&&0!==h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let Qa;re?Qa=Ve.iconsInText?We(Me.kind,Xe,se,Z,m,Sr,Wi,Ir,At,Xt,Oe,zn,he,Fo,Ft,Ve.getProjection()):Ie(Me.kind,Xe,se,Z,m,Sr,Wi,Ir,x,At,!0,Oe,zn,he,Fo,Ft,Ve.getProjection()):(z<1&&Ar.push("SATURATION"),Qa=ql(Me.kind,Xe,se,Z,m,Sr,Wi,Ir,x,At,Oe,zn,he,Fo,Ft,Ve.getProjection(),z,No));const zo={program:m.getOrCreateProgram(Mi(re,x,Ve),{config:Ge,defines:Ar}),buffers:Re,uniformValues:Qa,atlasTexture:vt,atlasTextureIcon:Yt,atlasInterpolation:Vt,atlasInterpolationIcon:xt,isSDF:re,hasHalo:Qi,tile:be,labelPlaneMatrixInv:Eo};if(ue&&Ve.canOverlap){K=!0;const qn=Re.segments.get();for(const Ea of qn)ye.push({segments:new f.bm([Ea]),sortKey:Ea.sortKey,state:zo})}else ye.push({segments:Re.segments,sortKey:0,state:zo})}K&&ye.sort((Oe,be)=>Oe.sortKey-be.sortKey);for(const Oe of ye){const be=Oe.state;if(m.terrain&&m.terrain.setupElevationDraw(be.tile,be.program,{useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:be.labelPlaneMatrixInv}),G.activeTexture.set(W.TEXTURE0),be.atlasTexture&&be.atlasTexture.bind(be.atlasInterpolation,W.CLAMP_TO_EDGE,!0),be.atlasTextureIcon&&(G.activeTexture.set(W.TEXTURE1),be.atlasTextureIcon&&be.atlasTextureIcon.bind(be.atlasInterpolationIcon,W.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,be.program),be.hasHalo){const Ve=be.uniformValues;Ve.u_is_halo=1,Za(be.buffers,Oe.segments,h,m,be.program,ie,j,$,Ve,2),Ve.u_is_halo=0}else{if(be.isSDF){const Ve=be.uniformValues;be.hasHalo&&(Ve.u_is_halo=1,Za(be.buffers,Oe.segments,h,m,be.program,ie,j,$,Ve,1)),Ve.u_is_halo=0}Za(be.buffers,Oe.segments,h,m,be.program,ie,j,$,be.uniformValues,1)}}}function Za(m,l,h,y,x,w,T,S,O,k){const z=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];x.draw(y,y.context.gl.TRIANGLES,w,T,S,f.b5.disabled,O,h.id,m.layoutVertexBuffer,m.indexBuffer,l,h.paint,y.transform.zoom,m.programConfigurations.get(h.id),z,k)}function Ws(m,l,h,y,x,w,T){const S=m.context.gl,O=h.paint.get("fill-pattern"),k=O&&O.constantOr(1);let z,j,$,G,W;T?(j=k&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=S.LINES):(j=k?"fillPattern":"fill",z=S.TRIANGLES);for(const X of y){const q=l.getTile(X);if(k&&!q.patternsLoaded())continue;const Z=q.getBucket(h);if(!Z)continue;m.prepareDrawTile();const ee=Z.programConfigurations.get(h.id),se=m.isTileAffectedByFog(X),ue=m.getOrCreateProgram(j,{config:ee,overrideFog:se});k&&(m.context.activeTexture.set(S.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ee.updatePaintBuffers());const K=O.constantOr(null);if(K&&q.imageAtlas){const ge=q.imageAtlas.patternPositions[K.toString()];ge&&ee.setConstantPatternPositions(ge)}const ie=m.translatePosMatrix(X.projMatrix,q,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),he=h.paint.get("fill-emissive-strength");if(T){G=Z.indexBuffer2,W=Z.segments2;const ge=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];$="fillOutlinePattern"===j&&k?yl(ie,he,m,q,ge):sh(ie,he,ge)}else G=Z.indexBuffer,W=Z.segments,$=k?Po(ie,he,m,q):Tc(ie,he);m.uploadCommonUniforms(m.context,ue,X.toUnwrapped()),ue.draw(m,z,x,m.stencilModeForClipping(X),w,f.b5.disabled,$,h.id,Z.layoutVertexBuffer,G,W,h.paint,m.transform.zoom,ee,void 0)}}function va(m,l,h,y,x,w,T,S){h.resetLayerRenderingStats();const O=m.context,k=O.gl,z=m.transform,j=h.paint.get("fill-extrusion-pattern"),$=j.constantOr(1),G=h.paint.get("fill-extrusion-opacity"),W=m.style.enable3dLights(),X=h.paint.get(W&&!$?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],Z=h.layout.get("fill-extrusion-edge-radius"),ee=Z>0&&!h.paint.get("fill-extrusion-rounded-roof"),se=ee?0:Z,ue="globe"===z.projection.name?f.bO():0,K="globe"===z.projection.name,ie=K?f.ao(z.zoom):0,he=[f.E(z.center.lng),f.H(z.center.lat)],ge=h.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),pe=h.paint.get("fill-extrusion-flood-light-intensity"),ye=h.paint.get("fill-extrusion-vertical-scale"),Ne=pa(m,h.paint.get("fill-extrusion-cutoff-fade-range")),Ae=h.paint.get("fill-extrusion-emissive-strength"),Oe=[];let be;K&&Oe.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Oe.push("FAUX_AO"),ee&&Oe.push("ZERO_ROOF_RADIUS"),S&&Oe.push("HAS_CENTROID"),pe>0&&Oe.push("FLOOD_LIGHT"),Ne.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF");const Ve="shadow"===m.renderPass,Re=m.shadowRenderer,Ge=Ve&&!!Re;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let re=[0,0,0];if(Re){const Xe=m.style.directionalLight,At=m.style.ambientLight;Xe&&At&&(re=Xl(Xe,At)),be=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const Me=Ge?"fillExtrusionDepth":$?"fillExtrusionPattern":"fillExtrusion",tt=h.getLayerRenderingStats();for(const Xe of y){const At=l.getTile(Xe),vt=At.getBucket(h);if(!vt||vt.projection.name!==z.projection.name)continue;let Vt=!1;Re&&(Vt=0===Re.getMaxCascadeForTile(Xe.toUnwrapped()));const xt=m.isTileAffectedByFog(Xe),Xt=vt.programConfigurations.get(h.id),Yt=m.getOrCreateProgram(Me,{config:Xt,defines:Vt?be:Oe,overrideFog:xt});if(m.terrain&&m.terrain.setupElevationDraw(At,Yt,{useMeterToDem:!0}),!vt.centroidVertexBuffer){const ar=Yt.attributes.a_centroid_pos;void 0!==ar&&k.vertexAttrib2f(ar,0,0)}!Ve&&Re&&Re.setupShadows(At.tileID.toUnwrapped(),Yt,"vector-tile",At.tileID.overscaledZ),$&&(m.context.activeTexture.set(k.TEXTURE0),At.imageAtlasTexture&&At.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Xt.updatePaintBuffers());const Lt=j.constantOr(null);if(Lt&&At.imageAtlas){const ar=At.imageAtlas.patternPositions[Lt.toString()];ar&&Xt.setConstantPatternPositions(ar)}const Ft=h.paint.get("fill-extrusion-vertical-gradient");let zn;if(Ve&&Re){if(mu(At.tileID,vt,m))continue;const ar=Re.calculateShadowPassMatrixFromTile(At.tileID.toUnwrapped());zn=Qt(ar,se,ye)}else{const ar=m.translatePosMatrix(Xe.expandedProjMatrix,At,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Eo=z.projection.createInversionMatrix(z,Xe.canonical);zn=$?ya(ar,m,Ft,G,q,se,Xe,At,ue,ie,he,Eo,ge,ye):_a(ar,m,Ft,G,q,se,Xe,ue,ie,he,Eo,ge,ye,pe,re,Ae)}m.uploadCommonUniforms(O,Yt,Xe.toUnwrapped(),null,Ne);let ke=vt.segments;if("mercator"===z.projection.name&&!Ve&&(ke=vt.getVisibleSegments(At.tileID,m.terrain,m.transform.getFrustum(0)),!ke.get().length))continue;if(tt)if(Ve)for(const ar of ke.get())tt.numRenderedVerticesInShadowPass+=ar.primitiveLength;else for(const ar of ke.get())tt.numRenderedVerticesInTransparentPass+=ar.primitiveLength;const ln=[];(m.terrain||S)&&ln.push(vt.centroidVertexBuffer),K&&ln.push(vt.layoutVertexExtBuffer),Yt.draw(m,O.gl.TRIANGLES,x,w,T,f.b5.backCCW,zn,h.id,vt.layoutVertexBuffer,vt.indexBuffer,ke,h.paint,m.transform.zoom,Xt,ln)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function Wa(m,l,h,y,x,w,T,S,O,k,z,j,$,G,W,X,q,Z,ee){const se=m.context,ue=se.gl,K=m.transform,ie=m.transform.zoom,he=[],ge=pa(m,h.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===k?(he.push("CLEAR_SUBPASS"),ee&&(he.push("CLEAR_FROM_TEXTURE"),se.activeTexture.set(ue.TEXTURE0),ee.bind(ue.LINEAR,ue.CLAMP_TO_EDGE))):"sdf"===k&&he.push("SDF_SUBPASS"),q&&he.push("HAS_CENTROID"),ge.shouldRenderCutoff&&he.push("RENDER_CUTOFF");const pe=h.layout.get("fill-extrusion-edge-radius"),ye=(Ne,Ae,Oe,be,Ve)=>{const Re=Ae.programConfigurations.get(h.id),Ge=m.isTileAffectedByFog(Ne),re=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:Re,defines:he,overrideFog:Ge}),Me={u_matrix:be,u_opacity:z,u_ao_pass:O?1:0,u_meter_to_tile:Ve,u_ao:[j,$*Ve],u_flood_light_intensity:G,u_flood_light_color:W,u_attenuation:X,u_edge_radius:ie>=17?0:pe*Ve,u_fb:0,u_fb_size:ee?ee.size[0]:0},tt=[];q&&tt.push(Ae.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(se,re,Ne.toUnwrapped(),null,ge),re.draw(m,se.gl.TRIANGLES,x,w,T,S,Me,h.id,Ae.vertexBuffer,Ae.indexBuffer,Oe,h.paint,ie,Re,tt)};for(const Ne of y){const Ae=l.getTile(Ne),Oe=Ae.getBucket(h);if(!Oe||Oe.projection.name!==K.projection.name||!Oe.groundEffect||Oe.groundEffect&&!Oe.groundEffect.hasData())continue;const be=Oe.groundEffect,Ve=1/Oe.tileToMeter;{const Re=m.translatePosMatrix(Ne.projMatrix,Ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ge=be.getDefaultSegment();ye(Ne,be,Ge,Re,Ve)}if(Z)for(let Re=0;Re<4;Re++){const Ge=f.bP[Re](Ne),re=l.getTile(Ge);if(!re)continue;const Me=re.getBucket(h);if(!Me||Me.projection.name!==K.projection.name||!Me.groundEffect||Me.groundEffect&&!Me.groundEffect.hasData())continue;const tt=Me.groundEffect;let Xe,At;0===Re?(Xe=[-f.J,0,0],At=1):1===Re?(Xe=[f.J,0,0],At=0):2===Re?(Xe=[0,-f.J,0],At=3):(Xe=[0,f.J,0],At=2);const vt=tt.regionSegments[At];if(!vt)continue;const Vt=new Float32Array(16);f.m.translate(Vt,Ne.projMatrix,Xe),ye(Ne,tt,vt,m.translatePosMatrix(Vt,Ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ve)}}}function fd(m,l,h,y,x,w,T){0===y.centroidVertexArray.length&&y.createCentroidsBuffer();const S=w?w.findDEMTileFor(h):null;if(!(S&&S.dem||T))return;const O=Z=>new f.P(Math.ceil((Z+f.bS)*f.bT),0),k=Z=>{const ee=l.getSource().minzoom,se=K=>{const ie=l.getTileByID(K);if(ie&&ie.hasData())return ie.getBucket(x)},ue=[0,-1,1];for(const K of ue){if(Z.overscaledZ+K<ee)continue;const ie=se(Z.calculateScaledKey(Z.overscaledZ+K));if(ie)return ie}},z=[0,0,0],j=(Z,ee)=>(z[0]=Math.min(Z.min.y,ee.min.y),z[1]=Math.max(Z.max.y,ee.max.y),z[2]=f.J-ee.min.x>Z.max.x?ee.min.x-f.J:Z.max.x,z),$=(Z,ee)=>(z[0]=Math.min(Z.min.x,ee.min.x),z[1]=Math.max(Z.max.x,ee.max.x),z[2]=f.J-ee.min.y>Z.max.y?ee.min.y-f.J:Z.max.y,z),G=[(Z,ee)=>j(Z,ee),(Z,ee)=>j(ee,Z),(Z,ee)=>$(Z,ee),(Z,ee)=>$(ee,Z)],W=(Z,ee,se,ue,K,ie,he)=>{if(!w)return 0;const ge=[[ie?se:Z,ie?Z:se,0],[ie?se:ee,ie?ee:se,0]],pe=he<0?f.J+he:he,ye=[ie?pe:(Z+ee)/2,ie?(Z+ee)/2:pe,0];return 0===se&&he<0||0!==se&&he>0?w.getForTilePoints(K,[ye],!0,ue):ge.push(ye),w.getForTilePoints(h,ge,!0,S),Math.max(ge[0][2],ge[1][2],ye[2])/w.exaggeration()};for(let Z=0;Z<4;Z++){const ee=y.borderFeatureIndices[Z];if(0===ee.length)continue;const se=f.bP[Z](h),ue=k(se);if(!(ue&&ue instanceof f.bQ)||y.borderDoneWithNeighborZ[Z]===ue.canonical.z)continue;0===ue.centroidVertexArray.length&&ue.createCentroidsBuffer();const K=w?w.findDEMTileFor(se):null;if(!(K&&K.dem||T))continue;const ie=(Z<2?1:5)-Z,he=ue.borderDoneWithNeighborZ[ie]!==y.canonical.z,ge=ue.borderFeatureIndices[ie];let pe=0;if(y.canonical.z!==ue.canonical.z){for(const ye of ee)y.showCentroid(y.featuresOnBorder[ye]);if(he)for(const ye of ge)ue.showCentroid(ue.featuresOnBorder[ye]);y.borderDoneWithNeighborZ[Z]=ue.canonical.z,ue.borderDoneWithNeighborZ[ie]=y.canonical.z}for(const ye of ee){const Ne=y.featuresOnBorder[ye],Ae=y.centroidData[Ne.centroidDataIndex],Oe=Ne.borders[Z];let be;for(;pe<ge.length;){be=ue.featuresOnBorder[ge[pe]];const Ve=be.borders[ie];if(Ve[1]>Oe[0]+3||Ve[0]>Oe[0]-3)break;ue.showCentroid(be),pe++}if(be&&pe<ge.length){const Ve=pe;let Re=0;for(;!(be.borders[ie][0]>Oe[1]-3)&&(Re++,++pe!==ge.length);)be=ue.featuresOnBorder[ge[pe]];if(be=ue.featuresOnBorder[ge[Ve]],Re>1){const Me=be.borders[ie];Math.abs(Oe[0]-Me[0])<3&&Math.abs(Oe[1]-Me[1])<3&&(Re=1,pe=Ve+1)}else if(0===Re){y.showCentroid(Ne);continue}const Ge=ue.centroidData[be.centroidDataIndex];T&&1===Re&&(((X=Ae).flags|(q=Ge).flags)&f.bR?(X.flags|=f.bR,q.flags|=f.bR):(X.flags&=~f.bR,q.flags&=~f.bR));const re=Ne.intersectsCount()>1||be.intersectsCount()>1;if(Re>1)pe=Ve,Ae.centroidXY=Ge.centroidXY=new f.P(0,0);else if(K&&K.dem&&!re){const Me=G[Z](Ae,Ge),tt=Z%2?f.J-1:0,Xe=W(Me[0],Math.min(f.J-1,Me[1]),tt,K,se,Z<2,Me[2]);Ae.centroidXY=Ge.centroidXY=O(Xe)}else re?Ae.centroidXY=Ge.centroidXY=new f.P(0,0):(Ae.centroidXY=y.encodeBorderCentroid(Ne),Ge.centroidXY=ue.encodeBorderCentroid(be));y.writeCentroidToBuffer(Ae),ue.writeCentroidToBuffer(Ge)}else y.showCentroid(Ne)}y.borderDoneWithNeighborZ[Z]=ue.canonical.z,ue.borderDoneWithNeighborZ[ie]=y.canonical.z}var X,q;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&0!==y.centroidVertexArray.length)&&y.uploadCentroid(m)}const bl=[1,0,0],Lr=[0,1,0],Dr=[0,0,1];function mu(m,l,h){const y=h.transform,x=h.shadowRenderer;if(!x)return!0;const w=m.toUnwrapped(),T=y.tileSize*x._cascades[h.currentShadowCascade].scale;let S=l.maxHeight;if(y.elevation){const X=y.elevation.getMinMaxForTile(m);X&&(S+=X.max)}const O=[...x.shadowDirection];O[2]=-O[2];const k=x.computeSimplifiedTileShadowVolume(w,S,T,O);if(!k)return!1;const z=[bl,Lr,Dr,O,[O[0],0,O[2]],[0,O[1],O[2]]],j="globe"===y.projection.name,$=y.scaleZoom(T),G=f.F.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,$,!j),W=x.getCurrentCascadeFrustum();return 0===G.intersectsPrecise(k.vertices,k.planes,z)||0===W.intersectsPrecise(k.vertices,k.planes,z)}function as(m){const l=m._nearZ,h=m.projection.farthestPixelDistance(m),y=h-l,x=.2*m.height,w=l+x;return[l,h,(w-x-l)/y,(w-l)/y]}const Dc=new f.C(1,0,0,1),Lo=new f.C(0,1,0,1),Ms=new f.C(0,0,1,1),qi=new f.C(1,0,1,1),Zl=new f.C(0,1,1,1);function Ds(m,l,h,y,x,w){const T=m.context,S=m.transform,O=T.gl,k="globe"===S.projection.name,z=k?["PROJECTION_GLOBE_VIEW"]:[];let j=f.m.clone(h.projMatrix);if(k&&f.ao(S.zoom)>0){const be=f.bU(h.canonical,S),Ve=f.bV(be);j=f.m.multiply(new Float32Array(16),S.globeMatrix,Ve),f.m.multiply(j,S.projMatrix,j)}const $=f.m.create();$[12]+=2*x/(f.a4.devicePixelRatio*S.width),$[13]+=2*w/(f.a4.devicePixelRatio*S.height),f.m.multiply(j,$,j);const G=m.getOrCreateProgram("debug",{defines:z}),W=l.getTileByID(h.key);m.terrain&&m.terrain.setupElevationDraw(W,G);const X=f.b4.disabled,q=f.b6.disabled,Z=m.colorModeForRenderPass();T.activeTexture.set(O.TEXTURE0),m.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),k?W._makeGlobeTileDebugBuffers(m.context,S):W._makeDebugTileBoundsBuffers(m.context,S.projection);const se=W._tileDebugBuffer||m.debugBuffer,ue=W._tileDebugIndexBuffer||m.debugIndexBuffer,K=W._tileDebugSegments||m.debugSegments;G.draw(m,O.LINE_STRIP,X,q,Z,f.b5.disabled,Zs(j,y),"$debug",se,ue,K,null,null,null,[W._globeTileDebugBorderBuffer]);const ie=W.latestRawTileData,he=Math.floor((ie&&ie.byteLength||0)/1024),ge=l.getTile(h).tileSize,pe=512/Math.min(ge,512)*(h.overscaledZ/S.zoom)*.5;let ye=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ye+=` => ${h.overscaledZ}`),ye+=` ${he}kb`,function(be,Ve){be.initDebugOverlayCanvas();const Re=be.debugOverlayCanvas,Ge=be.context.gl,re=be.debugOverlayCanvas.getContext("2d");re.clearRect(0,0,Re.width,Re.height),re.shadowColor="white",re.shadowBlur=2,re.lineWidth=1.5,re.strokeStyle="white",re.textBaseline="top",re.font="bold 36px Open Sans, sans-serif",re.fillText(Ve,5,5),re.strokeText(Ve,5,5),be.debugOverlayTexture.update(Re),be.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(m,ye);const Ne=W._tileDebugTextBuffer||m.debugBuffer,Ae=W._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Oe=W._tileDebugTextSegments||m.debugSegments;G.draw(m,O.TRIANGLES,X,q,f.a.alphaBlended,f.b5.disabled,Zs(j,f.C.transparent,pe),"$debug",Ne,Ae,Oe,null,null,null,[W._globeTileDebugTextBuffer])}function xn(m,l,h,y){$n(m,0,l+h/2,m.transform.width,h,y)}function ii(m,l,h,y){$n(m,l-h/2,0,h,m.transform.height,y)}function $n(m,l,h,y,x,w){const T=m.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(l*f.a4.devicePixelRatio,h*f.a4.devicePixelRatio,y*f.a4.devicePixelRatio,x*f.a4.devicePixelRatio),T.clear({color:w}),S.disable(S.SCISSOR_TEST)}const Di=f.bW([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Fi}=Di;function Ki(m,l,h,y){m.emplaceBack(l,h,y)}class Yr{constructor(l){this.vertexArray=new f.bX,this.indices=new f.bp,Ki(this.vertexArray,-1,-1,1),Ki(this.vertexArray,1,-1,1),Ki(this.vertexArray,-1,1,1),Ki(this.vertexArray,1,1,1),Ki(this.vertexArray,-1,-1,-1),Ki(this.vertexArray,1,-1,-1),Ki(this.vertexArray,-1,1,-1),Ki(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Fi),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=f.bm.simpleSegment(0,0,36,12)}}function Xs(m,l,h,y,x,w){const T=m.context.gl,S=l.paint.get("sky-atmosphere-color"),O=l.paint.get("sky-atmosphere-halo-color"),k=l.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:f.bx.fromMat4(f.bx.create(),y),u_sun_direction:x,u_sun_intensity:k,u_color_tint_r:[(W=S).r,W.g,W.b,W.a],u_color_tint_m:[(X=O).r,X.g,X.b,X.a],u_luminance:5e-5};var W,X;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+w,l.skyboxTexture,0),h.draw(m,T.TRIANGLES,f.b4.disabled,f.b6.disabled,f.a.unblended,f.b5.frontCW,z,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Wl=f.bW([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class xa{constructor(l){const h=new f.bY;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const y=new f.bp;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(h,Wl.members),this.indexBuffer=l.createIndexBuffer(y),this.segments=f.bm.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Am=f.bW([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class zf{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15}}class Ni{constructor(l){this.colorModeAlphaBlendedWriteRGB=new f.a([f.bZ,f.b_,f.bZ,f.b_],f.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new f.a([f.bZ,f.b$,f.bZ,f.b$],f.C.transparent,[!1,!1,!1,!0]),this.params=new zf,this.allocatedStarsCount=0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01})}update(l){const h=l.context;if(!this.atmosphereBuffer||this.allocatedStarsCount!==this.params.starsCount){this.atmosphereBuffer=new xa(h),this.allocatedStarsCount=this.params.starsCount;const y=100,x=200,w=function(z){const j=f.c2(30),$=[];for(let G=0;G<z;++G){const W=2*Math.PI*j(),X=Math.acos(1-2*j())-.5*Math.PI;$.push(f.v.fromValues(Math.cos(X)*Math.cos(W),Math.cos(X)*Math.sin(W),Math.sin(X)))}return $}(this.allocatedStarsCount),T=f.c2(300),S=new f.c0,O=new f.bp;let k=0;for(let z=0;z<w.length;++z){const j=f.v.scale([],w[z],200),$=Math.max(0,1+.01*y*(1*T()-.5)),G=Math.max(0,1+.01*x*(1*T()-.5));S.emplaceBack(j[0],j[1],j[2],-1,-1,$,G),S.emplaceBack(j[0],j[1],j[2],1,-1,$,G),S.emplaceBack(j[0],j[1],j[2],1,1,$,G),S.emplaceBack(j[0],j[1],j[2],-1,1,$,G),O.emplaceBack(k+0,k+1,k+2),O.emplaceBack(k+0,k+2,k+3),k+=4}this.starsVx=h.createVertexBuffer(S,Am.members),this.starsIdx=h.createIndexBuffer(O),this.starsSegments=f.bm.simpleSegment(0,0,S.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,h){const y=l.context,x=y.gl,w=l.transform,T=new f.b4(x.LEQUAL,f.b4.ReadOnly,[0,1]),S=f.ao(w.zoom),O=h.properties.get("color").toArray01(),k=h.properties.get("high-color").toArray01(),z=h.properties.get("space-color").toArray01PremultipliedAlpha(),j=5e-4,$=f.c1(h.properties.get("horizon-blend"),0,1,j,.25),G=f.bb(l,y,w)&&$===j?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,W=l.frameCounter/1e3%1,X=f.v.length(w.globeCenterInViewSpace),q=Math.sqrt(Math.pow(X,2)-Math.pow(G,2)),Z=Math.acos(q/X),ee=se=>{const ue="globe"===w.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];se&&ue.push("ALPHA_PASS");const K=l.getOrCreateProgram("globeAtmosphere",{defines:ue}),ie={u_frustum_tl:w.frustumCorners.TL,u_frustum_tr:w.frustumCorners.TR,u_frustum_br:w.frustumCorners.BR,u_frustum_bl:w.frustumCorners.BL,u_horizon:w.frustumCorners.horizon,u_transition:S,u_fadeout_range:$,u_color:O,u_high_color:k,u_space_color:z,u_temporal_offset:W,u_horizon_angle:Z};l.uploadCommonUniforms(y,K);const he=this.atmosphereBuffer;he&&K.draw(l,x.TRIANGLES,T,f.b6.disabled,se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,f.b5.backCW,ie,se?"atmosphere_glow_alpha":"atmosphere_glow",he.vertexBuffer,he.indexBuffer,he.segments)};ee(!1),ee(!0)}drawStars(l,h){const y=f.c(h.properties.get("star-intensity"),0,1);if(0===y)return;const x=l.context,w=x.gl,T=l.transform,S=l.getOrCreateProgram("stars"),O=f.q.identity([]);f.q.rotateX(O,O,-T._pitch),f.q.rotateZ(O,O,-T.angle),f.q.rotateX(O,O,f.d(T._center.lat)),f.q.rotateY(O,O,-f.d(T._center.lng));const k=f.m.fromQuat(new Float32Array(16),O),z=f.m.multiply([],T.starsProjMatrix,k),j=f.bx.fromMat4([],k),$=f.bx.invert([],j),G=[0,1,0];f.v.transformMat3(G,G,$),f.v.scale(G,G,this.params.sizeMultiplier);const W=[1,0,0];f.v.transformMat3(W,W,$),f.v.scale(W,W,this.params.sizeMultiplier);const X=(q=G,Z=W,ee=y,{u_matrix:Float32Array.from(z),u_up:q,u_right:Z,u_intensity_multiplier:ee});var q,Z,ee;l.uploadCommonUniforms(x,S),this.starsVx&&this.starsIdx&&S.draw(l,w.TRIANGLES,f.b4.disabled,f.b6.disabled,this.colorModeAlphaBlendedWriteRGB,f.b5.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Zt(m,l){const h=[...m],y=l.cameraWorldSizeForFog/l.worldSize,x=f.m.identity([]);return f.m.scale(x,x,[y,y,1]),f.m.multiply(h,x,h),f.m.multiply(h,l.worldToFogMatrix,h),h}function jn(m,l,h,y){const x=h.material,w=y.context,{baseColorTexture:T,metallicRoughnessTexture:S}=x.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:k,emissionTexture:z}=x;function j($,G,W){if($&&(m.push(G),w.activeTexture.set(w.gl.TEXTURE0+W),$.gfxTexture)){const{minFilter:X,magFilter:q,wrapS:Z,wrapT:ee}=$.sampler;$.gfxTexture.bindExtraParam(X,q,Z,ee)}}j(T,"HAS_TEXTURE_u_baseColorTexture",Fn.BaseColor),j(S,"HAS_TEXTURE_u_metallicRoughnessTexture",Fn.MetallicRoughness),j(O,"HAS_TEXTURE_u_normalTexture",Fn.Normal),j(k,"HAS_TEXTURE_u_occlusionTexture",Fn.Occlusion),j(z,"HAS_TEXTURE_u_emissionTexture",Fn.Emission),h.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(h.texcoordBuffer)),h.colorBuffer&&(m.push(12===h.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(h.colorBuffer)),h.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(h.normalBuffer)),h.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(h.pbrBuffer)),"OPAQUE"!==x.alphaMode&&"MASK"!==x.alphaMode||m.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||m.push("DIFFUSE_SHADED"),m.push("USE_STANDARD_DERIVATIVES")}function kr(m,l,h,y,x,w){const T=h.paint.get("model-opacity"),S=l.context,O=new f.b4(l.context.gl.LEQUAL,f.b4.ReadWrite,l.depthRangeFor3D),k=l.transform,z=m.mesh,j=z.material,$=j.pbrMetallicRoughness,G=l.style.fog;let W;W="pixels"===l.transform.projection.zAxisUnit?[...m.nodeModelMatrix]:f.m.multiply([],y.zScaleMatrix,m.nodeModelMatrix),f.m.multiply(W,y.negCameraPosMatrix,W);const X=f.m.invert([],W);f.m.transpose(X,X);const q=h.paint.get("model-emissive-strength").constantOr(0),Z=Hn(new Float32Array(m.worldViewProjection),new Float32Array(W),new Float32Array(X),l,T,$.baseColorFactor,j.emissiveFactor,$.metallicFactor,$.roughnessFactor,j,q,h),ee={defines:[]},se=[];jn(ee.defines,se,z,l);const ue=l.shadowRenderer;ue&&(ue.useNormalOffset=!1);let K=null;if(G){const ge=Zt(m.nodeModelMatrix,l.transform);if(K=new Float32Array(ge),"globe"!==k.projection.name){const pe=z.aabb.min,ye=z.aabb.max,[Ne,Ae]=G.getOpacityForBounds(ge,pe[0],pe[1],ye[0],ye[1]);ee.overrideFog=Ne>=yi||Ae>=yi}}const ie=pa(l,h.paint.get("model-cutoff-fade-range"));ie.shouldRenderCutoff&&ee.defines.push("RENDER_CUTOFF");const he=l.getOrCreateProgram("model",ee);l.uploadCommonUniforms(S,he,null,K,ie),"shadow"!==l.renderPass&&ue&&ue.setupShadowsFromMatrix(m.nodeModelMatrix,he),he.draw(l,S.gl.TRIANGLES,O,x,w,z.material.doubleSided?f.b5.disabled:f.b5.backCCW,Z,h.id,z.vertexBuffer,z.indexBuffer,z.segments,h.paint,l.transform.zoom,void 0,se)}function Ys(m,l,h,y,x,w,T){let S;S="globe"===m.projection.name?f.c5(h,m):[...h],f.m.multiply(S,S,l.matrix);const O=f.m.multiply([],y,S);if(l.meshes)for(const k of l.meshes){if("BLEND"!==k.material.alphaMode){T.push({mesh:k,depth:0,modelIndex:x,worldViewProjection:O,nodeModelMatrix:S});continue}const z=f.v.transformMat4([],k.centroid,O);z[2]>0&&w.push({mesh:k,depth:z[2],modelIndex:x,worldViewProjection:O,nodeModelMatrix:S})}if(l.children)for(const k of l.children)Ys(m,k,h,y,x,w,T)}function wl(m,l,h,y){const x=h.shadowRenderer;if(!x)return;const w=x.getShadowPassDepthMode(),T=x.getShadowPassColorMode(),S=x.calculateShadowPassMatrixFromMatrix(l),O=jr(S);h.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,w,f.b6.disabled,T,f.b5.backCCW,O,y.id,m.vertexBuffer,m.indexBuffer,m.segments,y.paint,h.transform.zoom,void 0,void 0)}function ko(m,l,h){const y=l.updateZoomBasedPaintProperties(),x=function(w,T,S){let O,k,z,j=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&j>0){const $=w.terrain,G=$.findDEMTileFor(S);G&&G.dem?O=f.c7.create($,S,G):j=0}if(0===j&&(T.terrainElevationMin=0,T.terrainElevationMax=0),j===T.validForExaggeration&&(0===j||O&&O._demTile&&O._demTile.tileID===T.validForDEMTile.id&&O._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const $ in T.instancesPerModel){const G=T.instancesPerModel[$];for(let W=0;W<G.instancedDataArray.length;++W){const X=(O?j*O.getElevationAt(0|G.instancedDataArray.float32[16*W],0|G.instancedDataArray.float32[16*W+1],!0,!0):0)+G.instancesEvaluatedElevation[W];G.instancedDataArray.float32[16*W+6]=X,k=k?Math.min(T.terrainElevationMin,X):X,z=z?Math.max(T.terrainElevationMax,X):X}}return T.terrainElevationMin=k||0,T.terrainElevationMax=z||0,T.validForExaggeration=j,T.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,l,h);(y||x)&&(l.uploaded=!1,l.upload(m.context))}const bo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new f.c3([0,0,0],[f.J,f.J,0])};function Zi(m,l){const h=1<<m.canonical.z,y=l.getFreeCameraOptions().position,x=l.elevation,w=m.canonical.x/h,T=(m.canonical.x+1)/h,S=m.canonical.y/h,O=(m.canonical.y+1)/h;let k=l._centerAltitude;if(x){const G=x.getMinMaxForTile(m);G&&G.max>k&&(k=G.max)}const z=f.c(y.x,w,T)-y.x,j=f.c(y.y,S,O)-y.y,$=f.b(k,l.center.lat)-y.z;return l._zoomFromMercatorZ(Math.sqrt(z*z+j*j+$*$))}function Js(m,l,h,y,x,w,T){const S=m.context,O="shadow"===m.renderPass,k=m.shadowRenderer,z=O&&k?k.getShadowPassDepthMode():new f.b4(S.gl.LEQUAL,f.b4.ReadWrite,m.depthRangeFor3D),j=m.isTileAffectedByFog(w);if(h.meshes)for(const $ of h.meshes){const G=["MODEL_POSITION_ON_GPU"],W=[];let X,q,Z;y.instancedDataArray.length>20&&G.push("INSTANCED_ARRAYS");const ee=pa(m,l.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),O&&k)X=m.getOrCreateProgram("modelDepth",{defines:G}),q=jr(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(h.matrix)),Z=k.getShadowPassColorMode();else{jn(G,W,$,m),X=m.getOrCreateProgram("model",{defines:G,overrideFog:j});const ue=$.material,K=ue.pbrMetallicRoughness,ie=l.paint.get("model-opacity"),he=l.paint.get("model-emissive-strength").constantOr(0);q=Hn(w.expandedProjMatrix,Float32Array.from(h.matrix),new Float32Array(16),m,ie,K.baseColorFactor,ue.emissiveFactor,K.metallicFactor,K.roughnessFactor,ue,he,l,x),k&&(T.shadowUniformsInitialized?X.setShadowUniformValues(S,k.getShadowUniformValues()):(k.setupShadows(w.toUnwrapped(),X,"model-tile",w.overscaledZ),T.shadowUniformsInitialized=!0)),Z=ee.shouldRenderCutoff||ie<1||"OPAQUE"!==ue.alphaMode?f.a.alphaBlended:f.a.unblended}m.uploadCommonUniforms(S,X,w.toUnwrapped(),null,ee);const se=$.material.doubleSided?f.b5.disabled:f.b5.backCCW;if(y.instancedDataArray.length>20)W.push(y.instancedDataBuffer),X.draw(m,S.gl.TRIANGLES,z,f.b6.disabled,Z,se,q,l.id,$.vertexBuffer,$.indexBuffer,$.segments,l.paint,m.transform.zoom,void 0,W,y.instancedDataArray.length);else{const ue=O?"u_instance":"u_normal_matrix";for(let K=0;K<y.instancedDataArray.length;++K)q[ue]=new Float32Array(y.instancedDataArray.arrayBuffer,64*K,16),X.draw(m,S.gl.TRIANGLES,z,f.b6.disabled,Z,se,q,l.id,$.vertexBuffer,$.indexBuffer,$.segments,l.paint,m.transform.zoom,void 0,W)}}if(h.children)for(const $ of h.children)Js(m,l,$,y,x,w,T)}const gu=[1,-1,1];function Nn(m,l,h,y){if(!h.modelManager)return!0;const x=h.modelManager;if(!h.shadowRenderer)return!0;const w=h.shadowRenderer,T=l.aabb;let S=!0,O=m.maxHeight;if(0===O){let z=0;for(const j in m.instancesPerModel){const $=x.getModel(j,y);$?z=Math.max(z,Math.max(Math.max($.aabb.max[0],$.aabb.max[1]),$.aabb.max[2])):S=!1}O=m.maxScale*z*1.41+m.maxVerticalOffset,S&&(m.maxHeight=O)}T.max[2]=O,T.min[2]+=m.terrainElevationMin,T.max[2]+=m.terrainElevationMax,f.v.transformMat4(T.min,T.min,l.tileMatrix),f.v.transformMat4(T.max,T.max,l.tileMatrix);const k=T.intersects(w.getCurrentCascadeFrustum());return 0===h.currentShadowCascade&&(m.isInsideFirstShadowMapFrustum=2===k),0===k}class _u{}class Sc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,h,y){{const j=this._storage.get(h.id);if(j)return j.lastUsedFrameIdx=l,j.buf}const x=y.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),T=new ArrayBuffer(w),S=new Int16Array(T);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const O=new f.c9;for(let j=0;j<w/2;j+=3){const $=S[j],G=S[j+1],W=S[j+2];O.emplaceBack($,G),O.emplaceBack(G,W),O.emplaceBack(W,$)}const k=y.bindVertexArrayOES.current,z=new _u;return z.buf=new f.I(y,O),z.lastUsedFrameIdx=l,this._storage.set(h.id,z),y.bindVertexArrayOES.set(k),z.buf}update(l){for(const[h,y]of this._storage)l-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(h))}destroy(){for(const[l,h]of this._storage)h.buf.destroy(),this._storage.delete(l)}}class Ic{registerParameter(l,h,y,x,w){}registerButton(l,h,y){}}const Si={symbol:function(m,l,h,y,x){if("translucent"!==m.renderPass)return;const w=f.b6.disabled,T=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(S,O,k,z,j,$,G){const W=O.transform,X="map"===j,q="map"===$;for(const Z of S){const ee=z.getTile(Z),se=ee.getBucket(k);if(!se||!se.text||!se.text.segments.get().length)continue;const ue=f.i(se.textSizeData,W.zoom),K=$e(Z,se.getProjection(),W),ie=W.calculatePixelsToTileUnitsMatrix(ee),he=di(K,ee.tileID.canonical,q,X,W,se.getProjection(),ie),ge=se.hasIconTextFit()&&se.hasIconData();if(ue){const pe=Math.pow(2,W.zoom-ee.tileID.overscaledZ);ao(se,X,q,G,f.bG,W,he,Z,pe,ue,ge)}}}(y,m,h,l,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),0!==h.paint.get("icon-opacity").constantOr(1)&&mn(m,l,h,y,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),h.paint.get("icon-color-saturation"),w,T),0!==h.paint.get("text-opacity").constantOr(1)&&mn(m,l,h,y,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),h.paint.get("icon-color-saturation"),w,T),l.map.showCollisionBoxes&&(Ti(m,l,h,y,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Ti(m,l,h,y,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,l,h,y){if("translucent"!==m.renderPass)return;const x=h.paint.get("circle-opacity"),w=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),S=void 0!==h.layout.get("circle-sort-key").constantOr(1),O=h.paint.get("circle-emissive-strength");if(0===x.constantOr(1)&&(0===w.constantOr(1)||0===T.constantOr(1)))return;const k=m.context,z=k.gl,j=m.transform,$=m.depthModeForSublayer(0,f.b4.ReadOnly),G=f.b6.disabled,W=m.colorModeForDrapableLayerRenderPass(O),X="globe"===j.projection.name,q=[f.E(j.center.lng),f.H(j.center.lat)],Z=[];for(let se=0;se<y.length;se++){const ue=y[se],K=l.getTile(ue),ie=K.getBucket(h);if(!ie||ie.projection.name!==j.projection.name)continue;const he=ie.programConfigurations.get(h.id),ge=f.bH(h),pe=m.isTileAffectedByFog(ue);X&&ge.push("PROJECTION_GLOBE_VIEW");const ye=m.getOrCreateProgram("circle",{config:he,defines:ge,overrideFog:pe}),Ne=ie.layoutVertexBuffer,Ae=ie.globeExtVertexBuffer,Oe=ie.indexBuffer,be=j.projection.createInversionMatrix(j,ue.canonical),Ve={programConfiguration:he,program:ye,layoutVertexBuffer:Ne,globeExtVertexBuffer:Ae,indexBuffer:Oe,uniformValues:f.bI(m,ue,K,be,q,h),tile:K};if(S){const Re=ie.segments.get();for(const Ge of Re)Z.push({segments:new f.bm([Ge]),sortKey:Ge.sortKey,state:Ve})}else Z.push({segments:ie.segments,sortKey:0,state:Ve})}S&&Z.sort((se,ue)=>se.sortKey-ue.sortKey);const ee={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const se of Z){const{programConfiguration:ue,program:K,layoutVertexBuffer:ie,globeExtVertexBuffer:he,indexBuffer:ge,uniformValues:pe,tile:ye}=se.state,Ne=se.segments;m.terrain&&m.terrain.setupElevationDraw(ye,K,ee),m.uploadCommonUniforms(k,K,ye.tileID.toUnwrapped()),K.draw(m,z.TRIANGLES,$,G,W,f.b5.disabled,pe,h.id,ie,ge,Ne,h.paint,j.zoom,ue,[he])}},heatmap:function(m,l,h,y){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const x=m.context,w=x.gl,T=f.b6.disabled,S=new f.a([w.ONE,w.ONE,w.ONE,w.ONE],f.C.transparent,[!0,!0,!0,!0]);(function(G,W,X,q){const Z=G.gl,ee=W.width*q,se=W.height*q;G.activeTexture.set(Z.TEXTURE1),G.viewport.set([0,0,ee,se]);let ue=X.heatmapFbo;if(!ue||ue&&(ue.width!==ee||ue.height!==se)){ue&&ue.destroy();const K=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,K),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),ue=X.heatmapFbo=G.createFramebuffer(ee,se,!0,null),function(ie,he,ge,pe,ye,Ne){const Ae=ie.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,ie.extRenderToTextureHalfFloat?Ae.RGBA16F:Ae.RGBA,ye,Ne,0,Ae.RGBA,ie.extRenderToTextureHalfFloat?Ae.HALF_FLOAT:Ae.UNSIGNED_BYTE,null),pe.colorAttachment.set(ge)}(G,0,K,ue,ee,se)}else Z.bindTexture(Z.TEXTURE_2D,ue.colorAttachment.get()),G.bindFramebuffer.set(ue.framebuffer)})(x,m,h,"globe"===m.transform.projection.name?.5:.25),x.clear({color:f.C.transparent});const O=m.transform,k="globe"===O.projection.name,z=k?["PROJECTION_GLOBE_VIEW"]:[],j=k?f.b5.frontCCW:f.b5.disabled,$=[f.E(O.center.lng),f.H(O.center.lat)];for(let G=0;G<y.length;G++){const W=y[G];if(l.hasRenderableParent(W))continue;const X=l.getTile(W),q=X.getBucket(h);if(!q||q.projection.name!==O.projection.name)continue;const Z=m.isTileAffectedByFog(W),ee=q.programConfigurations.get(h.id),se=m.getOrCreateProgram("heatmap",{config:ee,defines:z,overrideFog:Z}),{zoom:ue}=m.transform;m.terrain&&m.terrain.setupElevationDraw(X,se),m.uploadCommonUniforms(x,se,W.toUnwrapped());const K=O.projection.createInversionMatrix(O,W.canonical);se.draw(m,w.TRIANGLES,f.b4.disabled,T,S,j,Ro(m,W,X,K,$,ue,h.paint.get("heatmap-intensity")),h.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,h.paint,m.transform.zoom,ee,k?[q.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,w){const T=x.context,S=T.gl,O=w.heatmapFbo;if(!O)return;T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,O.colorAttachment.get()),T.activeTexture.set(S.TEXTURE1);let k=w.colorRampTexture;k||(k=w.colorRampTexture=new f.a9(T,w.colorRamp,S.RGBA)),k.bind(S.LINEAR,S.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,S.TRIANGLES,f.b4.disabled,f.b6.disabled,x.colorModeForRenderPass(),f.b5.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(m,h))},line:function(m,l,h,y){if("translucent"!==m.renderPass)return;const x=h.paint.get("line-opacity"),w=h.paint.get("line-width");if(0===x.constantOr(1)||0===w.constantOr(1))return;const T=h.paint.get("line-emissive-strength"),S=m.depthModeForSublayer(0,f.b4.ReadOnly),O=m.colorModeForDrapableLayerRenderPass(T),k=m.terrain&&m.terrain.renderingToTexture?1:f.a4.devicePixelRatio,z=h.paint.get("line-dasharray"),j=z.constantOr(1),$=h.layout.get("line-cap"),G=h.paint.get("line-pattern"),W=G.constantOr(1),X=h.paint.get("line-pattern").constantOr(1),q=1!==h.paint.get("line-opacity").constantOr(1);let Z=!X&&q;const ee=h.paint.get("line-gradient"),se=W?"linePattern":"line",ue=m.context,K=ue.gl,ie=f.bJ(h);m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Z=!1);for(const he of y){const ge=l.getTile(he);if(W&&!ge.patternsLoaded())continue;const pe=ge.getBucket(h);if(!pe)continue;m.prepareDrawTile();const ye=pe.programConfigurations.get(h.id),Ne=m.isTileAffectedByFog(he),Ae=m.getOrCreateProgram(se,{config:ye,defines:ie,overrideFog:Ne}),Oe=G.constantOr(null);if(Oe&&ge.imageAtlas){const Xe=ge.imageAtlas.patternPositions[Oe.toString()];Xe&&ye.setConstantPatternPositions(Xe)}const be=z.constantOr(null),Ve=$.constantOr(null);if(!W&&be&&Ve&&ge.lineAtlas){const Xe=ge.lineAtlas.getDash(be,Ve);Xe&&ye.setConstantPatternPositions(Xe)}let[Re,Ge]=h.paint.get("line-trim-offset");("round"===Ve||"square"===Ve)&&Re!==Ge&&(0===Re&&(Re-=1),1===Ge&&(Ge+=1));const re=m.terrain?he.projMatrix:null,Me=W?f.bK(m,ge,h,re,k):f.bL(m,ge,h,re,pe.lineClipsArray.length,k,[Re,Ge]);if(ee){const Xe=pe.gradients[h.id];let At=Xe.texture;if(h.gradientVersion!==Xe.version){let vt=256;if(h.stepInterpolant){const Vt=l.getSource().maxzoom,xt=he.canonical.z===Vt?Math.ceil(1<<m.transform.maxZoom-he.canonical.z):1;vt=f.c(f.bM(pe.maxLineLength/f.J*1024*xt),256,ue.maxTextureSize)}Xe.gradient=f.bN({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:vt,image:Xe.gradient||void 0,clips:pe.lineClipsArray}),Xe.texture?Xe.texture.update(Xe.gradient):Xe.texture=new f.a9(ue,Xe.gradient,K.RGBA),Xe.version=h.gradientVersion,At=Xe.texture}ue.activeTexture.set(K.TEXTURE1),At.bind(h.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}j&&(ue.activeTexture.set(K.TEXTURE0),ge.lineAtlasTexture&&ge.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),ye.updatePaintBuffers()),W&&(ue.activeTexture.set(K.TEXTURE0),ge.imageAtlasTexture&&ge.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),ye.updatePaintBuffers()),m.uploadCommonUniforms(ue,Ae,he.toUnwrapped());const tt=Xe=>{Ae.draw(m,K.TRIANGLES,S,Xe,O,f.b5.disabled,Me,h.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,h.paint,m.transform.zoom,ye,[pe.layoutVertexBuffer2])};if(Z){const Xe=m.stencilModeForClipping(he).ref;0===Xe&&m.terrain&&ue.clear({stencil:0});const At={func:K.EQUAL,mask:255};Me.u_alpha_discard_threshold=.8,tt(new f.b6(At,Xe,255,K.KEEP,K.KEEP,K.INVERT)),Me.u_alpha_discard_threshold=0,tt(new f.b6(At,Xe,255,K.KEEP,K.KEEP,K.KEEP))}else tt(m.stencilModeForClipping(he))}Z&&(m.resetStencilClippingMasks(),m.terrain&&ue.clear({stencil:0}))},fill:function(m,l,h,y){const x=h.paint.get("fill-color"),w=h.paint.get("fill-opacity");if(0===w.constantOr(1))return;const T=h.paint.get("fill-emissive-strength"),S=m.colorModeForDrapableLayerRenderPass(T),O=h.paint.get("fill-pattern"),k=m.opaquePassEnabledForLayer()&&!O.constantOr(1)&&1===x.constantOr(f.C.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(m.renderPass===k){const z=m.depthModeForSublayer(1,"opaque"===m.renderPass?f.b4.ReadWrite:f.b4.ReadOnly);Ws(m,l,h,y,z,S,!1)}if("translucent"===m.renderPass&&h.paint.get("fill-antialias")){const z=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,f.b4.ReadOnly);Ws(m,l,h,y,z,S,!0)}},"fill-extrusion":function(m,l,h,y){const x=h.paint.get("fill-extrusion-opacity"),w=m.context,T=w.gl,S=m.terrain,O=S&&S.renderingToTexture;if(0===x)return;const k=m.conflationActive&&m.layerUsedInConflation(h,l.getSource());if(k&&function(z,j,$,G){for(const W of G){const X=j.getTile(W).getBucket($);X&&(X.updateReplacement(W,z.replacementSource),X.uploadCentroid(z.context))}}(m,l,h,y),S||k)for(const z of y){const j=l.getTile(z).getBucket(h);j&&fd(m.context,l,z,j,h,S,k)}if("shadow"===m.renderPass&&m.shadowRenderer){const z=m.shadowRenderer;if(S&&x<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof f.am)return;const j=z.getShadowPassDepthMode(),$=z.getShadowPassColorMode();va(m,l,h,y,j,f.b6.disabled,$,k)}else if("translucent"===m.renderPass){const z=!h.paint.get("fill-extrusion-pattern").constantOr(1),j=h.paint.get("fill-extrusion-color").constantOr(f.C.white);if(!O&&0!==j.a){const $=new f.b4(m.context.gl.LEQUAL,f.b4.ReadWrite,m.depthRangeFor3D);1===x&&z?va(m,l,h,y,$,f.b6.disabled,f.a.unblended,k):(va(m,l,h,y,$,f.b6.disabled,f.a.disabled,k),va(m,l,h,y,$,m.stencilModeFor3D(),m.colorModeForRenderPass(),k),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&z&&(!S&&"globe"!==m.transform.projection.name||O)){const $=h.paint.get("fill-extrusion-opacity"),G=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=h.paint.get("fill-extrusion-flood-light-intensity"),q=h.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),Z=G>0&&W>0,ee=X>0,se=(K,ie,he)=>(1-he)*K+he*ie,ue=K=>{const ie=m.depthModeForSublayer(1,f.b4.ReadOnly,T.LEQUAL,!0),he=h.paint.get(K?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ge=se(.1,3,he),pe=m._showOverdrawInspector;if(!pe){const ye=new f.b6({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Ne=new f.a([T.ONE,T.ONE,T.ONE,T.ONE],f.C.transparent,[!1,!1,!1,!0],T.MIN);Wa(m,l,h,y,ie,ye,Ne,f.b5.disabled,K,"sdf",$,G,W,X,q,ge,k,!1)}{const ye=pe?f.b6.disabled:new f.b6({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Ne=pe?m.colorModeForRenderPass():new f.a([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],f.C.transparent,[!0,!0,!0,!0]);Wa(m,l,h,y,ie,ye,Ne,f.b5.disabled,K,"color",$,G,W,X,q,ge,k,!1)}};if(O){const K=(ie,he,ge)=>{const pe=m.depthModeForSublayer(1,f.b4.ReadOnly,T.LEQUAL,!1),ye=h.paint.get(ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=se(.1,3,ye);{const Ae=new f.a([T.ONE,T.ONE,T.ONE,T.ONE],f.C.transparent,[!1,!1,!1,!0]);Wa(m,l,h,y,pe,f.b6.disabled,Ae,f.b5.disabled,ie,"clear",$,G,W,X,q,Ne,k,he)}{const Ae=new f.b6({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Oe=new f.a([T.ONE,T.ONE,T.ONE,T.ONE],f.C.transparent,[!1,!1,!1,!0],T.MIN);Wa(m,l,h,y,pe,Ae,Oe,f.b5.disabled,ie,"sdf",$,G,W,X,q,Ne,k,he)}{const Ae=ie?T.ZERO:T.ONE_MINUS_DST_ALPHA,Oe=new f.b6({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),be=new f.a([Ae,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],f.C.transparent,[!0,!0,!0,!0]);Wa(m,l,h,y,pe,Oe,be,f.b5.disabled,ie,"color",$,G,W,X,q,Ne,k,he)}{const Ae=new f.a([T.ONE,T.ONE,T.ONE,ie?T.ZERO:T.ONE],f.C.transparent,[!1,!1,!1,!0],ie?T.FUNC_ADD:T.MAX);Wa(m,l,h,y,pe,f.b6.disabled,Ae,f.b5.disabled,ie,"clear",$,G,W,X,q,Ne,k,he,ge)}};if(Z||ee){let ie;if(m.prepareDrawTile(),S){const he=S.drapeBufferSize[0],ge=S.drapeBufferSize[1];ie=S.framebufferCopyTexture,ie&&(!ie||ie.size[0]===he&&ie.size[1]===ge)||(ie&&ie.destroy(),ie=S.framebufferCopyTexture=new f.a9(w,new f.a5({width:he,height:ge}),T.RGBA)),ie.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexImage2D(T.TEXTURE_2D,0,T.RGBA,0,0,he,ge,0)}Z&&K(!0,!1,ie),ee&&K(!1,!0,ie)}}else Z&&ue(!0),ee&&ue(!1)}}},hillshade:function(m,l,h,y){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass||m.style.disableElevatedTerrain)return;const x=m.context,w=m.terrain&&m.terrain.renderingToTexture,[T,S]="translucent"!==m.renderPass||w?[{},y]:m.stencilConfigForOverlap(y);for(const O of S){const k=l.getTile(O);if(k.needsHillshadePrepare&&"offscreen"===m.renderPass)Ec(m,k,h);else if("translucent"===m.renderPass){const z=m.depthModeForSublayer(0,f.b4.ReadOnly),j=h.paint.get("hillshade-emissive-strength"),$=m.colorModeForDrapableLayerRenderPass(j),G=w&&m.terrain?m.terrain.stencilModeForRTTOverlap(O):T[O.overscaledZ];sn(m,O,k,h,z,G,$)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,l,h,y,x,w){if("translucent"!==m.renderPass||0===h.paint.get("raster-opacity"))return;const T=m.context,S=T.gl,O=l.getSource(),k=function(he,ge,pe){const ye=he.paint.get("raster-color"),Ne=[],Ae=he.paint.get("raster-resampling"),Oe=he.paint.get("raster-color-mix"),be=he.paint.get("raster-color-range"),Ve=[Oe[0],Oe[1],Oe[2],0],Re=Oe[3],Ge="nearest"===Ae?pe.NEAREST:pe.LINEAR;if(ye&&Ne.push("RASTER_COLOR"),ye){ge.activeTexture.set(pe.TEXTURE2);let re=he.colorRampTexture;re||(re=he.colorRampTexture=new f.a9(ge,he.colorRamp,pe.RGBA)),re.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}return{mix:Ve,range:be,offset:Re,defines:Ne,resampling:Ge}}(h,T,S),z=k.defines,j="globe"===m.transform.projection.name;let $=!1;if(O instanceof f.aK&&!y.length){if(!j)return;if(O.onNorthPole)$=!0,z.push("GLOBE_POLES");else{if(!O.onSouthPole)return;$=!0,z.push("GLOBE_POLES")}}const G=h.paint.get("raster-emissive-strength"),W=m.colorModeForDrapableLayerRenderPass(G),X=m.terrain&&m.terrain.renderingToTexture,q=O instanceof f.aK&&0!==h.paint.get("raster-elevation"),Z=!m.options.moving,ee="nearest"===h.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;if($){const he=l.getSource();if(!(he instanceof f.aK))return;const ge=he.texture;if(!ge)return;const pe=m.globeSharedBuffers;if(!pe)return;const ye=new f.b4(S.LEQUAL,f.b4.ReadWrite,m.depthRangeFor3D),Ne=Float32Array.from(m.transform.expandedFarZProjMatrix);let Ae=f.bj(0,0,m.transform);const Oe=Float32Array.from(f.bh(f.bi(new f.t(0,0,0)))),be={opacity:1,mix:0};m.terrain&&m.terrain.prepareDrawTile(),T.activeTexture.set(S.TEXTURE0),ge.bind(ee,S.CLAMP_TO_EDGE),T.activeTexture.set(S.TEXTURE1),ge.bind(ee,S.CLAMP_TO_EDGE),ge.useMipmap&&T.extTextureFilterAnisotropic&&m.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const[Ve,Re,Ge,re]=pe.getPoleBuffers(0,!0);let Me;he.onNorthPole?(Me=Ve,m.renderDefaultNorthPole=!1):(Ae=f.m.scale(f.m.create(),Ae,[1,-1,1]),Me=Re,m.renderDefaultSouthPole=!1);const tt=(At=Ne,vt=Oe,Vt=Ae,xt=be,Xt=h,Lt=h.paint.get("raster-elevation"),zn=k.mix,ke=k.offset,ln=k.range,ar=G,os(At,vt,Vt,new Float32Array(16),new Float32Array(9),[0,0],0,[0,0],[0,0,0,0],1,xt,Xt,[0,0],Lt,2,zn,ke,ln,1,0,ar)),Xe=m.getOrCreateProgram("raster",{defines:k.defines});return m.uploadCommonUniforms(T,Xe,null),void Xe.draw(m,S.TRIANGLES,ye,f.b6.disabled,W,f.b5.disabled,tt,h.id,Me,Ge,re)}var At,vt,Vt,xt,Xt,Lt,zn,ke,ln,ar;if(!y.length)return;const[se,ue]=O instanceof f.aK||X?[{},y]:m.stencilConfigForOverlap(y),K=ue[ue.length-1].overscaledZ,ie=q&&j;ie&&k.defines.push("PROJECTION_GLOBE_VIEW"),q&&k.defines.push("RENDER_CUTOFF");for(const he of ue){const ge=he.toUnwrapped(),pe=l.getTile(he);if(X&&(!pe||!pe.hasData())||!pe.texture)continue;let ye,Ne;X?(ye=f.b4.disabled,Ne=he.projMatrix):q?(ye=new f.b4(S.LEQUAL,f.b4.ReadWrite,m.depthRangeFor3D),Ne=j?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(ge,Z)):(ye=m.depthModeForSublayer(he.overscaledZ-K,1===h.paint.get("raster-opacity")?f.b4.ReadWrite:f.b4.ReadOnly,S.LESS),Ne=m.transform.calculateProjMatrix(ge,Z));const Ae=m.terrain&&X?m.terrain.stencilModeForRTTOverlap(he):se[he.overscaledZ],Oe=w?0:h.paint.get("raster-fade-duration");pe.registerFadeDuration(Oe);const be=l.findLoadedParent(he,0),Ve=is(pe,be,l,m.transform,Oe);let Re,Ge;m.terrain&&m.terrain.prepareDrawTile(),T.activeTexture.set(S.TEXTURE0),pe.texture&&pe.texture.bind(ee,S.CLAMP_TO_EDGE),T.activeTexture.set(S.TEXTURE1),be?(be.texture&&be.texture.bind(ee,S.CLAMP_TO_EDGE),Re=Math.pow(2,be.tileID.overscaledZ-pe.tileID.overscaledZ),Ge=[pe.tileID.canonical.x*Re%1,pe.tileID.canonical.y*Re%1]):pe.texture&&pe.texture.bind(ee,S.CLAMP_TO_EDGE),pe.texture&&pe.texture.useMipmap&&T.extTextureFilterAnisotropic&&m.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const re=m.transform;let Me;const tt=q?as(re):[0,0,0,0];let Xe,At,vt,Vt,xt;ie&&O instanceof f.aK&&O.coordinates.length>3?(Xe=Float32Array.from(f.bh(f.bi(new f.t(0,0,0)))),At=Float32Array.from(re.globeMatrix),vt=Float32Array.from(f.bc(re)),Vt=[f.E(re.center.lng),f.H(re.center.lat)],Me=O.elevatedGlobePerspectiveTransform,xt=O.elevatedGlobeGridMatrix||new Float32Array(9)):(Me=O instanceof f.aK?O.perspectiveTransform:[0,0],Xe=new Float32Array(16),At=new Float32Array(9),vt=new Float32Array(16),Vt=[0,0],xt=new Float32Array(9));const Xt=os(Ne,Xe,At,vt,xt,Ge||[0,0],f.ao(m.transform.zoom),Vt,tt,Re||1,Ve,h,Me,q?h.paint.get("raster-elevation"):0,2,k.mix,k.offset,k.range,1,0,G),Yt=m.isTileAffectedByFog(he),Lt=m.getOrCreateProgram("raster",{defines:k.defines,overrideFog:Yt});if(m.uploadCommonUniforms(T,Lt,ge),O instanceof f.aK){const Ft=O.elevatedGlobeVertexBuffer,zn=O.elevatedGlobeIndexBuffer;if(X||!j)O.boundsBuffer&&O.boundsSegments&&Lt.draw(m,S.TRIANGLES,ye,f.b6.disabled,W,f.b5.disabled,Xt,h.id,O.boundsBuffer,m.quadTriangleIndexBuffer,O.boundsSegments);else if(Ft&&zn){const ke=re.zoom<=f.Z?O.elevatedGlobeSegments:O.getSegmentsForLongitude(re.center.lng);ke&&(Lt.draw(m,S.TRIANGLES,ye,f.b6.disabled,W,f.b5.backCW,Xt,h.id,Ft,zn,ke),Lt.draw(m,S.TRIANGLES,ye,f.b6.disabled,W,f.b5.frontCW,Xt,h.id,Ft,zn,ke))}}else{const{tileBoundsBuffer:Ft,tileBoundsIndexBuffer:zn,tileBoundsSegments:ke}=m.getTileBoundsBuffers(pe);Lt.draw(m,S.TRIANGLES,ye,Ae,W,f.b5.disabled,Xt,h.id,Ft,zn,ke)}}m.resetStencilClippingMasks()},background:function(m,l,h,y){const x=h.paint.get("background-color"),w=h.paint.get("background-opacity"),T=h.paint.get("background-emissive-strength");if(0===w)return;const S=m.context,O=S.gl,k=m.transform,z=k.tileSize,j=h.paint.get("background-pattern");if(m.isPatternMissing(j,h.scope))return;const $=!j&&1===x.a&&1===w&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==$)return;const G=f.b6.disabled,W=m.depthModeForSublayer(0,"opaque"===$?f.b4.ReadWrite:f.b4.ReadOnly),X=m.colorModeForDrapableLayerRenderPass(T),q=j?"backgroundPattern":"background";let Z,ee=y;ee||(Z=m.getBackgroundTiles(),ee=Object.values(Z).map(se=>se.tileID)),j&&(S.activeTexture.set(O.TEXTURE0),m.imageManager.bind(m.context,h.scope));for(const se of ee){const ue=m.isTileAffectedByFog(se),K=m.getOrCreateProgram(q,{overrideFog:ue}),ie=se.toUnwrapped(),he=y?se.projMatrix:m.transform.calculateProjMatrix(ie);m.prepareDrawTile();const ge=l?l.getTile(se):Z?Z[se.key]:new f.bt(se,z,k.zoom,m),pe=j?an(he,T,w,m,j,h.scope,{tileID:se,tileSize:z}):Bt(he,T,w,x);m.uploadCommonUniforms(S,K,ie);const{tileBoundsBuffer:ye,tileBoundsIndexBuffer:Ne,tileBoundsSegments:Ae}=m.getTileBoundsBuffers(ge);K.draw(m,O.TRIANGLES,W,G,X,f.b5.disabled,pe,h.id,ye,Ne,Ae)}},sky:function(m,l,h){const y=m._atmosphere?f.ao(m.transform.zoom):1,x=h.paint.get("sky-opacity")*y;if(0===x)return;const w=m.context,T=h.paint.get("sky-type"),S=new f.b4(w.gl.LEQUAL,f.b4.ReadOnly,[0,1]),O=m.frameCounter/1e3%1;"atmosphere"===T?"offscreen"===m.renderPass?h.needsSkyboxCapture(m)&&(function(k,z,j,$){const G=k.context,W=G.gl;let X=z.skyboxFbo;if(!X){X=z.skyboxFbo=G.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new Yr(G),z.skyboxTexture=G.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,z.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let se=0;se<6;++se)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(X.framebuffer),G.viewport.set([0,0,32,32]);const q=z.getCenter(k,!0),Z=k.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);f.m.identity(ee),f.m.rotateY(ee,ee,.5*-Math.PI),Xs(k,z,Z,ee,q,0),f.m.identity(ee),f.m.rotateY(ee,ee,.5*Math.PI),Xs(k,z,Z,ee,q,1),f.m.identity(ee),f.m.rotateX(ee,ee,.5*-Math.PI),Xs(k,z,Z,ee,q,2),f.m.identity(ee),f.m.rotateX(ee,ee,.5*Math.PI),Xs(k,z,Z,ee,q,3),f.m.identity(ee),Xs(k,z,Z,ee,q,4),f.m.identity(ee),f.m.rotateY(ee,ee,Math.PI),Xs(k,z,Z,ee,q,5),G.viewport.set([0,0,k.width,k.height])}(m,h),h.markSkyboxValid(m)):"sky"===m.renderPass&&function(k,z,j,$,G){const W=k.context,X=W.gl,q=k.transform,Z=k.getOrCreateProgram("skybox");W.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,z.skyboxTexture);const ee={u_matrix:q.skyboxMatrix,u_sun_direction:z.getCenter(k,!1),u_cubemap:0,u_opacity:$,u_temporal_offset:G};k.uploadCommonUniforms(W,Z),Z.draw(k,X.TRIANGLES,j,f.b6.disabled,k.colorModeForRenderPass(),f.b5.backCW,ee,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(m,h,S,x,O):"gradient"===T&&"sky"===m.renderPass&&function(k,z,j,$,G){const W=k.context,X=W.gl,q=k.transform,Z=k.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Yr(W)),W.activeTexture.set(X.TEXTURE0);let ee=z.colorRampTexture;ee||(ee=z.colorRampTexture=new f.a9(W,z.colorRamp,X.RGBA)),ee.bind(X.LINEAR,X.CLAMP_TO_EDGE);const se=(ue=q.skyboxMatrix,K=z.getCenter(k,!1),ie=z.paint.get("sky-gradient-radius"),he=$,ge=G,{u_matrix:ue,u_color_ramp:0,u_center_direction:K,u_radius:f.d(ie),u_opacity:he,u_temporal_offset:ge});var ue,K,ie,he,ge;k.uploadCommonUniforms(W,Z),Z.draw(k,X.TRIANGLES,j,f.b6.disabled,k.colorModeForRenderPass(),f.b5.backCW,se,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(m,h,S,x,O)},debug:function(m,l,h,y,x){for(let w=0;w<h.length;w++)if(x){const O=new f.C(.8*y.r,.8*y.g,.8*y.b,1);Ds(m,l,h[w],y,-1,-1),Ds(m,l,h[w],y,-1,1),Ds(m,l,h[w],y,1,1),Ds(m,l,h[w],y,1,-1),Ds(m,l,h[w],O,0,0)}else Ds(m,l,h[w],y,0,0)},custom:function(m,l,h,y){const x=m.context,w=h.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||"offscreen"===m.renderPass)&&h.isLayerDraped(l)){if("offscreen"===m.renderPass){const T=w.prerender;if(T){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),"globe"===m.transform.projection.name){const S=m.transform.pointMerc;T.call(w,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),f.ao(m.transform.zoom),[S.x,S.y],m.transform.pixelsPerMeterRatio)}else T.call(w,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if("translucent"===m.renderPass){if(m.terrain&&m.terrain.renderingToTexture){const S=w.renderToTile;if(S){const O=y[0].canonical,k=new f.M(O.x+y[0].wrap*(1<<O.z),O.y,O.z);x.setDepthMode(f.b4.disabled),x.setStencilMode(f.b6.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),S.call(w,x.gl,k),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(f.b6.disabled);const T="3d"===w.renderingMode?new f.b4(m.context.gl.LEQUAL,f.b4.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,f.b4.ReadOnly);if(x.setDepthMode(T),"globe"===m.transform.projection.name){const S=m.transform.pointMerc;w.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),f.ao(m.transform.zoom),[S.x,S.y],m.transform.pixelsPerMeterRatio)}else w.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else f.X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,l,h,y){if("opaque"===m.renderPass)return;const x=h.paint.get("model-opacity");if(0===x)return;const w=h.paint.get("model-cast-shadows");if("shadow"===m.renderPass&&(!w||m.terrain&&x<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof f.am))return;const T=m.shadowRenderer,S=h.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,S||(T.enabled=!1));const O=()=>{T&&(T.useNormalOffset=!0,S||(T.enabled=!0))},k=l.getSource();if("light-beam"===m.renderPass&&"batched-model"!==k.type)return;if("vector"===k.type||"geojson"===k.type)return function(Z,ee,se,ue){const K=Z.transform;if("mercator"!==K.projection.name)return void f.X(`Drawing 3D models for ${K.projection.name} projection is not yet implemented`);const ie=K.getFreeCameraOptions().position;if(!Z.modelManager)return;const he=Z.modelManager,ge=Z.shadowRenderer;if(!se._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const pe=se._unevaluatedLayout._values["model-id"],ye={...se.layout.get("model-id").parameters};for(const Ne of ue){const Ae=ee.getTile(Ne).getBucket(se);if(!Ae||Ae.projection.name!==K.projection.name)continue;const Oe=Zi(Ne,K);ye.zoom=Oe;const be=pe.possiblyEvaluate(ye);if(ko(Z,Ae,Ne),bo.shadowUniformsInitialized=!1,bo.useSingleShadowCascade=!!ge&&0===ge.getMaxCascadeForTile(Ne.toUnwrapped()),"shadow"===Z.renderPass&&ge){if(1===Z.currentShadowCascade&&Ae.isInsideFirstShadowMapFrustum)continue;const Ge=K.calculatePosMatrix(Ne.toUnwrapped(),K.worldSize);if(bo.tileMatrix.set(Ge),bo.shadowTileMatrix=Float32Array.from(ge.calculateShadowPassMatrixFromMatrix(Ge)),bo.aabb.min.fill(0),bo.aabb.max[0]=bo.aabb.max[1]=f.J,bo.aabb.max[2]=0,Nn(Ae,bo,Z,se.scope))continue}const Ve=1<<Ne.canonical.z,Re=[((ie.x-Ne.wrap)*Ve-Ne.canonical.x)*f.J,(ie.y*Ve-Ne.canonical.y)*f.J,ie.z*Ve*f.J];for(let Ge in Ae.instancesPerModel){const re=Ae.instancesPerModel[Ge];re.features.length>0&&(Ge=be.evaluate(re.features[0].feature,{}));const Me=he.getModel(Ge,se.scope);if(Me&&Me.uploaded)for(const tt of Me.nodes)Js(Z,se,tt,re,Re,Ne,bo)}}}(m,l,h,y),void O();if(!k.loaded())return;if("batched-model"===k.type)return function(Z,ee,se,ue){const K=Z.context,ie=Z.transform,he=Z.style.fog,ge=Z.shadowRenderer;if("mercator"!==ie.projection.name)return void f.X(`Drawing 3D landmark models for ${ie.projection.name} projection is not yet implemented`);const pe=Z.transform.getFreeCameraOptions().position,ye=f.v.scale([],[pe.x,pe.y,pe.z],Z.transform.worldSize);f.v.negate(ye,ye);const Ne=f.m.identity([]),Ae=f.c4(ie.center.lat,ie.zoom),Oe=f.m.fromScaling([],[1,1,1/Ae]);f.m.translate(Ne,Ne,ye);const be=se.paint.get("model-opacity"),Ve=new f.b4(K.gl.LEQUAL,f.b4.ReadWrite,Z.depthRangeFor3D),Re=new f.b4(K.gl.LEQUAL,f.b4.ReadOnly,Z.depthRangeFor3D),Ge=function(re,Me){for(const tt of ue){const Xe=ee.getTile(tt).getBucket(se);if(!Xe||!Xe.uploaded)continue;let At=!1;ge&&(At=0===ge.getMaxCascadeForTile(tt.toUnwrapped()));const vt=ie.calculatePosMatrix(tt.toUnwrapped(),ie.worldSize),Vt=Xe.modelTraits;for(const xt of Xe.getNodesInfo()){if(xt.hiddenByReplacement||!xt.node.meshes)continue;const Xt=xt.node,Yt="light-beam"===Z.renderPass,Lt=[...vt],Ft=xt.evaluatedScale;let zn=0;Z.terrain&&Xt.elevation&&(zn=Xt.elevation*Z.terrain.exaggeration()),f.m.translate(Lt,Lt,[(Xt.anchor?Xt.anchor[0]:0)*(Ft[0]-1),(Xt.anchor?Xt.anchor[1]:0)*(Ft[1]-1),zn]),Ft!==f.c6&&f.m.scale(Lt,Lt,Ft),f.m.multiply(Lt,Lt,Xt.matrix);const ke=f.m.multiply([],Oe,Lt);f.m.multiply(ke,Ne,ke);const ln=f.m.invert([],ke);f.m.transpose(ln,ln),f.m.scale(ln,ln,gu);const ar=f.m.multiply([],ie.expandedFarZProjMatrix,Lt),Eo=Vt&f.c8.HasMapboxMeshFeatures,Kr=Eo?0:xt.evaluatedRMEA[0][2];for(let lr=0;lr<Xt.meshes.length;++lr){const Rn=Xt.meshes[lr],In=lr===Xt.lightMeshIndex;if(In){if(!Yt&&!Z.terrain&&Z.shadowRenderer){Z.currentLayer<Z.firstLightBeamLayer&&(Z.firstLightBeamLayer=Z.currentLayer);continue}}else if(Yt)continue;const Sr={defines:[]},Wi=[];jn(Sr.defines,Wi,Rn,Z),Eo||Sr.defines.push("DIFFUSE_SHADED"),At&&Sr.defines.push("SHADOWS_SINGLE_CASCADE");const Ir="shadow"===Z.renderPass;if(Ir){wl(Rn,Lt,Z,se);continue}let Fo=null;if(he){const zo=Zt(Lt,Z.transform);if(Fo=new Float32Array(zo),"globe"!==ie.projection.name){const qn=Rn.aabb.min,Ea=Rn.aabb.max,[Ca,Sl]=he.getOpacityForBounds(zo,qn[0],qn[1],Ea[0],Ea[1]);Sr.overrideFog=Ca>=yi||Sl>=yi}}const No=Z.getOrCreateProgram("model",Sr);!Ir&&ge&&(ge.useNormalOffset=!!Rn.normalBuffer,ge.setupShadowsFromMatrix(Lt,No,ge.useNormalOffset)),Z.uploadCommonUniforms(K,No,tt.toUnwrapped(),Fo);const Ar=Rn.material,Qi=Ar.pbrMetallicRoughness;Qi.metallicFactor=.9,Qi.roughnessFactor=.5;const Qa=Hn(new Float32Array(ar),new Float32Array(ke),new Float32Array(ln),Z,be,Qi.baseColorFactor,Ar.emissiveFactor,Qi.metallicFactor,Qi.roughnessFactor,Ar,Kr,se);No.draw(Z,K.gl.TRIANGLES,Me&&!In?Ve:Re,f.b6.disabled,re?In||be<1||xt.hasTranslucentParts?f.a.alphaBlended:f.a.unblended:f.a.disabled,f.b5.backCCW,Qa,se.id,Rn.vertexBuffer,Rn.indexBuffer,Rn.segments,se.paint,Z.transform.zoom,void 0,Wi)}}}};(function(re,Me,tt,Xe){const At=re.terrain?re.terrain.exaggeration():0,vt=re.transform.zoom;for(const Vt of Xe){const xt=Me.getTile(Vt).getBucket(tt);xt&&(re.conflationActive&&xt.updateReplacement(Vt,re.replacementSource),xt.evaluateScale(re,tt),re.terrain&&At>0&&xt.elevationUpdate(re.terrain,At,Vt,tt.source),xt.needsReEvaluation(re,vt,tt)&&xt.evaluate(tt))}})(Z,ee,se,ue),1===be?Ge(!0,!0):(Ge(!1,!0),Ge(!0,!1))}(m,l,h,y),void O();const z=k.getModels(),j=[],$=m.transform.getFreeCameraOptions().position,G=f.v.scale([],[$.x,$.y,$.z],m.transform.worldSize);f.v.negate(G,G);const W=[],X=[];let q=0;for(const Z of z){const ee=h.paint.get("model-rotation").constantOr(null),se=h.paint.get("model-scale").constantOr(null),ue=h.paint.get("model-translation").constantOr(null);Z.computeModelMatrix(m,ee,se,ue,!0,!0,!1);const K=f.m.identity([]),ie=f.c4(Z.position.lat,m.transform.zoom),he=f.m.fromScaling([],[1,1,1/ie]);f.m.translate(K,K,G),j.push({zScaleMatrix:he,negCameraPosMatrix:K});for(const ge of Z.nodes)Ys(m.transform,ge,Z.matrix,m.transform.expandedFarZProjMatrix,q,W,X);q++}if(W.sort((Z,ee)=>ee.depth-Z.depth),"shadow"!==m.renderPass){if(1===x)for(const Z of X)kr(Z,m,h,j[Z.modelIndex],f.b6.disabled,m.colorModeForRenderPass());else{for(const Z of X)kr(Z,m,h,j[Z.modelIndex],f.b6.disabled,f.a.disabled);for(const Z of X)kr(Z,m,h,j[Z.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const Z of W)kr(Z,m,h,j[Z.modelIndex],f.b6.disabled,m.colorModeForRenderPass());O()}else{for(const Z of X)wl(Z.mesh,Z.nodeModelMatrix,m,h);for(const Z of W)wl(Z.mesh,Z.nodeModelMatrix,m,h);O()}}},yu={modelUpload:function(m,l,h){const y=l.getSource();if(!y.loaded())return;if("vector"===y.type||"geojson"===y.type)return void(m.modelManager&&m.modelManager.upload(m,h));if("batched-model"===y.type)return;const x=y.getModels();for(const w of x)w.upload(m.context)}};class vu{constructor(l,h,y,x){this.context=new qr(l,h),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._debugParams={showTerrainProxyTiles:!1},x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=f.bq.maxUnderzooming+f.bq.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new f.ca,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Xa(this),this._wireframeDebugCache=new Sc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(l,h){const y=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Hl(this,l));const x=this._terrain;this.transform.elevation=y?x:null,x.update(l,this.transform,h),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(l){const h=l.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,x]=h.getFovAdjustedRange(this.transform._fov);if(y>x)return void(this.transform.fogCullDistSq=null);const w=y+.78*(x-y);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,h){if(this.width=l*f.a4.devicePixelRatio,this.height=h*f.a4.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const l=this.context,h=new f.bo;h.emplaceBack(0,0),h.emplaceBack(f.J,0),h.emplaceBack(0,f.J),h.emplaceBack(f.J,f.J),this.tileExtentBuffer=l.createVertexBuffer(h,f.bl.members),this.tileExtentSegments=f.bm.simpleSegment(0,0,4,2);const y=new f.bo;y.emplaceBack(0,0),y.emplaceBack(f.J,0),y.emplaceBack(0,f.J),y.emplaceBack(f.J,f.J),this.debugBuffer=l.createVertexBuffer(y,f.bl.members),this.debugSegments=f.bm.simpleSegment(0,0,4,5);const x=new f.bo;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(x,f.bl.members),this.viewportSegments=f.bm.simpleSegment(0,0,4,2);const w=new f.cb;w.emplaceBack(0,0,0,0),w.emplaceBack(f.J,0,f.J,0),w.emplaceBack(0,f.J,0,f.J),w.emplaceBack(f.J,f.J,f.J,f.J),this.mercatorBoundsBuffer=l.createVertexBuffer(w,f.cc.members),this.mercatorBoundsSegments=f.bm.simpleSegment(0,0,4,2);const T=new f.bp;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(T);const S=new f.cd;for(const k of[0,1,3,2,0])S.emplaceBack(k);this.debugIndexBuffer=l.createIndexBuffer(S),this.emptyTexture=new f.a9(l,new f.a5({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=f.m.create();const O=this.context.gl;this.stencilClearMode=new f.b6({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,f.b4.disabled,this.stencilClearMode,f.a.disabled,f.b5.disabled,fo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,h,y){if(!h||this.currentStencilSource===h.id||!l.isTileClipped()||!y||0===y.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const O of y)if(void 0===this._tileClippingMaskIDs[O.key]){S=!0;break}if(!S)return}this.currentStencilSource=h.id;const x=this.context,w=x.gl;this.nextStencilID+y.length>256&&this.clearStencil(),x.setColorMode(f.a.disabled),x.setDepthMode(f.b4.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of y){const O=h.getTile(S),k=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:j,tileBoundsSegments:$}=this.getTileBoundsBuffers(O);T.draw(this,w.TRIANGLES,f.b4.disabled,new f.b6({func:w.ALWAYS,mask:0},k,255,w.KEEP,w.KEEP,w.REPLACE),f.a.disabled,f.b5.disabled,fo(S.projMatrix),"$clipping",z,j,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,h=this.context.gl;return new f.b6({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const h=this.context.gl;return new f.b6({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(l){const h=this.context.gl,y=l.sort((T,S)=>S.overscaledZ-T.overscaledZ),x=y[y.length-1].overscaledZ,w=y[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const T={};for(let S=0;S<w;S++)T[S+x]=new f.b6({func:h.GEQUAL,mask:255},S+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[T,y]}return[{[x]:f.b6.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new f.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new f.C(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.a.unblended:f.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const h=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new f.a([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new f.C(0,0,0,void 0===l?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,h,y,x=!1){if(!this.opaquePassEnabledForLayer()&&!x)return f.b4.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new f.b4(y||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,h){this._wireframeDebugCache.update(this.frameCounter),this.style=l,this.options=h;const y=this.style._mergedLayers,x=this.style.order,w=x.map(K=>y[K]),T=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(f.a4.now()),this.imageManager.beginFrame();let S=0,O=!1;for(const K in T){const ie=T[K];ie.used&&(ie.prepare(this.context),ie.getSource().usedInConflation&&++S)}const k={},z={},j={},$={},G={};for(const K in T){const ie=T[K];k[K]=ie.getVisibleCoordinates(),z[K]=k[K].slice().reverse(),j[K]=ie.getVisibleCoordinates(!0).reverse(),$[K]=ie.getShadowCasterCoordinates(),G[K]=ie.sortCoordinatesByDistance(k[K])}const W=K=>{const ie=this.style.getLayerSourceCache(K);return ie&&ie.used?ie.getSource():null};if(S){const K=[];for(const ie of w)this.layerUsedInConflation(ie,W(ie))&&K.push(ie);if(K&&K.length>1){const ie=[];for(const he of K){const ge=this.style.getLayerSourceCache(he);ge&&ge.used&&ge.getSource().usedInConflation&&ie.push({layer:he.fqid,cache:ge})}this.replacementSource.setSources(ie),O=!0}}O||this.replacementSource.clear(),this.conflationActive=O,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const K of w){const ie=K.cutoffRange();if(this.longestCutoffRange=Math.max(ie,this.longestCutoffRange),ie>0){const he=W(K);he&&(this.minCutoffZoom=Math.max(he.minzoom,this.minCutoffZoom)),K.minzoom&&(this.minCutoffZoom=Math.max(K.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let K=0;K<w.length;K++)if(w[K].is3D()){this.opaquePassCutoff=K;break}const X=this.style&&this.style.fog;X?(this._fogVisible=0!==X.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=X.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(j),this.opaquePassCutoff=0);const q=this._shadowRenderer;if(q){q.updateShadowParameters(this.transform,this.style.directionalLight);for(const K in T)for(const ie of k[K]){let he={min:0,max:0};this.terrain&&(he=this.terrain.getMinMaxForTile(ie)||he),q.addShadowReceiver(ie.toUnwrapped(),he.min,he.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.ce(this.context));for(const K of w){if(K.isHidden(this.transform.zoom))continue;const ie=l.getLayerSourceCache(K);this.uploadLayer(this,K,ie)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ni(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!f.cf(this.context.gl))return;this.renderPass="offscreen";for(const K of w){const ie=l.getLayerSourceCache(K);if(!K.hasOffscreenPass()||K.isHidden(this.transform.zoom))continue;const he=ie?z[ie.id]:void 0;("custom"===K.type||"raster"===K.type||K.isSky()||he&&he.length)&&this.renderLayer(this,ie,K,he)}this.depthRangeFor3D=[0,1-(w.length+2)*this.numSublayers*this.depthEpsilon];const Z=this.terrain;Z&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&Z.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,$)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ee="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),se=(()=>{if(h.showOverdrawInspector)return f.C.black;if(this.style.fog&&this.transform.projection.supportsFog&&!ee){const K=this.style.fog.properties.get("color").toArray01();return new f.C(...K)}if(this.style.fog&&this.transform.projection.supportsFog&&ee){const K=this.style.fog.properties.get("space-color").toArray01();return new f.C(...K)}return f.C.transparent})();if(this.context.clear({color:se,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ee&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const K=w[this.currentLayer],ie=l.getLayerSourceCache(K);if(K.isSky())continue;const he=ie?(K.is3D()?G:z)[ie.id]:void 0;this._renderTileClippingMasks(K,ie,he),this.renderLayer(this,ie,K,he)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ee&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||f.ao(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const K=w[this.currentLayer],ie=l.getLayerSourceCache(K);K.isSky()&&this.renderLayer(this,ie,K,ie?z[ie.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ue=0;for(q&&(ue=q.getShadowCastingLayerCount());this.currentLayer<x.length;){const K=w[this.currentLayer],ie=l.getLayerSourceCache(K);if(K.isSky()){++this.currentLayer;continue}if(Z&&this.style.isLayerDraped(K)){if(K.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=Z.renderBatch(this.currentLayer);continue}let he;if(ie&&(he=("symbol"===K.type?j:K.is3D()?G:z)[ie.id]),this._renderTileClippingMasks(K,ie,ie?k[ie.id]:void 0),this.renderLayer(this,ie,K,he),!Z&&q&&ue>0&&K.hasShadowPass()&&0==--ue&&(q.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ge;this.currentLayer++){const pe=w[this.currentLayer];if(!pe.hasLightBeamPass())continue;const ye=l.getLayerSourceCache(pe);this.renderLayer(this,ye,pe,ye?z[ye.id]:void 0)}this.currentLayer=ge,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let K=null;w.forEach(ie=>{const he=l.getLayerSourceCache(ie);he&&!ie.isHidden(this.transform.zoom)&&he.getVisibleCoordinates().length&&(!K||K.getSource().maxzoom<he.getSource().maxzoom)&&(K=he)}),K&&this.options.showTileBoundaries&&Si.debug(this,K,K.getVisibleCoordinates(),f.C.red,!1)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Si.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new f.C(1,.8,.1,1),!0),this.options.showPadding&&function(K){const ie=K.transform.padding;xn(K,K.transform.height-(ie.top||0),3,Dc),xn(K,ie.bottom||0,3,Lo),ii(K,ie.left||0,3,Ms),ii(K,K.transform.width-(ie.right||0),3,qi);const he=K.transform.centerPoint;var ge,pe,ye,Ne;$n(ge=K,(pe=he.x)-1,(ye=K.transform.height-he.y)-10,2,20,Ne=Zl),$n(ge,pe-10,ye-1,20,2,Ne)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),O||(this.conflationActive=!1)}uploadLayer(l,h,y){this.gpuTimingStart(h),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(h.type)||l.terrain&&"custom"===h.type)&&yu[`${h.type}Upload`]&&yu[`${h.type}Upload`](l,y,h.scope),this.gpuTimingEnd()}renderLayer(l,h,y,x){y.isHidden(this.transform.zoom)||("background"===y.type||"sky"===y.type||"custom"===y.type||"model"===y.type||"raster"===y.type||x&&x.length)&&(this.id=y.id,this.gpuTimingStart(y),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(y.type)||l.terrain&&"custom"===y.type)&&Si[y.type](l,h,y,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,y=this.context.gl;let x=this.gpuTimers[l.id];x||(x=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:y.createQuery()}),x.calls++,y.beginQuery(h.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,h=this.context.gl,y=h.createQuery();this.deferredRenderGpuTimeQueries.push(y),h.beginQuery(l.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const h={};for(const y in l){const x=l[y],w=this.context.extTimerQuery,T=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),h[y]=T}return h}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery,y=this.context.gl;let x=0;for(const w of l)x+=h.getQueryParameter(w,y.QUERY_RESULT)/1e6,h.deleteQueryEXT(w);return x}translatePosMatrix(l,h,y,x,w){if(!y[0]&&!y[1])return l;const T=w?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(T){const k=Math.sin(T),z=Math.cos(T);y=[y[0]*z-y[1]*k,y[0]*k+y[1]*z]}const S=[w?y[0]:f.ay(h,y[0],this.transform.zoom),w?y[1]:f.ay(h,y[1],this.transform.zoom),0],O=new Float32Array(16);return f.m.translate(O,l,S),O}saveTileTexture(l){const h=l.size[0],y=this._tileTextures[h];y?y.push(l):this._tileTextures[h]=[l]}getTileTexture(l){const h=this._tileTextures[l];return h&&h.length>0?h.pop():null}isPatternMissing(l,h){return null===l||void 0!==l&&!this.imageManager.getPattern(l.toString(),h)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(l,h,y){const x=void 0===y?this.terrain&&this.terrain.renderingToTexture:y,w=this.terrain&&0===this.terrain.exaggeration(),T=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===l||"terrainRaster"===l?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||T.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||T.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?T.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):T.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT"),w&&T.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&T.push("GLOBE"),!this._fogVisible||x||void 0!==h&&!h||T.push("FOG","FOG_DITHERING"),x&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(l,h){this.cache=this.cache||{};const y=h&&h.defines||[],x=h&&h.config,w=this.currentGlobalDefines(l,h&&h.overrideFog,h&&h.overrideRtt).concat(y),T=Ts.cacheKey(wc[l],l,w,x);return this.cache[T]||(this.cache[T]=new Ts(this.context,l,wc[l],x,Zo[l],w)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.a9(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,h){if(this.style.enable3dLights()){const y=this.style.directionalLight,x=this.style.ambientLight;if(y&&x){const w=((T,S)=>{const O=T.properties.get("direction"),k=T.properties.get("color").toArray01(),z=T.properties.get("intensity"),j=S.properties.get("color").toArray01(),$=S.properties.get("intensity"),G=[O.x,O.y,O.z],W=f.bv(j,$),X=f.bv(k,z);return{u_lighting_ambient_color:W,u_lighting_directional_dir:G,u_lighting_directional_color:X,u_ground_radiance:_l(G,X,W)}})(y,x);h.setLightsUniformValues(l,w)}}}uploadCommonUniforms(l,h,y,x,w){if(this.uploadCommonLightUniforms(l,h),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const S=T.getOpacity(this.transform.pitch),O=((k,z,j,$,G,W,X,q,Z,ee,se,ue)=>{const K=k.transform,ie=z.properties.get("color").toArray01();ie[3]=$;const he=k.frameCounter/1e3%1,[ge,pe]=z.properties.get("vertical-range");return{u_fog_matrix:j?K.calculateFogTileMatrix(j):ue||k.identityMat,u_fog_range:z.getFovAdjustedRange(K._fov),u_fog_color:ie,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ge,pe),pe],u_fog_temporal_offset:he,u_frustum_tl:G,u_frustum_tr:W,u_frustum_br:X,u_frustum_bl:q,u_globe_pos:Z,u_globe_radius:ee,u_viewport:se,u_globe_transition:f.ao(K.zoom),u_is_globe:+("globe"===K.projection.name)}})(this,T,y,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*f.a4.devicePixelRatio,this.transform.height*f.a4.devicePixelRatio],x);h.setFogUniformValues(l,O)}w&&h.setCutoffUniformValues(l,w.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,h=l.createTexture();return l.bindTexture(l.TEXTURE_2D,h),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&0!==l.getOpacity(this.transform.pitch)}getBackgroundTiles(){const l=this._backgroundTiles,h=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const x of y)h[x.key]=l[x.key]||new f.bt(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(l,h){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||"building"!==l.sourceLayer&&(!h||"batched-model"!==h.type))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let h=this._cachedTileFogOpacities[l.key];return h||(this._cachedTileFogOpacities[l.key]=h=this.style.fog.getOpacityForTile(l)),h[0]>=yi||h[1]>=yi}}const Ii={cascadeCount:2,shadowMapResolution:2048};class ah{constructor(l,h){this.aabb=l,this.lastCascade=h}}class pd{add(l,h){const y=this.receivers[l.key];void 0!==y?(y.aabb.min[0]=Math.min(y.aabb.min[0],h.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],h.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],h.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],h.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],h.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],h.max[2])):this.receivers[l.key]=new ah(h,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,h,y){const x=f.c3.fromPoints(l.points);let w=0;for(const T in this.receivers){const S=this.receivers[T];if(!S||!x.intersectsAabb(S.aabb))continue;S.aabb.min=x.closestPoint(S.aabb.min),S.aabb.max=x.closestPoint(S.aabb.max);const O=S.aabb.getCorners();for(let k=0;k<y.length;k++){let z=!0;for(const j of O){const $=[j[0]*h,j[1]*h,j[2]];if(f.v.transformMat4($,$,y[k].matrix),$[0]<-1||$[0]>1||$[1]<-1||$[1]>1){z=!1;break}}if(S.lastCascade=k,w=Math.max(w,k),z)break}}return w+1}}class Xa{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new pd,this._depthMode=new f.b4(l.context.gl.LEQUAL,f.b4.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,l.tp.registerParameter(Ii,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(Ii,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,h){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const x=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||x<=0||(this._shadowLayerCount=y.style.order.reduce((W,X)=>{const q=y.style._mergedLayers[X];return W+(q.hasShadowPass()&&!q.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const w=y.context,T=Ii.shadowMapResolution,S=Ii.shadowMapResolution;if(0===this._cascades.length||Ii.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let W=0;W<Ii.cascadeCount;++W){const X=y._shadowMapDebug,q=w.gl,Z=w.createFramebuffer(T,S,X,"texture"),ee=new f.a9(w,{width:T,height:S,data:null},q.DEPTH_COMPONENT);if(Z.depthAttachment.set(ee.texture),X){const se=new f.a9(w,{width:T,height:S,data:null},q.RGBA);Z.colorAttachment.set(se.texture)}this._cascades.push({framebuffer:Z,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new f.F,scale:0})}}this.shadowDirection=Ac(h);let O=0;if(l.elevation){const W=l.elevation,X=[1e4,-1e4];W.visibleDemTiles.filter(q=>q.dem).forEach(q=>{const Z=q.dem.tree;X[0]=Math.min(X[0],Z.minimums[0]),X[1]=Math.max(X[1],Z.maximums[0])}),1e4!==X[0]&&(O=(X[1]-X[0])*W.exaggeration())}const k=1.5*l.cameraToCenterDistance,z=3*k,j=new Float64Array(16);for(let W=0;W<this._cascades.length;++W){const X=this._cascades[W];let q=l.height/50,Z=1;1===Ii.cascadeCount?Z=z:0===W?Z=k:(q=k,Z=z);const[ee,se]=sr(l,this.shadowDirection,q,Z,Ii.shadowMapResolution,O);X.scale=l.scale,X.matrix=ee,X.boundingSphereRadius=se,f.m.invert(j,X.matrix),X.frustum=f.F.fromInvProjectionMatrix(j,1,0,!0),X.far=Z}const $=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[$].far,this._cascades[$].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ii.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ii.shadowMapResolution,this._uniformValues.u_shadowmap_0=Fn.ShadowMap0,this._uniformValues.u_shadowmap_1=Fn.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=y.transform.elevation;for(const W of this._groundShadowTiles){let X={min:0,max:0};if(G){const q=G.getMinMaxForTile(W);q&&(X=q)}this.addShadowReceiver(W.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled}set enabled(l){this._enabled=l}drawShadowPass(l,h){if(!this._enabled)return;const y=this.painter,x=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),x.viewport.set([0,0,Ii.shadowMapResolution,Ii.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){y.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:f.C.white,depth:1});for(const T of l.order){const S=l._mergedLayers[T];if(!S.hasShadowPass()||S.isHidden(y.transform.zoom))continue;const O=l.getLayerSourceCache(S),k=O?h[O.id]:void 0;("model"===S.type||k&&k.length)&&y.renderLayer(y,O,S,k)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const l=this.painter,h=l.style,y=l.context,x=h.directionalLight,w=h.ambientLight;if(!x||!w)return;const T=[],S=pa(l,l.longestCutoffRange);S.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const O=Xl(x,w),k=new f.b4(y.gl.LEQUAL,f.b4.ReadOnly,l.depthRangeFor3D);for(const z of this._groundShadowTiles){const j=z.toUnwrapped(),$=l.isTileAffectedByFog(z),G=l.getOrCreateProgram("groundShadow",{defines:T,overrideFog:$});this.setupShadows(j,G),l.uploadCommonUniforms(y,G,j,null,S);const W={u_matrix:l.transform.calculateProjMatrix(j),u_ground_shadow_factor:O};G.draw(l,y.gl.TRIANGLES,k,f.b6.disabled,f.a.multiply,f.b5.disabled,W,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?f.a.unblended:f.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const h=this.painter.transform,y=h.calculatePosMatrix(l,h.worldSize);return f.m.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(l){return f.m.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,h,y,x=0){if(!this._enabled)return;const w=this.painter.transform,T=this.painter.context,S=T.gl,O=this._uniformValues,k=new Float64Array(16),z=w.calculatePosMatrix(l,w.worldSize);for(let j=0;j<this._cascades.length;j++)f.m.multiply(k,this._cascades[j].matrix,z),O[0===j?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),T.activeTexture.set(S.TEXTURE0+Fn.ShadowMap0+j),this._cascades[j].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const j=f.cg(l.canonical),$=2/w.tileSize*f.J/Ii.shadowMapResolution,G=$*this._cascades[0].boundingSphereRadius,W=$*this._cascades[this._cascades.length-1].boundingSphereRadius,X=("vector-tile"===y?1:3)/Math.pow(2,x-l.canonical.z-(1-w.zoom+Math.floor(w.zoom)));O.u_shadow_normal_offset=[j,G*X,W*X],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(T,O)}setupShadowsFromMatrix(l,h,y=!1){if(!this._enabled)return;const x=this.painter.context,w=x.gl,T=this._uniformValues,S=new Float64Array(16);for(let O=0;O<Ii.cascadeCount;O++)f.m.multiply(S,this._cascades[O].matrix,l),T[0===O?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),x.activeTexture.set(w.TEXTURE0+Fn.ShadowMap0+O),this._cascades[O].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);this.useNormalOffset=y,y?(T.u_shadow_normal_offset=[1,5,5],T.u_shadow_bias=[6e-5,.0012,.012]):T.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(x,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,h,y,x){if(x[2]>=0)return{};const w=function(O,k,z){const j=z/(1<<O.canonical.z);return new f.c3([O.canonical.x*j+O.wrap*z,O.canonical.y*j+O.wrap*z,0],[(O.canonical.x+1)*j+O.wrap*z,(O.canonical.y+1)*j+O.wrap*z,k])}(l,h,y).getCorners(),T=h/-x[2];x[0]<0?(f.v.add(w[0],w[0],[x[0]*T,0,0]),f.v.add(w[3],w[3],[x[0]*T,0,0])):x[0]>0&&(f.v.add(w[1],w[1],[x[0]*T,0,0]),f.v.add(w[2],w[2],[x[0]*T,0,0])),x[1]<0?(f.v.add(w[0],w[0],[0,x[1]*T,0]),f.v.add(w[1],w[1],[0,x[1]*T,0])):x[1]>0&&(f.v.add(w[2],w[2],[0,x[1]*T,0]),f.v.add(w[3],w[3],[0,x[1]*T,0]));const S={};return S.vertices=w,S.planes=[Ss(w[1],w[0],w[4]),Ss(w[2],w[1],w[5]),Ss(w[3],w[2],w[6]),Ss(w[0],w[3],w[7])],S}addShadowReceiver(l,h,y){this._receivers.add(l,f.c3.fromTileIdAndHeight(l,h,y))}getMaxCascadeForTile(l){const h=this._receivers.get(l);return h&&h.lastCascade?h.lastCascade:0}}function Ss(m,l,h){const y=f.v.sub([],h,l),x=f.v.sub([],m,l),w=f.v.cross([],y,x),T=f.v.length(w);return 0===T?[0,0,1,0]:(f.v.scale(w,w,1/T),[w[0],w[1],w[2],-f.v.dot(w,l)])}function Ac(m){const l=m.properties.get("direction"),h=f.b3(l.x,l.y,l.z);h[2]=f.c(h[2],0,75);const y=f.ch([h[0],h[1],h[2]]);return f.v.fromValues(y.x,y.y,y.z)}function Xl(m,l){const h=m.properties.get("color"),y=m.properties.get("intensity"),x=m.properties.get("direction"),w=[x.x,x.y,x.z],T=l.properties.get("color"),S=l.properties.get("intensity"),O=Math.max(f.v.dot([0,0,1],w),0),k=[0,0,0];f.v.scale(k,T.toArray01Linear().slice(0,3),S);const z=[0,0,0];return f.v.scale(z,h.toArray01Linear().slice(0,3),O*y),f.bw([k[0]>0?k[0]/(k[0]+z[0]):0,k[1]>0?k[1]/(k[1]+z[1]):0,k[2]>0?k[2]/(k[2]+z[2]):0])}function sr(m,l,h,y,x,w){const T=m.zoom,S=m.scale,O=m.worldSize,k=1/O,z=m.aspect,j=Math.sqrt(1+z*z)*Math.tan(.5*m.fovX),$=j*j,G=y-h,W=y+h;let X,q;$>G/W?(X=y,q=y*j):(X=.5*W*(1+$),q=.5*Math.sqrt(G*G+2*(y*y+h*h)*$+W*W*$*$));const Z=m.projection.pixelsPerMeter(m.center.lat,O),ee=m._camera.getCameraToWorldMercator(),se=[0,0,-X*k];f.v.transformMat4(se,se,ee);let ue=q*k;const K=m._edgeInsets;if(!(0===K.left&&0===K.top&&0===K.right&&0===K.bottom||K.left===K.right&&K.top===K.bottom)){const Xe=m._camera.getWorldToCamera(m.worldSize,"meters"===m.projection.zAxisUnit?Z:1),At=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,h,y);At[8]=2*-m.centerOffset.x/m.width,At[9]=2*m.centerOffset.y/m.height;const vt=new Float64Array(16);f.m.mul(vt,At,Xe);const Vt=new Float64Array(16);f.m.invert(Vt,vt);const xt=f.F.fromInvProjectionMatrix(Vt,O,T,!0);for(const Xt of xt.points){const Yt=((ie=Xt)[0]/=S,ie[1]/=S,ie[2]=f.b(ie[2],m._center.lat),ie);ue=Math.max(ue,f.v.len(f.v.subtract([],se,Yt)))}}var ie;ue*=x/(x-1);const he=Math.acos(l[2]),ge=Math.atan2(-l[0],-l[1]),pe=new oo;pe.position=se,pe.setPitchBearing(he,ge);const ye=pe.getWorldToCamera(O,Z),Ne=ue*O,Ae=Math.min(m._mercatorZfromZoom(17)*O*-2,-2*Ne),Oe=pe.getCameraToClipOrthographic(-Ne,Ne,-Ne,Ne,Ae,(Ne+w*Z)/l[2]),be=new Float64Array(16);f.m.multiply(be,Oe,ye);const Ve=f.v.fromValues(Math.floor(1e6*se[0])/1e6*O,Math.floor(1e6*se[1])/1e6*O,0),Re=.5*x,Ge=[0,0,0];f.v.transformMat4(Ge,Ve,be),f.v.scale(Ge,Ge,Re);const re=[Math.floor(Ge[0]),Math.floor(Ge[1]),Math.floor(Ge[2])],Me=[0,0,0];f.v.sub(Me,Ge,re),f.v.scale(Me,Me,-1/Re);const tt=new Float64Array(16);return f.m.identity(tt),f.m.translate(tt,tt,Me),f.m.multiply(be,tt,be),[be,Ne]}class j_ extends f.a6{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,h){return f.aO(this.requestManager.transformRequest(h,f.a2.Model).url).then(y=>{if(!y)return;const x=f.aP(y),w=new f.aQ(l,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w}).catch(y=>{this.fire(new f.a7(new Error(`Could not load model ${l} from ${h}: ${y.message}`)))})}load(l,h){this.models[h]||(this.models[h]={});const y=Object.keys(l);this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+y.length;const x=[];for(const w of y)x.push(this.loadModel(w,l[w]));Promise.allSettled(x).then(w=>{for(let T=0;T<w.length;T++){const{status:S,value:O}=w[T];"fulfilled"===S&&O&&(this.models[h][y[T]]=O)}this.numModelsLoading[h]-=y.length,this.fire(new f.a8("data",{dataType:"style"}))}).catch(w=>{this.fire(new f.a7(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,h){return!!this.getModel(l,h)}getModel(l,h){return this.models[h]||(this.models[h]={}),this.models[h][l]}addModel(l,h,y){this.models[y]||(this.models[y]={}),this.hasModel(l,y)&&this.removeModel(l,y),this.load({[l]:this.requestManager.normalizeModelURL(h)},y)}addModels(l,h){const y={};for(const x in l)y[x]=this.requestManager.normalizeModelURL(l[x]);this.load(y,h)}removeModel(l,h){this.models[h]||(this.models[h]={});const y=this.models[h][l];delete this.models[h][l],y.destroy()}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,h){this.models[h]||(this.models[h]={});for(const y in this.models[h])this.models[h][y].upload(l.context)}}const El=(m,l)=>f.ai(m,l&&l.filter(h=>"source.canvas"!==h.identifier)),Bf=f.p(He,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),ba=f.p(He,["setCenter","setZoom","setBearing","setPitch"]),xu={version:8,layers:[],sources:{}},Is={duration:300,delay:0},Cl=new Set(["fill","line","background","hillshade","raster"]);class Jr extends f.a6{constructor(l,h={}){super(),this.map=l,this.scope=h.scope||"",this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=f.ak({},Is),this._buildingIndex=new Tn(this),this.crossTileSymbolIndex=new Cn,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=h.styleChanges||new ut,this.dispatcher=h.dispatcher?h.dispatcher:new f.br(f.bs(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Zr,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new f.cj(l._requestManager,h.localFontFamily?f.ck.all:h.localIdeographFontFamily?f.ck.ideographs:f.ck.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new j_(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._config=h.config,this.dispatcher.broadcast("setReferrer",f.cl());const y=this;this._rtlTextPluginCallback=Jr.registerForPluginStateChange(x=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,T)=>{if(f.cm(w),T&&T.every(S=>S))for(const S in y._sourceCaches){const O=y._sourceCaches[S],k=O.getSource().type;"vector"!==k&&"geojson"!==k||O.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(const T in this._layers){const S=this._layers[T];S.source===w.id&&this._validateLayer(S)}})}loadURL(l,h={}){this.fire(new f.a8("dataloading",{dataType:"style"}));const y="boolean"==typeof h.validate?h.validate:!f.cn(l);l=this.map._requestManager.normalizeStyleURL(l,h.accessToken),this.resolvedImports.add(l);const x=this.importsCache.get(l);if(x)return this._load(x,y);const w=this.map._requestManager.transformRequest(l,f.a2.Style);this._request=f.a1(w,(T,S)=>{if(this._request=null,T)this.fire(new f.a7(T));else if(S)return this.importsCache.set(l,S),this._load(S,y)})}loadJSON(l,h={}){this.fire(new f.a8("dataloading",{dataType:"style"})),this._request=f.a4.frame(()=>{this._request=null,this._load(l,!1!==h.validate)})}loadEmpty(){this.fire(new f.a8("dataloading",{dataType:"style"})),this._load(xu,!1)}_loadImports(l,h){if(this.importDepth>=4)return f.X("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const x of l){const w=this._createFragmentStyle(x),T=new Promise(O=>{w.once("style.import.load",O),w.once("error",O)}).then(()=>this.mergeAll());if(y.push(T),this.resolvedImports.has(x.url)){w.loadEmpty();continue}const S=x.data||this.importsCache.get(x.url);S?w.loadJSON(S,{validate:h}):x.url?w.loadURL(x.url,{validate:h}):w.loadEmpty(),this.fragments.push({style:w,id:x.id,config:x.config})}return Promise.allSettled(y)}_createFragmentStyle(l){const h=this.scope?f.aE(l.id,this.scope):l.id,y=new Jr(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:l.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const l=this.isRootStyle();this._shouldPrecompile=l,this.fire(new f.a8(l?"style.load":"style.import.load"))}_load(l,h){const y=l.schema;if(this.isRootStyle()&&(l.fragment||y&&!1!==l.fragment)){const T=f.ak({},xu,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(T,h)}if(this.setConfig(this._config,y),h&&El(this,f.aj(l)))return;this._loaded=!0,this.stylesheet=f.co(l);for(const T in l.sources)this.addSource(T,l.sources[T],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const x=ha(this.stylesheet.layers);if(this._order=x.map(T=>T.id),this.stylesheet.light&&f.X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const T=this.stylesheet.lights[0];this.light=new Li(T.properties,T.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Li(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const T of x){const S=f.cp(T,this.scope,this.options);S.isConfigDependent&&this._configDependentLayers.add(S.fqid),S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize();const O=this.getOwnLayerSourceCache(S),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&S.canCastShadows()&&k&&(O.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const w=this.stylesheet.terrain;w&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=f.a4.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?f.X("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new f.a8("data",{dataType:"style"})),l.imports?this._loadImports(l.imports,h).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let l,h,y,x,w,T,S,O;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(k=>{if(k.stylesheet){if(null!=k.light&&(l=k.light),k.stylesheet.lights)for(const z of k.stylesheet.lights)"ambient"===z.type&&null!=k.ambientLight&&(h=k.ambientLight),"directional"===z.type&&null!=k.directionalLight&&(y=k.directionalLight);x=this._prioritizeTerrain(x,k.terrain,k.stylesheet.terrain),k.stylesheet.fog&&null!=k.fog&&(w=k.fog),null!=k.stylesheet.camera&&(O=k.stylesheet.camera),null!=k.stylesheet.projection&&(T=k.stylesheet.projection),null!=k.stylesheet.transition&&(S=k.stylesheet.transition)}}),this.light=l,this.ambientLight=h,this.directionalLight=y,this.fog=w,null===x?delete this.terrain:this.terrain=x,this.camera=O||{"camera-projection":"perspective"},this.projection=T||{name:"mercator"},this.transition=f.ak({},Is,S),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const h=y=>{for(const x of y.fragments)h(x.style);l(y)};h(this)}_prioritizeTerrain(l,h,y){const x=l&&0===l.drapeRenderMode;return null===y?h&&0===h.drapeRenderMode?h:x?l:null:null!=h&&(!l||x||h&&1===h.drapeRenderMode)?h:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{l=this._prioritizeTerrain(l,h.terrain,h.stylesheet.terrain)}),null===l?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(h=>{null!=h.stylesheet.projection&&(l=h.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},h={},y={};this.forEachFragmentStyle(x=>{for(const w in x._sourceCaches){const T=f.aE(w,x.scope);l[T]=x._sourceCaches[w]}for(const w in x._otherSourceCaches){const T=f.aE(w,x.scope);h[T]=x._otherSourceCaches[w]}for(const w in x._symbolSourceCaches){const T=f.aE(w,x.scope);y[T]=x._symbolSourceCaches[w]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=y}mergeLayers(){const l={},h=[],y={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const T of w._order){const S=w._layers[T];if("slot"===S.type){const O=f.cq(T);if(l[O])continue;l[O]=[]}S.slot&&l[S.slot]?l[S.slot].push(S):h.push(S)}}),this._mergedOrder=[];const x=(w=[])=>{for(const T of w)if("slot"===T.type){const S=f.cq(T.id);l[S]&&x(l[S])}else{const S=f.aE(T.id,T.scope);this._mergedOrder.push(S),y[S]=T,T.is3D()&&(this._has3DLayers=!0),"circle"===T.type&&(this._hasCircleLayers=!0),"symbol"===T.type&&(this._hasSymbolLayers=!0)}};x(h),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=f.ak({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(h,y,x){let w,T,S;const O=f.a4.devicePixelRatio>1?"@2x":"";let k=f.a1(y.transformRequest(y.normalizeSpriteURL(h,O,".json"),f.a2.SpriteJSON),($,G)=>{k=null,S||(S=$,w=G,j())}),z=f.a3(y.transformRequest(y.normalizeSpriteURL(h,O,".png"),f.a2.SpriteImage),($,G)=>{z=null,S||(S=$,T=G,j())});function j(){if(S)x(S);else if(w&&T){const $=f.a4.getImageData(T),G={};for(const W in w){const{width:X,height:q,x:Z,y:ee,sdf:se,pixelRatio:ue,stretchX:K,stretchY:ie,content:he}=w[W],ge=new f.a5({width:X,height:q});f.a5.copy($,ge,{x:Z,y:ee},{x:0,y:0},{width:X,height:q}),G[W]={data:ge,pixelRatio:ue,sdf:se,stretchX:K,stretchY:ie,content:he}}x(null,G)}}return{cancel(){k&&(k.cancel(),k=null),z&&(z.cancel(),z=null)}}}(l,this.map._requestManager,(h,y)=>{if(this._spriteRequest=null,h)this.fire(new f.a7(h));else if(y)for(const x in y)this.imageManager.addImage(x,this.scope,y[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new f.a8("data",{dataType:"style"}))})}_validateLayer(l){const h=this.getOwnSource(l.source);if(!h)return;const y=l.sourceLayer;y&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(y))&&this.fire(new f.a7(new Error(`Source layer "${y}" does not exist on source "${h.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,h)=>{const y=this.fragments[h];return y&&y.style&&(l.data=y.style.serialize()),l})}_serializeSources(){const l={};for(const h in this._sourceCaches){const y=this._sourceCaches[h].getSource();l[y.id]||(l[y.id]=y.serialize())}return l}_serializeLayers(l){const h=[];for(const y of l){const x=this._layers[y];x&&"custom"!==x.type&&h.push(x.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&("function"==typeof l.isLayerDraped?l.isLayerDraped(this.getLayerSourceCache(l)):Cl.has(l.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const h=this.getOwnLayer(l);if(h)return h;this.fire(new f.a7(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const h=this.getOwnSource(l);if(h)return h;this.fire(new f.a7(new Error(`The source '${l}' does not exist in the map's style.`)))}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const h=this.calculateLightsBrightness();l.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h));const y=this._changes.isDirty();if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const T in w){const{updatedIds:S,removedIds:O}=w[T];(S||O)&&this._updateWorkerLayers(T,S,O)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const x={};for(const w in this._mergedSourceCaches){const T=this._mergedSourceCaches[w];x[w]=T.used,T.used=!1}for(const w of this._mergedOrder){const T=this._mergedLayers[w];if(T.recalculate(l,this._availableImages),!T.isHidden(l.zoom)){const S=this.getLayerSourceCache(T);S&&(S.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let S=T.minzoom||0;S<(T.maxzoom||25.5);S++){const O=this.map.painter;if(O){const k=T.getProgramIds();if(!k)continue;for(const z of k){const j=T.getDefaultProgramParams(z,l.zoom);j&&(O.style=this,this.fog&&(O._fogVisible=!0,j.overrideFog=!0,O.getOrCreateProgram(z,j)),O._fogVisible=!1,j.overrideFog=!1,O.getOrCreateProgram(z,j),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(j.overrideRtt=!0,O.getOrCreateProgram(z,j)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const w in x){const T=this._mergedSourceCaches[w];x[w]!==T.used&&T.getSource().fire(new f.a8("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new f.a8("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,h,y){const x=this.getFragmentStyle(l);x&&this.dispatcher.broadcast("updateLayers",{layers:h?x._serializeLayers(h):[],scope:l,removedIds:y||[],options:x.options})}setState(l){if(this._checkLoaded(),El(this,f.aj(l)))return!1;(l=f.co(l)).layers=ha(l.layers);const h=function(x,w){if(!x)return[{command:He.setStyle,args:[w]}];let T=[];try{if(!en(x.version,w.version))return[{command:He.setStyle,args:[w]}];en(x.center,w.center)||T.push({command:He.setCenter,args:[w.center]}),en(x.zoom,w.zoom)||T.push({command:He.setZoom,args:[w.zoom]}),en(x.bearing,w.bearing)||T.push({command:He.setBearing,args:[w.bearing]}),en(x.pitch,w.pitch)||T.push({command:He.setPitch,args:[w.pitch]}),en(x.sprite,w.sprite)||T.push({command:He.setSprite,args:[w.sprite]}),en(x.glyphs,w.glyphs)||T.push({command:He.setGlyphs,args:[w.glyphs]}),en(x.imports,w.imports)||function(j=[],$=[],G){$=$||[];const W=(j=j||[]).map(xe),X=$.map(xe),q=j.reduce(we,{}),Z=$.reduce(we,{}),ee=W.slice();let se,ue,K,ie;for(se=0,ue=0;se<W.length;se++)K=W[se],Z.hasOwnProperty(K)?ue++:(G.push({command:He.removeImport,args:[K]}),ee.splice(ee.indexOf(K,ue),1));for(se=0,ue=0;se<X.length;se++)K=X[X.length-1-se],ee[ee.length-1-se]!==K&&(q.hasOwnProperty(K)?(G.push({command:He.removeImport,args:[K]}),ee.splice(ee.lastIndexOf(K,ee.length-ue),1)):ue++,ie=ee[ee.length-se],G.push({command:He.addImport,args:[Z[K],ie]}),ee.splice(ee.length-se,0,K));for(const he of $){const ge=q[he.id];if(!ge||en(ge,he))continue;en(ge.config,he.config)||G.push({command:He.setImportConfig,args:[he.id,he.config]}),en(ge.url,he.url)||G.push({command:He.setImportUrl,args:[he.id,he.url]});const pe=he.data;en(ge&&ge.data,pe)||G.push({command:He.setImportData,args:[he.id,pe]})}}(x.imports,w.imports,T),en(x.transition,w.transition)||T.push({command:He.setTransition,args:[w.transition]}),en(x.light,w.light)||T.push({command:He.setLight,args:[w.light]}),en(x.fog,w.fog)||T.push({command:He.setFog,args:[w.fog]}),en(x.projection,w.projection)||T.push({command:He.setProjection,args:[w.projection]}),en(x.lights,w.lights)||T.push({command:He.setLights,args:[w.lights]}),en(x.camera,w.camera)||T.push({command:He.setCamera,args:[w.camera]});const S={},O=[];!function(j,$,G,W){let X;for(X in $=$||{},j=j||{})j.hasOwnProperty(X)&&($.hasOwnProperty(X)||P(X,G,W));for(X in $){if(!$.hasOwnProperty(X))continue;const q=$[X];j.hasOwnProperty(X)?en(j[X],q)||("geojson"===j[X].type&&"geojson"===q.type&&te(j,$,X)?G.push({command:He.setGeoJSONSourceData,args:[X,q.data]}):V(X,$,G,W)):Mn(X,$,G)}}(x.sources,w.sources,O,S);const k=[];x.layers&&x.layers.forEach(j=>{j.source&&S[j.source]?T.push({command:He.removeLayer,args:[j.id]}):k.push(j)});let z=x.terrain;z&&S[z.source]&&(T.push({command:He.setTerrain,args:[void 0]}),z=void 0),T=T.concat(O),en(z,w.terrain)||T.push({command:He.setTerrain,args:[w.terrain]}),function(j,$,G){$=$||[];const W=(j=j||[]).map(xe),X=$.map(xe),q=j.reduce(we,{}),Z=$.reduce(we,{}),ee=W.slice(),se=Object.create(null);let ue,K,ie,he,ge,pe,ye;for(ue=0,K=0;ue<W.length;ue++)ie=W[ue],Z.hasOwnProperty(ie)?K++:(G.push({command:He.removeLayer,args:[ie]}),ee.splice(ee.indexOf(ie,K),1));for(ue=0,K=0;ue<X.length;ue++)ie=X[X.length-1-ue],ee[ee.length-1-ue]!==ie&&(q.hasOwnProperty(ie)?(G.push({command:He.removeLayer,args:[ie]}),ee.splice(ee.lastIndexOf(ie,ee.length-K),1)):K++,pe=ee[ee.length-ue],G.push({command:He.addLayer,args:[Z[ie],pe]}),ee.splice(ee.length-ue,0,ie),se[ie]=!0);for(ue=0;ue<X.length;ue++)if(ie=X[ue],he=q[ie],ge=Z[ie],!se[ie]&&!en(he,ge))if(en(he.source,ge.source)&&en(he["source-layer"],ge["source-layer"])&&en(he.type,ge.type)){for(ye in ce(he.layout,ge.layout,G,ie,null,He.setLayoutProperty),ce(he.paint,ge.paint,G,ie,null,He.setPaintProperty),en(he.slot,ge.slot)||G.push({command:He.setSlot,args:[ie,ge.slot]}),en(he.filter,ge.filter)||G.push({command:He.setFilter,args:[ie,ge.filter]}),en(he.minzoom,ge.minzoom)&&en(he.maxzoom,ge.maxzoom)||G.push({command:He.setLayerZoomRange,args:[ie,ge.minzoom,ge.maxzoom]}),he)he.hasOwnProperty(ye)&&"layout"!==ye&&"paint"!==ye&&"filter"!==ye&&"metadata"!==ye&&"minzoom"!==ye&&"maxzoom"!==ye&&"slot"!==ye&&(0===ye.indexOf("paint.")?ce(he[ye],ge[ye],G,ie,ye.slice(6),He.setPaintProperty):en(he[ye],ge[ye])||G.push({command:He.setLayerProperty,args:[ie,ye,ge[ye]]}));for(ye in ge)ge.hasOwnProperty(ye)&&!he.hasOwnProperty(ye)&&"layout"!==ye&&"paint"!==ye&&"filter"!==ye&&"metadata"!==ye&&"minzoom"!==ye&&"maxzoom"!==ye&&"slot"!==ye&&(0===ye.indexOf("paint.")?ce(he[ye],ge[ye],G,ie,ye.slice(6),He.setPaintProperty):en(he[ye],ge[ye])||G.push({command:He.setLayerProperty,args:[ie,ye,ge[ye]]}))}else G.push({command:He.removeLayer,args:[ie]}),pe=ee[ee.lastIndexOf(ie)+1],G.push({command:He.addLayer,args:[ge,pe]})}(k,w.layers,T)}catch(S){console.warn("Unable to compute style diff:",S),T=[{command:He.setStyle,args:[w]}]}return T}(this.serialize(),l).filter(x=>!(x.command in ba));if(0===h.length)return!1;const y=h.filter(x=>!(x.command in Bf));if(y.length>0)throw new Error(`Unimplemented: ${y.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{this[x.command].apply(this,x.args)}),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,h){return this.getImage(l)?this.fire(new f.a7(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,h),this._afterImageUpdated(l),this)}updateImage(l,h){this.imageManager.updateImage(l,this.scope,h)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new f.a7(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new f.a8("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,h,y={}){return this._checkLoaded(),this._validate(f.cr,`models.${l}`,h,null,y)||(this.modelManager.addModel(l,h,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new f.a7(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,h,y={}){if(this._checkLoaded(),void 0!==this.getOwnSource(l))throw new Error(`There is already a source with ID "${l}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(f.cs,`sources.${l}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=ws(l,h,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const w=T=>{const S=(T?"symbol:":"other:")+x.id,O=f.aE(S,this.scope),k=this._sourceCaches[S]=new f.bq(O,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=k,k.onAdd(this.map)};w(!1),"vector"!==h.type&&"geojson"!==h.type||w(!0),x.onAdd&&x.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const h=this.getOwnSource(l);if(!h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===l)return this.fire(new f.a7(new Error(`Source "${l}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new f.a7(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(l);for(const x of y){const w=f.cq(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new f.a8("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,h){this._checkLoaded(),this.getOwnSource(l).setData(h),this._changes.setDirty()}getOwnSource(l){const h=this.getOwnSourceCache(l);return h&&h.getSource()}getOwnSources(){const l=[];for(const h in this._otherSourceCaches){const y=this.getOwnSourceCache(h);y&&l.push(y.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const h in l){const y=l[h]._tiles;for(const x in y){const w=y[x];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const x of l){if(this._validate(f.ct,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(x),w.updateTransitions(h)}else this.ambientLight=new dl(x,xs,this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(x),w.updateTransitions(h)}else this.directionalLight=new dl(x,wi,this.scope,this.options)}}const y=new f.al(this.z||0,h);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,h=this.ambientLight;if(!l||!h)return;const y=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),x=l.properties.get("color").toArray01(),w=l.properties.get("intensity"),T=l.properties.get("direction"),S=1-f.b3(T.x,T.y,T.z)[2]/90,O=y(x)*w*S,k=h.properties.get("color").toArray01(),z=h.properties.get("intensity");return(O+y(k)*z)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(f.cu(l)){const h=f.cv(l),y=this.fragments.find(({id:w})=>w===h);if(!y)throw new Error(`Style import not found: ${l}`);const x=f.cq(l);return y.style.getFragmentStyle(x)}{const h=this.fragments.find(({id:y})=>y===l);if(!h)throw new Error(`Style import not found: ${l}`);return h.style}}getConfigProperty(l,h){const y=this.getFragmentStyle(l);if(!y)return null;const x=f.aE(h,y.scope),w=y.options.get(x),T=w?w.value||w.default:null;return T?T.serialize():null}setConfigProperty(l,h,y){const x=f.cw(y);if("success"!==x.result)return void El(this,x.value);const w=x.value.expression,T=this.getFragmentStyle(l);if(!T)return;const S=f.aE(h,T.scope),O=T.options.get(S);O&&(this.options.set(S,{...O,value:w}),this.updateConfigDependencies())}setConfig(l,h){if(this._config=l,l||h)if(h)for(const y in h){let x,w;const T=f.cw(h[y].default);if("success"===T.result&&(x=T.value.expression),l&&void 0!==l[y]){const $=f.cw(l[y]);"success"===$.result&&(w=$.value.expression)}const{minValue:S,maxValue:O,stepValue:k,type:z,values:j}=h[y];if(x){const $=f.aE(y,this.scope);this.options.set($,{default:x,value:w,minValue:S,maxValue:O,stepValue:k,type:z,values:j})}else this.fire(new f.a7(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new f.a7(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const l of this._configDependentLayers){const h=this.getLayer(l);h&&(h.possiblyEvaluateVisibility(),this._updateLayer(h))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(l,h,y={}){this._checkLoaded();const x=l.id;if(this._layers[x])return void this.fire(new f.a7(new Error(`Layer with id "${x}" already exists on this map`)));let w;if("custom"===l.type){if(El(this,f.cx(l)))return;w=f.cp(l,this.scope,this.options)}else{if("object"==typeof l.source&&(this.addSource(x,l.source),l=f.co(l),l=f.ak(l,{source:x})),this._validate(f.cy,`layers.${x}`,l,{arrayIndex:-1},y))return;w=f.cp(l,this.scope,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize()}w.isConfigDependent&&this._configDependentLayers.add(w.fqid);let T=this._order.length;if(h){const z=this._order.indexOf(h);if(-1===z)return void this.fire(new f.a7(new Error(`Layer with id "${h}" does not exist on this map.`)));w.slot===this._layers[h].slot?T=z:f.X(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const S=this.getOwnLayerSourceCache(w),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&w.canCastShadows()&&O&&(S.castsShadows=!0);const k=this._changes.getRemovedLayer(w);if(k&&w.source&&S&&"custom"!==w.type){this._changes.discardLayerRemoval(w);const z=f.aE(w.source,w.scope);k.type!==w.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),S.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(l,h){this._checkLoaded();const y=this._checkLayer(l);if(!y||l===h)return;const x=this._order.indexOf(l);this._order.splice(x,1);let w=this._order.length;if(h){const T=this._order.indexOf(h);if(-1===T)return void this.fire(new f.a7(new Error(`Layer with id "${h}" does not exist on this map.`)));y.slot===this._layers[h].slot?w=T:f.X(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const h=this._checkLayer(l);if(!h)return;h.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const x=this.getOwnLayerSourceCache(h);if(x&&x.castsShadows){let w=!1;for(const T in this._layers)if(this._layers[T].source===h.source&&this._layers[T].canCastShadows()){w=!0;break}x.castsShadows=w}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const h in this._layers)if(this._layers[h].type===l)return!0;return!1}setLayerZoomRange(l,h,y){this._checkLoaded();const x=this._checkLayer(l);x&&(x.minzoom===h&&x.maxzoom===y||(null!=h&&(x.minzoom=h),null!=y&&(x.maxzoom=y),this._updateLayer(x)))}setSlot(l,h){this._checkLoaded();const y=this._checkLayer(l);y&&y.slot!==h&&(y.slot=h,this._updateLayer(y))}setFilter(l,h,y={}){this._checkLoaded();const x=this._checkLayer(l);if(x&&!en(x.filter,h))return null==h?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(f.cz,`layers.${x.id}.filter`,h,{layerType:x.type},y)||(x.filter=f.co(h),this._updateLayer(x)))}getFilter(l){const h=this._checkLayer(l);if(h)return f.co(h.filter)}setLayoutProperty(l,h,y,x={}){this._checkLoaded();const w=this._checkLayer(l);w&&(en(w.getLayoutProperty(h),y)||(w.setLayoutProperty(h,y,x),w.isConfigDependent&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)))}getLayoutProperty(l,h){const y=this._checkLayer(l);if(y)return y.getLayoutProperty(h)}setPaintProperty(l,h,y,x={}){this._checkLoaded();const w=this._checkLayer(l);if(!w||en(w.getPaintProperty(h),y))return;const T=w.setPaintProperty(h,y,x);w.isConfigDependent&&this._configDependentLayers.add(w.fqid),T&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(l,h){const y=this._checkLayer(l);if(y)return y.getPaintProperty(h)}setFeatureState(l,h){this._checkLoaded();const y=l.source,x=l.sourceLayer,w=this._checkSource(y);if(!w)return;const T=w.type;if("geojson"===T&&x)return void this.fire(new f.a7(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===T&&!x)return void this.fire(new f.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===l.id&&this.fire(new f.a7(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(y);for(const O of S)O.setFeatureState(x,l.id,h)}removeFeatureState(l,h){this._checkLoaded();const y=l.source,x=this._checkSource(y);if(!x)return;const w=x.type,T="vector"===w?l.sourceLayer:void 0;if("vector"===w&&!T)return void this.fire(new f.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof l.id&&"number"!=typeof l.id)return void this.fire(new f.a7(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(y);for(const O of S)O.removeFeatureState(T,l.id,h)}getFeatureState(l){this._checkLoaded();const h=l.source,y=l.sourceLayer,x=this._checkSource(h);if(x){if("vector"!==x.type||y)return void 0===l.id&&this.fire(new f.a7(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(y,l.id);this.fire(new f.a7(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=f.ak({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return f.ak({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),h=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return f.cA({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>void 0!==y)}_updateLayer(l){this._changes.updateLayer(l);const h=this.getLayerSourceCache(l),y=f.aE(l.source,l.scope),x=this._changes.getUpdatedSourceCaches();l.source&&!x[y]&&h&&"raster"!==h.getSource().type&&(this._changes.updateSourceCache(y,"reload"),h.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const h=S=>"fill-extrusion"===this._mergedLayers[S].type,y=this.order,x={},w=[];for(let S=y.length-1;S>=0;S--){const O=y[S];if(h(O)){x[O]=S;for(const k of l){const z=k[O];if(z)for(const j of z)w.push(j)}}}w.sort((S,O)=>O.intersectionZ-S.intersectionZ);const T=[];for(let S=y.length-1;S>=0;S--){const O=y[S];if(h(O))for(let k=w.length-1;k>=0;k--){const z=w[k].feature;if(x[z.layer.id]<S)break;T.push(z),w.pop()}else for(const k of l){const z=k[O];if(z)for(const j of z)T.push(j.feature)}}return T}queryRenderedFeatures(l,h,y){h&&h.filter&&this._validate(f.cz,"queryRenderedFeatures.filter",h.filter,null,h),h.scope=this.scope,h.availableImages=this._availableImages,h.serializedLayers=this._serializedLayers;const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new f.a7(new Error("parameters.layers must be an Array."))),[];for(const k of h.layers){const z=this._mergedLayers[k];if(!z)return this.fire(new f.a7(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];x[z.source]=!0}}const w=[],T=h.serializedLayers||{},S=h&&h.layers?h.layers.some(k=>{const z=this.getLayer(k);return z&&z.is3D()}):this.has3DLayers(),O=ki.createFromScreenPoints(l,y);for(const k in this._mergedSourceCaches){const z=this._mergedSourceCaches[k].getSource();if(!z||z.scope!==h.scope)continue;const j=this._mergedSourceCaches[k].getSource().id;h.layers&&!x[j]||w.push(Vr(this._mergedSourceCaches[k],this._mergedLayers,T,O,h,y,S,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(k,z,j,$,G,W,X){const q={},Z=W.queryRenderedSymbols($),ee=[];for(const se of Object.keys(Z).map(Number))ee.push(X[se]);ee.sort(mi);for(const se of ee){const ue=se.featureIndex.lookupSymbolFeatures(Z[se.bucketInstanceId],z,se.bucketIndex,se.sourceLayerIndex,G.filter,G.layers,G.availableImages,k);for(const K in ue){const ie=q[K]=q[K]||[],he=ue[K];he.sort((ge,pe)=>{const ye=se.featureSortOrder;if(ye){const Ne=ye.indexOf(ge.featureIndex);return ye.indexOf(pe.featureIndex)-Ne}return pe.featureIndex-ge.featureIndex});for(const ge of he)ie.push(ge)}}for(const se in q)q[se].forEach(ue=>{const K=ue.feature,ie=j(k[se]);if(!ie)return;const he=ie.getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=he});return q}(this._mergedLayers,T,this.getLayerSourceCache.bind(this),O.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(l,h){h&&h.filter&&this._validate(f.cz,"querySourceFeatures.filter",h.filter,null,h);const y=this.getOwnSourceCaches(l);let x=[];for(const w of y)x=x.concat(th(w,h));return x}addSourceType(l,h,y){return Jr.getSourceType(l)?y(new Error(`A source type called "${l}" already exists.`)):(Jr.setSourceType(l,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:h.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,h,y={}){this._checkLoaded();const x=this.light.getLight();let w=!1;for(const S in l)if(!en(l[S],x[S])){w=!0;break}if(!w)return;const T=this._getTransitionParameters();this.light.setLight(l,h,y),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,h=1){if(this._checkLoaded(),!l)return delete this.terrain,null===l?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let y=l;const x=null==l.source;if(1===h){if("object"==typeof y.source){const S="terrain-dem-src";this.addSource(S,y.source),y=f.co(y),y=f.ak(y,{source:S})}const w=f.ak({},y),T={};if(this.terrain&&x){w.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(T.style=S.serialize())}if(this._validate(f.cB,"terrain",w,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&h!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,h),this.fire(new f.a8("data",{dataType:"style"}))}else{const w=this.terrain,T=w.get();for(const S of Object.keys(f.ae.terrain))!y.hasOwnProperty(S)&&f.ae.terrain[S].default&&(y[S]=f.ae.terrain[S].default);for(const S in l)if(!en(l[S],T[S])){w.set(l,this.options),this.stylesheet.terrain=l;const O=this._getTransitionParameters({duration:0});w.updateTransitions(O),this.fire(new f.a8("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const h=this.fog=new Gl(l,this.map.transform);this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!en(h.get(),l)){h.set(l),this.stylesheet.fog=h.get();const y=this._getTransitionParameters({duration:0});h.updateTransitions(y)}}else this._createFog(l);this._markersNeedUpdate=!0}_getTransitionParameters(l){return{now:f.a4.now(),transition:f.ak(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],h=[];for(const y in this._mergedLayers)this.isLayerDraped(this._mergedLayers[y])?l.push(y):h.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...h)}_createTerrain(l,h){const y=this.terrain=new Ho(l,h,this.scope,this.options);1===h&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});y.updateTransitions(x)}_force3DLayerUpdate(){for(const l in this._layers){const h=this._layers[l];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const h=this._layers[l];"symbol"===h.type&&this._updateLayer(h)}}_validate(l,h,y,x,w={}){if(w&&!1===w.validate)return!1;const T=f.ak({},this.serialize());return El(this,l.call(f.aj,f.ak({key:h,style:T,value:y,styleSpec:f.ae},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.cC.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const h=this.getSourceCaches(l);for(const y of h)y.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const h=this.getSourceCaches(l);for(const y of h)y.resume(),y.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let h;this.directionalLight&&(h=Ac(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(l,void 0,void 0,h)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const h=this._sourceCaches[l];h.resume(),h.reload()}}_updatePlacement(l,h,y,x,w=!1){let T=!1,S=!1;const O={},k={};for(const z of this._mergedOrder){const j=this._mergedLayers[z];if("symbol"!==j.type)continue;const $=f.aE(j.source,j.scope);let G=O[$];if(!G){const X=this.getLayerSourceCache(j);if(!X)continue;const q=X.getRenderableIds(!0).map(Z=>X.getTileByID(Z));k[$]=q.slice(),G=O[$]=q.sort((Z,ee)=>ee.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(ee.tileID)?-1:1))}const W=this.crossTileSymbolIndex.addLayer(j,G,l.center.lng,l.projection);T=T||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged||0===y,this._layerOrderChanged&&this.fire(new f.a8("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.a4.now(),l.zoom))&&(this.pauseablePlacement=new Ao(l,this._mergedOrder,w,h,y,x,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.a4.now()),S=!0),T&&this.pauseablePlacement.placement.setStale()),S||T)for(const z of this._mergedOrder){const j=this._mergedLayers[z];"symbol"===j.type&&this.placement.updateLayerOpacities(j,O[f.aE(j.source,j.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.a4.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==h.findIndex(({id:y})=>y===l.id)?this.fire(new f.a7(new Error(`Import with id '${l.id}' already exists in the map's style.`))):(h.push(l),this._loadImports([l],!0),this)}setImportUrl(l,h){this._checkLoaded();const y=this.stylesheet.imports||[],x=this.getImportIndex(l);if(-1===x)return this;y[x].url=h;const w=this.fragments[x];return w.style=this._createFragmentStyle(y[x]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(h),this}setImportData(l,h){this._checkLoaded();const y=this.getImportIndex(l),x=this.stylesheet.imports||[];return-1===y?this:h?(this.fragments[y].style.setState(h),this._reloadImports(),this):(delete x[y].data,this.setImportUrl(l,x[y].url))}setImportConfig(l,h){this._checkLoaded();const y=this.getImportIndex(l),x=this.stylesheet.imports||[];if(-1===y)return this;h?x[y].config=h:delete x[y].config;const w=this.fragments[y],T=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=h,w.style.setConfig(h,T),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const h=this.stylesheet.imports||[],y=this.getImportIndex(l);return-1===y||(h.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports()),this}getImportIndex(l){const h=(this.stylesheet.imports||[]).findIndex(y=>y.id===l);return-1===h&&this.fire(new f.a7(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),h}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const h in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[h];y&&l.push(y.getSource())}return l}getSource(l,h){const y=this.getSourceCache(l,h);return y&&y.getSource()}getLayerSource(l){const h=this.getLayerSourceCache(l);return h&&h.getSource()}getSourceCache(l,h){const y=f.aE(l,h);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(l){const h=f.aE(l.source,l.scope);return"symbol"===l.type?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(l){const h=[];return this._mergedOtherSourceCaches[l]&&h.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&h.push(this._mergedSymbolSourceCaches[l]),h}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const h in l){const y=l[h];"reload"===y?this.reloadSource(h):"clear"===y&&this.clearSource(h)}}updateLayers(l){const h=this._changes.getUpdatedPaintProperties();for(const y of h){const x=this.getLayer(y);x&&x.updateTransitions(l)}}getImages(l,h,y){this.imageManager.getImages(h.icons,h.scope,y),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(l,h,y){this.glyphManager.getGlyphs(h.stacks,h.scope,y)}getResource(l,h,y){return f.cD(h,y)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return"symbol"===l.type?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const h=[];return this._otherSourceCaches[l]&&h.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&h.push(this._symbolSourceCaches[l]),h}_isSourceCacheLoaded(l){const h=this.getOwnSourceCaches(l);return 0===h.length?(this.fire(new f.a7(new Error(`There is no source with ID '${l}'`))),!1):h.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Pc(m,l){let h=!1,y=null;const x=()=>{y=null,h&&(m(),y=setTimeout(x,l),h=!1)};return()=>(h=!0,y||x(),y)}Jr.getSourceType=function(m){return bs[m]},Jr.setSourceType=function(m,l){bs[m]=l},Jr.registerForPluginStateChange=f.ci;class Wo{constructor(l){this._hashName=l&&encodeURIComponent(l),f.aR(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Pc(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const h=zi(l);if(this._hashName){const y=this._hashName;let x=!1;const w=location.hash.slice(1).split("&").map(T=>{const S=T.split("=")[0];return S===y?(x=!0,`${S}=${h}`):T}).filter(T=>T);return x||w.push(`${y}=${h}`),`#${w.join("&")}`}return`#${h}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let h;return l.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(h=y)}),(h&&h[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(y))){const y=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(h[3]||0):l.getBearing();return l.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function zi(m,l){const h=m.getCenter(),y=Math.round(100*m.getZoom())/100,x=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),T=Math.round(h.lng*w)/w,S=Math.round(h.lat*w)/w,O=m.getBearing(),k=m.getPitch();let z=l?`/${T}/${S}/${y}`:`${y}/${S}/${T}`;return(O||k)&&(z+="/"+Math.round(10*O)/10),k&&(z+=`/${Math.round(k)}`),z}const Rc={linearity:.3,easing:f.cE(0,0,.3,1)},Tl=f.ak({deceleration:2500,maxSpeed:1400},Rc),bu=f.ak({deceleration:20,maxSpeed:1400},Rc),ls=f.ak({deceleration:1e3,maxSpeed:360},Rc),Vf=f.ak({deceleration:1e3,maxSpeed:90},Rc);class Pm{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.a4.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,h=f.a4.now();for(;l.length>0&&h-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new f.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const w=jf(h.pan.mag(),y,f.ak({},Tl,l||{}));x.offset=h.pan.mult(w.amount/h.pan.mag()),x.center=this._map.transform.center,Yl(x,w)}if(h.zoom){const w=jf(h.zoom,y,bu);x.zoom=this._map.transform.zoom+w.amount,Yl(x,w)}if(h.bearing){const w=jf(h.bearing,y,ls);x.bearing=this._map.transform.bearing+f.c(w.amount,-179,179),Yl(x,w)}if(h.pitch){const w=jf(h.pitch,y,Vf);x.pitch=this._map.transform.pitch+w.amount,Yl(x,w)}if(x.zoom||x.bearing){const w=void 0===h.pinchAround?h.around:h.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Yl(m,l){(!m.duration||m.duration<l.duration)&&(m.duration=l.duration,m.easing=l.easing)}function jf(m,l,h){const{maxSpeed:y,linearity:x,deceleration:w}=h,T=f.c(m*x/(l/1e3),-y,y),S=Math.abs(T)/(w*x);return{easing:h.easing,duration:1e3*S,amount:T*(S/2)}}class As extends f.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y,x={}){const w=go(h.getCanvasContainer(),y),T=h.unproject(w);super(l,f.ak({point:w,lngLat:T,originalEvent:y},x)),this._defaultPrevented=!1,this.target=h}}class lh extends f.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){const x="touchend"===l?y.changedTouches:y.touches,w=sa(h.getCanvasContainer(),x),T=w.map(O=>h.unproject(O)),S=w.reduce((O,k,z,j)=>O.add(k.div(j.length)),new f.P(0,0));super(l,{points:w,point:S,lngLats:T,lngLat:h.unproject(S),originalEvent:y}),this._defaultPrevented=!1}}class A0 extends f.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){super(l,{originalEvent:y}),this._defaultPrevented=!1}}class Rm{constructor(l,h){this._map=l,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new A0(l.type,this._map,l))}mousedown(l,h){return this._mousedownPos=h,this._firePreventable(new As(l.type,this._map,l))}mouseup(l){this._map.fire(new As(l.type,this._map,l))}preclick(l){const h=f.ak({},l);h.type="preclick",this._map.fire(new As(h.type,this._map,h))}click(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(l),this._map.fire(new As(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new As(l.type,this._map,l))}mouseover(l){this._map.fire(new As(l.type,this._map,l))}mouseout(l){this._map.fire(new As(l.type,this._map,l))}touchstart(l){return this._firePreventable(new lh(l.type,this._map,l))}touchmove(l){this._map.fire(new lh(l.type,this._map,l))}touchend(l){this._map.fire(new lh(l.type,this._map,l))}touchcancel(l){this._map.fire(new lh(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uf{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new As(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new As("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new As(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class md{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,h){this.isEnabled()&&l.shiftKey&&0===l.button&&(io(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(l,h){if(!this._active)return;const y=h,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(y)||!this._box&&y.dist(x)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=hn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const T=Math.min(x.x,y.x),S=Math.max(x.x,y.x),O=Math.min(x.y,y.y),k=Math.max(x.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${O}px)`,this._box.style.width=S-T+"px",this._box.style.height=k-O+"px")})}mouseupWindow(l,h){if(!this._active)return;const y=this._startPos,x=h;if(y&&0===l.button){if(this.reset(),Cr(),y.x!==x.x||y.y!==x.y)return this._map.fire(new f.a8("boxzoomend",{originalEvent:l})),{cameraAnimation:w=>w.fitScreenCoordinates(y,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ba(),delete this._startPos,delete this._lastPos}_fireEvent(l,h){return this._map.fire(new f.a8(l,{originalEvent:h}))}}function gd(m,l){const h={};for(let y=0;y<m.length;y++)h[m[y].identifier]=l[y];return h}class _d{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(x){const w=new f.P(0,0);for(const T of x)w._add(T);return w.div(x.length)}(h),this.touches=gd(y,h)))}touchmove(l,h,y){if(this.aborted||!this.centroid)return;const x=gd(y,h);for(const w in this.touches){const T=x[w];(!T||T.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(l,h,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===y.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class yd{constructor(l){this.singleTap=new _d(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,h,y){this.singleTap.touchstart(l,h,y)}touchmove(l,h,y){this.singleTap.touchmove(l,h,y)}touchend(l,h,y){const x=this.singleTap.touchend(l,h,y);if(x){const w=l.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(w&&T||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class $f{constructor(){this._zoomIn=new yd({numTouches:1,numTaps:2}),this._zoomOut=new yd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,h,y){this._zoomIn.touchstart(l,h,y),this._zoomOut.touchstart(l,h,y)}touchmove(l,h,y){this._zoomIn.touchmove(l,h,y),this._zoomOut.touchmove(l,h,y)}touchend(l,h,y){const x=this._zoomIn.touchend(l,h,y),w=this._zoomOut.touchend(l,h,y);return x?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:l})}):w?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(w)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Gf={0:1,2:2};class Ps{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,h){return!1}_move(l,h){return{}}mousedown(l,h){if(this._lastPoint)return;const y=aa(l);this._correctButton(l,y)&&(this._lastPoint=h,this._eventButton=y)}mousemoveWindow(l,h){const y=this._lastPoint;if(y)if(l.preventDefault(),null!=this._eventButton&&function(x,w){const T=Gf[w];return void 0===x.buttons||(x.buttons&T)!==T}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(y,h)}mouseupWindow(l){this._lastPoint&&aa(l)===this._eventButton&&(this._moved&&Cr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class U_ extends Ps{mousedown(l,h){super.mousedown(l,h),this._lastPoint&&(this._active=!0)}_correctButton(l,h){return 0===h&&!l.ctrlKey}_move(l,h){return{around:h,panDelta:h.sub(l)}}}class Om extends Ps{_correctButton(l,h){return 0===h&&l.ctrlKey||2===h}_move(l,h){const y=.8*(h.x-l.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(l){l.preventDefault()}}class vd extends Ps{_correctButton(l,h){return 0===h&&l.ctrlKey||2===h}_move(l,h){const y=-.5*(h.y-l.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(l){l.preventDefault()}}class Jl{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),f.aR(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.P(0,0)}touchstart(l,h,y){return this._calculateTransform(l,h,y)}touchmove(l,h,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===y.length&&!f.cF())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,h,y)}}touchend(l,h,y){this._calculateTransform(l,h,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,h,y){y.length>0&&(this._active=!0);const x=gd(y,h),w=new f.P(0,0),T=new f.P(0,0);let S=0;for(const k in x){const z=x[k],j=this._touches[k];j&&(w._add(z),T._add(z.sub(j)),S++,x[k]=z)}if(this._touches=x,S<this._minTouches||!T.mag())return;const O=T.div(S);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(S),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=hn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Hf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,h,y){return{}}touchstart(l,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(l,h,y){const x=this._firstTwoTouches;if(!x)return;l.preventDefault();const[w,T]=x,S=wu(y,h,w),O=wu(y,h,T);if(!S||!O)return;const k=this._aroundCenter?null:S.add(O).div(2);return this._move([S,O],k,l)}touchend(l,h,y){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,T=wu(y,h,x),S=wu(y,h,w);T&&S||(this._active&&Cr(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function wu(m,l,h){for(let y=0;y<m.length;y++)if(m[y].identifier===h)return l[y]}function qf(m,l){return Math.log(m/l)/Math.LN2}class Ya extends Hf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,h){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(qf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qf(this._distance,y),pinchAround:h}}}function Ja(m,l){return 180*m.angleWith(l)/Math.PI}class $_ extends Hf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,h){const y=this._vector;if(this._vector=l[0].sub(l[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ja(this._vector,y),pinchAround:h}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const h=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const x=Ja(l,y);return Math.abs(x)<h}}function Oc(m){return Math.abs(m.y)>Math.abs(m.x)}class wo extends Hf{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Oc(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,h,y){const x=this._lastPoints;if(!x)return;const w=l[0].sub(x[0]),T=l[1].sub(x[1]);return this._map._cooperativeGestures&&!f.cF()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(w,T,y.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(w.y+T.y)/2*-.5})}gestureBeginsVertically(l,h,y){if(void 0!==this._valid)return this._valid;const x=l.mag()>=2,w=h.mag()>=2;if(!x&&!w)return;if(!x||!w)return null==this._firstMove&&(this._firstMove=y),y-this._firstMove<100&&void 0;const T=l.y>0==h.y>0;return Oc(l)&&Oc(h)&&T}}const xd={panStep:100,bearingStep:15,pitchStep:10};class Rs{constructor(){const l=xd;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let h=0,y=0,x=0,w=0,T=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?x=1:(l.preventDefault(),T=-1);break;case 40:l.shiftKey?x=-1:(l.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(y=0,x=0),{cameraAnimation:S=>{const O=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:ch,zoom:h?Math.round(O)+h*(l.shiftKey?2:1):O,bearing:S.getBearing()+y*this._bearingStep,pitch:S.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-T*this._panStep],center:S.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ch(m){return m*(2-m)}const uh=4.000244140625;class Zf{constructor(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.aR(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||f.cF()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=f.a4.now(),x=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,0!==h&&h%uh==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=go(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;"wheel"===this._type&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>uh?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==z&&(z=1/z);const j=h(),$=Math.pow(2,j),G="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(G*z))),"wheel"===this._type&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y="number"==typeof this._targetZoom?this._targetZoom:h(),x=this._startZoom,w=this._easing;let T,S=!1;if("wheel"===this._type&&x&&w){const k=Math.min((f.a4.now()-this._lastWheelEventTime)/200,1),z=w(k);T=f.n(x,y,z),k<1?this._frameId||(this._frameId=!0):S=!0}else T=y,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=T-h();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let h=f.cG;if(this._prevEase){const y=this._prevEase,x=(f.a4.now()-y.start)/y.duration,w=y.easing(x+.01)-y.easing(x),T=.27/Math.sqrt(w*w+1e-4)*.01,S=Math.sqrt(.0729-T*T);h=f.cE(T,S,.25,1)}return this._prevEase={start:f.a4.now(),duration:l,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=hn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Wf{constructor(l,h){this._clickZoom=l,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Eu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,h){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(l.shiftKey?-1:1),around:y.unproject(h)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bd{constructor(){this._tap=new yd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,h,y){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=h[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(l,h,y))}touchmove(l,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const x=h[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,l.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(l,h,y)}touchend(l,h,y){this._tapTime?this._swipePoint&&0===y.length&&this.reset():this._tap.touchend(l,h,y)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wd{constructor(l,h,y){this._el=l,this._mousePan=h,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ed{constructor(l,h,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xf{constructor(l,h,y,x){this._el=l,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Cu=m=>m.zoom||m.drag||m.pitch||m.rotate;class Yf extends f.a8{}class Ml{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,h){const y=f.v.sub([],h,l);this.radius=f.v.length(y[2]<0?f.v.div([],y,this.constants):[y[0],y[1],0])}projectRay(l){f.v.div(l,l,this.constants),f.v.normalize(l,l),f.v.mul(l,l,this.constants);const h=f.v.scale([],l,this.radius);if(h[2]>0){const y=f.v.scale([],[0,0,1],f.v.dot(h,[0,0,1])),x=f.v.scale([],f.v.normalize([],[h[0],h[1],0]),this.radius),w=f.v.add([],h,f.v.scale([],f.v.sub([],f.v.add([],x,y),h),2));h[0]=w[0],h[1]=w[1]}return h}}function Dl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Lc{constructor(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pm(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ml,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),f.aR(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,w,T]of this._listeners){const S=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,S,T)}}destroy(){for(const[l,h,y]of this._listeners){const x=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(h,x,y)}}_addDefaultHandlers(l){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new Rm(h,l));const x=h.boxZoom=new md(h,l);this._add("boxZoom",x);const w=new $f,T=new Eu;h.doubleClickZoom=new Wf(T,w),this._add("tapZoom",w),this._add("clickZoom",T);const S=new bd;this._add("tapDragZoom",S);const O=h.touchPitch=new wo(h);this._add("touchPitch",O);const k=new Om(l),z=new vd(l);h.dragRotate=new Ed(l,k,z),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const j=new U_(l),$=new Jl(h,l);h.dragPan=new wd(y,j,$),this._add("mousePan",j),this._add("touchPan",$,["touchZoom","touchRotate"]);const G=new $_,W=new Ya;h.touchZoomRotate=new Xf(y,W,G,S),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Uf(h));const X=h.scrollZoom=new Zf(h,this);this._add("scrollZoom",X,["mousePan"]);const q=h.keyboard=new Rs;this._add("keyboard",q);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[Z]&&h[Z].enable(l[Z])}_add(l,h,y){this._handlers.push({handlerName:l,handler:h,allowed:y}),this._handlersById[l]=h}stop(l){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,h,y){for(const x in l)if(x!==y&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const h=[];for(const y of l)this._el.contains(y.target)&&h.push(y);return h}handleEvent(l,h){this._updatingCamera=!0;const y="renderFrame"===l.type,x=y?void 0:l,w={needsRenderFrame:!1},T={},S={},O=l.touches?this._getMapTouches(l.touches):void 0,k=O?sa(this._el,O):y?void 0:go(this._el,l);for(const{handlerName:$,handler:G,allowed:W}of this._handlers){if(!G.isEnabled())continue;let X;this._blockedByActive(S,W,$)?G.reset():G[h||l.type]&&(X=G[h||l.type](l,k,O),this.mergeHandlerResult(w,T,X,$,x),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||G.isActive())&&(S[$]=G)}const z={};for(const $ in this._previousActiveHandlers)S[$]||(z[$]=x);this._previousActiveHandlers=S,(Object.keys(z).length||Dl(w))&&(this._changes.push([w,T,z]),this._triggerRenderFrame()),(Object.keys(S).length||Dl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=w;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(l,h,y,x,w){if(!y)return;f.ak(l,y);const T={handlerName:x,originalEvent:y.originalEvent||w};void 0!==y.zoomDelta&&(h.zoom=T),void 0!==y.panDelta&&(h.drag=T),void 0!==y.pitchDelta&&(h.pitch=T),void 0!==y.bearingDelta&&(h.rotate=T)}_applyChanges(){const l={},h={},y={};for(const[x,w,T]of this._changes)x.panDelta&&(l.panDelta=(l.panDelta||new f.P(0,0))._add(x.panDelta)),x.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(l.around=x.around),void 0!==x.aroundCoord&&(l.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(l.pinchAround=x.pinchAround),x.noInertia&&(l.noInertia=x.noInertia),f.ak(h,w),f.ak(y,T);this._updateMapTransform(l,h,y),this._changes=[]}_updateMapTransform(l,h,y){const x=this._map,w=x.transform,T=ee=>[ee.x,ee.y,ee.z];if((ee=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!Dl(l)){const ee=w.zoom;w.cameraElevationReference="sea",null!=this._originalZoom&&w._orthographicProjectionAtLowPitch&&"globe"!==w.projection.name&&0===w.pitch?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),ee!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!Dl(l))return void this._fireEvents(h,y,!0);let{panDelta:S,zoomDelta:O,bearingDelta:k,pitchDelta:z,around:j,aroundCoord:$,pinchAround:G}=l;w._isCameraConstrained&&(O>0&&(O=0),w._isCameraConstrained=!1),void 0!==G&&(j=G),(O||(ee=>h.drag&&!this._eventsInProgress.drag)())&&j&&(this._dragOrigin=T(w.pointCoordinate3D(j)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),j=j||x.transform.centerPoint,k&&(w.bearing+=k),z&&(w.pitch+=z),w._updateCameraState();const W=[0,0,0];if(S)if("mercator"===w.projection.name){const ee=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(j).dir),se=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(j.sub(S)).dir);W[0]=se[0]-ee[0],W[1]=se[1]-ee[1]}else{const ee=w.pointCoordinate(j);if("globe"===w.projection.name){S=S.rotate(-w.angle);const se=w._pixelsPerMercatorPixel/w.worldSize;W[0]=-S.x*f.cH(f.l(ee.y))*se,W[1]=-S.y*f.cH(w.center.lat)*se}else{const se=w.pointCoordinate(j.sub(S));ee&&se&&(W[0]=se.x-ee.x,W[1]=se.y-ee.y)}}const X=w.zoom,q=[0,0,0];if(O){const ee=T($||w.pointCoordinate3D(j)),se={dir:f.v.normalize([],f.v.sub([],ee,w._camera.position))};if(se.dir[2]<0){const ue=w.zoomDeltaToMovement(ee,O);f.v.scale(q,se.dir,ue)}}const Z=f.v.add(W,W,q);w._translateCameraConstrained(Z),O&&Math.abs(w.zoom-X)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,y,!0)}_fireEvents(l,h,y){const x=Cu(this._eventsInProgress),w=Cu(l),T={};for(const z in l){const{originalEvent:j}=l[z];this._eventsInProgress[z]||(T[`${z}start`]=j),this._eventsInProgress[z]=l[z]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const z in T)this._fireEvent(z,T[z]);w&&this._fireEvent("move",w.originalEvent);for(const z in l){const{originalEvent:j}=l[z];this._fireEvent(z,j)}const S={};let O;for(const z in this._eventsInProgress){const{handlerName:j,originalEvent:$}=this._eventsInProgress[z];this._handlersById[j].isActive()||(delete this._eventsInProgress[z],O=h[j]||$,S[`${z}end`]=O)}for(const z in S)this._fireEvent(z,S[z]);const k=Cu(this._eventsInProgress);if(y&&(x||w)&&!k){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=$=>0!==$&&-this._bearingSnap<$&&$<this._bearingSnap;z?(j(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:O})):(this._map.fire(new f.a8("moveend",{originalEvent:O})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,h){this._map.fire(new f.a8(l,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new Yf("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Jf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class G_ extends f.a6{constructor(l,h){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=!1!==h.respectPrefersReducedMotion,f.aR(["_renderFrameCallback"],this)}getCenter(){return new f.L(this.transform.center.lng,this.transform.center.lat)}setCenter(l,h){return this.jumpTo({center:l},h)}panBy(l,h,y){return l=f.P.convert(l).mult(-1),this.panTo(this.transform.center,f.ak({offset:l},h),y)}panTo(l,h,y){return this.easeTo(f.ak({center:l},h),y)}getZoom(){return this.transform.zoom}setZoom(l,h){return this.jumpTo({zoom:l},h),this}zoomTo(l,h,y){return this.easeTo(f.ak({zoom:l},h),y)}zoomIn(l,h){return this.zoomTo(this.getZoom()+1,l,h),this}zoomOut(l,h){return this.zoomTo(this.getZoom()-1,l,h),this}getBearing(){return this.transform.bearing}setBearing(l,h){return this.jumpTo({bearing:l},h),this}getPadding(){return this.transform.padding}setPadding(l,h){return this.jumpTo({padding:l},h),this}rotateTo(l,h,y){return this.easeTo(f.ak({bearing:l},h),y)}resetNorth(l,h){return this.rotateTo(0,f.ak({duration:1e3},l),h),this}resetNorthPitch(l,h){return this.easeTo(f.ak({bearing:0,pitch:0,duration:1e3},l),h),this}snapToNorth(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this}getPitch(){return this.transform.pitch}setPitch(l,h){return this.jumpTo({pitch:l},h),this}cameraForBounds(l,h){l=f.D.convert(l);const y=h&&h.bearing||0,x=h&&h.pitch||0,w=l.getNorthWest(),T=l.getSouthEast();return this._cameraForBounds(this.transform,w,T,y,x,h)}_extendCameraOptions(l){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(l=f.ak({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding){const y=l.padding;l.padding={top:y,bottom:y,right:y,left:y}}return l.padding=f.ak(h,l.padding),l}_minimumAABBFrustumDistance(l,h){const y=h.max[0]-h.min[0],x=h.max[1]-h.min[1];return y/x>l.aspect?y/(2*Math.tan(.5*l.fovX)*l.aspect):x/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,h,y,x,w,T){const S=l.clone(),O=this._extendCameraOptions(T);S.bearing=x,S.pitch=w;const k=f.L.convert(h),z=f.L.convert(y),j=.5*(k.lat+z.lat),$=.5*(k.lng+z.lng),G=f.cI(j,$),W=f.v.normalize([],G),X=f.v.normalize([],f.v.cross([],W,[0,1,0])),q=f.v.cross([],X,W),Z=[X[0],X[1],X[2],0,q[0],q[1],q[2],0,W[0],W[1],W[2],0,0,0,0,1],ee=[G,f.cI(k.lat,k.lng),f.cI(z.lat,k.lng),f.cI(z.lat,z.lng),f.cI(k.lat,z.lng),f.cI(j,k.lng),f.cI(j,z.lng),f.cI(k.lat,$),f.cI(z.lat,$)];let se=f.c3.fromPoints(ee.map(Me=>[f.v.dot(X,Me),f.v.dot(q,Me),f.v.dot(W,Me)]));const ue=f.v.transformMat4([],se.center,Z);0===f.v.squaredLength(ue)&&f.v.set(ue,0,0,1),f.v.normalize(ue,ue),f.v.scale(ue,ue,f.aC),S.center=f.cJ(ue);const K=S.getWorldToCameraMatrix(),ie=f.m.invert(new Float64Array(16),K);se=f.c3.applyTransform(se,f.m.multiply([],K,Z)),f.v.transformMat4(ue,ue,K);const he=.5*(se.max[2]-se.min[2]),ge=this._minimumAABBFrustumDistance(S,se),pe=f.v.scale([],[0,0,1],he),ye=f.v.add(pe,ue,pe),Ne=ge+(0===S.pitch?0:f.v.distance(ue,ye)),Ae=S.globeCenterInViewSpace,Oe=f.v.sub([],ue,[Ae[0],Ae[1],Ae[2]]);f.v.normalize(Oe,Oe),f.v.scale(Oe,Oe,Ne);const be=f.v.add([],ue,Oe);f.v.transformMat4(be,be,ie);const Ve=f.cL/f.aC,Re=f.v.length(be),Ge=f.b(Math.max(Re*Ve-f.cL,Number.EPSILON),0),re=Math.min(S.zoomFromMercatorZAdjusted(Ge),O.maxZoom);return re>.5*(f.Z+f.G)?(S.setProjection({name:"mercator"}),S.zoom=re,this._cameraForBounds(S,h,y,x,w,T)):{center:S.center,zoom:re,bearing:x,pitch:w}}queryTerrainElevation(l,h){const y=this.transform.elevation;return y?(h=f.ak({},{exaggerated:!0},h),y.getAtPoint(f.M.fromLngLat(l),null,h.exaggerated)):null}_cameraForBounds(l,h,y,x,w,T){if("globe"===l.projection.name)return this._cameraForBoundsOnGlobe(l,h,y,x,w,T);const S=l.clone(),O=this._extendCameraOptions(T),k=S.padding;S.bearing=x,S.pitch=w;const z=f.L.convert(h),j=f.L.convert(y),$=new f.L(z.lng,j.lat),G=new f.L(j.lng,z.lat),W=S.project(z),X=S.project(j),q=this.queryTerrainElevation(z),Z=this.queryTerrainElevation(j),ee=this.queryTerrainElevation($),se=this.queryTerrainElevation(G),ue=[[W.x,W.y,Math.min(q||0,Z||0,ee||0,se||0)],[X.x,X.y,Math.max(q||0,Z||0,ee||0,se||0)]];let K=f.c3.fromPoints(ue);const ie=S.getWorldToCameraMatrix(),he=f.m.invert(new Float64Array(16),ie);K=f.c3.applyTransform(K,ie);const ge=f.v.sub([],K.max,K.min),pe=k.left||0,ye=k.right||0,Ne=k.bottom||0,Ae=k.top||0,{left:Oe,right:be,top:Ve,bottom:Re}=O.padding,Ge=.5*(pe+ye),re=.5*(Ae+Ne),Me=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(pe+ye+Oe+be))/ge[0],(S.height-(Ne+Ae+Re+Ve))/ge[1])),O.maxZoom),tt=S.scale/S.zoomScale(Me);K=new f.c3([K.min[0]-(Oe+Ge)*tt,K.min[1]-(Re+re)*tt,K.min[2]],[K.max[0]+(be+Ge)*tt,K.max[1]+(Ve+re)*tt,K.max[2]]);const Xe=.5*ge[2],At=this._minimumAABBFrustumDistance(S,K),vt=[0,0,1,0];f.e.transformMat4(vt,vt,ie),f.e.normalize(vt,vt);const Vt=f.v.scale([],vt,At+Xe),xt=f.v.add([],K.center,Vt),Xt=("number"==typeof O.offset.x&&"number"==typeof O.offset.y?new f.P(O.offset.x,O.offset.y):f.P.convert(O.offset)).rotate(-f.d(x));K.center[0]-=Xt.x*tt,K.center[1]+=Xt.y*tt,f.v.transformMat4(K.center,K.center,he),f.v.transformMat4(xt,xt,he);const Yt=[K.center[0],K.center[1],xt[2]*S.pixelsPerMeter];f.v.scale(Yt,Yt,1/S.worldSize);const Lt=f.cK(Yt[0]),Ft=f.l(Yt[1]),zn=Math.min(S._zoomFromMercatorZ(Yt[2]),O.maxZoom),ke=new f.L(Lt,Ft);return S.mercatorFromTransition&&zn<.5*(f.Z+f.G)?(S.setProjection({name:"globe"}),S.zoom=zn,this._cameraForBounds(S,h,y,x,w,T)):{center:ke,zoom:zn,bearing:x,pitch:w}}fitBounds(l,h,y){const x=this.cameraForBounds(l,h);return this._fitInternal(x,h,y)}fitScreenCoordinates(l,h,y,x,w){const T=f.P.convert(l),S=f.P.convert(h),O=new f.P(Math.min(T.x,S.x),Math.min(T.y,S.y)),k=new f.P(Math.max(T.x,S.x),Math.max(T.y,S.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(T,S))return this;const z=this.transform.pointLocation3D(O),j=this.transform.pointLocation3D(k),$=this.transform.pointLocation3D(new f.P(O.x,k.y)),G=this.transform.pointLocation3D(new f.P(k.x,O.y)),W=[Math.min(z.lng,j.lng,$.lng,G.lng),Math.min(z.lat,j.lat,$.lat,G.lat)],X=[Math.max(z.lng,j.lng,$.lng,G.lng),Math.max(z.lat,j.lat,$.lat,G.lat)],q=x&&x.pitch?x.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,W,X,y,q,x);return this._fitInternal(Z,x,w)}_fitInternal(l,h,y){return l?(delete(h=f.ak(l,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this}jumpTo(l,h){this.stop();const y=l.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,T=!1;return"zoom"in l&&y.zoom!==+l.zoom&&(x=!0,y.zoom=+l.zoom),void 0!==l.center&&(y.center=f.L.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(w=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(T=!0,y.pitch=+l.pitch),null==l.padding||y.isPaddingEqual(l.padding)||(y.padding=l.padding),l.preloadOnly?(this._preloadTiles(y),this):(this.fire(new f.a8("movestart",h)).fire(new f.a8("move",h)),x&&this.fire(new f.a8("zoomstart",h)).fire(new f.a8("zoom",h)).fire(new f.a8("zoomend",h)),w&&this.fire(new f.a8("rotatestart",h)).fire(new f.a8("rotate",h)).fire(new f.a8("rotateend",h)),T&&this.fire(new f.a8("pitchstart",h)).fire(new f.a8("pitch",h)).fire(new f.a8("pitchend",h)),this.fire(new f.a8("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.X(Jf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,h){const y=this.transform;if(!y.projection.supportsFreeCamera)return f.X(Jf),this;this.stop();const x=y.zoom,w=y.pitch,T=y.bearing;y.setFreeCameraOptions(l);const S=x!==y.zoom,O=w!==y.pitch,k=T!==y.bearing;return this.fire(new f.a8("movestart",h)).fire(new f.a8("move",h)),S&&this.fire(new f.a8("zoomstart",h)).fire(new f.a8("zoom",h)).fire(new f.a8("zoomend",h)),k&&this.fire(new f.a8("rotatestart",h)).fire(new f.a8("rotate",h)).fire(new f.a8("rotateend",h)),O&&this.fire(new f.a8("pitchstart",h)).fire(new f.a8("pitch",h)).fire(new f.a8("pitchend",h)),this.fire(new f.a8("moveend",h)),this}easeTo(l,h){this._stop(!1,l.easeId),(!1===(l=f.ak({offset:[0,0],duration:500,easing:f.cG},l)).animate||this._prefersReducedMotion(l))&&(l.duration=0);const y=this.transform,x=this.getZoom(),w=this.getBearing(),T=this.getPitch(),S=this.getPadding(),O="zoom"in l?+l.zoom:x,k="bearing"in l?this._normalizeBearing(l.bearing,w):w,z="pitch"in l?+l.pitch:T,j="padding"in l?l.padding:y.padding,$=f.P.convert(l.offset);let G,W,X;if("globe"===y.projection.name){const pe=f.M.fromLngLat(y.center),ye=$.rotate(-y.angle);pe.x+=ye.x/y.worldSize,pe.y+=ye.y/y.worldSize;const Ne=pe.toLngLat(),Ae=f.L.convert(l.center||Ne);this._normalizeCenter(Ae),G=y.centerPoint.add(ye),W=new f.P(pe.x,pe.y).mult(y.worldSize),X=new f.P(f.E(Ae.lng),f.H(Ae.lat)).mult(y.worldSize).sub(W)}else{G=y.centerPoint.add($);const pe=y.pointLocation(G),ye=f.L.convert(l.center||pe);this._normalizeCenter(ye),W=y.project(pe),X=y.project(ye).sub(W)}const q=y.zoomScale(O-x);let Z,ee;l.around&&(Z=f.L.convert(l.around),ee=y.locationPoint(Z));const se=this._zooming||O!==x,ue=this._rotating||w!==k,K=this._pitching||z!==T,ie=!y.isPaddingEqual(j),he=pe=>ye=>{if(se&&(pe.zoom=f.n(x,O,ye)),ue&&(pe.bearing=f.n(w,k,ye)),K&&(pe.pitch=f.n(T,z,ye)),ie&&(pe.interpolatePadding(S,j,ye),G=pe.centerPoint.add($)),Z)pe.setLocationAtPoint(Z,ee);else{const Ne=pe.zoomScale(pe.zoom-x),Ae=O>x?Math.min(2,q):Math.max(.5,q),Oe=Math.pow(Ae,1-ye),be=pe.unproject(W.add(X.mult(ye*Oe)).mult(Ne));pe.setLocationAtPoint(pe.renderWorldCopies?be.wrap():be,G)}return l.preloadOnly||this._fireMoveEvents(h),pe};if(l.preloadOnly){const pe=this._emulate(he,l.duration,y);return this._preloadTiles(pe),this}const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=se,this._rotating=ue,this._pitching=K,this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,ge),this._ease(he(y),pe=>{"sea"===y.cameraElevationReference&&y.recenterOnTerrain(),this._afterEase(h,pe)},l),this}_prepareEase(l,h,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),h||y.moving||this.fire(new f.a8("movestart",l)),this._zooming&&!y.zooming&&this.fire(new f.a8("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new f.a8("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new f.a8("pitchstart",l))}_fireMoveEvents(l){this.fire(new f.a8("move",l)),this._zooming&&this.fire(new f.a8("zoom",l)),this._rotating&&this.fire(new f.a8("rotate",l)),this._pitching&&this.fire(new f.a8("pitch",l))}_afterEase(l,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,y&&this.fire(new f.a8("zoomend",l)),x&&this.fire(new f.a8("rotateend",l)),w&&this.fire(new f.a8("pitchend",l)),this.fire(new f.a8("moveend",l))}flyTo(l,h){if(this._prefersReducedMotion(l)){const Re=f.p(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Re,h)}this.stop(),l=f.ak({offset:[0,0],speed:1.2,curve:1.42,easing:f.cG},l);const y=this.transform,x=this.getZoom(),w=this.getBearing(),T=this.getPitch(),S="zoom"in l?f.c(+l.zoom,y.minZoom,y.maxZoom):x,O="bearing"in l?this._normalizeBearing(l.bearing,w):w,k="pitch"in l?+l.pitch:T,z=y.zoomScale(S-x),j=f.P.convert(l.offset),$=y.centerPoint.add(j),G=y.pointLocation($);let W=l.center;if(W&&l.padding){const Re=this._cameraForBounds(this.transform,W,W,O,k,l);Re&&(W=Re.center)}W=f.L.convert(W||G),this._normalizeCenter(W);const X=y.project(G),q=y.project(W).sub(X);let Z=l.curve;const ee=Math.max(y.width,y.height),se=ee/z,ue=q.mag();if("minZoom"in l){const Re=f.c(Math.min(l.minZoom,x,S),y.minZoom,y.maxZoom),Ge=ee/y.zoomScale(Re-x);Z=Math.sqrt(Ge/ue*2)}const K=Z*Z;function ie(Re){const Ge=(se*se-ee*ee+(Re?-1:1)*K*K*ue*ue)/(2*(Re?se:ee)*K*ue);return Math.log(Math.sqrt(Ge*Ge+1)-Ge)}function he(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function ge(Re){return(Math.exp(Re)+Math.exp(-Re))/2}const pe=ie(0);let ye=function(Re){return ge(pe)/ge(pe+Z*Re)},Ne=function(Re){return ee*((ge(pe)*(he(Ge=pe+Z*Re)/ge(Ge))-he(pe))/K)/ue;var Ge},Ae=(ie(1)-pe)/Z;if(Math.abs(ue)<1e-6||!isFinite(Ae)){if(Math.abs(ee-se)<1e-6)return this.easeTo(l,h);const Re=se<ee?-1:1;Ae=Math.abs(Math.log(se/ee))/Z,Ne=function(){return 0},ye=function(Ge){return Math.exp(Re*Z*Ge)}}l.duration="duration"in l?+l.duration:1e3*Ae/("screenSpeed"in l?+l.screenSpeed/Z:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Oe=w!==O,be=k!==T,Ve=Re=>Ge=>{const re=Ge*Ae,Me=1/ye(re);Re.zoom=1===Ge?S:x+Re.scaleZoom(Me),Oe&&(Re.bearing=f.n(w,O,Ge)),be&&(Re.pitch=f.n(T,k,Ge));const tt=1===Ge?W:Re.unproject(X.add(q.mult(Ne(re))).mult(Me));return Re.setLocationAtPoint(Re.renderWorldCopies?tt.wrap():tt,$),Re._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(h),Re};if(l.preloadOnly){const Re=this._emulate(Ve,l.duration,y);return this._preloadTiles(Re),this}return this._zooming=!0,this._rotating=Oe,this._pitching=be,this._prepareEase(h,!1),this._ease(Ve(y),()=>this._afterEase(h),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,h)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,h,y){!1===y.animate||0===y.duration?(l(1),h()):(this._easeStart=f.a4.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((f.a4.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,h){l=f.w(l,-180,180);const y=Math.abs(l-h);return Math.abs(l-360-h)<y&&(l-=360),Math.abs(l+360-h)<y&&(l+=360),l}_normalizeCenter(l){const h=this.transform;if(h.maxBounds||"globe"!==h.projection.name&&!h.renderWorldCopies)return;const y=l.lng-h.center.lng;l.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&f.a4.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,h,y){const x=Math.ceil(15*h/1e3),w=[],T=l(y.clone());for(let S=0;S<=x;S++){const O=T(S/x);w.push(O.clone())}return w}}class Lm{constructor(l={}){this.options=l,f.aR(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const h=this.options&&this.options.compact;return this._map=l,this._container=hn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=hn("button","mapboxgl-ctrl-attrib-button",this._container),hn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=hn("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,h){const y=this._map._getUIString(`AttributionControl.${h}`);l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.cM.ACCESS_TOKEN}];if(l){const y=h.reduce((x,w,T)=>(w.value&&(x+=`${w.key}=${w.value}${T<h.length-1?"&":""}`),x),"?");l.href=`${f.cM.FEEDBACK_URL}/${y}#${zi(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._mergedSourceCaches;for(const x in h){const w=h[x];if(w.used){const T=w.getSource();T.attribution&&l.indexOf(T.attribution)<0&&l.push(T.attribution)}}l.sort((x,w)=>x.length-w.length),l=l.filter((x,w)=>{for(let T=w+1;T<l.length;T++)if(l[T].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class km{constructor(){f.aR(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=hn("div","mapboxgl-ctrl");const h=hn("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&"metadata"!==l.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(0===Object.entries(l).length)return!0;for(const h in l){const y=l[h].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Kf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h}remove(l){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const x of y)if(x.id===l)return void(x.cancelled=!0)}run(l=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Qf(m,l,h){if(m=new f.L(m.lng,m.lat),l){const y=new f.L(m.lng-360,m.lat),x=new f.L(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-h.center.lng)/360),T=h.locationPoint(m).distSqr(l),S=l.x<0||l.y<0||l.x>h.width||l.y>h.height;h.locationPoint(y).distSqr(l)<T&&(S||Math.abs(y.lng-h.center.lng)<w)?m=y:h.locationPoint(x).distSqr(l)<T&&(S||Math.abs(x.lng-h.center.lng)<w)&&(m=x)}for(;Math.abs(m.lng-h.center.lng)>180;){const y=h.locationPoint(m);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const ep={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bi extends f.a6{constructor(l,h){if(super(),(l instanceof HTMLElement||h)&&(l=f.ak({element:l},h)),f.aR(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=f.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=hn("div");const w=41,T=27,S=Un("svg",{display:"block",height:w*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${w}`},this._element),O=Un("radialGradient",{id:"shadowGradient"},Un("defs",{},S));Un("stop",{offset:"10%","stop-opacity":.4},O),Un("stop",{offset:"100%","stop-opacity":.05},O),Un("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),Un("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),Un("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),Un("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=f.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const y=this._element.classList;for(const w in ep)y.remove(`mapboxgl-marker-anchor-${w}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const x=l&&l.className?l.className.trim().split(/\s+/):[];y.add(...x),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=f.L.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const h=l.code,y=l.charCode||l.keyCode;"Space"!==h&&"Enter"!==h&&32!==y&&13!==y||this.togglePopup()}_onMapClick(l){const h=l.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,h=this._pos;if(!l||!h)return!1;const y=l.unproject(h),x=l.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(y)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const h=this._pos;if(!h||h.x<0||h.x>l.transform.width||h.y<0||h.y>l.transform.height)return void this._clearFadeTimer();const y=l.unproject(h);let x;l._showingGlobe()&&f.cN(l.transform,this._lngLat)?x=0:(x=1-l._queryFogOpacity(y),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${l.x}px,${l.y}px)\n            ${ep[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const l=this._pos,h=this._map,y=this.getPitchAlignment();if(!h||!l||"map"!==y)return"";if(!h._showingGlobe()){const O=h.getPitch();return O?`rotateX(${O}deg)`:""}const x=f.Y(f.cO(h.transform,this._lngLat)),w=l.sub(f.cP(h.transform)),T=Math.abs(w.x)+Math.abs(w.y);if(0===T)return"";const S=x/T;return`rotateX(${-w.y*S}deg) rotateY(${w.x*S}deg)`}_calculateZTransform(){const l=this._pos,h=this._map;if(!h||!l)return"";let y=0;const x=this.getRotationAlignment();if("map"===x)if(h._showingGlobe()){const w=h.project(new f.L(this._lngLat.lng,this._lngLat.lat+.001)),T=h.project(new f.L(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);y=f.Y(Math.atan2(T.y,T.x))-90}else y=-h.getBearing();else if("horizon"===x){const w=f.an(4,6,h.getZoom()),T=f.cP(h.transform);T.y+=w*h.transform.height;const S=l.sub(T),O=f.Y(Math.atan2(S.y,S.x));y=(O>90?O-270:O+90)*(1-w)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Qf(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===l?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=f.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const h=this._map;if(!h)return;const y=this._pointerdownPos,x=this._positionDelta;if(y&&x){if(!this._isDragging){const w=this._clickTolerance||h._clickTolerance;if(l.point.dist(y)<w)return;this._isDragging=!0}this._pos=l.point.sub(x),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.a8("dragstart"))),this.fire(new f.a8("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.a8("dragend")),this._state="inactive"}_addDragHandler(l){const h=this._map,y=this._pos;h&&y&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(y),this._pointerdownPos=l.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const h=this._map;return h&&(l?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const tp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Fm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hh(m=new f.P(0,0),l="bottom"){if("number"==typeof m){const h=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(l){case"top":return new f.P(0,m);case"top-left":return new f.P(h,h);case"top-right":return new f.P(-h,h);case"bottom":return new f.P(0,-m);case"bottom-left":return new f.P(h,-h);case"bottom-right":return new f.P(-h,-h);case"left":return new f.P(m,0);case"right":return new f.P(-m,0)}return new f.P(0,0)}return m instanceof f.P||Array.isArray(m)?f.P.convert(m):f.P.convert(m[l]||[0,0])}class P0{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const h=f.ba((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,h,y){this._start=this.getValue(h),this._end=l,this._startTime=h,this._endTime=h+y}}const R0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},wa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class np{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.continuousRedraw=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Nm={showCompass:!0,showZoom:!0,visualizePitch:!1};class Kl{constructor(l,h,y=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Om({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,y&&(this.mousePitch=new vd({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),f.aR(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),io()}move(l,h){const y=this.map,x=this.mouseRotate.mousemoveWindow(l,h),w=x&&x.bearingDelta;if(w&&y.setBearing(y.getBearing()+w),this.mousePitch){const T=this.mousePitch.mousemoveWindow(l,h),S=T&&T.pitchDelta;S&&y.setPitch(y.getPitch()+S)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ba(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(f.ak({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),go(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,go(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=sa(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=sa(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ka={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Tu={maxWidth:100,unit:"metric"},dh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:f.c$,supported:ts,setRTLTextPlugin:f.d1,getRTLTextPluginStatus:f.d2,Map:class extends G_{constructor(m){const l=m;if(null!=(m=f.ak({},wa,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&f.cQ(window)&&(m.antialias=!1,f.X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Xn(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._repaint=!1,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Kf,this._domRenderTaskQueue=new Kf,this._controls=[],this._markers=[],this._popups=[],this._mapId=f.cR(),this._locale=f.ak({},R0,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new P0(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new f.cS(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?{...m.contextCreateOptions}:{},"string"==typeof m.container){const h=document.getElementById(m.container);if(!h)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=h}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&f.X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),f.aR(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new np,this._tp=m.devtools?new Ic(this):new Ic,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,h=>{this.repaint=h}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Lc(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||f.cM.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new Wo("string"==typeof m.hash&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==l.center&&null==l.zoom||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const h=m.bounds;h&&(this.resize(),this.fitBounds(h,f.ak({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Lm({customAttribution:m.customAttribution})),this._logoControl=new km,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update("style"===h.dataType),this.fire(new f.a8(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new f.a8(`${h.dataType}dataloading`,h))})}_getMapId(){return this._mapId}addControl(m,l){if(void 0===l&&(l=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new f.a7(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const y=this._controlPositions[l];return-1!==l.indexOf("bottom")?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new f.a7(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(m);return l>-1&&this._controls.splice(l,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new f.a8("movestart",m)).fire(new f.a8("move",m)),this.fire(new f.a8("resize",m)),l&&this.fire(new f.a8("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(f.D.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new f.a8("zoomstart")).fire(new f.a8("zoom")).fire(new f.a8("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new f.a8("zoomstart")).fire(new f.a8("zoom")).fire(new f.a8("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new f.a8("pitchstart")).fire(new f.a8("pitch")).fire(new f.a8("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new f.a8("pitchstart")).fire(new f.a8("pitch")).fire(new f.a8("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return"auto"===m?navigator.language:Array.isArray(m)?0===m.length?void 0:m.map(l=>"auto"===l?navigator.language:l):m}setLanguage(m){const l=this._parseLanguage(m);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(m){return this._lazyInitEmptyStyle(),m?"string"==typeof m&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const m=this.transform,l=m.projection.name;let h;"globe"===l&&m.zoom>=f.G?(m.setMercatorFromTransition(),h=!0):"mercator"===l&&m.zoom<f.G&&(m.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,l){return this._updateProjection(m||l||{name:"mercator"})}_updateProjection(m){let l;return l="globe"===m.name&&this.transform.zoom>=f.G?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m){return this.transform.locationPoint3D(f.L.convert(m))}unproject(m){return this.transform.pointLocation3D(f.P.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,l,h){if("mouseenter"===m||"mouseover"===m){let y=!1;const x=T=>{const S=l.filter(k=>this.getLayer(k)),O=S.length?this.queryRenderedFeatures(T.point,{layers:S}):[];O.length?y||(y=!0,h.call(this,new As(m,this,T.originalEvent,{features:O}))):y=!1},w=()=>{y=!1};return{layers:new Set(l),listener:h,delegates:{mousemove:x,mouseout:w}}}if("mouseleave"===m||"mouseout"===m){let y=!1;const x=T=>{const S=l.filter(O=>this.getLayer(O));(S.length?this.queryRenderedFeatures(T.point,{layers:S}):[]).length?y=!0:y&&(y=!1,h.call(this,new As(m,this,T.originalEvent)))},w=T=>{y&&(y=!1,h.call(this,new As(m,this,T.originalEvent)))};return{layers:new Set(l),listener:h,delegates:{mousemove:x,mouseout:w}}}{const y=x=>{const w=l.filter(S=>this.getLayer(S)),T=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];T.length&&(x.features=T,h.call(this,x),delete x.features)};return{layers:new Set(l),listener:h,delegates:{[m]:y}}}}on(m,l,h){if(void 0===h)return super.on(m,l);if(Array.isArray(l)||(l=[l]),l)for(const x of l)if(!this._isValidId(x))return this;const y=this._createDelegatedListener(m,l,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(y);for(const x in y.delegates)this.on(x,y.delegates[x]);return this}once(m,l,h){if(void 0===h)return super.once(m,l);if(Array.isArray(l)||(l=[l]),l)for(const x of l)if(!this._isValidId(x))return this;const y=this._createDelegatedListener(m,l,h);for(const x in y.delegates)this.once(x,y.delegates[x]);return this}off(m,l,h){if(void 0===h)return super.off(m,l);l=new Set(Array.isArray(l)?l:[l]);for(const w of l)if(!this._isValidId(w))return this;const y=(w,T)=>{if(w.size!==T.size)return!1;for(const S of w)if(!T.has(S))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[m]:void 0;return x&&(w=>{for(let T=0;T<w.length;T++){const S=w[T];if(S.listener===h&&y(S.layers,l)){for(const O in S.delegates)this.off(O,S.delegates[O]);return w.splice(T,1),this}}})(x),this}queryRenderedFeatures(m,l){if(!this.style)return[];if(void 0!==l||void 0===m||m instanceof f.P||Array.isArray(m)||(l=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers))for(const h of l.layers)if(!this._isValidId(h))return[];return this.style.queryRenderedFeatures(m,l,this.transform)}querySourceFeatures(m,l){return this._isValidId(m)?this.style.querySourceFeatures(m,l):[]}isPointOnSurface(m){const{name:l}=this.transform.projection;return"globe"!==l&&"mercator"!==l&&f.X(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(f.P.convert(m))}setStyle(m,l){return!1!==(l=f.ak({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(m,l))}_getUIString(m){const l=this._locale[m];if(null==l)throw new Error(`Missing UI string '${m}'`);return l}_updateStyle(m,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new Jr(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Jr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,l){if("string"==typeof m){const h=this._requestManager.normalizeStyleURL(m),y=this._requestManager.transformRequest(h,f.a2.Style);f.a1(y,(x,w)=>{x?this.fire(new f.a7(x)):w&&this._updateDiff(w,l)})}else"object"==typeof m&&this._updateDiff(m,l)}_updateDiff(m,l){try{this.style.setState(m)&&this._update(!0)}catch(h){f.X(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.X("There is no style added to the map."),!1)}_isValidId(m){return null==m?(this.fire(new f.a7(new Error("IDs can't be empty."))),!1):!f.cu(m)||(this.fire(new f.a7(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}addSource(m,l){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,l),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,l,h){this._lazyInitEmptyStyle(),this.style.addSourceType(m,l,h)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,l,{pixelRatio:h=1,sdf:y=!1,stretchX:x,stretchY:w,content:T}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:S,height:O,data:k}=f.a4.getImageData(l);this.style.addImage(m,{data:new f.a5({width:S,height:O},k),pixelRatio:h,stretchX:x,stretchY:w,content:T,sdf:y,version:0})}else if(void 0===l.width||void 0===l.height)this.fire(new f.a7(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:O}=l,k=l;this.style.addImage(m,{data:new f.a5({width:S,height:O},new Uint8Array(k.data)),pixelRatio:h,stretchX:x,stretchY:w,content:T,sdf:y,version:0,userImage:k}),k.onAdd&&k.onAdd(this,m)}}updateImage(m,l){this._lazyInitEmptyStyle();const h=this.style.getImage(m);if(!h)return void this.fire(new f.a7(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?f.a4.getImageData(l):l,{width:x,height:w}=y,T=y.data;if(void 0===x||void 0===w)return void this.fire(new f.a7(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==h.data.width||w!==h.data.height)return void this.fire(new f.a7(new Error(`The width and height of the updated image (${x}, ${w})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`)));const S=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);h.data.replace(T,S),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style&&!!this.style.getImage(m):(this.fire(new f.a7(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,l){f.a3(this._requestManager.transformRequest(m,f.a2.Image),(h,y)=>{l(h,y instanceof HTMLImageElement?f.a4.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(m,l){this._lazyInitEmptyStyle(),this.style.addModel(m,l)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new f.a7(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,l){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,l),this._update(!0)):this}moveLayer(m,l){return this._isValidId(m)?(this.style.moveLayer(m,l),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){return this._isValidId(m)?this.style.getOwnLayer(m):null}setLayerZoomRange(m,l,h){return this._isValidId(m)?(this.style.setLayerZoomRange(m,l,h),this._update(!0)):this}setFilter(m,l,h={}){return this._isValidId(m)?(this.style.setFilter(m,l,h),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,l,h,y={}){return this._isValidId(m)?(this.style.setPaintProperty(m,l,h,y),this._update(!0)):this}getPaintProperty(m,l){return this._isValidId(m)?this.style.getPaintProperty(m,l):null}setLayoutProperty(m,l,h,y={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,l,h,y),this._update(!0)):this}getLayoutProperty(m,l){return this._isValidId(m)?this.style.getLayoutProperty(m,l):null}getConfigProperty(m,l){return this.style.getConfigProperty(m,l)}setConfigProperty(m,l,h){return this.style.setConfigProperty(m,l,h),this._update(!0)}setLights(m){if(this._lazyInitEmptyStyle(),m&&1===m.length&&"flat"===m[0].type){const l=m[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return 0===m.length&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===m["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.L.convert(m),this.transform):0}setFeatureState(m,l){return this._isValidId(m.source)?(this.style.setFeatureState(m,l),this._update()):this}removeFeatureState(m,l){return this._isValidId(m.source)?(this.style.removeFeatureState(m,l),this._update()):this}getFeatureState(m){return this._isValidId(m.source)?this.style.getFeatureState(m):null}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let h,y,x,w=this._container;for(;w&&(!y||!x);){const T=window.getComputedStyle(w).transform;T&&"none"!==T&&(h=T.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(y=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(x=h[3])),w=w.parentElement}this._containerWidth=y?Math.abs(m/y):m,this._containerHeight=x?Math.abs(l/x):l}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=hn("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=hn("div","mapboxgl-canvas-container",m);this._canvas=hn("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=hn("div","mapboxgl-control-container",m),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{y[x]=hn("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,l){const h=f.a4.devicePixelRatio||1;this._canvas.width=h*Math.ceil(m),this._canvas.height=h*Math.ceil(l),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${l}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const l=this._markers.indexOf(m);-1!==l&&this._markers.splice(l,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const l=this._popups.indexOf(m);-1!==l&&this._popups.splice(l,1)}_setupPainter(){const m=f.ak({},ts.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",m);l?(f.cT(l,!0),this.painter=new vu(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),f.cU.testSupport(l)):this.fire(new f.a7(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.a8("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new f.a8("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let l;this.fire(new f.a8("renderstart"));const h=this.painter.context.extTimerQuery,y=f.a4.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=x.createQuery(),x.beginQuery(h.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,k=this.transform.pitch,z=f.a4.now(),j=new f.al(O,{now:z,fadeDuration:w,pitch:k,transition:this.style.transition});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(y),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.a8("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new f.a8("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const O=f.a4.now()-y;x.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const k=x.getQueryParameter(l,x.QUERY_RESULT)/1e6;x.deleteQuery(l),this.fire(new f.a8("gpu-timing-frame",{cpuTime:O,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const O=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(O);this.fire(new f.a8("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(O);this.fire(new f.a8("gpu-timing-deferred-render",{gpuTime:k}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(S||this._repaint)this.triggerRepaint();else{const O=!this.isMoving()&&this.loaded();if(O&&(T=this._updateAverageElevation(y,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new f.a8("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new f.a8("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._performanceMetricsCollection&&f.cV(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const l of this._markers)m&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!m||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(m,l=!1){const h=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(l||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const x=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=m;const T=Math.abs(x-w);if(T>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(w),h(w);this._averageElevation.easeTo(w,m,300)}else if(T>1e-4)return this._averageElevation.jumpTo(w),h(w)}return!!this._averageElevation.isEasing(m)&&h(this._averageElevation.getValue(m))}_authenticate(){f.cW(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===f.cX||401===m.status)){const l=this.painter.context.gl;f.cT(l,!1),this._logoControl instanceof km&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.a7(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.cY(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const h=this.painter.context.gl,y=h.createFramebuffer();function x(w){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,w,0);const T=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,T),T}return h.bindFramebuffer(h.FRAMEBUFFER,y),this._canvasPixelComparison(x(m),l.canvasCopies.map(x),l.timeStamps)}_canvasPixelComparison(m,l,h){let y=h[1]-h[0];const x=m.length/4;for(let w=0;w<l.length;w++){const T=l[w];let S=0;for(let O=0;O<T.length;O+=4)T[O]===m[O]&&T[O+1]===m[O+1]&&T[O+2]===m[O+2]&&T[O+3]===m[O+3]&&(S+=1);y+=(h[w+2]-h[w+1])*(1-S/x)}return y}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),f.cZ(this.painter.context.gl),this._removed=!0,this.fire(new f.a8("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=f.a4.frame(l=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(l)}))}_preloadTiles(m){const l=this.style?Object.values(this.style._sourceCaches):[];return f.c_(l,(h,y)=>h._preloadTiles(m,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,l){f.d0(m,l)}get version(){return f.c$}},NavigationControl:class{constructor(m){this.options=f.ak({},Nm,m),this._container=hn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(f.aR(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),hn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),hn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.aR(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:l}):h.resetNorth({},{originalEvent:l}))}),this._compassIcon=hn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const l=m.getZoom(),h=l===m.getMaxZoom(),y=l===m.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Kl(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,l){const h=hn("button",m,this._container);return h.type="button",h.addEventListener("click",l),h}_setButtonTitle(m,l){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${l}`);m.setAttribute("aria-label",h),m.firstElementChild&&m.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends f.a6{constructor(m){super();const l=navigator.geolocation;this.options=f.ak({geolocation:l},Ka,m),f.aR(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Pc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=hn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const l=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,m(h)};void 0!==this._supportsGeolocation?m(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(h=>l("denied"!==h.state)).catch(()=>l()):l()}_isOutOfMapMaxBounds(m){const l=this._map.getMaxBounds(),h=m.coords;return!!l&&(h.longitude<l.getWest()||h.longitude>l.getEast()||h.latitude<l.getSouth()||h.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new f.a8("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new f.a8("geolocate",m)),this._finish()}}_updateCamera(m){const l=new f.L(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,y=this._map.getBearing(),x=f.ak({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(h),x,{geolocateSource:!0})}_updateMarker(m){if(m){const l=new f.L(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,l=f.b(1,m._center.lat)*m.worldSize,h=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new f.a8("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=hn("button","mapboxgl-ctrl-geolocate",this._container),hn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){f.X("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=hn("div","mapboxgl-user-location"),this._dotElement.appendChild(hn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(hn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bi({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=hn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.a8("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.a8("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.a8("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.a8("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(l=>{"granted"===l&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lm,ScaleControl:class{constructor(m){this.options=f.ak({},Tu,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),f.aR(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,l=this._map,h=l._containerHeight/2,y=l._containerWidth/2-m/2,x=l.unproject([y,h]),w=l.unproject([y+m,h]),T=x.distanceTo(w);if("imperial"===this.options.unit){const S=3.2808*T;S>5280?this._setScale(m,S/5280,"mile"):this._setScale(m,S,"foot")}else"nautical"===this.options.unit?this._setScale(m,T/1852,"nautical-mile"):T>=1e3?this._setScale(m,T/1e3,"kilometer"):this._setScale(m,T,"meter")}_setScale(m,l,h){this._map._requestDomTask(()=>{const y=function(w){const T=Math.pow(10,`${Math.floor(w)}`.length-1);let S=w/T;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(O){const k=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*k)/k}(S),T*S}(l),x=y/l;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(y):`${y}&nbsp;${dh[h]}`,this._container.style.width=m*x+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=hn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:f.X("Full screen control 'container' must be a DOM element.")),f.aR(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=hn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=hn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);hn("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.a6{constructor(m){super(),this.options=f.ak(Object.create(tp),m),f.aR(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new f.a8("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new f.a8("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=f.L.convert(m),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const l=document.createDocumentFragment(),h=document.createElement("body");let y;for(h.innerHTML=m;y=h.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=hn("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(m),this.options.closeButton){const h=this._closeButton=hn("button","mapboxgl-popup-close-button",l);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let l;return this._classList.delete(m)?l=!1:(this._classList.add(m),l=!0),this._updateClassList(),l}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const l=this._map,h=this._container,y=this._pos;if(!l||!h||!y)return"bottom";const x=h.offsetWidth,w=h.offsetHeight,T=y.x<x/2,S=y.x>l.transform.width-x/2;if(y.y+m<w)return T?"top-left":S?"top-right":"top";if(y.y>l.transform.height-w){if(T)return"bottom-left";if(S)return"bottom-right"}return T?"left":S?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),m.className=l.join(" ")}_update(m){const l=this._map,h=this._content;if(!l||!this._lngLat&&!this._trackPointer||!h)return;let y=this._container;if(y||(y=this._container=hn("div","mapboxgl-popup",l.getContainer()),this._tip=hn("div","mapboxgl-popup-tip",y),y.appendChild(h)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qf(this._lngLat,this._pos,l.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m?m:l.project(this._lngLat),w=hh(this.options.offset),T=this._anchor=this._getAnchor(w.y),S=hh(this.options.offset,T),O=x.add(S).round();l._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${ep[T]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&l._showingGlobe()){const x=f.cN(l.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Fm);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Bi,Style:Jr,LngLat:f.L,LngLatBounds:f.D,Point:f.P,MercatorCoordinate:f.M,FreeCameraOptions:Gi,Evented:f.a6,config:f.cM,prewarm:f.d3,clearPrewarmedResources:f.d4,get accessToken(){return f.cM.ACCESS_TOKEN},set accessToken(m){f.cM.ACCESS_TOKEN=m},get baseApiUrl(){return f.cM.API_URL},set baseApiUrl(m){f.cM.API_URL=m},get workerCount(){return f.d5.workerCount},set workerCount(m){f.d5.workerCount=m},get maxParallelImageRequests(){return f.cM.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){f.cM.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){f.d6(m)},get workerUrl(){return f.d7.workerUrl},set workerUrl(m){f.d7.workerUrl=m},get workerClass(){return f.d7.workerClass},set workerClass(m){f.d7.workerClass=m},get workerParams(){return f.d7.workerParams},set workerParams(m){f.d7.workerParams=m},get dracoUrl(){return f.d8()},set dracoUrl(m){f.d9(m)},setNow:f.a4.setNow,restoreNow:f.a4.restoreNow}}),zr}()}},kf=>{kf(kf.s=985)}]);